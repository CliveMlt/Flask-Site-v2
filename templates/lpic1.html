<!DOCTYPE html>
<html lang="en">
    
<link href="{{url_for('static', filename='css/lpic1.css')}}" rel="stylesheet">

<h2 class="code-line" data-line-start=7 data-line-end=8 ><a id="Clive_Micallef_7"></a>Clive Micallef</h2>
<h1 class="code-line" data-line-start=9 data-line-end=10 ><a id="LPIC1_System_Administrator_9"></a>LPIC-1: System Administrator</h1>
<h2 class="code-line" data-line-start=13 data-line-end=14 ><a id="Table_of_Contents_13"></a>Table of Contents</h2>
<ul>
<li class="has-line-data" data-line-start="15" data-line-end="16">LPIC-1 Exam</li>
<li class="has-line-data" data-line-start="16" data-line-end="17">LPIC – 1 – Exam</li>
<li class="has-line-data" data-line-start="17" data-line-end="18">101.1 – Determine and configure hardware settings –</li>
<li class="has-line-data" data-line-start="18" data-line-end="19">101.2 – Boot the system –</li>
<li class="has-line-data" data-line-start="19" data-line-end="20">101.3 – Change runlevels / boot targets and shutdown or reboot system –</li>
<li class="has-line-data" data-line-start="20" data-line-end="21">102.1 - Design hard disk layout -</li>
<li class="has-line-data" data-line-start="21" data-line-end="22">102.2 – Install a Boot Manager –</li>
<li class="has-line-data" data-line-start="22" data-line-end="23">102.3 – Manage Shared Libraries -</li>
<li class="has-line-data" data-line-start="23" data-line-end="24">102.4 - Use Debian Package Management –</li>
<li class="has-line-data" data-line-start="24" data-line-end="25">102.5 - Use RPM and YUM package management –</li>
<li class="has-line-data" data-line-start="25" data-line-end="26">102.6 – Linux as a virtualization guest –</li>
<li class="has-line-data" data-line-start="26" data-line-end="27">103.1 – Work on the command line –</li>
<li class="has-line-data" data-line-start="27" data-line-end="28">103.2 – Process text streams using filters –</li>
<li class="has-line-data" data-line-start="28" data-line-end="29">103.3 – Perform basic file management –</li>
<li class="has-line-data" data-line-start="29" data-line-end="30">103.4 – Use streams, pipes and redirects -</li>
<li class="has-line-data" data-line-start="30" data-line-end="31">103.5 – Create, Monitor and Kill Processes -</li>
<li class="has-line-data" data-line-start="31" data-line-end="32">103.6 – Modify process execution priorities –</li>
<li class="has-line-data" data-line-start="32" data-line-end="33">103.7 – Search text files using regular expressions -</li>
<li class="has-line-data" data-line-start="33" data-line-end="34">103.8 – Perform basic file editing operations using vi -</li>
<li class="has-line-data" data-line-start="34" data-line-end="35">104.1 – Create partitions and filesystems –</li>
<li class="has-line-data" data-line-start="35" data-line-end="36">104.2 – Maintain the Integrity of Filesystems –</li>
<li class="has-line-data" data-line-start="36" data-line-end="37">104.3 – Control mounting and unmounting of filesystems –</li>
<li class="has-line-data" data-line-start="37" data-line-end="38">104.5 – Manage file permissions and ownership –</li>
<li class="has-line-data" data-line-start="38" data-line-end="39">104.6 – Create and change hard and symbolic links –</li>
<li class="has-line-data" data-line-start="39" data-line-end="40">104.7 – Find system files and place files in the correct location –</li>
<li class="has-line-data" data-line-start="40" data-line-end="41">LPIC – 1 – Exam 102</li>
<li class="has-line-data" data-line-start="41" data-line-end="42">105.1 - Customize and use the shell environment Weight -</li>
<li class="has-line-data" data-line-start="42" data-line-end="43">105.2 - Customize or write simple scripts -</li>
<li class="has-line-data" data-line-start="43" data-line-end="44">105.3 - SQL data management -</li>
<li class="has-line-data" data-line-start="44" data-line-end="45">106.1 - Install and configure X11 -</li>
<li class="has-line-data" data-line-start="45" data-line-end="46">106.2 - Setup a display manager -</li>
<li class="has-line-data" data-line-start="46" data-line-end="47">106.3 - Accessibility -</li>
<li class="has-line-data" data-line-start="47" data-line-end="48">107.1 - Manage user and group accounts and related system files -</li>
<li class="has-line-data" data-line-start="48" data-line-end="49">107.2 - Automate system administration tasks by scheduling jobs -</li>
<li class="has-line-data" data-line-start="49" data-line-end="50">107.3 Localization and internationalization -</li>
<li class="has-line-data" data-line-start="50" data-line-end="51">108.1 - Maintain system time -</li>
<li class="has-line-data" data-line-start="51" data-line-end="52">108.2 - System logging -</li>
<li class="has-line-data" data-line-start="52" data-line-end="53">108.3 Mail Transfer Agent (MTA) basics -</li>
<li class="has-line-data" data-line-start="53" data-line-end="54">108.4 - Manage printers and printing -</li>
<li class="has-line-data" data-line-start="54" data-line-end="55">109.1 - Fundamentals of internet protocols -</li>
<li class="has-line-data" data-line-start="55" data-line-end="56">109.2 - Basic network configuration -</li>
<li class="has-line-data" data-line-start="56" data-line-end="57">109.3 - Basic network troubleshooting -</li>
<li class="has-line-data" data-line-start="57" data-line-end="58">109.4 Configure client-side DNS -</li>
<li class="has-line-data" data-line-start="58" data-line-end="59">110.1 - Perform security administration tasks -</li>
<li class="has-line-data" data-line-start="59" data-line-end="60">110.2 - Setup host security -</li>
<li class="has-line-data" data-line-start="60" data-line-end="61">110.3 - Securing data with encryption -</li>
</ul>
<p class="has-line-data" data-line-start="64" data-line-end="65"><strong>101.1 – Determine and configure hardware settings – 2</strong></p>
<p class="has-line-data" data-line-start="66" data-line-end="67"><strong>Utilities used to Manage Devices</strong></p>
<p class="has-line-data" data-line-start="68" data-line-end="69"><strong>HAL</strong> - Hardware Abstraction Layer</p>
<p class="has-line-data" data-line-start="70" data-line-end="72">It abstracts your hardware details from you, say and first network care will be eth0. This way Linux will<br>
see any hardware as a standard hardware and you will be able to replace the hardware easily.</p>
<ul>
<li class="has-line-data" data-line-start="73" data-line-end="76"><strong>D-Bus</strong> - A daemon. D-Bus stands for “Desktop Bus.” Enables processes to communicate with<br>
each other and be aware of events occurring on the computer system. (Memory tag: “We all sat<br>
on Da-Bus, and had a good conversation as people got on and off.”)</li>
<li class="has-line-data" data-line-start="76" data-line-end="78"><strong>HAL Daemon (hald)</strong> - HAL stands for “Hardware Access Layer.” Provides information to other<br>
programs about the hardware available on the running Linux system.</li>
<li class="has-line-data" data-line-start="78" data-line-end="79"><strong>hdparm /dev/device_name</strong> - Displays information about a denoted hard drive (device_name).</li>
<li class="has-line-data" data-line-start="79" data-line-end="80"><strong>hwinfo</strong> - Displays system hardware information (an overview).</li>
<li class="has-line-data" data-line-start="80" data-line-end="82"><strong>Sysfs</strong> - virtual filesystem mounted at /sys, which contains device information. (Memory tag: <strong>Sys</strong> -<br>
system device info. fs = file system)</li>
<li class="has-line-data" data-line-start="82" data-line-end="85"><strong>udev</strong> - Configured in the /etc/udev files it creates dynamic device files as devices; mounts it and<br>
configures it as needed; and alerts other processes.</li>
</ul>
<p class="has-line-data" data-line-start="85" data-line-end="86"><strong>Files to know:</strong></p>
<p class="has-line-data" data-line-start="87" data-line-end="100">Note: All can be displayed with the cat command.<br>
<strong>/proc/bus/devices</strong> - USB devices on computer system<br>
<strong>/proc/cpuinfo</strong> - system CPU information<br>
<strong>/proc/devices</strong> - devices installed on computer system<br>
<strong>/proc/dma</strong> - Direct Memory Addressing (DMA) channels currently used by the Linux system<br>
<em><em>/proc/ide/</em>.</em>** - Files with information on the IDE devices on computer system.<br>
<strong>/proc/interrupts</strong> - IRQ’s being used currently by the Linux system (not used if no driver loaded for<br>
device).<br>
<strong>/proc/iomem</strong> - I/O ports assigned on computer system<br>
<strong>/proc/modules</strong> - Kernel modules used on system<br>
<em><em>/proc/scsi/</em>.</em>** - Files with information on the SCSI devices on computer system.<br>
<strong>/proc/version</strong> - Kernel version<br>
<strong>/proc/partitions</strong> - Contains major and minor numbers of each partition as well as number of blocks and</p>
<p class="has-line-data" data-line-start="101" data-line-end="102">partition name</p>
<ul>
<li class="has-line-data" data-line-start="103" data-line-end="104">
<p class="has-line-data" data-line-start="103" data-line-end="104"><strong>/dev</strong> directory lists devices as file system</p>
</li>
<li class="has-line-data" data-line-start="104" data-line-end="105">
<p class="has-line-data" data-line-start="104" data-line-end="105">contains files representing device access points</p>
</li>
<li class="has-line-data" data-line-start="105" data-line-end="107">
<p class="has-line-data" data-line-start="105" data-line-end="106">devices include, terminal devices (tty), floppy (fd), hard disks (hd, sd), RAM (ram), cdrom (cd)</p>
</li>
<li class="has-line-data" data-line-start="107" data-line-end="109">
<p class="has-line-data" data-line-start="107" data-line-end="109">Examples: <strong>/dev/sda</strong> designates first hard disk, /dev/sda1 designates first partition on first hard<br>
disk</p>
</li>
<li class="has-line-data" data-line-start="109" data-line-end="111">
<p class="has-line-data" data-line-start="109" data-line-end="111">Hard disks listed in /dev do not necessarily start with sd: they can start with hd, fd, or even some<br>
other letter-combination</p>
</li>
<li class="has-line-data" data-line-start="111" data-line-end="113">
<p class="has-line-data" data-line-start="111" data-line-end="113"><strong>/dev/initrd</strong> is the initial RAM disk loaded by the bootloader. Newer kernels list RAM disks as<br>
/dev/ram0, /dev/ram1, …</p>
</li>
<li class="has-line-data" data-line-start="113" data-line-end="115">
<p class="has-line-data" data-line-start="113" data-line-end="114">file --special-files /dev/sda shows partitions and startheads and startsectors of the partitions</p>
</li>
</ul>
<p class="has-line-data" data-line-start="115" data-line-end="116"><strong>Coldplug vs Hotplug Device</strong></p>
<p class="has-line-data" data-line-start="117" data-line-end="118"><strong>Hotplug</strong> is when you insert hardware into a running computer and <strong>Coldplug</strong> is when you have to turn</p>
<p class="has-line-data" data-line-start="119" data-line-end="121">your computer off to install hardware. USB devices are hot pluggable while PCI cards should be cold-<br>
plugged.</p>
<p class="has-line-data" data-line-start="122" data-line-end="126"><strong>PCI Cards</strong><br>
Peripheral Component Interconnect (PCI) - Typically Plug and Play (PnP) devices.<br>
<strong>lspci</strong> - command that displays info about PCI busses on system &amp; devices connected to the busses.<br>
<strong>lspci</strong> - k shows the kernel modules associated with each device.</p>
<p class="has-line-data" data-line-start="127" data-line-end="134"><strong>USB Devices</strong><br>
Universal Serial Bus (USB) - protocol and hardware port for moving data to/from devices.<br>
Protocol Standards:<br>
1 - up to 127 devices. up to 120 Mbps data transfer<br>
2 - up to 480 Mbps (4 x Standard 1)<br>
3 - up to 4.8 Gbps (1,000 x Standard 2)<br>
<strong>lsusb</strong> - Display information about USB devices on computer system.</p>
<p class="has-line-data" data-line-start="135" data-line-end="139"><strong>SCSI Devices</strong><br>
Replaced (though some older systems still have them) IDE drives.<br>
<strong>sg_scan -</strong> Scans SCSI bus and shows all SCSI devices.<br>
<strong>sginfo -l</strong> - Shows all SCSI devices</p>
<p class="has-line-data" data-line-start="140" data-line-end="141"><strong>modprobe</strong> to add and remove modules from the Linux Kernel</p>
<p class="has-line-data" data-line-start="142" data-line-end="143"><strong>101. 2 – Boot the system – 3</strong></p>
<p class="has-line-data" data-line-start="144" data-line-end="145"><strong>Linux Boot Steps</strong></p>
<p class="has-line-data" data-line-start="146" data-line-end="148">Note: These are the basic steps. However, the exam expects you to know “the flow” of the boot process.<br>
The steps can be broken up in various ways. Thus “Step 4” is not always as listed below.</p>
<h3 class="code-line" data-line-start=149 data-line-end=150 ><a id="BIOS_149"></a>BIOS</h3>
<pre><code class="has-line-data" data-line-start="152" data-line-end="157">1) Power-On Self-Test (POST)
2) Determines the first bootable device found in bootable media list (found in CMOS).
3) Find the Master Boot Record (MBR) in the first sector of the device (called the &quot;boot sector&quot;),
and loads the bootloader software into memory (RAM).
</code></pre>
<p class="has-line-data" data-line-start="158" data-line-end="163"><strong>Bootloader<br>
4)</strong> Creates a virtual temporary “disk” (ramdisk) in memory (RAM). The “disk” is actually a<br>
filesystem called “initrd image.”<br>
<strong>5)</strong> Loads the Linux kernel into memory (file name is: /boot/vmlinuz-version.gz, where version is<br>
the current version number of the kernel).</p>
<p class="has-line-data" data-line-start="164" data-line-end="165"><strong>Linux Kernel</strong></p>
<ol start="6">
<li class="has-line-data" data-line-start="165" data-line-end="166">Mounts the filesystem</li>
<li class="has-line-data" data-line-start="166" data-line-end="167">Loads and starts the init daemon (mother of all the other Linux processes) init Daemon</li>
<li class="has-line-data" data-line-start="167" data-line-end="170">Starts up daemons, etc. (Note: This step has changed dramatically recently. As is covered in<br>
more detail in objective 101.3)</li>
</ol>
<p class="has-line-data" data-line-start="170" data-line-end="175"><strong>Bootloader</strong><br>
Bootloader can be <strong>GRUB</strong> (1&amp;2) or <strong>LILO</strong> which are great for disks less than 2TB.<br>
/etc/lilo.conf<br>
/boot/grub/grub.cfg<br>
/boot/grub/menu.lst</p>
<h3 class="code-line" data-line-start=176 data-line-end=177 ><a id="LILO_176"></a>LILO</h3>
<ul>
<li class="has-line-data" data-line-start="178" data-line-end="182">configuration file: /etc/lilo.conf<br>
Important: After change /etc/lilo.conf you must enter the command lilo at the shell prompt (restarts<br>
LILO) so the changes will take effect! If you don’t, they won’t!</li>
</ul>
<h3 class="code-line" data-line-start=182 data-line-end=183 ><a id="GRUB_182"></a>GRUB</h3>
<p class="has-line-data" data-line-start="184" data-line-end="189">GRUB Stages<br>
1 - Stored on MBR. Points simply to stage 1.5 or state 2.<br>
1.5 - Stored after MBR, but before first partition. Contains drivers needed to load Stage 2.<br>
2 - Stored on disk partition. Shows a menu which allows selection of the kernel image to be loaded.<br>
(Menu is from configuration file)</p>
<p class="has-line-data" data-line-start="190" data-line-end="193"><strong>GRUB Configuration Files</strong><br>
/boot/grub/grub.conf (Fedora distribution).<br>
/boot/grub/menu.lst (Debian or SUSE distribution)</p>
<p class="has-line-data" data-line-start="194" data-line-end="198"><strong>How to Install Grub on Boot Device of Your Choice</strong><br>
Issue the command: grub-install device<br>
Example: grub-install /dev/sda<br>
<strong>Also can be more specific examples:</strong></p>
<p class="has-line-data" data-line-start="199" data-line-end="201">grub-install --root-directory=/boot hd0 (1st hard drive)<br>
grub-install --root-directory=/boot hd1 (2nd hard drive)</p>
<p class="has-line-data" data-line-start="202" data-line-end="204"><strong>Kernel Modules<br>
General Kernel Module Notes</strong></p>
<ul>
<li class="has-line-data" data-line-start="205" data-line-end="206">Kernel modules are automatically loaded at boot time from the /etc/modprobe.d/dist.conf file.</li>
<li class="has-line-data" data-line-start="206" data-line-end="207">(Hardware vendors can add their own .conf files to this directory for module loading).</li>
<li class="has-line-data" data-line-start="207" data-line-end="208">The /etc/modprobe.d/blacklist.conf contains a list of modules that are preventing from being</li>
<li class="has-line-data" data-line-start="208" data-line-end="209">loaded, even if they are listed in another file in the /etc/modprobe.d directory.</li>
<li class="has-line-data" data-line-start="209" data-line-end="210">Kernel components are stored in the /usr/kernel.</li>
<li class="has-line-data" data-line-start="210" data-line-end="212">Kernel source code is stored in /usr/src</li>
</ul>
<p class="has-line-data" data-line-start="212" data-line-end="220"><strong>Kernel Module Commands<br>
lsmod</strong> = shows information about what kernel modules are currently loaded on the system. (Basically<br>
displays the contents of /proc/modules file.)<br>
<strong>insmod</strong> = inserts (loads) a single module into the kernel. (needs the full module file name which ends in<br>
.mo)<br>
<strong>modprobe</strong> = loads a single module into the kernel (just needs the module name)<br>
configuration file = <strong>/etc/modprobe.conf</strong><br>
options:</p>
<ul>
<li class="has-line-data" data-line-start="221" data-line-end="222">C = Change the configuration file</li>
<li class="has-line-data" data-line-start="222" data-line-end="223">f = force a module load</li>
<li class="has-line-data" data-line-start="223" data-line-end="224">l = list all available modules (similar to lsmod)</li>
<li class="has-line-data" data-line-start="224" data-line-end="225">n = no actual load. Performs the necessary checks, etc.</li>
<li class="has-line-data" data-line-start="225" data-line-end="226">r = remove a module</li>
<li class="has-line-data" data-line-start="226" data-line-end="228">v = verbose</li>
</ul>
<p class="has-line-data" data-line-start="228" data-line-end="229"><strong>rmmod</strong> = removes a kernel module</p>
<p class="has-line-data" data-line-start="230" data-line-end="233"><strong>Kernel</strong><br>
Kernel parameters (sometimes called boot parameters) supply the kernel with information about<br>
hardware parameters that it might not determine on its own - say single user mod boot (S)</p>
<p class="has-line-data" data-line-start="234" data-line-end="238"><strong>init</strong><br>
When the kernel finishes loading, it usually starts /sbin/init. This program remains running until the<br>
system is shut down. It is always assigned process ID 1.<br>
first process, process in charge, a big family tree of commands:</p>
<p class="has-line-data" data-line-start="239" data-line-end="242"><strong>pstree</strong><br>
init is being replaced in many distros (say ubuntu with upstart) but still is in exam and has its own<br>
section.</p>
<p class="has-line-data" data-line-start="243" data-line-end="246"><strong>Dmesg</strong><br>
dmesg command will show the full data from kernel ring buffer up to now. But<br>
cat /var/log/dmesg - will show only the data during the boot</p>
<p class="has-line-data" data-line-start="247" data-line-end="250"><strong>/var/log/messages</strong><br>
After the init process comes up, syslog daemon will log messages. It has timestamps and will persist<br>
during restarts.</p>
<ul>
<li class="has-line-data" data-line-start="251" data-line-end="252">Kernel is still logging its own messages in dmesg</li>
<li class="has-line-data" data-line-start="252" data-line-end="253">in some systems it might be called /var/log/syslog</li>
<li class="has-line-data" data-line-start="253" data-line-end="256">there are many other logs at /var/log<br>
<strong>101. 3 – Change runlevels / boot targets and shutdown or reboot system – 3</strong></li>
</ul>
<p class="has-line-data" data-line-start="256" data-line-end="257"><strong>Different Start-ups</strong></p>
<ul>
<li class="has-line-data" data-line-start="258" data-line-end="259"><strong>SysV</strong> (legacy but still popular. Focus on this one!)</li>
<li class="has-line-data" data-line-start="259" data-line-end="260"><strong>Upstart</strong> (who uses it? <strong>Ubuntu</strong> )</li>
<li class="has-line-data" data-line-start="260" data-line-end="262"><strong>systemd</strong> (who uses it? <strong>Fedora</strong> v15 &amp; up, <strong>OpenSUSE</strong> 12.1 &amp; up, and eventually <strong>Red Hat</strong> )</li>
</ul>
<p class="has-line-data" data-line-start="262" data-line-end="270"><strong>Runlevels</strong><br>
0 - halt<br>
1or S- Single User Mode<br>
2 - Multi-user, no network<br>
3 - Multi-user, network<br>
4 - User-defined<br>
5 - Multi-user, network, GUI<br>
6 – reboot</p>
<p class="has-line-data" data-line-start="271" data-line-end="275"><strong>Set the default runlevel<br>
SysV:</strong><br>
/etc/inittab file, and line is formatted as follows:<br>
id:#:initdefault:</p>
<h1 class="code-line" data-line-start=276 data-line-end=277 ><a id="is_replaced_by_the_default_runlevel_number_276"></a>is replaced by the default runlevel number</h1>
<p class="has-line-data" data-line-start="278" data-line-end="282"><strong>Upstart:</strong><br>
Note: same as above (for some distributions moving to Upstart)<br>
/etc/init/rc-sysinit.conf file, and lines is formatted as follows:<br>
env DEFAULT_RUNLEVEL=#</p>
<h1 class="code-line" data-line-start=283 data-line-end=284 ><a id="is_replaced_by_the_default_runlevel_number_283"></a>is replaced by the default runlevel number</h1>
<p class="has-line-data" data-line-start="285" data-line-end="291"><strong>systemd:</strong><br>
Note: systemd uses the term “target unit” instead of “runlevel”<br>
Default target unit set via a symbolic link command as follows:<br>
ln -sf /lib/systemd/system/runlevel#.target /etc/systemd/system/default.target<br>
Note: the f option on the symbolic link command, forces any current symbolic link to be broken and the<br>
new designated symbolic link to be enforced).</p>
<p class="has-line-data" data-line-start="292" data-line-end="295"><strong>Startup shell script locations<br>
SysV:</strong><br>
Three possible locations (depending upon the distribution):</p>
<ul>
<li class="has-line-data" data-line-start="296" data-line-end="297">/etc/rc.d</li>
<li class="has-line-data" data-line-start="297" data-line-end="298">/etc/init.d</li>
<li class="has-line-data" data-line-start="298" data-line-end="300">/etc/rc.d/init.d</li>
</ul>
<p class="has-line-data" data-line-start="300" data-line-end="304"><strong>Upstart:</strong><br>
No startup scripts.<br>
Instead it uses startup configuration files, located in /etc/init.<br>
Configuration files determine what runlevels a service or task start on.</p>
<p class="has-line-data" data-line-start="305" data-line-end="308"><strong>systemd:</strong><br>
No startup scripts.<br>
Instead it uses service configuration unit files in /etc/systemd/system or /lib/systemd/system</p>
<p class="has-line-data" data-line-start="309" data-line-end="311">(which can be overwritten during software upgrades)<br>
<strong>Switch System’s current runlevels</strong></p>
<p class="has-line-data" data-line-start="312" data-line-end="321"><strong>SysV</strong> :<br>
Use either the telinit or init command (there are basically “twins”)<br>
init runlevel<br>
example: init 5<br>
Current runlevel:<br>
The runlevel command shows the previous and the current runlevel.<br>
Default runlevel:<br>
Enter the following command to quickly check your default runlevel:<br>
grep :initdefault /etc/inittab</p>
<p class="has-line-data" data-line-start="322" data-line-end="326"><strong>Upstart:</strong><br>
No such thing as runlevels (except for backwards compatibility purposes).<br>
Concerned with system events:<br>
An event is a Linux server occurrence that triggers a needed system state change.</p>
<p class="has-line-data" data-line-start="327" data-line-end="332"><strong>systemd:</strong><br>
Runlevels are not called “runlevels” but instead are called target units.<br>
A target unit is a service (or action) group consisting of a name, type, and configuration file.<br>
A service unit is for managing daemons, while a target unit is simply a group of other units.<br>
Switch a Service’s runlevel(s) to Start On</p>
<p class="has-line-data" data-line-start="333" data-line-end="337"><strong>SysV:</strong><br>
chkconfig --level runlevels_to_start_on service_name on<br>
Example: chkconfig --level 35 cups on<br>
(Will start the cups daemon on runlevels 3 and 5)</p>
<p class="has-line-data" data-line-start="338" data-line-end="342"><strong>Upstart:</strong><br>
Edit the /etc/init/service_name.conf file and change the start on and stop on parameters to the desired<br>
runlevels (Yes…Upstart does not use runlevels, but it still kind-of does. It is in a heavy state of<br>
development (2012-2013). Hopefully, it will settle down soon).</p>
<p class="has-line-data" data-line-start="343" data-line-end="347"><strong>systemd:</strong><br>
Runlevels are not called “runlevels” but instead are called target units.<br>
Edit the /etc/systemd/system/service_name.service file and change the WantedBy parameter to<br>
desired .target (e.g. multi-user.target).</p>
<p class="has-line-data" data-line-start="348" data-line-end="351"><strong>Auditing Services<br>
SysV:</strong><br>
All services:</p>
<pre><code class="has-line-data" data-line-start="353" data-line-end="360">chkconfig --list
service --status-all
A single service:
chkconfig --list service_name
service service_name status
Example: service cups status
</code></pre>
<p class="has-line-data" data-line-start="361" data-line-end="367"><strong>Upstart:</strong><br>
All services: initctl list<br>
A single service: initctl status service_name<br>
<strong>systemd:</strong><br>
All services: systemctl list-unit-files --type=service | grep -v disabled<br>
A single service: systemctl status service_name.service</p>
<p class="has-line-data" data-line-start="368" data-line-end="373"><strong>Stop/Start/Restart Services<br>
SysV:</strong><br>
service service_name start<br>
service service_name stop<br>
service service_name restart</p>
<p class="has-line-data" data-line-start="374" data-line-end="378"><strong>Upstart:</strong><br>
initctl start service_name<br>
initctl stop service_name<br>
initctl restart service_name</p>
<p class="has-line-data" data-line-start="379" data-line-end="383"><strong>systemd:</strong><br>
systemctl start service_name.service<br>
systemctl stop service_name.service<br>
systemctl restart service_name.service</p>
<p class="has-line-data" data-line-start="384" data-line-end="387"><strong>Shutdown and reboot from command line<br>
shutdown command:</strong><br>
now (shuts down system immediately)</p>
<ul>
<li class="has-line-data" data-line-start="388" data-line-end="389">r (reboots system)</li>
<li class="has-line-data" data-line-start="389" data-line-end="390">h (halts system)</li>
<li class="has-line-data" data-line-start="390" data-line-end="391">P (powers off system)</li>
<li class="has-line-data" data-line-start="391" data-line-end="399">c (cancels shut down)<br>
+number (will shut down the system in number minutes)<br>
hh:mm (shuts down the system at hh:mm)<br>
&quot;message to system users ́(sends a shut down warning message to users)<br>
<strong>shutdown</strong> - r 13:30 “The system will be rebooted at 1:30pm. Please be prepared.”<br>
<strong>reboot</strong> (reboots the system)<br>
<strong>poweroff</strong> (shuts down system and powers it off)<br>
<strong>halt</strong> (shuts down system, but does not power it off)</li>
</ul>
<p class="has-line-data" data-line-start="402" data-line-end="403"><strong>102.1 - Design hard disk layout - 2</strong></p>
<p class="has-line-data" data-line-start="404" data-line-end="405"><strong>Primary locations</strong> you need to know:</p>
<p class="has-line-data" data-line-start="406" data-line-end="420"><strong>/ root</strong> - bottom of the directory tree, the root<br>
<strong>/var</strong> - variable location, log files and dynamic content (such as web sites)<br>
<strong>/home</strong> - this is the users home directory where their personal files are stored; each user gets their own<br>
home directory /home/bennettnw2 /home/user<br>
<strong>/boot</strong> - this is where the kernel is stored and supporting files for the kernel; also the boot files to get the<br>
system to boot; often on a diff partition<br>
<strong>/opt</strong> - third party software vendors use this directory to install their programs; this is also a good<br>
candidate to be on its own partition; enterprise uses this directory extensively<br>
<strong>/bin</strong> – Essential command binaries<br>
<strong>/dev</strong> – Device files<br>
<strong>/etc</strong> – Host-specific system configuration<br>
<strong>/media</strong> – Mount point for removable media<br>
<strong>/mnt</strong> – Mount point for mounting a filesystem temporarily<br>
<strong>/tmp</strong> – Temporary files</p>
<p class="has-line-data" data-line-start="421" data-line-end="422"><strong>Partitions:</strong></p>
<p class="has-line-data" data-line-start="423" data-line-end="425">In Linux world, devices are defined at <strong>/dev/</strong>. First SATA disk is <strong>/dev/sda</strong> , second SATA disk is <strong>/dev/sdb</strong> ,<br>
… and first SCSI disk (older systems) is <strong>/dev/hda</strong>.</p>
<p class="has-line-data" data-line-start="426" data-line-end="428">You have to PARTITION the disks, that is creating smaller parts on a big disk and calling them /dev/sda<br>
(first partition on first SCSI disk) or /dev/hdb3 (3rd partition on second disk).</p>
<p class="has-line-data" data-line-start="429" data-line-end="430"><strong>Swap Space</strong></p>
<p class="has-line-data" data-line-start="431" data-line-end="432">Swap is <strong>temporary storage</strong> that acts like RAM. When a percentage of RAM is full, the kernel will move</p>
<p class="has-line-data" data-line-start="433" data-line-end="434">less used data to swap.</p>
<p class="has-line-data" data-line-start="435" data-line-end="436">There are two ways to configure swap.</p>
<ul>
<li class="has-line-data" data-line-start="437" data-line-end="438"><strong>Swap partition</strong></li>
<li class="has-line-data" data-line-start="438" data-line-end="440"><strong>Swap file</strong>.</li>
</ul>
<p class="has-line-data" data-line-start="440" data-line-end="442">The swap partition is faster than using a swap file. (similar to a page file in windows) The partition is<br>
faster because data is getting written directly to disk rather than data getting written to a file and then</p>
<p class="has-line-data" data-line-start="443" data-line-end="444">to disk as when you are using a swap file.</p>
<p class="has-line-data" data-line-start="445" data-line-end="446">The general rule of sizing of the swap space used to be 1.5x to 2.0x the size of your available RAM. With</p>
<p class="has-line-data" data-line-start="447" data-line-end="448">RAM being much cheaper nowadays, the rule of thumb is to use at least .50x of your available RAM.</p>
<p class="has-line-data" data-line-start="449" data-line-end="450"><strong>Partitions and Mount Points</strong></p>
<p class="has-line-data" data-line-start="451" data-line-end="455">/dev/sda is the first hard drive (ssusi, sata, etc.) the “a” means it is the first disk the kernel has found.<br>
/dev/sda1 - the 1 means it is the first partition Normally you would have different partitions and those<br>
would be represented by: /dev/sda2, /dev/sda3, etc. Each partition has a specific function within the<br>
system.</p>
<p class="has-line-data" data-line-start="456" data-line-end="458">Speaking of partitions and specific functions, each partition would need to be mounted to a specific<br>
directory. For example</p>
<ul>
<li class="has-line-data" data-line-start="459" data-line-end="460">/dev/sda1 can be the / (root) partition</li>
<li class="has-line-data" data-line-start="460" data-line-end="461">/dev/sda2 can be the /boot partition</li>
<li class="has-line-data" data-line-start="461" data-line-end="463">/dev/sda3 can be the /home partition In this way they are isolated from each other</li>
</ul>
<p class="has-line-data" data-line-start="463" data-line-end="464">Commands for mounting</p>
<ul>
<li class="has-line-data" data-line-start="465" data-line-end="467"><strong>mount</strong> can be used to mount partitions and also to show all existing mounts without any<br>
options</li>
<li class="has-line-data" data-line-start="467" data-line-end="469"><strong>lsblk</strong> used to show all block devices on a system and their names – a block device is basically a<br>
hard disk or anything that takes a large amount of data and writes it in block sizes, to a location.</li>
<li class="has-line-data" data-line-start="469" data-line-end="471"><strong>fdisk</strong> helpful for partitioning hard drives, for now we will use it to list out partitions on a specific<br>
disk; ie: fdisk -l /dev/xvda</li>
<li class="has-line-data" data-line-start="471" data-line-end="474"><strong>swapon</strong> --summary will show a summary of the swap usage on a system; the same info can be<br>
found in /proc/swaps</li>
</ul>
<p class="has-line-data" data-line-start="474" data-line-end="475"><strong>Introduction to LVM</strong></p>
<p class="has-line-data" data-line-start="476" data-line-end="477">Taking a quick look at LVM (Logical Volume Manager) LVM allows the create of “groups” or disks or</p>
<p class="has-line-data" data-line-start="478" data-line-end="479">partitions that can be assembled into a single (or multiple) file systems</p>
<ul>
<li class="has-line-data" data-line-start="480" data-line-end="482">GRUB cannot read LVM metadata, therefore LVM cannot be used as a /boot partition. All other<br>
partitions are fine like wine.</li>
<li class="has-line-data" data-line-start="482" data-line-end="483">LVM allows for easy and dynamic resizing of volumes</li>
<li class="has-line-data" data-line-start="483" data-line-end="485">snapshots can be taken of LVMs</li>
</ul>
<p class="has-line-data" data-line-start="485" data-line-end="486"><strong>Example Layout of an LVM Group</strong></p>
<p class="has-line-data" data-line-start="487" data-line-end="488">On the bottom layer you have your PVs (Physical Volumes).</p>
<ul>
<li class="has-line-data" data-line-start="489" data-line-end="491">this is made up of all your block devices on your system Above the PV layer you will have the VG<br>
(Volume Group) layer.</li>
<li class="has-line-data" data-line-start="491" data-line-end="492">This layer encompasses the PV layer</li>
<li class="has-line-data" data-line-start="492" data-line-end="493">A volume group could encompass one disk to At the top, we have LV (Logical Volumes).</li>
<li class="has-line-data" data-line-start="493" data-line-end="494">This is where we carve out individual sections of the VG layer for specific mount points</li>
<li class="has-line-data" data-line-start="494" data-line-end="495">These logical volumes are akin to partitions</li>
<li class="has-line-data" data-line-start="495" data-line-end="497">Then on top of the LV is the file systems mounted to directories</li>
</ul>
<p class="has-line-data" data-line-start="497" data-line-end="498"><strong>LVM Main Concepts</strong></p>
<p class="has-line-data" data-line-start="499" data-line-end="500">In many cases you need to resize your partitions or even add new disks and add them to your mount</p>
<p class="has-line-data" data-line-start="501" data-line-end="502">points. LVM is designed for this.</p>
<p class="has-line-data" data-line-start="503" data-line-end="504">LVM helps you create one partition from different disks and add or remove space to them. The main</p>
<p class="has-line-data" data-line-start="505" data-line-end="506">concepts are:</p>
<ul>
<li class="has-line-data" data-line-start="507" data-line-end="509"><strong>Physical Volume (pv):</strong> a whole drive or a partition. It is better to define partitions and not use<br>
whole disks - unpartitioned.</li>
<li class="has-line-data" data-line-start="509" data-line-end="511"><strong>Volume Groups (vg):</strong> this is the collection of one or more pvs. OS will see the vg as one big disk.<br>
PVs in one vg, can have different sizes or even be on different physical disks.</li>
<li class="has-line-data" data-line-start="511" data-line-end="513"><strong>Logical Volumes (lv):</strong> OS will see lvs as partitions. You can format an lv with your OS and use it.</li>
</ul>
<p class="has-line-data" data-line-start="513" data-line-end="514"><strong>LVM Commands to set up a layout</strong></p>
<ul>
<li class="has-line-data" data-line-start="515" data-line-end="516"><strong>pvs</strong> physical volume scan - checks out all individual physical volumes in an LVM setup</li>
<li class="has-line-data" data-line-start="516" data-line-end="517"><strong>vgs</strong> virtual groups scan - scans for the volume groups in the system</li>
<li class="has-line-data" data-line-start="517" data-line-end="519"><strong>lvs</strong> logical volume scan - scans for the logical volume</li>
</ul>
<p class="has-line-data" data-line-start="519" data-line-end="520"><strong>102. 2 – Install a Boot Manager – 2</strong></p>
<p class="has-line-data" data-line-start="521" data-line-end="522"><strong>Boot overview</strong></p>
<p class="has-line-data" data-line-start="523" data-line-end="524">System starts from BIOS and will do a <strong>self-test</strong> called <strong>POST</strong>. Then it will hand over the boot process to</p>
<p class="has-line-data" data-line-start="525" data-line-end="526">the first sector of master boot record ( <strong>MBR</strong> ).</p>
<p class="has-line-data" data-line-start="527" data-line-end="528">MBR is on track (Cylinder) 0, side (Head) 0 and Sector 1 of the first disk which defines CHS.</p>
<p class="has-line-data" data-line-start="529" data-line-end="531">MBR is only 512bytes so we need a smart bootloader to handle larger boot managers and even multiple<br>
systems. Some of these boot loaders are <strong>LILO</strong> , <strong>GRUB</strong> and <strong>GRUB</strong>.</p>
<p class="has-line-data" data-line-start="532" data-line-end="534">Chain Loading is when a boot loader, loads another boot loader. This is done when a Linux bootloader<br>
needs to start a Windows system.</p>
<p class="has-line-data" data-line-start="535" data-line-end="536"><strong>Installing Grub</strong></p>
<p class="has-line-data" data-line-start="537" data-line-end="538"><strong>grub-install [device]</strong> is the command used to install GRUB to the specified device. You have to look for</p>
<p class="has-line-data" data-line-start="539" data-line-end="541">the boot mount point with which to install GRUB. <strong>findmnt /boot</strong> will tell you the exact location as a<br>
device; it will tell you exact disk and partition like, /dev/vda1. You can even make it easier and use</p>
<p class="has-line-data" data-line-start="542" data-line-end="543">/dev/hd0 or ‘(hd0)’ to refer to the first drive of the system.</p>
<p class="has-line-data" data-line-start="544" data-line-end="545">If you run grub by itself, it will look for the correct partition to install itself. You can even use a <strong>grub</strong></p>
<p class="has-line-data" data-line-start="546" data-line-end="547"><strong>“find”</strong> command where it will let you know where to find stage1 = /grub/stage1.</p>
<p class="has-line-data" data-line-start="548" data-line-end="549">This search is relative to root being /boot. So, when the answer you receive is /grub/stage1, it really</p>
<p class="has-line-data" data-line-start="550" data-line-end="551">means /boot/grub/stage</p>
<p class="has-line-data" data-line-start="552" data-line-end="553">If your system is up and running fine. Running <strong>grub-install</strong> is potentially dangerous. This command is</p>
<p class="has-line-data" data-line-start="554" data-line-end="556">usually run from a liveCD/USB where GRUB is getting installed to a new disk as part of a new system<br>
installation. In short, I should not ever really have to run grub-install.</p>
<p class="has-line-data" data-line-start="557" data-line-end="558"><strong>GRUB shell commands:</strong></p>
<p class="has-line-data" data-line-start="559" data-line-end="561">grub by itself from the bash shell as root will place you into the GRUB shell help will give you more<br>
information regarding the list of commands you can use in the grub shell find find /grub/stage1 will tell</p>
<p class="has-line-data" data-line-start="562" data-line-end="563">you (hd0,0) quit will quit the shell for us</p>
<p class="has-line-data" data-line-start="564" data-line-end="565">Be sure to back up your grub config before tooling around with grub</p>
<h3 class="code-line" data-line-start=566 data-line-end=567 ><a id="GRUB_566"></a>GRUB</h3>
<p class="has-line-data" data-line-start="568" data-line-end="569">What are the differences between <strong>MBR</strong> and <strong>GPT</strong>?</p>
<ul>
<li class="has-line-data" data-line-start="570" data-line-end="572">MBR only supported 4 partitions, with 1 being extended to 23 partitions a: - z: for a total of 26<br>
partitions</li>
<li class="has-line-data" data-line-start="572" data-line-end="573">MBR only supported partitions sizes up to 2 TB</li>
<li class="has-line-data" data-line-start="573" data-line-end="574">GPT (GUID Partition Table) supported 128 partitions</li>
<li class="has-line-data" data-line-start="574" data-line-end="576">GPT could support partition sizes up to 1 ZB (zetabyte) or 909.5 million TB</li>
</ul>
<p class="has-line-data" data-line-start="576" data-line-end="577">For <strong>GUID</strong> to work we needed a replacement for the traditional BIOS. This is where <strong>UEFI</strong> comes in</p>
<p class="has-line-data" data-line-start="578" data-line-end="579">(Unified Extensible Firmware Interface).</p>
<ul>
<li class="has-line-data" data-line-start="580" data-line-end="581">UEFI was still compatible with legacy BIOS.</li>
<li class="has-line-data" data-line-start="581" data-line-end="582">Requires a 64-bit operating system</li>
<li class="has-line-data" data-line-start="582" data-line-end="584">Prevents unauthorized operating systems from booting on the system</li>
</ul>
<p class="has-line-data" data-line-start="584" data-line-end="585">Booting with <strong>GRUB2</strong> on <strong>GPT with UEFI</strong></p>
<ul>
<li class="has-line-data" data-line-start="586" data-line-end="594">UEFI was a modern drop in replacement for BIOS; once UEFI gets started it will also look for a<br>
MBR in the first 512 bytes of a drive to find a boot loader (boot.img) Stage 1<br>
o Something to understand about GPT disks:<br>
▪ after the MBR, we are going to have a GPT header which lets the system know<br>
that this is a GPT style disk.<br>
▪ After the header, we will have a partition entry array. A large listing of all the<br>
partitions, thier ID, and their locations (similar to fstab?)<br>
▪ We will then have the core.img file which is Stage 1.5 just like MBR</li>
<li class="has-line-data" data-line-start="594" data-line-end="604">This next step is a big departure from MBR; core.img is looking for /boot/efi partition which can<br>
only be either a vfat or FAT32 partition. This partition is known as the ESP (EFI System Partition)<br>
UEFI can only read from those types<br>
o IMPORTANT! the /boot/efi partition is were the boot images are located and booting<br>
begins in a UEFI environment<br>
▪ this is the hand-off to grub2 /boot/grub2 where Stage 2 begins<br>
▪ within /boot/grub2 are two main files<br>
▪ grubenv<br>
▪ themes</li>
</ul>
<p class="has-line-data" data-line-start="604" data-line-end="605">Commands to run to modify our <strong>grub2 setup</strong> and check current config</p>
<p class="has-line-data" data-line-start="606" data-line-end="607">IMPORTANT! RHEL based = grub2- and Debian based = grub-</p>
<ul>
<li class="has-line-data" data-line-start="608" data-line-end="616"><strong>grub2-editenv</strong> you can use this to edit the environment file located /boot/grub/grubenv<br>
o typically, you do not want to edit anything under /boot/grub/ like you would with legacy<br>
grub<br>
o so, the best use of grub2-editenv is to extract information from that file with grub2-<br>
editenv list<br>
o grub2-editev list will show us the saved_entry of the default OS and kernel to be booted<br>
when grub2 boots the system; view the default boot entry for the grub configuration file<br>
o So, what file can we modify by hand to edit the boot environment? Glad you asked!</li>
<li class="has-line-data" data-line-start="616" data-line-end="621"><strong>/etc/default/grub</strong><br>
o this is like modifying grub.conf in legacy GRUB with very similar options like:<br>
▪ timeout<br>
▪ submenu<br>
▪ and also adding options to the command line to modify how GRUB boots</li>
<li class="has-line-data" data-line-start="621" data-line-end="623">So, the process is to edit /etc/default/grub and then run grub2-mkconfig to programmatically<br>
modify GRUB</li>
<li class="has-line-data" data-line-start="623" data-line-end="627"><strong>grub2-mkconfig</strong> will create or update a /boot/grub2/grub.cfg file based on entries from the<br>
/etc/default/grub file<br>
o NOTE: On Debain systems, the “2” is omitted from the command name<br>
o it is just grub-mkconfig</li>
<li class="has-line-data" data-line-start="627" data-line-end="637"><strong>/etc/grub.d</strong> is another location that you can make changes to so that you can edit the boot<br>
environment<br>
o These are individual configuration files that grub2-mkconfig will read from in order to<br>
generate the /boot/grub2/grub.cfg file<br>
o NOTE: on Debian systems, you would use update-grub to update a GRUB configuration<br>
after changes to /etc/default/grub have been made. So said another way, with RHEL you<br>
use the same command but with Debian, you would use a different command to update<br>
/boot/grub2/grub.cfg if you make changes within /etc/grub.d/<br>
o These options are what you would edit to make changes to a multiple OS computer</li>
</ul>
<h3 class="code-line" data-line-start=637 data-line-end=638 ><a id="LILO_637"></a>LILO</h3>
<p class="has-line-data" data-line-start="639" data-line-end="642">LILO is the (almost) original LInux LOader. It does not depend on you using a specific<br>
filesystem, it can boot Linux kernel images from floppy disks, and it can act as a bootmanager<br>
for other operating systems.</p>
<p class="has-line-data" data-line-start="643" data-line-end="644">LILO works something like this:</p>
<ul>
<li class="has-line-data" data-line-start="645" data-line-end="646">You create the configuration file <strong>/etc/lilo.conf</strong></li>
<li class="has-line-data" data-line-start="646" data-line-end="647">You run <strong>/sbin/lilo</strong></li>
<li class="has-line-data" data-line-start="647" data-line-end="649"><strong>/sbin/lilo</strong> maps out the sectors on the disk that contain the data needed for booting (the<br>
kernel, the configuration options)</li>
<li class="has-line-data" data-line-start="649" data-line-end="651"><strong>/sbin/lilo</strong> maps out the locations of the disk that contain the data needed for booting (the<br>
kernel, the configuration options). This map is stored in /boot/map.</li>
<li class="has-line-data" data-line-start="651" data-line-end="654"><strong>/sbin/lilo</strong> installs the boot loader on the disk, and configures it with the location of<br>
/boot/map.</li>
</ul>
<p class="has-line-data" data-line-start="654" data-line-end="658">One of the important consequences of the way LILO works is that the location of data on the<br>
disk may not change after /boot/map has been created. This means that if you modify the<br>
configuration in /etc/lilo.conf, install a kernel upgrade, or rename files and directories, you<br>
need to run /sbin/lilo again before things work as expected.</p>
<p class="has-line-data" data-line-start="659" data-line-end="660"><strong>Interacting with the Boot Loader</strong></p>
<p class="has-line-data" data-line-start="661" data-line-end="663">Learning how to work with the GRUB boot menu in both GRUB and GRUB2. Practice booting the system<br>
using different kernel boot options and learn how to reinstall GRUB to our disk. Also, a walkthrough of</p>
<p class="has-line-data" data-line-start="664" data-line-end="665">boot using one command at a time.</p>
<p class="has-line-data" data-line-start="666" data-line-end="667"><strong>GRUB Legacy menu</strong></p>
<p class="has-line-data" data-line-start="668" data-line-end="669">You will have to press any key to get to the menu before the kernel takes over. Once there you will be</p>
<p class="has-line-data" data-line-start="670" data-line-end="671">able to:</p>
<pre><code class="has-line-data" data-line-start="673" data-line-end="685">▪ Select which kernel to boot into using your arrow keys
▪ Press the &quot;a&quot; key to add new kernel arguments to the kernel you wish to boot
o you can remove the quiet option
o you can remove the graphical
o you can add 2 to boot into runlevel 2
▪ Press the &quot;c&quot; key to get to the grub command line
o you can read out some of the files in the boot directory
o you can set new options for your configuration file
o you can even reinstall GRUB in the event GRUB breaks
▪ you could use the install command but that is for GRUB Pros
▪ the best way is to use the setup command setup (hd0)
</code></pre>
<p class="has-line-data" data-line-start="686" data-line-end="687"><strong>GRUB2 Menu</strong></p>
<p class="has-line-data" data-line-start="688" data-line-end="689">This will take you directly to the install GRUB2 menu</p>
<pre><code class="has-line-data" data-line-start="691" data-line-end="700">▪ There is no option for &quot;a&quot;
▪ The &quot;e&quot; key to edit; it looks way different as it gives us all the options rather than just the
command line
▪ These are systemd options rather than sysvinit
o so instead of just appending 2 for runlevel 2; we would need to set up the unit as
systemd.unit and the target as rescue.target
o it would look like systemd.unit=rescue.target
o use &lt;ctrl+x&gt; to boot with the options we just changed
</code></pre>
<p class="has-line-data" data-line-start="701" data-line-end="702"><strong>Booting GRUB Manually</strong></p>
<pre><code class="has-line-data" data-line-start="704" data-line-end="712">▪ ls
▪ ls (hd0,1)/ will show us the boot directory contents
▪ set root=(hd0,1)
▪ linux /boot/vmlinz-4.24.9- 43 - generic root=/dev/vda
▪ intrd /boot/initrd.img-4.24.9- 43 - generic
▪ ram disks and kernel names are very similar
▪ use the boot command to boot with all the options we just set
</code></pre>
<p class="has-line-data" data-line-start="713" data-line-end="714"><strong>102. 3 – Manage Shared Libraries - 2</strong></p>
<p class="has-line-data" data-line-start="715" data-line-end="716"><strong>Shared library</strong></p>
<p class="has-line-data" data-line-start="717" data-line-end="720">A shared library is a group of files that contains functionality that other applications can use. This is good<br>
for developers who only have to focus on their application and can rely on the functionality of shared<br>
libraries to interact with the operating system.</p>
<ul>
<li class="has-line-data" data-line-start="721" data-line-end="722">Shared libraries end in a .so file extension which means shared object</li>
<li class="has-line-data" data-line-start="722" data-line-end="724">Library files can be found in the following locations on a Linux system:</li>
</ul>
<pre><code class="has-line-data" data-line-start="725" data-line-end="731">o /lib
o /usr/lib(for 32bit systems) /usr/lib64(for 64bit systems)
▪ some 64bit programs can still use the 32bit libraries
o /usr/local/lib
o /usr/share
</code></pre>
<ul>
<li class="has-line-data" data-line-start="732" data-line-end="734">There are two types of library files: Dynamic (ends in .so) and Static (ends in .a)</li>
</ul>
<pre><code class="has-line-data" data-line-start="735" data-line-end="739">o Statically linked library files are compiled into an application when the application is
installed
o Dynamically linked libraries are called when needed by an application
</code></pre>
<ul>
<li class="has-line-data" data-line-start="740" data-line-end="743"><strong>Static</strong> linking is when you add this library to your executable program. In this method your<br>
program size is big because it has all the needed libraries. One good advantage is your program<br>
can be run without being dependent to other programs / libraries.</li>
<li class="has-line-data" data-line-start="743" data-line-end="748"><strong>Dynamic</strong> linking is when you just say in your program “We need this and that library to run this<br>
program”. This way your program is smaller but you need to install those libraries separately.<br>
This makes programs more secure (because libraries can be updated centrally), more advanced<br>
(any improvement in a library will improve the whole program) and smaller.</li>
</ul>
<p class="has-line-data" data-line-start="748" data-line-end="749"><strong>Commands and options when dealing with shared libraries</strong></p>
<ul>
<li class="has-line-data" data-line-start="750" data-line-end="752">
<p class="has-line-data" data-line-start="750" data-line-end="752"><strong>ldd</strong> prints out shared object (library) dependencies<br>
o ldd /bin/cp shows what library files are linked to the cp application</p>
</li>
<li class="has-line-data" data-line-start="752" data-line-end="757">
<p class="has-line-data" data-line-start="752" data-line-end="757"><strong>ldconfig</strong> configures dynamic linker run-time binding, create a cache based on tlibrary directories<br>
and can show you what is currently cached<br>
o will create a cached listing of the most used libraries based off of a directory I’ve<br>
provided<br>
o this command needs to be run as root/sudo</p>
</li>
<li class="has-line-data" data-line-start="757" data-line-end="761">
<p class="has-line-data" data-line-start="757" data-line-end="760"><strong>/etc/ld.so.conf</strong> configuration file that points to directories and other configuration files that<br>
hodl reference to library directory locations<br>
o so this is the configuration file that links applications and libraries together?</p>
</li>
<li class="has-line-data" data-line-start="761" data-line-end="769">
<p class="has-line-data" data-line-start="761" data-line-end="768"><strong>LD_LIBRARY_PATH</strong> legacy environment variable that points to a path where library files can be<br>
read from<br>
o you can use this instead of a configuration file to link libraries and applications<br>
o however, it is best to use a config file as this is old school and outdated but comes in<br>
handy if you are just testing something out<br>
o example of usage `$ export LD_LIBRARY_PATH=/opt/java/jre/lib<br>
o similar to the PATH variable but this is for libraries</p>
</li>
</ul>
<p class="has-line-data" data-line-start="769" data-line-end="770"><strong>102.4 - Use Debian Package Management – 3</strong></p>
<h3 class="code-line" data-line-start=771 data-line-end=772 ><a id="APT_771"></a>APT</h3>
<p class="has-line-data" data-line-start="773" data-line-end="774"><strong>Advance Package Tool</strong> used as the default for Debian based Linux distros</p>
<ul>
<li class="has-line-data" data-line-start="775" data-line-end="776">APT is used to install applications and their dependencies</li>
<li class="has-line-data" data-line-start="776" data-line-end="777">it is configured to use a network for retrieving data and dependencies</li>
<li class="has-line-data" data-line-start="777" data-line-end="779">removes applications and also updates and upgrades packages</li>
</ul>
<p class="has-line-data" data-line-start="779" data-line-end="780">How does <strong>APT</strong> work?</p>
<ul>
<li class="has-line-data" data-line-start="781" data-line-end="783">reads the file at /etc/apt/sources.list<br>
o which contains url listing of software repositories</li>
<li class="has-line-data" data-line-start="783" data-line-end="785">once it reads the file and make the calculations for dependencies, it will download all the<br>
needed files</li>
<li class="has-line-data" data-line-start="785" data-line-end="787">then directs commands to dpkg to get it all done</li>
</ul>
<p class="has-line-data" data-line-start="787" data-line-end="788"><strong>Commands</strong> and options used for apt</p>
<ul>
<li class="has-line-data" data-line-start="789" data-line-end="791">/etc/apt/sources.list<br>
o configuration file that lists out repository locations for packages</li>
<li class="has-line-data" data-line-start="791" data-line-end="792">apt-get upgrade or apt upgrade</li>
<li class="has-line-data" data-line-start="792" data-line-end="795">apt-get update or apt update<br>
o updates the local apt cache so that the upgrade command does not use excessive<br>
bandwidth?</li>
<li class="has-line-data" data-line-start="795" data-line-end="796">apt-get install or apt install</li>
<li class="has-line-data" data-line-start="796" data-line-end="797">apt-get remove will only remove the application but not the dependencies</li>
<li class="has-line-data" data-line-start="797" data-line-end="798">apt-get purge will remove the application and the dependencies and config files</li>
<li class="has-line-data" data-line-start="798" data-line-end="800">apt-get dist-upgrade will install new packages to get the system up-to-date while the apt<br>
upgrade will not install new packages</li>
<li class="has-line-data" data-line-start="800" data-line-end="801">apt-get download will download a package file but not install it</li>
<li class="has-line-data" data-line-start="801" data-line-end="803">apt-cache search [package] searches through your local apt cache for a package that can be<br>
installed</li>
<li class="has-line-data" data-line-start="803" data-line-end="804">apt-cache show lists out basic information about a package</li>
<li class="has-line-data" data-line-start="804" data-line-end="806">apt-cache showpkg displays more technical information about a package</li>
</ul>
<p class="has-line-data" data-line-start="806" data-line-end="807"><strong>Using Debian Package (dpkg)</strong></p>
<p class="has-line-data" data-line-start="808" data-line-end="809">The Debian Package Utility</p>
<ul>
<li class="has-line-data" data-line-start="810" data-line-end="815">The .deb package contains:<br>
o the application or utility you want to install<br>
o default configuration files<br>
o how and where to install the files that come with the package<br>
o listing of dependencies, the package requires</li>
<li class="has-line-data" data-line-start="815" data-line-end="818">Dependencies should already be installed or be installed with the package<br>
o apt will automatically handle dependencies for you while dpkg will not</li>
</ul>
<p class="has-line-data" data-line-start="818" data-line-end="819"><strong>Some common commands and flags for use with dpkg</strong></p>
<p class="has-line-data" data-line-start="820" data-line-end="821">First you will want to download a .deb file using apt-get download [pkg name]</p>
<ul>
<li class="has-line-data" data-line-start="822" data-line-end="823">dpkg --info taking a look at basic information about a package (apt-cache show is similar)</li>
<li class="has-line-data" data-line-start="823" data-line-end="824">dpkg --status on a package that has already been installed</li>
<li class="has-line-data" data-line-start="824" data-line-end="825">dpkg -l htop list packages that match the string on the search on a system dpkg -l htop</li>
<li class="has-line-data" data-line-start="825" data-line-end="827">dpkg -i htop need to be sudo to -i install a package; run --status to verify the package has been<br>
installed</li>
<li class="has-line-data" data-line-start="827" data-line-end="828">dpkg -L htop will list the files that were installed for htop</li>
<li class="has-line-data" data-line-start="828" data-line-end="829">dpkg -c htop will show the contents of the htop .deb package</li>
<li class="has-line-data" data-line-start="829" data-line-end="830">dpkg - r htop will remove a package</li>
<li class="has-line-data" data-line-start="830" data-line-end="831">dpkg -P htop will purge a package</li>
<li class="has-line-data" data-line-start="831" data-line-end="832">dpkg -S htop will search to see if there is anything in the dpkg database that refers to htop</li>
<li class="has-line-data" data-line-start="832" data-line-end="835">dpkg-reconfigure IMPORTANT TO KNOW FOR TEST - rerun configuration utility<br>
o sudo dpkg-reconfigure console-setup</li>
</ul>
<p class="has-line-data" data-line-start="835" data-line-end="836"><strong>102.5 - Use RPM and YUM package management – 3</strong></p>
<p class="has-line-data" data-line-start="837" data-line-end="839">RedHat Package Manager (RPM) and Yellowdog Updater Modified (YUM) are fedora /redhat /rhel /<br>
centos / … tools to manage packages. There are also gui tools for installing and updating. As you saw on</p>
<p class="has-line-data" data-line-start="840" data-line-end="841">102.4, all package managers can do standard functions like installing, updating and removing packages.</p>
<p class="has-line-data" data-line-start="842" data-line-end="843">YUM adds extra features likes automatic updates, dependency management and works with</p>
<p class="has-line-data" data-line-start="844" data-line-end="845">repositories (collection on packages accessed over network or on a CD).</p>
<h3 class="code-line" data-line-start=846 data-line-end=847 ><a id="YUM_846"></a>YUM</h3>
<p class="has-line-data" data-line-start="848" data-line-end="849"><strong>The Yellowdog Updater Modified</strong></p>
<ul>
<li class="has-line-data" data-line-start="850" data-line-end="851">Originally used for the Yellowdog Linux Distribution</li>
<li class="has-line-data" data-line-start="851" data-line-end="852">Handles RPM package dependencies (keeps you out of dependency hell like apt)</li>
<li class="has-line-data" data-line-start="852" data-line-end="853">Installs, upgrades and removes packages</li>
<li class="has-line-data" data-line-start="853" data-line-end="855">The yum setup</li>
</ul>
<pre><code class="has-line-data" data-line-start="856" data-line-end="860">o global yum configuration options are set in /etc/yum.conf
o reads repository information from /etc/yum.repos.d
o caches latest repository information in /var/cache/yum
</code></pre>
<p class="has-line-data" data-line-start="861" data-line-end="862"><strong>Other RPMs (RedHat Package Managers)</strong></p>
<ul>
<li class="has-line-data" data-line-start="863" data-line-end="864">Zypper is used on SUSE Linux Distros</li>
<li class="has-line-data" data-line-start="864" data-line-end="868">DNF (Dandified yum) is used on Fedora distros<br>
o future replacement for yum in RHEL<br>
o uses same command syntax as yum</li>
</ul>
<p class="has-line-data" data-line-start="868" data-line-end="869"><strong>Common yum commands:</strong></p>
<ul>
<li class="has-line-data" data-line-start="870" data-line-end="873"><strong>yum update</strong> searches online repositories for updated package compared to what is currently<br>
installed on the system; also upgrades packages<br>
o it will also calculation and process dependencies</li>
<li class="has-line-data" data-line-start="873" data-line-end="879"><strong>yum search [string]</strong> searches the yum repositories for the string specified in the search<br>
o ie: yum search https<br>
o it will match any package with a reference to the search string<br>
o yum search uses /etc/yum.repos.d to do it’s search<br>
o It is important to understand the basic contents of a repo file<br>
▪ baseurl is the web address that indicates where packages are loaded from</li>
<li class="has-line-data" data-line-start="879" data-line-end="883"><strong>yum info [string]</strong> lists information about a specified package<br>
o yum info httpd<br>
▪ this gives us information abut the httpd package like name, architecture,<br>
version, repo it comes from and a short description</li>
<li class="has-line-data" data-line-start="883" data-line-end="885"><strong>yum list installed</strong> displays list of all installed packages on the system<br>
o yum list installed | less`</li>
<li class="has-line-data" data-line-start="885" data-line-end="889"><strong>yum clean all</strong> cleans up all your cache information and ist local database file<br>
o use this if your database is old or corrupted<br>
o the next time I run the yum command it will download fresh meta data from the<br>
repositories yum.repos.d directory</li>
<li class="has-line-data" data-line-start="889" data-line-end="891"><strong>yum install [package] -y</strong> will assume yes to the install of a package as yum will always want to<br>
confirm every package you want to install</li>
<li class="has-line-data" data-line-start="891" data-line-end="892"><strong>yum remove [package] -y</strong> will assume yes and remove a package that we have installed</li>
<li class="has-line-data" data-line-start="892" data-line-end="893">` <strong>yum autoremove [package]</strong> will remove a package and also its dependencies</li>
<li class="has-line-data" data-line-start="893" data-line-end="895">yum whatprovides */httpd will show you what package contains a particular file you are looking<br>
for</li>
<li class="has-line-data" data-line-start="895" data-line-end="899"><strong>yum reinstall [package]</strong> this will download the package and reinstall for you<br>
o will need yum-utils installed on your system<br>
o yumdownloader mc (midnight commander)</li>
</ul>
<p class="has-line-data" data-line-start="899" data-line-end="900"><strong>The Red Hat Package Manager (rpm)</strong></p>
<h3 class="code-line" data-line-start=901 data-line-end=902 ><a id="RPM_901"></a>RPM</h3>
<ul>
<li class="has-line-data" data-line-start="903" data-line-end="905">An .rpm package contains</li>
</ul>
<pre><code class="has-line-data" data-line-start="906" data-line-end="911">o the application or utility
o default config files
o how and were to install files
o list of dependencies that the package requires
</code></pre>
<ul>
<li class="has-line-data" data-line-start="912" data-line-end="914">The rpm database:</li>
</ul>
<pre><code class="has-line-data" data-line-start="915" data-line-end="918">o located in /var/lib/rpm
o use the rpm --rebuilddb to repair a corrupted rpm database
</code></pre>
<ul>
<li class="has-line-data" data-line-start="919" data-line-end="921">Dependencies need to already be on the system or installed with the package</li>
</ul>
<pre><code class="has-line-data" data-line-start="922" data-line-end="924">o yum handles dependencies automatically but rpm does not
</code></pre>
<p class="has-line-data" data-line-start="925" data-line-end="926"><strong>Common rpm Commands</strong></p>
<ul>
<li class="has-line-data" data-line-start="927" data-line-end="929"><strong>rpm -qpi [package]</strong> Queries Package Information<br>
o the output will be the same as the yum --info command</li>
<li class="has-line-data" data-line-start="929" data-line-end="930"><strong>rpm -qpl [package]</strong> lists all the files in a package (query package, list of files)</li>
<li class="has-line-data" data-line-start="930" data-line-end="931"><strong>rpm -qa</strong> list all installed packages on the system</li>
<li class="has-line-data" data-line-start="931" data-line-end="933"><strong>rpm -i [package]</strong> installs a specified package; often combined with other options to proved more<br>
verbose output with progress hashmarks ie: -ivh</li>
<li class="has-line-data" data-line-start="933" data-line-end="934"><strong>rpm -U [path-to-package-file]</strong> upgrades an installed package with a newer version</li>
<li class="has-line-data" data-line-start="934" data-line-end="935"><strong>rpm -e [package]</strong> this will erase or uninstall the selected package</li>
<li class="has-line-data" data-line-start="935" data-line-end="936"><strong>rpm -Va</strong> will verify all installed packages</li>
<li class="has-line-data" data-line-start="936" data-line-end="945"><strong>rpm2cpio</strong> converts an .rpm file into a cpio archive file and then you can extract the contents of<br>
the rpm package<br>
o often combined with the cpio command<br>
o ie: <strong>rpm2cpio [some.rpm] | cpio -idmv</strong><br>
▪ - i means extract<br>
▪ - d means extract with the same directory structure<br>
▪ - m modifed time the same<br>
▪ - v verbose output</li>
</ul>
<p class="has-line-data" data-line-start="945" data-line-end="946">NOTE: you can use which to see if a package is installed on your system or not</p>
<p class="has-line-data" data-line-start="947" data-line-end="948"><strong>102. 6 – Linux as a virtualization guest – 1</strong></p>
<p class="has-line-data" data-line-start="949" data-line-end="950"><strong>Virtualization and Containers</strong></p>
<p class="has-line-data" data-line-start="951" data-line-end="952"><strong>What is a</strong> Virtual Machine**?**</p>
<ul>
<li class="has-line-data" data-line-start="953" data-line-end="954">It is the emulation of a specific computer system type</li>
<li class="has-line-data" data-line-start="954" data-line-end="957">They operate based on the architecture and functions of a real computer and ist<br>
implementation<br>
o can involve specialized hardware, software or both</li>
<li class="has-line-data" data-line-start="957" data-line-end="961">Virt software will let you set up one operating system within another<br>
o they will both share the same physical hardware<br>
o the VM is isolated from the hardware but communicates with the hardware via a<br>
hypervisor</li>
<li class="has-line-data" data-line-start="961" data-line-end="968">Examples of <strong>hypervisors</strong> are:<br>
o KVM - kernel virtual machine; built into the linux kernel<br>
o QEMU - which KVM is built from<br>
o VMWare - proprietary<br>
o Xen -<br>
o VirtualBox - free system</li>
</ul>
<p class="has-line-data" data-line-start="968" data-line-end="969"><strong>Virtual Machine Basics:</strong></p>
<ul>
<li class="has-line-data" data-line-start="970" data-line-end="974">Two types of virtualization<br>
o <strong>full virtualization</strong> - does not know it is a virtual machine<br>
o <strong>para</strong> - <strong>virtualization</strong> - knows it is using guest drivers<br>
▪ para-virtualization typically performs better with guest drivers</li>
<li class="has-line-data" data-line-start="974" data-line-end="979">Virtual machine can be cloned or templated to rapidly deeply new systems<br>
o you will likely need to change the Linux system’s Dbus ID<br>
o dbus-uuidgen will ensure that each running kernel interacts with a system that has a<br>
unique ID</li>
</ul>
<p class="has-line-data" data-line-start="979" data-line-end="980"><strong>Virtual Machines in the Cloud</strong></p>
<ul>
<li class="has-line-data" data-line-start="981" data-line-end="982">Virtual servers can be provisioned from cloud providers</li>
<li class="has-line-data" data-line-start="982" data-line-end="988"><strong>cloud-init</strong> is typically used to insure that user data is new and unique<br>
o creates new SSH keys<br>
o sets systems default location<br>
o sets the system’s host name<br>
o sets up mount points</li>
</ul>
<p class="has-line-data" data-line-start="988" data-line-end="989"><strong>What is a Container?</strong></p>
<ul>
<li class="has-line-data" data-line-start="990" data-line-end="992">A container is an entirely isolated set of packages, libraries, and/or applications that are<br>
completely independent from their surroundings</li>
<li class="has-line-data" data-line-start="992" data-line-end="993">For getting an application up and running quickly</li>
<li class="has-line-data" data-line-start="993" data-line-end="994">Machine Container will share a kernel and file system with the host computer</li>
<li class="has-line-data" data-line-start="994" data-line-end="997">Application Container: shares everything but the application files and library files that the<br>
application needs</li>
</ul>
<pre><code class="has-line-data" data-line-start="998" data-line-end="1000">o able to rapidly deploy web servers when traffic is high
</code></pre>
<ul>
<li class="has-line-data" data-line-start="1001" data-line-end="1003">Examples of <strong>Container Tech</strong> :</li>
</ul>
<pre><code class="has-line-data" data-line-start="1004" data-line-end="1009">o Docker
o nspawn (from systemd)
o LXD
o OpenShift
</code></pre>
<p class="has-line-data" data-line-start="1010" data-line-end="1011"><strong>What is the difference between the two and why is it important</strong></p>
<ul>
<li class="has-line-data" data-line-start="1012" data-line-end="1014"><strong>Virtualization</strong></li>
</ul>
<pre><code class="has-line-data" data-line-start="1015" data-line-end="1022">o was invented to allow the sharing yet segregation of server instances from each other
o protects one operating system from another
o prevention of spare CPU cycles, memory, or disk space go to waste
▪ get the best bang for your buck to make use of all the resource
o emulating virtual hardware through a hyper visor
▪ heavy in terms of system requirements
</code></pre>
<ul>
<li class="has-line-data" data-line-start="1023" data-line-end="1025"><strong>Containers</strong></li>
</ul>
<pre><code class="has-line-data" data-line-start="1026" data-line-end="1030">o use shared operating systems
o more efficient in system resource terms
o more granular management of system resources
</code></pre>
<p class="has-line-data" data-line-start="1031" data-line-end="1032"><strong>103. 1 – Work on the command line – 4</strong></p>
<p class="has-line-data" data-line-start="1033" data-line-end="1034">We study:</p>
<ul>
<li class="has-line-data" data-line-start="1035" data-line-end="1036">working with shells and commands to perform basic tasks;</li>
<li class="has-line-data" data-line-start="1036" data-line-end="1037">use and modification of the shell environment, including environment variables;</li>
<li class="has-line-data" data-line-start="1037" data-line-end="1038">work with the history of executed commands;</li>
<li class="has-line-data" data-line-start="1038" data-line-end="1040">work with teams based on the current location.</li>
</ul>
<p class="has-line-data" data-line-start="1040" data-line-end="1041"><strong>Terms and utilities:</strong></p>
<ul>
<li class="has-line-data" data-line-start="1042" data-line-end="1043">bash</li>
<li class="has-line-data" data-line-start="1043" data-line-end="1044">echo</li>
<li class="has-line-data" data-line-start="1044" data-line-end="1045">env</li>
<li class="has-line-data" data-line-start="1045" data-line-end="1046">export</li>
<li class="has-line-data" data-line-start="1046" data-line-end="1047">pwd</li>
<li class="has-line-data" data-line-start="1047" data-line-end="1048">set</li>
<li class="has-line-data" data-line-start="1048" data-line-end="1049">unset</li>
<li class="has-line-data" data-line-start="1049" data-line-end="1050">man</li>
<li class="has-line-data" data-line-start="1050" data-line-end="1051">uname</li>
<li class="has-line-data" data-line-start="1051" data-line-end="1052">history</li>
<li class="has-line-data" data-line-start="1052" data-line-end="1054">.bash_history</li>
</ul>
<p class="has-line-data" data-line-start="1054" data-line-end="1056">The administrator’s job with Linux is primarily to operate on the command line. A command line or<br>
console is a separate programmable environment with its own settings, capabilities, and tools. There are</p>
<p class="has-line-data" data-line-start="1057" data-line-end="1058">many different shells, this lesson discusses bash, used in most modern operating systems.</p>
<p class="has-line-data" data-line-start="1059" data-line-end="1061">You can see the name of the default shell used by the user at the end of each line of the / ** etc /<br>
passwd file. The global command line settings are in the / etc / ** profile file, and the settings for each</p>
<p class="has-line-data" data-line-start="1062" data-line-end="1063">user are in the files in his home directory.</p>
<p class="has-line-data" data-line-start="1064" data-line-end="1066">However, there are several options for the location of the settings, depending on the family of operating<br>
systems. In general, the settings are searched in the following order: ~ / .bash_profile, ~ / .bash_login,</p>
<p class="has-line-data" data-line-start="1067" data-line-end="1068">and ~ / .profile (settings are taken from the first detected file).</p>
<p class="has-line-data" data-line-start="1069" data-line-end="1070">The following common commands are used when <strong>working in the console</strong> (there are more of them, but</p>
<p class="has-line-data" data-line-start="1071" data-line-end="1072">in this topic LPI for some reason focuses on these):</p>
<ul>
<li class="has-line-data" data-line-start="1073" data-line-end="1074"><strong>cat</strong> - output the contents of the file to the console;</li>
<li class="has-line-data" data-line-start="1074" data-line-end="1075"><strong>cd</strong> - go to the directory;</li>
<li class="has-line-data" data-line-start="1075" data-line-end="1076"><strong>ls</strong> - output directory content;</li>
<li class="has-line-data" data-line-start="1076" data-line-end="1077"><strong>echo</strong> - text output to the console;</li>
<li class="has-line-data" data-line-start="1077" data-line-end="1078"><strong>touch</strong> - update the file editing time or create a new empty file;</li>
<li class="has-line-data" data-line-start="1078" data-line-end="1080">** <strong>uname</strong> ** - output the name of the OS;</li>
</ul>
<p class="has-line-data" data-line-start="1080" data-line-end="1082">The console, as a separate working environment, contains its own variables: environment variables<br>
(global variables used in the OS) and ordinary variables (working within a running console session). The</p>
<p class="has-line-data" data-line-start="1083" data-line-end="1084">following commands are available for <strong>viewing variables</strong> :</p>
<ul>
<li class="has-line-data" data-line-start="1085" data-line-end="1086"><strong>env</strong> - output environment variables;</li>
<li class="has-line-data" data-line-start="1086" data-line-end="1087"><strong>export</strong> - turning a variable into an environment variable;</li>
<li class="has-line-data" data-line-start="1087" data-line-end="1089"><strong>unset</strong> - disable variable;</li>
</ul>
<p class="has-line-data" data-line-start="1089" data-line-end="1090">To <strong>create a variable</strong> , use simple syntax variable_name = variable_value. To refer to a variable, the $ sign</p>
<p class="has-line-data" data-line-start="1091" data-line-end="1092">is specified, for example:</p>
<p class="has-line-data" data-line-start="1093" data-line-end="1094">X ** = 12 ** (set the variable X to 12);</p>
<p class="has-line-data" data-line-start="1095" data-line-end="1096">echo $ ** X **** ** (display the value of the variable X _); _</p>
<p class="has-line-data" data-line-start="1097" data-line-end="1099">To execute a command in the current directory (you can find it with the pwd command), you need to<br>
specify the full path to the command (_ for example, / home / semaev / _script), if the current directory</p>
<p class="has-line-data" data-line-start="1100" data-line-end="1101">is not listed in the values of the PATH environment variable.</p>
<p class="has-line-data" data-line-start="1102" data-line-end="1103">The following commands are available for reference:</p>
<ul>
<li class="has-line-data" data-line-start="1104" data-line-end="1105"><strong>man</strong> - command reference;</li>
<li class="has-line-data" data-line-start="1105" data-line-end="1106"><strong>file</strong> - file reference;</li>
<li class="has-line-data" data-line-start="1106" data-line-end="1107"><strong>whatis</strong> - name help;</li>
<li class="has-line-data" data-line-start="1107" data-line-end="1109"><strong>history</strong> - output command history (the list is stored in .bash_history);</li>
</ul>
<p class="has-line-data" data-line-start="1109" data-line-end="1111">Separately, mention should be made of the exec command, which allows you to execute a command<br>
outside the current shell, dropping superuser rights.</p>
<p class="has-line-data" data-line-start="1112" data-line-end="1113"><strong>103. 2 – Process text streams using filters – 2</strong></p>
<p class="has-line-data" data-line-start="1114" data-line-end="1115"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="1116" data-line-end="1118">Send text files and output streams through text utility filters to modify the output using<br>
standard UNIX commands found in the GNU textutils package.</li>
<li class="has-line-data" data-line-start="1118" data-line-end="1119">cat</li>
<li class="has-line-data" data-line-start="1119" data-line-end="1120">cut</li>
<li class="has-line-data" data-line-start="1120" data-line-end="1121">expand</li>
<li class="has-line-data" data-line-start="1121" data-line-end="1122">fmt</li>
<li class="has-line-data" data-line-start="1122" data-line-end="1123">head</li>
<li class="has-line-data" data-line-start="1123" data-line-end="1124">od</li>
<li class="has-line-data" data-line-start="1124" data-line-end="1125">join</li>
<li class="has-line-data" data-line-start="1125" data-line-end="1126">nl</li>
<li class="has-line-data" data-line-start="1126" data-line-end="1127">paste</li>
<li class="has-line-data" data-line-start="1127" data-line-end="1128">pr</li>
<li class="has-line-data" data-line-start="1128" data-line-end="1129">sed</li>
<li class="has-line-data" data-line-start="1129" data-line-end="1130">sort</li>
<li class="has-line-data" data-line-start="1130" data-line-end="1131">split</li>
<li class="has-line-data" data-line-start="1131" data-line-end="1132">tail</li>
<li class="has-line-data" data-line-start="1132" data-line-end="1133">tr</li>
<li class="has-line-data" data-line-start="1133" data-line-end="1134">unexpand</li>
<li class="has-line-data" data-line-start="1134" data-line-end="1135">uniq</li>
<li class="has-line-data" data-line-start="1135" data-line-end="1137">wc</li>
</ul>
<p class="has-line-data" data-line-start="1137" data-line-end="1138"><strong>Streams</strong></p>
<p class="has-line-data" data-line-start="1139" data-line-end="1140">In <strong>UNIX</strong> world a lot of data is in TEXT form. Log files, configurations, user inputs, list of files, …</p>
<p class="has-line-data" data-line-start="1141" data-line-end="1145">. <strong>Filtering</strong> this data means taking an input stream of text and performing some conversion on the text<br>
before sending it to an output stream. In this context, a <strong>streams</strong> is nothing more than <em>“a sequence of<br>
bytes that can be read or written using library functions that hide the details of an underlying device<br>
from the application”</em>.</p>
<p class="has-line-data" data-line-start="1146" data-line-end="1148">In simple words, a text stream is an input of text from keyboard, a file, a network device, … and filtering<br>
it is automatically changing it.</p>
<p class="has-line-data" data-line-start="1149" data-line-end="1151">As you saw in previous section, modern programming environments and shells (including bash) use<br>
three standard I/O streams:</p>
<ul>
<li class="has-line-data" data-line-start="1152" data-line-end="1153"><strong>stdin</strong> is the standard input stream, which provides input to commands.</li>
<li class="has-line-data" data-line-start="1153" data-line-end="1154"><strong>stdout</strong> is the standard output stream, which displays output from commands.</li>
<li class="has-line-data" data-line-start="1154" data-line-end="1156"><strong>stderr</strong> is the standard error stream, which displays error output from commands</li>
</ul>
<p class="has-line-data" data-line-start="1156" data-line-end="1157"><strong>Piping ( | )</strong></p>
<p class="has-line-data" data-line-start="1158" data-line-end="1162">In <em>normal</em> cases, you give input from keyboard and output to the monitor. But in real life of a system<br>
admin, most inputs come from another commands. If you want to give the output of command1 as the<br>
input of command2, you should <strong>PIPE</strong> them as command1 | command2.<br>
this | looks like a pipe!</p>
<p class="has-line-data" data-line-start="1163" data-line-end="1178">jadi@funlife:~/w/lpic/101$ <strong>ls - 1 | sort</strong><br>
12<br>
62<br>
amir<br>
jadi<br>
neda<br>
you<br>
jadi@funlife:~/w/lpic/101$ <strong>ls - 1 | sort - r</strong><br>
you<br>
neda<br>
jadi<br>
amir<br>
62<br>
12<br>
UNIX philosophy is building small, strong tools and combine them</p>
<p class="has-line-data" data-line-start="1179" data-line-end="1180"><strong>Redirection ( &gt; )</strong></p>
<p class="has-line-data" data-line-start="1181" data-line-end="1185">Another useful way of controlling the streams is &gt;. This help you to redirect your output (mostly to a<br>
file).<br>
jadi@funlife:~/w/lpic/101$ <strong>ls - ltrh</strong><br>
total 0</p>
<ul>
<li class="has-line-data" data-line-start="1186" data-line-end="1187">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 12</li>
<li class="has-line-data" data-line-start="1187" data-line-end="1188">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 62</li>
<li class="has-line-data" data-line-start="1188" data-line-end="1189">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 neda</li>
<li class="has-line-data" data-line-start="1189" data-line-end="1190">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 jadi</li>
<li class="has-line-data" data-line-start="1190" data-line-end="1191">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 you</li>
<li class="has-line-data" data-line-start="1191" data-line-end="1195">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:34 amir<br>
jadi@funlife:~/w/lpic/101$ <strong>ls - ltrh &gt; directory_data</strong><br>
jadi@funlife:~/w/lpic/101$ <strong>cat directory_data</strong><br>
total 0</li>
<li class="has-line-data" data-line-start="1195" data-line-end="1196">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 12</li>
<li class="has-line-data" data-line-start="1196" data-line-end="1197">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 62</li>
<li class="has-line-data" data-line-start="1197" data-line-end="1198">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 neda</li>
<li class="has-line-data" data-line-start="1198" data-line-end="1199">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 jadi</li>
<li class="has-line-data" data-line-start="1199" data-line-end="1200">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 you</li>
<li class="has-line-data" data-line-start="1200" data-line-end="1201">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:34 amir</li>
<li class="has-line-data" data-line-start="1201" data-line-end="1203">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:37 directory_data</li>
</ul>
<p class="has-line-data" data-line-start="1203" data-line-end="1204"><strong>Cat</strong></p>
<p class="has-line-data" data-line-start="1205" data-line-end="1207">This command simply <strong>outputs its input stream</strong> (or the filename you give it). As you saw in previous<br>
section. As most commands, if you do not give an input to it, it will read the data from the keyboard.</p>
<p class="has-line-data" data-line-start="1208" data-line-end="1217">jadi@funlife:~/w/lpic/101$ <strong>cat &gt; mydata</strong><br>
test<br>
this is the second line<br>
bye<br>
jadi@funlife:~/w/lpic/101$ <strong>cat mydata</strong><br>
test<br>
this is the second line<br>
bye<br>
When inputting data, ctrl+d will end the stream.</p>
<p class="has-line-data" data-line-start="1218" data-line-end="1219">it is also possible to add files to each other using cat:</p>
<p class="has-line-data" data-line-start="1220" data-line-end="1225">jadi@funlife:~/w/lpic/101$ <strong>cat mydata directory_data</strong><br>
test<br>
this is the second line<br>
bye<br>
total 0</p>
<ul>
<li class="has-line-data" data-line-start="1226" data-line-end="1227">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 12</li>
<li class="has-line-data" data-line-start="1227" data-line-end="1228">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 62</li>
<li class="has-line-data" data-line-start="1228" data-line-end="1229">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 neda</li>
<li class="has-line-data" data-line-start="1229" data-line-end="1230">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 jadi</li>
<li class="has-line-data" data-line-start="1230" data-line-end="1231">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:33 you</li>
<li class="has-line-data" data-line-start="1231" data-line-end="1232">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:34 amir</li>
<li class="has-line-data" data-line-start="1232" data-line-end="1234">rw-rw-r-- 1 jadi jadi 0 Jan 4 17:37 directory_data</li>
</ul>
<p class="has-line-data" data-line-start="1234" data-line-end="1235"><strong>Od</strong></p>
<p class="has-line-data" data-line-start="1236" data-line-end="1238">This command <strong><em>dump</em></strong> <strong>s files</strong> (shows files in formats other than text). Normal behaviour is OctalDump<br>
(base 8):</p>
<p class="has-line-data" data-line-start="1239" data-line-end="1245">jadi@funlife:~/w/lpic/101$ <strong>od mydata</strong><br>
0000000 062564 072163 072012 064550 020163 071551 072040 062550<br>
0000020 071440 061545 067543 062156 066040 067151 005145 074542<br>
0000040 005145<br>
0000042<br>
Not good… lets use two switches:</p>
<ul>
<li class="has-line-data" data-line-start="1246" data-line-end="1248">
<ul>
<li class="has-line-data" data-line-start="1246" data-line-end="1248">t will tell what format to print (-t a for showing only named characters or - t c for showing<br>
escaped chars)</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1248" data-line-end="1250">
<ul>
<li class="has-line-data" data-line-start="1248" data-line-end="1250">A for choosing how to show offsets (-A``` Decimal, Octal, Hex or N````one)</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="1250" data-line-end="1252">od is very useful to find problems in your text files - say finding out if you are using tabs or correct line<br>
endings</p>
<p class="has-line-data" data-line-start="1253" data-line-end="1254"><strong>Split</strong></p>
<p class="has-line-data" data-line-start="1255" data-line-end="1257">Will split files. It is very useful for transferring HUGE files on smaller media (say splitting a 3TB file to 8GB<br>
parts and moving them to another machine with a USB Disk).</p>
<p class="has-line-data" data-line-start="1258" data-line-end="1276">jadi@funlife:~/w/lpic/101$ <strong>cat mydata</strong><br>
hello<br>
this is second line<br>
but as you can see we are<br>
still writing<br>
and this is getting longer<br>
.<br>
.<br>
and longer<br>
and longer!<br>
jadi@funlife:~/w/lpic/101$ <strong>ls</strong><br>
mydata<br>
jadi@funlife:~/w/lpic/101$ <strong>split - l 2 mydata</strong><br>
jadi@funlife:~/w/lpic/101$ <strong>ls</strong><br>
mydata xaa xab xac xad xae<br>
jadi@funlife:~/w/lpic/101$ <strong>cat xab</strong><br>
but as you can see we are<br>
still writing</p>
<ul>
<li class="has-line-data" data-line-start="1277" data-line-end="1279">on normal case, split uses xaa, xab, xac, … for output files. If can be changed with split -l 2<br>
mydata output which will lead to outputaa, outputab, …</li>
<li class="has-line-data" data-line-start="1279" data-line-end="1281">the - l 2``` switch told the split to put 2 lines in output files. It is possible to use - b 42to split every<br>
42 bytes or even-n 5```` to force 5 output files.</li>
<li class="has-line-data" data-line-start="1281" data-line-end="1283">if you want numeric output (x00, x01, …) use - d</li>
</ul>
<p class="has-line-data" data-line-start="1283" data-line-end="1284">need to join these files? cat them with cat x* &gt; originalfile.</p>
<p class="has-line-data" data-line-start="1285" data-line-end="1286"><strong>wc</strong></p>
<p class="has-line-data" data-line-start="1287" data-line-end="1288">wc is <strong><em>word count</em></strong>. It counts the characters, lines and bytes in the input stream.</p>
<p class="has-line-data" data-line-start="1289" data-line-end="1292">jadi@funlife:~/w/lpic/101$ <strong>wc mydata</strong><br>
9 25 121 mydata<br>
It is very normal to count the line numbers with - l switch.</p>
<p class="has-line-data" data-line-start="1293" data-line-end="1294"><strong>Head &amp; Tail</strong></p>
<p class="has-line-data" data-line-start="1295" data-line-end="1298">Shows the <em>head</em> (top) of a file or its <em>tail</em> (bottom). The default lines to show is 10 but you can specify<br>
with - n20 or - 20.<br>
tali -f will continue showing the new lines which are being written at the eng of the file. Very useful.</p>
<p class="has-line-data" data-line-start="1299" data-line-end="1300"><strong>Expand &amp; Unexpand &amp; tr</strong></p>
<p class="has-line-data" data-line-start="1301" data-line-end="1302">Expand will <strong>replace the tabs</strong> in a stream <strong>with spaces</strong> (normally 8 but can be defined with -n12 for 12):</p>
<p class="has-line-data" data-line-start="1303" data-line-end="1320">jadi@funlife:~/w/lpic/101$ <strong>cat howcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2<br>
you 12<br>
jadi@funlife:~/w/lpic/101$ <strong>od - tc howcool</strong><br>
0000000 j a d i \t 5 \n s i n a \t 6 \n r u<br>
0000020 b i c \t 2 \n y o u \t 1 2 \n<br>
0000036<br>
jadi@funlife:~/w/lpic/101$ <strong>expand howcool | od - tc</strong><br>
0000000 j a d i 5 \n s i n a<br>
0000020 6 \n r u b i c 2 \n y o<br>
0000040 u 1 2 \n<br>
0000051<br>
Unexpand will do the reverse. The default is converting only the initial blanks but his can be overrided<br>
by using - a.<br>
unexpand needs at least two spaces.</p>
<p class="has-line-data" data-line-start="1321" data-line-end="1343">The <strong>tr</strong> command <strong><em>translates</em></strong> A to 1, B to 2 and C to 3 in a stream you have to tr ‘ABC’ ‘123’. It is a pure<br>
filter so if you need to give it file to work on, you have to use cat:<br>
jadi@funlife:~/w/lpic/101$ <strong>cat mydata</strong><br>
hello<br>
this is second line<br>
but as you can see we are<br>
still writing<br>
and this is getting longer<br>
.<br>
.<br>
and longer<br>
and longer!<br>
jadi@funlife:~/w/lpic/101$ <strong>cat mydata | tr ‘and’ ‘AND’</strong><br>
hello<br>
this is second liNe<br>
but As you cAN see we Are<br>
still writiNg<br>
AND this is gettiNg loNger<br>
.<br>
.<br>
AND loNger<br>
AND loNger!</p>
<p class="has-line-data" data-line-start="1344" data-line-end="1345">Note: all <strong>a</strong> s are replaced with <strong>A</strong>.</p>
<p class="has-line-data" data-line-start="1346" data-line-end="1368">You should know that if you put - instead of a filename, the data will be replaced from the pipe (or<br>
keyboard stdin).<br>
jadi@funlife:~/w/lpic/101$ <strong>wc - l mydata | cat mydata - mydata</strong><br>
hello<br>
this is second line<br>
but as you can see we are<br>
still writing<br>
and this is getting longer<br>
.<br>
.<br>
and longer<br>
and longer!<br>
9 mydata<br>
hello<br>
this is second line<br>
but as you can see we are<br>
still writing<br>
and this is getting longer<br>
.<br>
.<br>
and longer<br>
and longer!</p>
<p class="has-line-data" data-line-start="1369" data-line-end="1370"><strong>pr</strong></p>
<p class="has-line-data" data-line-start="1371" data-line-end="1373">This <strong>formats text</strong> for classic <em>printers</em>. The default header includes the filename and file creation date and<br>
time, along with a page number and two lines of blank footer.</p>
<p class="has-line-data" data-line-start="1374" data-line-end="1375"><strong>pr mydata</strong></p>
<p class="has-line-data" data-line-start="1376" data-line-end="1377">2015 - 01 - 04 17:58 mydata Page 1</p>
<p class="has-line-data" data-line-start="1378" data-line-end="1388">hello<br>
this is second line<br>
but as you can see we are<br>
still writing<br>
and this is getting longer<br>
.<br>
.<br>
and longer<br>
and longer!<br>
It is possible to print in two or more columns and other outdated fun stuff.</p>
<p class="has-line-data" data-line-start="1389" data-line-end="1391">When output is created from multiple files or the standard input stream, the current date and time are<br>
used instead of the filename and creation date.</p>
<p class="has-line-data" data-line-start="1392" data-line-end="1393"><strong>nl</strong></p>
<p class="has-line-data" data-line-start="1394" data-line-end="1395">Simply <strong>numbers lines</strong>.</p>
<p class="has-line-data" data-line-start="1396" data-line-end="1400">jadi@funlife:~/w/lpic/101$ <strong>nl mydata | head - 3</strong><br>
1 hello<br>
2 this is second line<br>
3 but as you can see we are</p>
<p class="has-line-data" data-line-start="1401" data-line-end="1402">cat -n will also number lines.</p>
<p class="has-line-data" data-line-start="1403" data-line-end="1404"><strong>fmt</strong></p>
<p class="has-line-data" data-line-start="1405" data-line-end="1406">Will <strong>reformat a text file</strong> within <strong>margins</strong> (say 80 columns width or 60 if you use -w60).</p>
<p class="has-line-data" data-line-start="1407" data-line-end="1410">jadi@funlife:~/w/lpic/101$ <strong>fmt mydata</strong><br>
hello this is second line but as you can see we are still writing and<br>
this is getting longer… and longer and longer!</p>
<p class="has-line-data" data-line-start="1411" data-line-end="1412"><strong>sort &amp; uniq</strong></p>
<p class="has-line-data" data-line-start="1413" data-line-end="1414">Will <strong>sorts</strong> its input(s).</p>
<p class="has-line-data" data-line-start="1415" data-line-end="1434">jadi@funlife:~/w/lpic/101$ <strong>cat uses</strong><br>
you fedora<br>
jadi ubuntu<br>
rubic windows<br>
neda mac<br>
jadi@funlife:~/w/lpic/101$ <strong>cat howcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2<br>
you 12<br>
jadi@funlife:~/w/lpic/101$ <strong>sort howcool uses</strong><br>
jadi 5<br>
jadi ubuntu<br>
neda mac<br>
rubic 2<br>
rubic windows<br>
sina 6<br>
you 12<br>
if you want to sort NUMERICALLY (so 9 is lower than 19), use - n - r will reverse the search</p>
<p class="has-line-data" data-line-start="1435" data-line-end="1453">and the <strong>uniq removes duplicate entries</strong> from its input. Normal behaviour is removing only the<br>
duplicated lines but you can change the behaviour for example by giving - f1 to force it to not check fist<br>
field.<br>
jadi@funlife:~/w/lpic/101$ <strong>uniq what_i_have.txt</strong><br>
laptop<br>
socks<br>
tshirt<br>
ball<br>
socks<br>
glasses<br>
jadi@funlife:~/w/lpic/101$ <strong>sort what_i_have.txt | uniq</strong><br>
ball<br>
glasses<br>
laptop<br>
socks<br>
tshirt<br>
jadi@funlife:~/w/lpic/101$<br>
As you can see, the input HAVE TO BE sorted for uniq to work</p>
<p class="has-line-data" data-line-start="1454" data-line-end="1455"><strong>uniq</strong> has great switches:</p>
<p class="has-line-data" data-line-start="1456" data-line-end="1477">jadi@funlife:~/w/lpic/101$ <strong>cat what_i_have.txt</strong><br>
laptop<br>
socks<br>
tshirt<br>
ball<br>
socks<br>
glasses<br>
jadi@funlife:~/w/lpic/101$ <strong>sort what_i_have.txt | uniq - c #show count of each item</strong><br>
1 ball<br>
1 glasses<br>
1 laptop<br>
2 socks<br>
1 tshirt<br>
jadi@funlife:~/w/lpic/101$ <strong>sort what_i_have.txt | uniq - u #show only non-repeated items</strong><br>
ball<br>
glasses<br>
laptop<br>
tshirt<br>
jadi@funlife:~/w/lpic/101$ <strong>sort what_i_have.txt | uniq - d #show only repeated items</strong><br>
socks<br>
how many things I have? wc -l what_i_have.txt :)</p>
<p class="has-line-data" data-line-start="1478" data-line-end="1479"><strong>Cut</strong></p>
<p class="has-line-data" data-line-start="1480" data-line-end="1481">cut command will <strong><em>cut</em></strong> <strong>a column</strong> of one file. Good for separating fields:</p>
<p class="has-line-data" data-line-start="1482" data-line-end="1483">Let’s cut the <em>first field</em> of a file.</p>
<p class="has-line-data" data-line-start="1484" data-line-end="1496">jadi@funlife:~/w/lpic/101$ <strong>cat howcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2<br>
you 12<br>
jadi@funlife:~/w/lpic/101$ <strong>cut - f1 howcool</strong><br>
jadi<br>
sina<br>
rubic<br>
you<br>
normal delimiter is TAB. use -dx to change it to “x” or use | tr ’ ’ ‘\t’ | to convert spaces in your stream to<br>
TABs.</p>
<p class="has-line-data" data-line-start="1497" data-line-end="1500">It is also possible to <em>cut</em> fields 1, 2, 3 with - f1- 3 or only characters 4,5,7,8 with - c4,5,7,8.<br>
#paste The paste command pastes lines from two or more files side-by-side! You can not do this in a<br>
normal text editor.</p>
<p class="has-line-data" data-line-start="1501" data-line-end="1516">jadi@funlife:~/w/lpic/101$ <strong>cat howcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2<br>
you 12<br>
jadi@funlife:~/w/lpic/101$ <strong>cat uses</strong><br>
you fedora<br>
jadi ubuntu<br>
rubic windows<br>
neda mac<br>
jadi@funlife:~/w/lpic/101$ <strong>paste howcool uses</strong><br>
jadi 5 you fedora<br>
sina 6 jadi ubuntu<br>
rubic 2 rubic windows<br>
you 12 neda mac</p>
<p class="has-line-data" data-line-start="1517" data-line-end="1518"><strong>join</strong></p>
<p class="has-line-data" data-line-start="1519" data-line-end="1521">Our final field-manipulating command is join, which <strong>joins files</strong> based on a matching field. <strong>The files<br>
should be sorted on the join field.</strong></p>
<p class="has-line-data" data-line-start="1522" data-line-end="1526">jadi@funlife:~/w/lpic/101$ <strong>cat howcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2</p>
<p class="has-line-data" data-line-start="1527" data-line-end="1541">you 12<br>
jadi@funlife:~/w/lpic/101$ <strong>cat uses</strong><br>
you fedora<br>
jadi ubuntu<br>
rubic windows<br>
neda mac<br>
jadi@funlife:~/w/lpic/101$ <strong>sort howcool &gt; howcool.sorted</strong><br>
jadi@funlife:~/w/lpic/101$ <strong>sort uses &gt; uses.sorted</strong><br>
jadi@funlife:~/w/lpic/101$ <strong>join howcool.sorted uses.sorted</strong><br>
jadi 5 ubuntu<br>
rubic 2 windows<br>
you 12 fedora<br>
join does not work on numeric fields unless the fields are all the same length. It default delimiter is any<br>
white space (TAB, space) and it joins on first field. check man join for more info.</p>
<p class="has-line-data" data-line-start="1542" data-line-end="1543"><strong>Sed</strong></p>
<p class="has-line-data" data-line-start="1544" data-line-end="1561">sed is <strong>stream editor</strong>. It is POWERFUL and can do magic! Just like most of the tools we saw, sed can work<br>
as a filter or take its input from a file. It uses <strong>regular expressions</strong> and is a great tool for replacing text. If<br>
you need to replace A with B only once in each line in a stream you have to say sed ‘s/A/B/’:<br>
jadi@funlife:~/w/lpic/101$ <strong>cat uses</strong><br>
you fedora<br>
jadi ubuntu<br>
rubic windows<br>
neda mac<br>
jadi@funlife:~/w/lpic/101$ <strong>sed ‘s/ubuntu/debian/’ uses</strong><br>
you fedora<br>
jadi debian<br>
rubic windows<br>
neda mac<br>
jadi@funlife:~/w/lpic/101$<br>
the pattern for changing EVERY occurrence of A to B in a line is sed ‘s/A/B/g’.<br>
Remember escape characters? They also work here and this will remove every <em>new line</em> from a file and<br>
will replace it with a space:</p>
<p class="has-line-data" data-line-start="1562" data-line-end="1573">jadi@funlife:~/w/lpic/101$ <strong>cat mydata</strong><br>
hello<br>
this is second line<br>
but as you can see we are<br>
still writing<br>
jadi@funlife:~/w/lpic/101$ <strong>sed ‘s/ /\t/g’ mydata &gt; mydata.tab</strong><br>
jadi@funlife:~/w/lpic/101$ <strong>cat mydata.tab</strong><br>
hello<br>
this is second line<br>
but as you can see we are<br>
still writing</p>
<p class="has-line-data" data-line-start="1574" data-line-end="1575"><strong>103. 3 – Perform basic file management – 4</strong></p>
<p class="has-line-data" data-line-start="1576" data-line-end="1577"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="1578" data-line-end="1579">Copy, move and remove files and directories individually.</li>
<li class="has-line-data" data-line-start="1579" data-line-end="1580">Copy multiple files and directories recursively.</li>
<li class="has-line-data" data-line-start="1580" data-line-end="1581">Remove files and directories recursively.</li>
<li class="has-line-data" data-line-start="1581" data-line-end="1582">Use simple and advanced wildcard specifications in commands.</li>
<li class="has-line-data" data-line-start="1582" data-line-end="1583">Using find to locate and act on files based on type, size, or time.</li>
<li class="has-line-data" data-line-start="1583" data-line-end="1584">Usage of tar, cpio and dd.</li>
<li class="has-line-data" data-line-start="1584" data-line-end="1585">cp</li>
<li class="has-line-data" data-line-start="1585" data-line-end="1586">find</li>
<li class="has-line-data" data-line-start="1586" data-line-end="1587">mkdir</li>
<li class="has-line-data" data-line-start="1587" data-line-end="1588">mv</li>
<li class="has-line-data" data-line-start="1588" data-line-end="1589">ls</li>
<li class="has-line-data" data-line-start="1589" data-line-end="1590">rm</li>
<li class="has-line-data" data-line-start="1590" data-line-end="1591">rmdir</li>
<li class="has-line-data" data-line-start="1591" data-line-end="1592">touch</li>
<li class="has-line-data" data-line-start="1592" data-line-end="1593">tar</li>
<li class="has-line-data" data-line-start="1593" data-line-end="1594">cpio</li>
<li class="has-line-data" data-line-start="1594" data-line-end="1595">dd</li>
<li class="has-line-data" data-line-start="1595" data-line-end="1596">file</li>
<li class="has-line-data" data-line-start="1596" data-line-end="1597">gzip</li>
<li class="has-line-data" data-line-start="1597" data-line-end="1598">gunzip</li>
<li class="has-line-data" data-line-start="1598" data-line-end="1599">bzip2</li>
<li class="has-line-data" data-line-start="1599" data-line-end="1601">file globbing</li>
</ul>
<p class="has-line-data" data-line-start="1601" data-line-end="1602"><strong>ls</strong></p>
<p class="has-line-data" data-line-start="1603" data-line-end="1604">Is used to <strong><em>list</em></strong> <strong>directories &amp; files</strong>. It can use absolute and relative paths</p>
<p class="has-line-data" data-line-start="1605" data-line-end="1607">$ <strong>ls - l</strong><br>
total 52</p>
<ul>
<li class="has-line-data" data-line-start="1608" data-line-end="1609">rw-rw-r-- 1 jadi jadi 146 Jan 5 08:29 alldata</li>
<li class="has-line-data" data-line-start="1609" data-line-end="1610">rw-rw-r-- 1 jadi jadi 30 Jan 5 09:15 howcool.sort</li>
<li class="has-line-data" data-line-start="1610" data-line-end="1611">rw-rw-r-- 1 jadi jadi 204 Jan 5 08:49 mydata</li>
<li class="has-line-data" data-line-start="1611" data-line-end="1618">rw-rw-r-- 1 jadi jadi 121 Jan 4 22:07 mydata.tab<br>
First field indicates if this is a file (-) or directory (d).
<ul>
<li class="has-line-data" data-line-start="1613" data-line-end="1614">
<ul>
<li class="has-line-data" data-line-start="1613" data-line-end="1614">l is for <em>long</em> (more info for each file)</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1614" data-line-end="1615">
<ul>
<li class="has-line-data" data-line-start="1614" data-line-end="1615">1 will print one file per line</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1615" data-line-end="1616">
<ul>
<li class="has-line-data" data-line-start="1615" data-line-end="1616">t sorts based on modification date</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1616" data-line-end="1618">
<ul>
<li class="has-line-data" data-line-start="1616" data-line-end="1618">r reverses the search (so -tr is reverse time (newer files at the bottom).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="1618" data-line-end="1619">you can always mix switches. A famous one is - ltrh (long+human readable sizes+reverse time).</p>
<p class="has-line-data" data-line-start="1620" data-line-end="1621"><strong>Copying, Moving &amp; Deleting</strong></p>
<p class="has-line-data" data-line-start="1622" data-line-end="1623"><strong><em>cp</em></strong></p>
<p class="has-line-data" data-line-start="1624" data-line-end="1626">This will <strong><em>copy</em></strong> <strong>files</strong> from one place / name to another place / name. If the target is a directory, all sources<br>
will be copied there.</p>
<p class="has-line-data" data-line-start="1627" data-line-end="1628"><strong>cp source destination</strong></p>
<p class="has-line-data" data-line-start="1629" data-line-end="1630"><strong><em>mv</em></strong></p>
<p class="has-line-data" data-line-start="1631" data-line-end="1634">Will <strong><em>move</em></strong> <strong>or</strong> <strong><em>rename</em></strong> <strong>files or directories</strong>. It works like cp command. If you are moving a file on the same<br>
file system, the <strong>inode</strong> wont change.<br>
In general:</p>
<ul>
<li class="has-line-data" data-line-start="1635" data-line-end="1636">If the target is an existing directory, then all sources are copied into the target</li>
<li class="has-line-data" data-line-start="1636" data-line-end="1639">If the target is a directory that does not exist, then the (single) source must also be a directory<br>
and a copy of the source directory and its contents is made with the target name as the new<br>
name</li>
<li class="has-line-data" data-line-start="1639" data-line-end="1642">If the target is a file, then the (single) source must also be a file and a copy of the source file is<br>
made with the target name as the new name, replacing any existing file of the same name.</li>
</ul>
<p class="has-line-data" data-line-start="1642" data-line-end="1643">But use common sense when answering questions or using cp and mv in real life.</p>
<p class="has-line-data" data-line-start="1644" data-line-end="1645"><strong><em>rm</em></strong></p>
<p class="has-line-data" data-line-start="1646" data-line-end="1647"><strong>Removes</strong> ( <strong>Deletes</strong> ) files.</p>
<p class="has-line-data" data-line-start="1648" data-line-end="1649"><strong>General notes</strong></p>
<p class="has-line-data" data-line-start="1650" data-line-end="1653">Normally, the <strong>cp</strong> command will copy a file over an existing copy, if the existing file is writable. On the<br>
other hand, the <strong>mv</strong> will not move or rename a file if the target exists. You can overcome this using the -<br>
f switch.</p>
<ul>
<li class="has-line-data" data-line-start="1654" data-line-end="1655">
<ul>
<li class="has-line-data" data-line-start="1654" data-line-end="1655">f (–force) will cause cp to try overwrite the target.</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1655" data-line-end="1656">
<ul>
<li class="has-line-data" data-line-start="1655" data-line-end="1656">i (–interactive) will ask Y/N question (deleting / overwriting).</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1656" data-line-end="1657">
<ul>
<li class="has-line-data" data-line-start="1656" data-line-end="1657">b (–backup) will make backups of overwritten files</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1657" data-line-end="1659">
<ul>
<li class="has-line-data" data-line-start="1657" data-line-end="1659">p will <em>preserve</em> the attributes.</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="1659" data-line-end="1660"><strong>Creating and removing directories</strong></p>
<p class="has-line-data" data-line-start="1661" data-line-end="1664">The <strong>mkdir</strong> command <strong>creates directories</strong>.<br>
$ <strong>mkdir dirA dirB</strong><br>
$ <strong>ls - ltrh</strong></p>
<ul>
<li class="has-line-data" data-line-start="1665" data-line-end="1666">rw-rw-r-- 1 jadi jadi 30 Jan 8 16:45 howcool.sort</li>
<li class="has-line-data" data-line-start="1666" data-line-end="1671">rw-rw-r-- 1 jadi jadi 58 Jan 8 16:45 uses.sort<br>
drwxrwxr-x 2 jadi jadi 4.0K Jan 8 17:11 dirB<br>
drwxrwxr-x 2 jadi jadi 4.0K Jan 8 17:11 dirA
<ul>
<li class="has-line-data" data-line-start="1669" data-line-end="1671"><strong>- p</strong> will create nested directories:</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="1671" data-line-end="1677">$ <strong>mkdir newDir/insideNew/lastDir</strong><br>
mkdir: cannot create directory ‘newDir/insideNew/lastDir’: No such file or directory<br>
$ <strong>mkdir - p newDir/insideNew/lastDir</strong><br>
$ <strong>ls newDir/insideNew/ - ltrh</strong><br>
total 4.0K<br>
drwxrwxr-x 2 jadi jadi 4.0K Jan 8 17:13 lastDir</p>
<p class="has-line-data" data-line-start="1678" data-line-end="1685">If you need to delete a directory the command is <strong>rmdir</strong> and you can also use the -p for nested removing:<br>
$ <strong>tree</strong><br>
.<br>
├── dirA<br>
├── dirB<br>
├── howcool.sort<br>
└── uses.sort</p>
<p class="has-line-data" data-line-start="1686" data-line-end="1696">2 directories, 2 files<br>
$ <strong>rmdir dirA dirB</strong><br>
$ <strong>mkdir - p newDir/insideNew/lastDir</strong><br>
$ <strong>tree</strong><br>
.<br>
├── howcool.sort<br>
├── newDir<br>
│ └── insideNew<br>
│ └── lastDir<br>
└── uses.sort</p>
<p class="has-line-data" data-line-start="1697" data-line-end="1703">3 directories, 2 files<br>
$ <strong>rmdir - p newDir/insideNew/lastDir</strong><br>
$ <strong>tree</strong><br>
.<br>
├── howcool.sort<br>
└── uses.sort</p>
<p class="has-line-data" data-line-start="1704" data-line-end="1706">0 directories, 2 files<br>
If you are using <strong>rmdir</strong> to remove a directory, it <strong>MUST BE EMPTY</strong>!</p>
<p class="has-line-data" data-line-start="1707" data-line-end="1708"><strong>Handling multiple files at once</strong></p>
<p class="has-line-data" data-line-start="1709" data-line-end="1710">Most of the times we need to work with more than one file. This is <em>Linux</em> and there are ways!</p>
<p class="has-line-data" data-line-start="1711" data-line-end="1712"><strong><em>Recursive commands</em></strong></p>
<p class="has-line-data" data-line-start="1713" data-line-end="1715">Recursive means going inside and inside and inside and inside! In many commands -r or -R is dedicated<br>
to recursive commands. Say ls. It uses -R :</p>
<p class="has-line-data" data-line-start="1716" data-line-end="1721">$ <strong>ls</strong><br>
howcool.sort newDir uses.sort<br>
$ <strong>ls - R</strong><br>
.:<br>
howcool.sort newDir uses.sort</p>
<p class="has-line-data" data-line-start="1722" data-line-end="1724">./newDir:<br>
insideNew TestFile</p>
<p class="has-line-data" data-line-start="1725" data-line-end="1727">./newDir/insideNew:<br>
lastDir</p>
<p class="has-line-data" data-line-start="1728" data-line-end="1729">./newDir/insideNew/lastDir:</p>
<p class="has-line-data" data-line-start="1730" data-line-end="1740">It is more useful when you are copying or deleting. When using cp or rm, -r (or -R or --recursive) will<br>
copy/delete all files inside the given source.<br>
$ <strong>tree mydir</strong><br>
mydir<br>
├── howcool.sort<br>
├── newDir<br>
│ ├── insideNew<br>
│ │ └── lastDir<br>
│ └── TestFile<br>
└── uses.sort</p>
<p class="has-line-data" data-line-start="1741" data-line-end="1754">3 directories, 3 files<br>
$ <strong>mkdir newCopy</strong><br>
$ <strong>cp mydir newCopy</strong><br>
cp: omitting directory ‘mydir’<br>
$ <strong>cp - r mydir newCopy</strong><br>
$ <strong>tree newCopy/</strong><br>
newCopy/<br>
└── mydir<br>
├── howcool.sort<br>
├── newDir<br>
│ ├── insideNew<br>
│ │ └── lastDir<br>
│ └── TestFile</p>
<p class="has-line-data" data-line-start="1755" data-line-end="1756">└── uses.sort</p>
<p class="has-line-data" data-line-start="1757" data-line-end="1758">4 directories, 3 files</p>
<p class="has-line-data" data-line-start="1759" data-line-end="1763">Same works with <strong>rm</strong> :<br>
$ <strong>rm newCopy</strong><br>
rm: cannot remove ‘newCopy’: Is a directory<br>
$ <strong>rm - r newCopy</strong></p>
<p class="has-line-data" data-line-start="1764" data-line-end="1767">As you can see we can not rm a file but if using -r (or -R or --recursive) it works because it deletes the dir<br>
and whatever inside it.<br>
rm -rf / is EXTREMELY DANGEROUS: force delete whatever in /</p>
<p class="has-line-data" data-line-start="1768" data-line-end="1769"><strong><em>Wildcards and globbing</em></strong></p>
<p class="has-line-data" data-line-start="1770" data-line-end="1772">This is a way to say <strong>All files</strong> or <strong>everything which starts with A</strong> or <strong>all files with 3 letter names which end<br>
in A or B or C</strong>.</p>
<p class="has-line-data" data-line-start="1773" data-line-end="1774">There are main cases:</p>
<ul>
<li class="has-line-data" data-line-start="1775" data-line-end="1777">
<ul>
<li class="has-line-data" data-line-start="1775" data-line-end="1777">means <strong>any string</strong><br>
-? means any single character</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1777" data-line-end="1778">[ABC] matches A, B &amp; C</li>
<li class="has-line-data" data-line-start="1778" data-line-end="1779">[a-k] matches a, b, c, …, k (both lower-case and capital)</li>
<li class="has-line-data" data-line-start="1779" data-line-end="1780">[0-9a-z] matches all digits and numbers</li>
<li class="has-line-data" data-line-start="1780" data-line-end="1782">[!x] means NOT X.</li>
</ul>
<p class="has-line-data" data-line-start="1782" data-line-end="1783">So… this means that you can use these patterns in your commands to point to these files:</p>
<pre><code class="has-line-data" data-line-start="1785" data-line-end="1787">command meaning
</code></pre>
<pre><code class="has-line-data" data-line-start="1789" data-line-end="1791">rm * delete all files
</code></pre>
<pre><code class="has-line-data" data-line-start="1793" data-line-end="1795">ls A*B all files starting with A ending with B
</code></pre>
<pre><code class="has-line-data" data-line-start="1797" data-line-end="1799">cp ???.* /tmp Copy all files with 3 characters, then a dot then whatever (even nothing) to /tmp
</code></pre>
<pre><code class="has-line-data" data-line-start="1801" data-line-end="1803">rmdir [a-z]* remove all directories which start with a letter
</code></pre>
<p class="has-line-data" data-line-start="1804" data-line-end="1805"><strong>Touch</strong></p>
<p class="has-line-data" data-line-start="1806" data-line-end="1810">The touch command with no option will update the <strong>modification</strong> date of a file to the current time (will<br>
create a file if it is not exists).<br>
/touch$ <strong>ls - l</strong><br>
total 0</p>
<ul>
<li class="has-line-data" data-line-start="1811" data-line-end="1815">rw-rw-r-- 1 jadi jadi 0 Jan 8 17:47 myfile<br>
/touch$ <strong>touch myfile #after a minute</strong><br>
/touch$ <strong>ls - l</strong><br>
total 0</li>
<li class="has-line-data" data-line-start="1815" data-line-end="1818">rw-rw-r-- 1 jadi jadi 0 Jan 8 17:48 myfile<br>
There are also possible:</li>
</ul>
<p class="has-line-data" data-line-start="1818" data-line-end="1826">[ian@echidna lpi103-2]$ touch - t 200908121510.59 f3<br>
[ian@echidna lpi103-2]$ touch - d 11am f4<br>
[ian@echidna lpi103-2]$ touch - d “last fortnight” f5<br>
[ian@echidna lpi103-2]$ touch - d “yesterday 6am” f6<br>
[ian@echidna lpi103-2]$ touch - d “2 days ago 12:00” f7<br>
[ian@echidna lpi103-2]$ touch - d “tomorrow 02:00” f8<br>
[ian@echidna lpi103-2]$ touch - d “5 Nov” f9<br>
[ian@echidna lpi103-2]$ ls - lrt f*</p>
<ul>
<li class="has-line-data" data-line-start="1827" data-line-end="1828">rw-rw-r–. 1 ian ian 0 2009 - 07 - 31 18:31 f5</li>
<li class="has-line-data" data-line-start="1828" data-line-end="1829">rw-rw-r–. 1 ian ian 0 2009 - 08 - 12 12:00 f7</li>
<li class="has-line-data" data-line-start="1829" data-line-end="1830">rw-rw-r–. 1 ian ian 0 2009 - 08 - 12 15:10 f3</li>
<li class="has-line-data" data-line-start="1830" data-line-end="1831">rw-rw-r–. 1 ian ian 0 2009 - 08 - 13 06:00 f6</li>
<li class="has-line-data" data-line-start="1831" data-line-end="1832">rw-rw-r–. 1 ian ian 0 2009 - 08 - 14 11:00 f4</li>
<li class="has-line-data" data-line-start="1832" data-line-end="1833">rw-rw-r–. 1 ian ian 4 2009 - 08 - 14 18:25 f1</li>
<li class="has-line-data" data-line-start="1833" data-line-end="1834">rw-rw-r–. 1 ian ian 0 2009 - 08 - 14 18:27 f2</li>
<li class="has-line-data" data-line-start="1834" data-line-end="1835">rw-rw-r–. 1 ian ian 0 2009 - 08 - 15 02:00 f8</li>
<li class="has-line-data" data-line-start="1835" data-line-end="1838">rw-rw-r–. 1 ian ian 0 2009 - 11 - 05 00:00 f9<br>
and the most advanced way is setting time of a file based on another file:</li>
</ul>
<p class="has-line-data" data-line-start="1838" data-line-end="1844">[ian@echidna lpi103-2]$ date<br>
Fri Aug 14 18:33:48 EDT 2009<br>
[ian@echidna lpi103-2]$ date - r f1<br>
Fri Aug 14 18:25:50 EDT 2009<br>
[ian@echidna lpi103-2]$ touch - r f1 f1a<br>
[ian@echidna lpi103-2]$ ls - l f1*</p>
<ul>
<li class="has-line-data" data-line-start="1845" data-line-end="1846">rw-rw-r–. 1 ian ian 4 2009 - 08 - 14 18 :25 f1</li>
<li class="has-line-data" data-line-start="1846" data-line-end="1848">rw-rw-r–. 1 ian ian 0 2009 - 08 - 14 18:25 f1a</li>
</ul>
<p class="has-line-data" data-line-start="1848" data-line-end="1849"><strong>Finding files</strong></p>
<p class="has-line-data" data-line-start="1850" data-line-end="1854">The find command helps us to find files based on MANY criteria. Look at this:<br>
$ <em><em>find. - iname &quot;[a-j]</em>&quot;</em>*<br>
./howcool.sort<br>
./alldata</p>
<p class="has-line-data" data-line-start="1855" data-line-end="1858">./mydir/howcool.sort<br>
./mydir/newDir/insideNew<br>
./howcool</p>
<ul>
<li class="has-line-data" data-line-start="1859" data-line-end="1860">the first parameter says where should be searched (with subdirectories).</li>
<li class="has-line-data" data-line-start="1860" data-line-end="1862">the - name switch indicates the criteria (here iname: searching for files with this name).</li>
</ul>
<p class="has-line-data" data-line-start="1862" data-line-end="1879">a common switch is <strong>- iname</strong> which says “name but case is not important (z is same as Z)”. Also - d is<br>
commonly used:<br>
$ <strong>find. - iname &quot;<em>my</em>&quot;</strong><br>
./myfiles<br>
./mydata.noenter<br>
./mydata<br>
./mydir<br>
./mydir/hereisMYfile.txt<br>
./touch/myfile<br>
./mydata.tab<br>
$ <strong>find. - type f - iname &quot;<em>my</em>&quot;</strong><br>
./myfiles<br>
./mydata.noenter<br>
./mydata<br>
./mydir/hereisMYfile.txt<br>
./touch/myfile<br>
./mydata.tab</p>
<p class="has-line-data" data-line-start="1880" data-line-end="1881">These are the most common file types:</p>
<ul>
<li class="has-line-data" data-line-start="1882" data-line-end="1883">
<ul>
<li class="has-line-data" data-line-start="1882" data-line-end="1883">type f will search for a regular file</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1883" data-line-end="1884">
<ul>
<li class="has-line-data" data-line-start="1883" data-line-end="1884">type d will search for a directory</li>
</ul>
</li>
<li class="has-line-data" data-line-start="1884" data-line-end="1886">
<ul>
<li class="has-line-data" data-line-start="1884" data-line-end="1886">type l will search for a symbolic link</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="1886" data-line-end="1887">you can also search for file sizes:</p>
<pre><code class="has-line-data" data-line-start="1889" data-line-end="1891">command meanint
</code></pre>
<ul>
<li class="has-line-data" data-line-start="1892" data-line-end="1893">size 100c files which are exactly 100 bytes (you can also use <strong>b</strong></li>
<li class="has-line-data" data-line-start="1893" data-line-end="1894">size +100k files which are more than 100 kilobytes</li>
<li class="has-line-data" data-line-start="1894" data-line-end="1895">size -20M files smaller than 20Megabytes</li>
<li class="has-line-data" data-line-start="1895" data-line-end="1897">size +2G files bigger than 2Gigabytes</li>
</ul>
<p class="has-line-data" data-line-start="1897" data-line-end="1898">So this will find all files ending in <em>tmp</em> with size between 1M and 100M in /var/ directory:</p>
<p class="has-line-data" data-line-start="1899" data-line-end="1901"><strong>find /var - iname ’<em>tmp</em> - size +1M - size - 100M</strong><br>
you can find all empty files with find. -size 0b or find. -empty</p>
<p class="has-line-data" data-line-start="1902" data-line-end="1903"><strong><em>Acting on files</em></strong></p>
<p class="has-line-data" data-line-start="1904" data-line-end="1905">We can act on files with various switches:</p>
<pre><code class="has-line-data" data-line-start="1907" data-line-end="1909">switch meanint
</code></pre>
<ul>
<li class="has-line-data" data-line-start="1910" data-line-end="1911">ls will run ls -dils on each file</li>
<li class="has-line-data" data-line-start="1911" data-line-end="1913">print will print the full name of the files on each line</li>
</ul>
<p class="has-line-data" data-line-start="1913" data-line-end="1916">But the best way to run commands on found files is - exec switch. You can point to the file<br>
with <strong>‘{}’</strong> or <strong>{}</strong> and finish your command with <strong>;</strong>.<br>
This will remove all empty files in this directory and its subdirectories:</p>
<p class="has-line-data" data-line-start="1917" data-line-end="1919"><strong>find. - empty - exec rm ‘{}’ ;</strong><br>
or this will rename all htm files to hfml</p>
<p class="has-line-data" data-line-start="1920" data-line-end="1922"><em><em>find. - name &quot;</em>.htm&quot; - exec mv ‘{}’ ‘{}l’ ;</em>*<br>
At last you have to know the - mtime switch for finding files based on their time.</p>
<pre><code class="has-line-data" data-line-start="1924" data-line-end="1926">switch meanint
</code></pre>
<ul>
<li class="has-line-data" data-line-start="1927" data-line-end="1928">atime - 6 file was last accessed less than 6*24 hours ago</li>
<li class="has-line-data" data-line-start="1928" data-line-end="1929">ctime +6 file was changed more than 6*24 hours ago</li>
<li class="has-line-data" data-line-start="1929" data-line-end="1930">mtime - 6 file <em>content</em> moditication less than time is 6*24 ago</li>
<li class="has-line-data" data-line-start="1930" data-line-end="1931">mmin - 90 file’s data was last modified less than 90 minutes ago</li>
<li class="has-line-data" data-line-start="1931" data-line-end="1933">amin, -cmin you guess!</li>
</ul>
<p class="has-line-data" data-line-start="1933" data-line-end="1935">if you add - <strong>daystart</strong> switch to <strong>- mtime</strong> or <strong>- atime</strong> it means that we want to consider days as calendar<br>
days, starting at midnight.</p>
<p class="has-line-data" data-line-start="1936" data-line-end="1937"><strong>Identify a file</strong></p>
<p class="has-line-data" data-line-start="1938" data-line-end="1951">That is the file command:<br>
$ <strong>file mydata.tab</strong><br>
mydata.tab: ASCII text<br>
$ <strong>file /bin/bash</strong><br>
/bin/bash: ELF 64 - bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for<br>
GNU/Linux 2.6.32, BuildID[sha1]=cb63ec0718f2022619814c04a5b6cd8a36752a83, stripped<br>
$ <strong>file mydata.tab</strong><br>
mydata.tab: ASCII text<br>
$ <strong>file /bin/bash</strong><br>
/bin/bash: ELF 64 - bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for<br>
GNU/Linux 2.6.32, BuildID[sha1]=cb63ec0718f2022619814c04a5b6cd8a36752a83, stripped<br>
$ <strong>file - i mydir</strong><br>
mydir: inode/directory; charset=binary</p>
<ul>
<li class="has-line-data" data-line-start="1952" data-line-end="1954">i switch prints the complete mime format</li>
</ul>
<p class="has-line-data" data-line-start="1954" data-line-end="1955"><strong>Compressing files</strong></p>
<p class="has-line-data" data-line-start="1956" data-line-end="1957"><strong><em>Zip</em></strong></p>
<p class="has-line-data" data-line-start="1958" data-line-end="1960">we mostly use <strong>gzip</strong> and <strong>gunzip</strong> in linux. It is very easy:<br>
$ <strong>ls * - ltrh</strong></p>
<ul>
<li class="has-line-data" data-line-start="1961" data-line-end="1964">rw-r–r-- 1 jadi jadi 79K Dec 22 11:52 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt<br>
$ <strong>gzip The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt</strong><br>
$ <strong>ls * - ltrh</strong></li>
<li class="has-line-data" data-line-start="1964" data-line-end="1967">rw-r–r-- 1 jadi jadi 30K Dec 22 11:52 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt.gz<br>
$ <strong>gunzip The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt.gz</strong><br>
$ <strong>ls * - ltrh</strong></li>
<li class="has-line-data" data-line-start="1967" data-line-end="1972">rw-r–r-- 1 jadi jadi 79K Dec 22 11:52 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt
<ul>
<li class="has-line-data" data-line-start="1968" data-line-end="1969">gzip preserves time</li>
<li class="has-line-data" data-line-start="1969" data-line-end="1970">gzip creates the new compressed file with the same name but with .gz ending</li>
<li class="has-line-data" data-line-start="1970" data-line-end="1972">gzip removes the original files after creating the compressed file</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="1972" data-line-end="1973"><strong><em>Bzip2</em></strong></p>
<p class="has-line-data" data-line-start="1974" data-line-end="1975">is another compressing tool. Works just the same but with another compression algorithm.</p>
<p class="has-line-data" data-line-start="1976" data-line-end="1977">$ ls * - ltrh</p>
<ul>
<li class="has-line-data" data-line-start="1978" data-line-end="1981">rw-r–r-- 1 jadi jadi 79K Dec 22 11:52 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt<br>
$ bzip2 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt<br>
$ ls * - ltrh</li>
<li class="has-line-data" data-line-start="1981" data-line-end="1984">rw-r–r-- 1 jadi jadi 22K Dec 22 11:52 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt.bz2<br>
$ bunzip2 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt.bz2</li>
</ul>
<p class="has-line-data" data-line-start="1984" data-line-end="1985">$ ls * - ltrh</p>
<ul>
<li class="has-line-data" data-line-start="1986" data-line-end="1988">rw-r–r-- 1 jadi jadi 79K Dec 22 11:52 The.Equalizer.2014.1080p.BluRay.x264.anoXmous_eng.srt</li>
</ul>
<p class="has-line-data" data-line-start="1988" data-line-end="1989"><strong>Archiving files</strong></p>
<p class="has-line-data" data-line-start="1990" data-line-end="1992">Sometimes we need to create an archive file from many files for easier moving or backing up. This is<br>
done with cpio and tar.</p>
<p class="has-line-data" data-line-start="1993" data-line-end="1994"><strong><em>Tar</em></strong></p>
<p class="has-line-data" data-line-start="1995" data-line-end="1997">TapeARchive or tar is the most common archiving tool. In automatically create an archive file from a<br>
directory and all its subdirs.</p>
<p class="has-line-data" data-line-start="1998" data-line-end="1999">Common switches are</p>
<pre><code class="has-line-data" data-line-start="2001" data-line-end="2003">switch meanint
</code></pre>
<ul>
<li class="has-line-data" data-line-start="2004" data-line-end="2005">cf myarchive.tar create file named myarchive.tar</li>
<li class="has-line-data" data-line-start="2005" data-line-end="2006">xf myarchive.tar extract a file called myarchive.tar</li>
<li class="has-line-data" data-line-start="2006" data-line-end="2007">z compress the archive with gzip after creating it</li>
<li class="has-line-data" data-line-start="2007" data-line-end="2008">b compress the archive with bzip2 after creating it</li>
<li class="has-line-data" data-line-start="2008" data-line-end="2009">v verbose! print a lot of data about what you are doing</li>
<li class="has-line-data" data-line-start="2009" data-line-end="2011">r appeng new files to the currentyp available archive</li>
</ul>
<p class="has-line-data" data-line-start="2011" data-line-end="2014">If you issue absolute paths, tar removes the starting slash (/) for safety reasons when creating an<br>
archive. If you want to override, use -p option.<br>
tar can work with tapes and other storages. Thats why we use - f to tell it that we are working with files.</p>
<p class="has-line-data" data-line-start="2015" data-line-end="2016"><strong><em>Cpio</em></strong></p>
<p class="has-line-data" data-line-start="2017" data-line-end="2018">Gets a list of files and creates archive (one file) of it which can be opened later.</p>
<p class="has-line-data" data-line-start="2019" data-line-end="2021">$ <strong>ls | cpio - o &gt; allfilesls.cpio</strong><br>
3090354 blocks</p>
<ul>
<li class="has-line-data" data-line-start="2022" data-line-end="2023">
<ul>
<li class="has-line-data" data-line-start="2022" data-line-end="2023">o makes cpio to create an output from its input</li>
</ul>
</li>
<li class="has-line-data" data-line-start="2023" data-line-end="2025">cpio does not goes into the folders. So mostly we use it with find:</li>
</ul>
<p class="has-line-data" data-line-start="2025" data-line-end="2026"><em><em>find. - name &quot;</em>&quot; | cpio - o &gt; myarchivefind.cpio</em>*</p>
<p class="has-line-data" data-line-start="2027" data-line-end="2028">to decompress it:</p>
<p class="has-line-data" data-line-start="2029" data-line-end="2033"><strong>mkdir extract<br>
mv myarchivefind.cpio extract<br>
cd extract<br>
cpio - id &lt; myarchivefind.cpio</strong></p>
<ul>
<li class="has-line-data" data-line-start="2034" data-line-end="2035">
<ul>
<li class="has-line-data" data-line-start="2034" data-line-end="2035">d will create the folders</li>
</ul>
</li>
<li class="has-line-data" data-line-start="2035" data-line-end="2037">
<ul>
<li class="has-line-data" data-line-start="2035" data-line-end="2037">i is for extract</li>
</ul>
</li>
</ul>
<p class="has-line-data" data-line-start="2037" data-line-end="2038"><strong>dd</strong></p>
<p class="has-line-data" data-line-start="2039" data-line-end="2056">The dd command <strong>copies data</strong> from one location to another. This data comes from files. You can use it<br>
just like copy:<br>
$ <strong>cat howcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2<br>
you 12<br>
$ <strong>dd if=howcool of=newcool</strong><br>
0+1 records in<br>
0+1 records out<br>
30 bytes (30 B) copied, 0.0227904 s, 1.3 kB/s<br>
$ <strong>cat newcool</strong><br>
jadi 5<br>
sina 6<br>
rubic 2<br>
you 12<br>
$</p>
<ul>
<li class="has-line-data" data-line-start="2057" data-line-end="2058">if is In File</li>
<li class="has-line-data" data-line-start="2058" data-line-end="2060">of is Out File</li>
</ul>
<p class="has-line-data" data-line-start="2060" data-line-end="2062">But it is used in many other cases specially writing directly to block devices such as /dev/sdb or changing<br>
data to upper/lower case.</p>
<p class="has-line-data" data-line-start="2063" data-line-end="2064">This will backup my whole hard to a file:</p>
<h1 class="code-line" data-line-start=2065 data-line-end=2066 ><a id="dd_ifdevsda_ofbackupdd_bs4096_2065"></a><strong>dd if=/dev/sda of=backup.dd bs=4096</strong></h1>
<p class="has-line-data" data-line-start="2067" data-line-end="2068">or better:</p>
<h1 class="code-line" data-line-start=2069 data-line-end=2070 ><a id="dd_ifdevsda2_gzip_backupddgzip_2069"></a><strong>dd if=/dev/sda2 |gzip &gt;backup.dd.gzip</strong></h1>
<p class="has-line-data" data-line-start="2071" data-line-end="2072">Another common usage is creating files of specific size:</p>
<p class="has-line-data" data-line-start="2073" data-line-end="2074">$ <strong>dd if=/dev/zero of=1g.bin bs=1G count=1</strong></p>
<p class="has-line-data" data-line-start="2075" data-line-end="2076"><strong>103.4 – Use streams, pipes and redirects - 4</strong></p>
<p class="has-line-data" data-line-start="2077" data-line-end="2078"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="2079" data-line-end="2080">Redirecting standard input, standard output and standard error.</li>
<li class="has-line-data" data-line-start="2080" data-line-end="2081">Pipe the output of one command to the input of another command.</li>
<li class="has-line-data" data-line-start="2081" data-line-end="2082">Use the output of one command as arguments to another command.</li>
<li class="has-line-data" data-line-start="2082" data-line-end="2083">Send output to both stdout and a file.</li>
<li class="has-line-data" data-line-start="2083" data-line-end="2084">tee</li>
<li class="has-line-data" data-line-start="2084" data-line-end="2086">xargs</li>
</ul>
<p class="has-line-data" data-line-start="2086" data-line-end="2088">We’ve already talked about basics of piping and redirects in previous sections. Here you will get a<br>
deeper understanding of these concepts.</p>
<p class="has-line-data" data-line-start="2089" data-line-end="2090"><strong>Redirecting standard IO</strong></p>
<p class="has-line-data" data-line-start="2091" data-line-end="2094">On a linux system most shells use streams for input and output (a list of characters)… These streams can<br>
be from (and toward) various things including keyboard, block devices (hards, usb stick, …), window of a<br>
program, fiels, …</p>
<ol>
<li class="has-line-data" data-line-start="2095" data-line-end="2096"><strong><em>stdout</em></strong> is the standard output stream, which displays output from commands (file descriptor 1)</li>
<li class="has-line-data" data-line-start="2096" data-line-end="2098"><strong><em>stderr</em></strong> is the standard error stream, which displays error output from commands (file descriptor
<ol start="2">
<li class="has-line-data" data-line-start="2097" data-line-end="2098"></li>
</ol>
</li>
<li class="has-line-data" data-line-start="2098" data-line-end="2100"><strong><em>stdin</em></strong> is the standard input stream, which provides input to commands (file descriptor 0)</li>
</ol>
<p class="has-line-data" data-line-start="2100" data-line-end="2102">What are these <strong>file descriptions</strong>? There are used to control the output. If you need to control where<br>
your output goes, you can add n&gt; or n&gt;&gt;.</p>
<ul>
<li class="has-line-data" data-line-start="2103" data-line-end="2105"><strong>n&gt;</strong> redirects <strong>file description n</strong> to a file or device. If the file already exists it is <strong>overwritten</strong> and if it<br>
does not exists, it will be created.</li>
<li class="has-line-data" data-line-start="2105" data-line-end="2108"><strong>n&gt;&gt;</strong> redirects file description n to a file or device. If the file already exists the stream will be<br>
appended to the end of it and if it does not exists, it will be created.</li>
</ul>
<p class="has-line-data" data-line-start="2108" data-line-end="2120">if the <strong>n</strong> is not given, the default is <em>standard output</em><br>
The user who runs the command should have write access to the file.<br>
$ <strong>ls</strong><br>
fiona habib mahmoodrm minoo mojtaba sina<br>
$ <strong>ls j</strong>*<br>
ls: cannot access j*: No such file or directory<br>
$ <strong>ls m</strong>*<br>
mahmoodrm minoo mojtaba<br>
$ <em><em>ls j</em> m</em>**<br>
ls: cannot access j*: No such file or directory<br>
mahmoodrm minoo mojtaba<br>
$ <em><em>ls j</em> m</em> &gt; output 2&gt; errors**</p>
<p class="has-line-data" data-line-start="2121" data-line-end="2128">$ <strong>cat output</strong><br>
mahmoodrm<br>
minoo<br>
mojtaba<br>
$ <strong>cat errors</strong><br>
ls: cannot access j*: No such file or directory<br>
$</p>
<p class="has-line-data" data-line-start="2129" data-line-end="2130"><strong><em>Redirecting both stdout and stderr to one location</em></strong></p>
<p class="has-line-data" data-line-start="2131" data-line-end="2137">Sometimes (say during automated tasks) we prefer to send both standard output and standard error to<br>
same place, Use <strong>&amp;&gt;</strong> and <strong>&amp;&gt;&gt;</strong> to say <em>both stderr and stdout</em>.<br>
It is also possible to use &amp;1 and &amp;2 and &amp;0 to refer to <strong>current place</strong> of stdout, stderr &amp; stdin. In this<br>
case ls &gt; file1 2&gt;&amp;1 means <em>redirect output to file1 and output stderr to same place as stdout (file1)</em><br>
Be careful! ls 2&gt;&amp;1 &gt; file1 means <em>print stderr to current location of stdout (screen) and then change the<br>
stdout to file1</em></p>
<p class="has-line-data" data-line-start="2138" data-line-end="2139"><strong><em>Sending to null</em></strong></p>
<p class="has-line-data" data-line-start="2140" data-line-end="2142">In linux, <strong>/dev/null</strong> is like a trash-can. You can send anything there and it disappears. So it is normal to<br>
say:</p>
<p class="has-line-data" data-line-start="2143" data-line-end="2150">$ <em><em>ls j</em> m</em> &gt; file1**<br>
ls: cannot access j*: No such file or directory<br>
$ <em><em>ls j</em> m</em> &gt; file1 2&gt;/dev/null**<br>
$ <strong>cat file1</strong><br>
mahmoodrm<br>
minoo<br>
mojtaba</p>
<p class="has-line-data" data-line-start="2151" data-line-end="2152"><strong>Redirecting input</strong></p>
<p class="has-line-data" data-line-start="2153" data-line-end="2154">The &lt; operand redirects the input.</p>
<p class="has-line-data" data-line-start="2155" data-line-end="2167">$ <strong>cat uses</strong><br>
you fedora<br>
jadi ubuntu<br>
rubic windows<br>
neda mac<br>
narsin arch<br>
$ <strong>tr ’ ’ ‘,’ &lt; uses</strong><br>
you,fedora<br>
jadi,ubuntu<br>
rubic,windows<br>
neda,mac<br>
narsin,arch</p>
<p class="has-line-data" data-line-start="2168" data-line-end="2169"><strong>Here-documents</strong></p>
<p class="has-line-data" data-line-start="2170" data-line-end="2173">Many shells, have here-documents (also called here-docs) as a way of input. You use <strong>&lt;&lt;</strong> and<br>
a <strong>WORD</strong> and then whatever you input is considered stdin till you give only the WORD in one line.<br>
$ <strong>tr ’ ’ ‘.’ &lt;&lt; END_OF_DATA</strong></p>
<blockquote>
<p class="has-line-data" data-line-start="2174" data-line-end="2176">this is a line<br>
and then this</p>
<p class="has-line-data" data-line-start="2177" data-line-end="2183">we’ll still type<br>
and,<br>
done!<br>
END_OF_DATA<br>
this.is.a.line<br>
and.then.this</p>
</blockquote>
<p class="has-line-data" data-line-start="2184" data-line-end="2188">we’ll.still.type<br>
and,<br>
done!<br>
Here-Documents are very useful if you are writing scripts and automated tasks.</p>
<p class="has-line-data" data-line-start="2189" data-line-end="2190"><strong>Pipes</strong></p>
<p class="has-line-data" data-line-start="2191" data-line-end="2195">Piping is sending one commands output to another commands input (Piping the stdout to stdin). You<br>
use <strong>|</strong> for this task.<br>
As previously seen, many commands use a hyphen - in place of a filename as an argument to<br>
indicate when the input should come from stdin rather than a file.</p>
<p class="has-line-data" data-line-start="2196" data-line-end="2209">$ <strong>cat what_i_have.txt</strong><br>
laptop<br>
socks<br>
tshirt<br>
ball<br>
socks<br>
glasses<br>
$ <strong>cut - f1 - d’ ’ what_i_have.txt | sort | uniq - c | sort - nr</strong><br>
2 socks<br>
1 tshirt<br>
1 laptop<br>
1 glasses<br>
1 ball</p>
<p class="has-line-data" data-line-start="2210" data-line-end="2212">If you need to start your pipeline with the contents of a file, start with cat filename | … or use a &lt; stdin<br>
redirect.</p>
<p class="has-line-data" data-line-start="2213" data-line-end="2214"><strong>Xargs</strong></p>
<p class="has-line-data" data-line-start="2215" data-line-end="2216">This command reads input from <strong><em>stdin</em></strong> and uses them as arguments.</p>
<p class="has-line-data" data-line-start="2217" data-line-end="2222">$ <strong>ls | xargs echo these are files:</strong><br>
these are files: errors f file1 fiona habib mahmoodrm minoo mojtaba output output.txt sina uses<br>
what_i_have.txt<br>
if you do not give any command to the xargs , the echo will be the default command (it will show the<br>
stdin).</p>
<p class="has-line-data" data-line-start="2223" data-line-end="2226">Have in mind that <strong>xargs</strong> breaks input based on blanks and use any part as an argument. You can limit the<br>
number of arguments with <strong>–max-args</strong> (same as - n) switch and escape blanks or quote them to prevent<br>
them from breaking.</p>
<p class="has-line-data" data-line-start="2227" data-line-end="2240">One important switch is <strong>- I.</strong> This is useful if you need to pass stdin arguments in the middle (or even start)<br>
of your commands. use the form <strong>xargs -I SOMETHING echo</strong> here is SOMETHING end:<br>
$ <strong>cat what_i_have.txt</strong><br>
laptop<br>
socks<br>
tshirt<br>
ball<br>
$ <strong>cat what_i_have.txt | xargs - I DATA echo I have DATA and I love it.</strong><br>
I have laptop and I love it.<br>
I have socks and I love it.<br>
I have tshirt and I love it.<br>
I have ball and I love it.<br>
If you use -L, the input will break by line and not by blanks.</p>
<p class="has-line-data" data-line-start="2241" data-line-end="2242"><strong>Tee</strong></p>
<p class="has-line-data" data-line-start="2243" data-line-end="2257">What if you need to see the output on screen and also save it to a file? Ugly way is redirecting to the file<br>
and using tail -f file in another window. Nice way is using tee and giving it one or more filenames for<br>
standard output (if you need to save <em>stderr</em> , first redirect it to <em>stdout</em> ). This will write the output to those<br>
files and also writes them to the screen:<br>
$ ls - 1 | tee allfiles myfiles<br>
allfiles<br>
f<br>
fiona<br>
habib<br>
mahmoodrm<br>
minoo<br>
mojtaba<br>
myfiles<br>
sina</p>
<p class="has-line-data" data-line-start="2258" data-line-end="2259">If you want to prevent overwriting files, use the - a switch to append to files if exists.</p>
<p class="has-line-data" data-line-start="2260" data-line-end="2261"><strong>103.5 – Create, Monitor and Kill Processes - 4</strong></p>
<p class="has-line-data" data-line-start="2262" data-line-end="2263"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="2264" data-line-end="2265">Run jobs in the foreground and background.</li>
<li class="has-line-data" data-line-start="2265" data-line-end="2266">Signal a program to continue running after logout.</li>
<li class="has-line-data" data-line-start="2266" data-line-end="2267">Monitor active processes.</li>
<li class="has-line-data" data-line-start="2267" data-line-end="2268">Select and sort processes for display.</li>
<li class="has-line-data" data-line-start="2268" data-line-end="2269">Send signals to processes.</li>
<li class="has-line-data" data-line-start="2269" data-line-end="2270">&amp;</li>
<li class="has-line-data" data-line-start="2270" data-line-end="2271">bg</li>
<li class="has-line-data" data-line-start="2271" data-line-end="2272">fg</li>
<li class="has-line-data" data-line-start="2272" data-line-end="2273">jobs</li>
<li class="has-line-data" data-line-start="2273" data-line-end="2274">kill</li>
<li class="has-line-data" data-line-start="2274" data-line-end="2275">nohup</li>
<li class="has-line-data" data-line-start="2275" data-line-end="2276">ps</li>
<li class="has-line-data" data-line-start="2276" data-line-end="2277">top</li>
<li class="has-line-data" data-line-start="2277" data-line-end="2278">free</li>
<li class="has-line-data" data-line-start="2278" data-line-end="2279">uptime</li>
<li class="has-line-data" data-line-start="2279" data-line-end="2281">killall</li>
</ul>
<p class="has-line-data" data-line-start="2281" data-line-end="2282"><strong>Foreground and Background jobs</strong></p>
<p class="has-line-data" data-line-start="2283" data-line-end="2285">One of the great points of linux on its beginning days, was the ability to run many programs at the same<br>
time. This is done with sending programs to the background.</p>
<p class="has-line-data" data-line-start="2286" data-line-end="2288">Normally if you run a program on the terminal, it <em>blocks</em> your terminal but sending a command to the<br>
background will prevent this:</p>
<p class="has-line-data" data-line-start="2289" data-line-end="2291">xeyes &amp;<br>
But what if we started it normally? We can break / cancel it with Ctrl+c or <em>suspend</em> it using Ctrl+z.</p>
<p class="has-line-data" data-line-start="2292" data-line-end="2306">$ xeyes<br>
^Z<br>
[1]+ Stopped xeyes<br>
$ jobs<br>
[1]+ Stopped xeyes<br>
$ bg<br>
[1]+ xeyes &amp;<br>
$ jobs<br>
[1]+ Running xeyes &amp;<br>
$ sleep 1000 &amp;<br>
[2] 7395<br>
$ jobs<br>
[1]- Running xeyes &amp;<br>
[2]+ Running sleep 1000 &amp;</p>
<p class="has-line-data" data-line-start="2307" data-line-end="2319">$ fg %2<br>
sleep 1000<br>
^Z<br>
[2]+ Stopped sleep 1000<br>
$ jobs<br>
[1]- Running xeyes &amp;<br>
[2]+ Stopped sleep 1000<br>
$ bg sle<br>
[2]+ sleep 1000 &amp;<br>
$ jobs<br>
[1]- Running xeyes &amp;<br>
[2]+ Running sleep 1000 &amp;</p>
<ul>
<li class="has-line-data" data-line-start="2320" data-line-end="2322">l switch of jobs will also show the process ID</li>
</ul>
<p class="has-line-data" data-line-start="2322" data-line-end="2323"><strong>Nohup</strong></p>
<p class="has-line-data" data-line-start="2324" data-line-end="2332">The nohup command lets you run your commands even after you logged out and writes its output<br>
to <strong>nohup.out</strong> :<br>
$ nohup ping 4.2.2.4<br>
nohup: ignoring input and appending output to ‘nohup.out’<br>
^C$ cat nohup.out<br>
PING 4.2.2.4 (4.2.2.4) 56(84) bytes of data.<br>
64 bytes from 4.2.2.4: icmp_seq=1 ttl=51 time=225 ms<br>
64 bytes from 4.2.2.4: icmp_seq=3 ttl=51 time=223 ms</p>
<p class="has-line-data" data-line-start="2333" data-line-end="2337">— 4.2.2.4 ping statistics —<br>
4 packets transmitted, 2 received, 50% packet loss, time 3010ms<br>
rtt min/avg/max/mdev = 223.584/224.767/225.950/1.183 ms<br>
It is common to use 2&gt; to redirect the nohup errors to a file: nohup <a href="http://script.sh">script.sh</a> &gt; mynohup.out 2&gt;&amp;1 &amp;</p>
<p class="has-line-data" data-line-start="2338" data-line-end="2339"><strong>Kill</strong></p>
<p class="has-line-data" data-line-start="2340" data-line-end="2355">You can control processes by <strong>signals</strong>. Actually pressing Ctrl+c and Ctrl+z is also sending signals. Another<br>
way for this is using the kill command:<br>
$ jobs<br>
[3] Running xeyes &amp;<br>
[4] Running sleep 1000 &amp;<br>
[5]- Running sleep 2000 &amp;<br>
[6]+ Running sleep 3000 &amp;<br>
$ kill %4<br>
$ jobs<br>
[3] Running xeyes &amp;<br>
[4] Terminated sleep 1000<br>
[5]- Running sleep 2000 &amp;<br>
[6]+ Running sleep 3000 &amp;<br>
$ jobs<br>
[3] Running xeyes &amp;</p>
<p class="has-line-data" data-line-start="2356" data-line-end="2358">[5]- Running sleep 2000 &amp;<br>
[6]+ Running sleep 3000 &amp;</p>
<p class="has-line-data" data-line-start="2359" data-line-end="2360">If is also possible to use PIDs in from of the kill or send other signals:</p>
<pre><code class="has-line-data" data-line-start="2362" data-line-end="2364">signal number signal name meaning
</code></pre>
<pre><code class="has-line-data" data-line-start="2366" data-line-end="2368">1 SIGHUP Informing the process that its controlling terminal (like an ssh connection) is terminated
</code></pre>
<pre><code class="has-line-data" data-line-start="2370" data-line-end="2372">15 SIGTERM normal termination request
</code></pre>
<pre><code class="has-line-data" data-line-start="2374" data-line-end="2376">9 SIGKILL forcefully kills the proccess
</code></pre>
<p class="has-line-data" data-line-start="2377" data-line-end="2379">So you can do a kill -9 8733 to force process ID 8733 to close.<br>
Now you can understand what nohup means: go not answer to the SIGHUP.</p>
<p class="has-line-data" data-line-start="2380" data-line-end="2381"><strong>killall</strong></p>
<p class="has-line-data" data-line-start="2382" data-line-end="2383">Will send the given signal (or 15) to all the processes with the given name:</p>
<p class="has-line-data" data-line-start="2384" data-line-end="2399">$ jobs<br>
[3] Running xeyes &amp;<br>
[5]- Running sleep 2000 &amp;<br>
[6]+ Running sleep 3000 &amp;<br>
$ ps - ef | grep sleep<br>
jadi 7864 7651 0 21:07 pts/1 00:00:00 sleep 2000<br>
jadi 7865 7651 0 21:07 pts/1 00:00:00 sleep 3000<br>
jadi 7977 7651 0 21:14 pts/1 00:00:00 grep sleep<br>
$ killall sleep<br>
[5]- Terminated sleep 2000<br>
[6]+ Terminated sleep 3000<br>
$ jobs<br>
[3]+ Running xeyes &amp;<br>
$ ps - ef | grep sleep<br>
jadi 7980 7651 0 21:14 pts/1 00:00:00 grep sleep</p>
<p class="has-line-data" data-line-start="2400" data-line-end="2401"><strong>Monitoring Processes</strong></p>
<p class="has-line-data" data-line-start="2402" data-line-end="2403"><strong>ps</strong></p>
<p class="has-line-data" data-line-start="2404" data-line-end="2422">The ps command shows running processes on your computer.<br>
$ sleep 1000 &amp;<br>
[1] 7678<br>
$ sleep 1001 &amp;<br>
[2] 7679<br>
$ xeyes &amp;<br>
[3] 7680<br>
$ <strong>ps</strong><br>
PID TTY TIME CMD<br>
7651 pts/1 00:00:00 bash<br>
7678 pts/1 00:00:00 sleep<br>
7679 pts/1 00:00:00 sleep<br>
7680 pts/1 00:00:00 xeyes<br>
7681 pts/1 00:00:00 ps<br>
But using ps aux (= - aux) or ps -ef is also common &amp; shows ALL processes on this system:<br>
$ <strong>ps - aux | wc - l</strong><br>
293<br>
Every process has a ProcessID (PID) and a PPID (Parent Process ID).</p>
<p class="has-line-data" data-line-start="2423" data-line-end="2424"><strong><em>finding processes</em></strong></p>
<p class="has-line-data" data-line-start="2425" data-line-end="2431">You’ve seen that ps -ef shows processes from all users. We can grep on that and see who is<br>
running gedit and what is its process ID:<br>
$ <strong>ps - ef | grep gedit</strong><br>
jadi 6213 4604 9 20:06? 00:04:43 gedit<br>
jadi 7725 7651 0 20:55 pts/1 00:00:00 grep gedit<br>
but there is also a more direct way:</p>
<p class="has-line-data" data-line-start="2432" data-line-end="2447">$ <strong>ps - C gedit - o user,pid,tty,time,comm</strong><br>
USER PID TT TIME COMMAND<br>
jadi 6213? 00:04:49 gedit<br>
It is also possible to use the --sort switch to sort output based on different fields (+ for ascending &amp; - for<br>
descending).<br>
$ <strong>ps - af --sort +comm,-sid</strong><br>
UID PID PPID C STIME TTY TIME CMD<br>
root 5486 5478 0 19:59 pts/12 00:00:00 - su<br>
root 4444 1169 0 19:56 tty4 00:00:00 - bash<br>
jadi 6638 5412 0 20:10 pts/0 00:00:04 node /usr/local/bin/sslocal<br>
jadi 7778 7651 0 20:58 pts/1 00:00:00 ps - af --sort +comm,-sid<br>
jadi 7678 7651 0 20:48 pts/1 00:00:00 sleep 1000<br>
jadi 7679 7651 0 20:48 pts/1 00:00:00 sleep 1001<br>
jadi 7775 7651 0 20:58 pts/1 00:00:00 sleep 1000<br>
jadi 7776 7651 0 20:58 pts/1 00:00:00 sleep 1000</p>
<p class="has-line-data" data-line-start="2448" data-line-end="2452">jadi 7777 7651 0 20:58 pts/1 00:00:00 sleep 1000<br>
root 5478 5477 0 19:59 pts/12 00:00:00 su -<br>
root 5477 5008 0 19:59 pts/12 00:00:00 sudo su -<br>
jadi 7680 7651 0 20:48 pts/1 00:00:01 xeyes</p>
<p class="has-line-data" data-line-start="2453" data-line-end="2454"><strong>Top</strong></p>
<p class="has-line-data" data-line-start="2455" data-line-end="2457">Processes are changing and sometimes you need to check them live. top command will help you:<br>
$top</p>
<p class="has-line-data" data-line-start="2458" data-line-end="2463">top - 21:00:44 up 1:16, 5 users, load average: 1.51, 1.65, 1.78<br>
Tasks: 293 total, 1 running, 292 sleeping, 0 stopped, 0 zombie<br>
%Cpu(s): 19.0 us, 5.0 sy, 0.0 ni, 70.9 id, 5.1 wa, 0.0 hi, 0.0 si, 0.0 st<br>
KiB Mem: 8060264 total, 5359812 used, 2700452 free, 169240 buffers<br>
KiB Swap: 7811068 total, 0 used, 7811068 free. 2250692 cached Mem</p>
<h3 class="code-line" data-line-start=2464 data-line-end=2465 ><a id="PID_USER_PR_NI_VIRT_RES_SHR_S_CPU_MEM_TIME_COMMAND_2464"></a>PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND</h3>
<p class="has-line-data" data-line-start="2466" data-line-end="2476">6570 jadi 20 0 1437752 546064 88312 S 18.4 6.8 12:00.96 firefox<br>
4870 jadi 20 0 1762516 299120 75664 S 12.2 3.7 7:37.05 compiz<br>
4492 jadi 9 - 11 455152 11516 8940 S 6.1 0.1 1:06.81 pulseaudio<br>
4532 root 20 0 389028 77116 60192 S 6.1 1.0 12:16.63 Xorg<br>
4723 jadi 20 0 358936 8288 5512 S 6.1 0.1 9:51.52 ibus-daemon<br>
5648 jadi 20 0 1641556 203676 102840 S 6.1 2.5 3:20.88 chrome<br>
7082 jadi 20 0 1210748 73136 42528 S 6.1 0.9 0:36.51 Telegram<br>
7806 jadi 20 0 33796 3004 2500 R 6. 1 0.0 0:00.02 top<br>
1 root 20 0 29528 4320 2584 S 0.0 0.1 0:01.71 init<br>
You can see the processes, system load, uptime, CPU status, memory, … and do some stuff:</p>
<pre><code class="has-line-data" data-line-start="2478" data-line-end="2480">key during top functionality
</code></pre>
<pre><code class="has-line-data" data-line-start="2482" data-line-end="2484">h help
</code></pre>
<pre><code class="has-line-data" data-line-start="2486" data-line-end="2488">q quit
</code></pre>
<pre><code class="has-line-data" data-line-start="2490" data-line-end="2492">M sort based on memory usage&quot;
</code></pre>
<pre><code class="has-line-data" data-line-start="2494" data-line-end="2496">c show full commands
</code></pre>
<pre><code class="has-line-data" data-line-start="2498" data-line-end="2500">k kill after asking pid and signal
</code></pre>
<p class="has-line-data" data-line-start="2501" data-line-end="2502"><strong>Free</strong></p>
<p class="has-line-data" data-line-start="2503" data-line-end="2508">The free command will show you info about the system memory. The default is <em>kilobytes</em> but you can<br>
change it with - mfor megabytes, - g for <em>gigabytes</em> or even - b for bytes:<br>
$ free - m<br>
total used free shared buffers cached<br>
Mem: 7871 5231 2640 332 169 2195</p>
<ul>
<li class="has-line-data" data-line-start="2509" data-line-end="2513">/+ buffers/cache: 2866 5005<br>
Swap: 7627 0 7627<br>
The system should not use swap in long term</li>
</ul>
<p class="has-line-data" data-line-start="2513" data-line-end="2514"><strong>Uptime</strong></p>
<p class="has-line-data" data-line-start="2515" data-line-end="2519">The uptime command shows the time, how long the system is up, how may users are logged in and the<br>
load average of 1, 5 &amp; 15 minutes:<br>
$ uptime<br>
21:18:52 up 1:34, 5 users, load average: 2.38, 2.64, 2.41</p>
<p class="has-line-data" data-line-start="2520" data-line-end="2521"><strong>103.6 – Modify process execution priorities – 2</strong></p>
<p class="has-line-data" data-line-start="2522" data-line-end="2523"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="2524" data-line-end="2525">Know the default priority of a job that is created.</li>
<li class="has-line-data" data-line-start="2525" data-line-end="2526">Run a program with higher or lower priority than the default…</li>
<li class="has-line-data" data-line-start="2526" data-line-end="2527">Change the priority of a running process.</li>
<li class="has-line-data" data-line-start="2527" data-line-end="2528">nice</li>
<li class="has-line-data" data-line-start="2528" data-line-end="2529">ps</li>
<li class="has-line-data" data-line-start="2529" data-line-end="2530">renice</li>
<li class="has-line-data" data-line-start="2530" data-line-end="2535">top<br>
On a Linux system, we are running a lot of processes and programs on a few CPUs. So, you need a way<br>
to tell your OS to give more priority to some tasks or give less resources to some others. In last section<br>
you saw the top command to check the CPU usage of each process:</li>
</ul>
<p class="has-line-data" data-line-start="2535" data-line-end="2536">$ <strong>top</strong></p>
<p class="has-line-data" data-line-start="2537" data-line-end="2542">top - 08:44:51 up 13:00, 5 users, load average: 0.57, 1.50, 1.50<br>
Tasks: 290 total, 2 running, 288 sleeping, 0 stopped, 0 zombie<br>
%Cpu(s): 38.4 us, 9.4 sy, 0.0 ni, 49.3 id, 2.8 wa, 0.0 hi, 0.0 si, 0.0 st<br>
KiB Mem: 8060264 total, 7858348 used, 201916 free, 360144 buffers<br>
KiB Swap: 7811068 total, 0 used, 7811068 free. 2842344 cached Mem</p>
<h3 class="code-line" data-line-start=2543 data-line-end=2544 ><a id="PID_USER_PR_NI_VIRT_RES_SHR_S_CPU_MEM_TIME_COMMAND_2543"></a>PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND</h3>
<p class="has-line-data" data-line-start="2545" data-line-end="2555">13605 jadi 25 5 1473652 530700 91128 R 54.5 6.6 3:25.50 firefox<br>
11157 root 20 0 572004 112652 94484 S 6.1 1.4 3:26.18 Xorg<br>
12265 jadi 20 0 1210484 75848 42264 S 6.1 0.9 0:32.06 Telegram<br>
12671 jadi 20 0 1800508 274564 80300 S 6.1 3.4 1:27.35 compiz<br>
15035 jadi 20 0 768688 54920 34228 S 6.1 0.7 0:00.93 /usr/bin/termin<br>
15066 jadi 20 0 33796 3076 2448 R 6.1 0.0 0:00.02 top<br>
1 root 20 0 29528 4320 2584 S 0.0 0.1 0:02.27 init<br>
2 root 20 0 0 0 0 S 0.0 0.0 0:00.00 kthreadd<br>
3 root 20 0 0 0 0 S 0.0 0.0 0:00.27 ksoftirqd/0<br>
5 root 0 - 20 0 0 0 S 0.0 0.0 0:00.00 kworker/0:0H ```</p>
<p class="has-line-data" data-line-start="2556" data-line-end="2560">Chkecn th<br>
There is <strong>NI</strong> column, it shows how <strong>nice</strong> the process is. The nicer the process, the less CPU it asks. Nice can<br>
be from -20 to 19 (a process with nice = <strong>- 20</strong> is ANGRY and asking for a lot of CPU while a process with<br>
nice = <strong>19</strong> is SUPER NICE and lets <strong>other</strong> processes use most of the CPU).</p>
<p class="has-line-data" data-line-start="2561" data-line-end="2563">If you do not use nice command, processes will have nice level of 0. This can be checked<br>
with nice command:</p>
<p class="has-line-data" data-line-start="2564" data-line-end="2567">$ <strong>nice</strong><br>
0<br>
It is also possible to tell ps command to write the nice parameter of processes:</p>
<p class="has-line-data" data-line-start="2568" data-line-end="2573">$ <strong>ps - l</strong><br>
F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD<br>
0 S 1000 15044 15035 0 80 0 - 7453 wait pts/29 00:00:00 bash<br>
0 S 1000 15052 15044 0 60 - 20 - 3976 hrtime pts/29 00:00:00 sleep<br>
0 R 1000 15080 15044 0 80 0 - 4680 - pts/29 00:00:00 ps</p>
<p class="has-line-data" data-line-start="2574" data-line-end="2575"><strong>Setting priorities when running commands</strong></p>
<p class="has-line-data" data-line-start="2576" data-line-end="2586">If you need to change the niceness level of a program you can running it with <strong>nice</strong> command and -<br>
n switch (for nice):<br>
$ <strong>nice - n - 20 echo “I am running!”</strong><br>
nice: cannot set niceness: Permission denied<br>
I am running!<br>
$ <strong>sudo nice - n - 20 echo “I am running!”</strong><br>
I am running!<br>
$ <strong>sudo nice - n 19 echo “I am running!”</strong><br>
I am running!<br>
Please note to two points:</p>
<ol>
<li class="has-line-data" data-line-start="2587" data-line-end="2588">Give high priorities (less than 0) needs root access</li>
<li class="has-line-data" data-line-start="2588" data-line-end="2591">If you are not root and asking for nice level lower than 0 you’ll get an error message but the<br>
process will run with normal nice level (0).</li>
</ol>
<p class="has-line-data" data-line-start="2591" data-line-end="2599">If you run a command with nice without any parameters, the nice value will be 10:<br>
$ <strong>nice xeyes &amp;</strong><br>
[1] 15217<br>
$ <strong>ps - l</strong><br>
F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD<br>
0 S 1000 15044 15035 0 80 0 - 7455 wait pts/29 00:00:00 bash<br>
0 S 1000 15217 15044 0 90 10 - 12522 poll_s pts/29 00:00:00 xeyes<br>
0 R 1000 15218 15044 0 80 0 - 4680 - pts/29 00:00:00 ps</p>
<p class="has-line-data" data-line-start="2600" data-line-end="2601"><strong>Changing priorities</strong></p>
<p class="has-line-data" data-line-start="2602" data-line-end="2608">The <strong>renice</strong> command can change the <em>niceness</em> of running processes:<br>
$ <strong>ps - ef | grep firefox</strong><br>
jadi 13605 11226 30 08:28? 00:10:13 /usr/lib/firefox/firefox<br>
jadi 15192 15044 0 09:01 pts/29 00:00:00 grep firefox<br>
$ sudo renice - n - 10 13605<br>
13605 (process ID) old priority 5, new priority - 10</p>
<p class="has-line-data" data-line-start="2609" data-line-end="2610"><strong>103.7 – Search text files using regular expressions - 3</strong></p>
<p class="has-line-data" data-line-start="2611" data-line-end="2612"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="2613" data-line-end="2614">Create simple regular expressions containing several notational elements.</li>
<li class="has-line-data" data-line-start="2614" data-line-end="2615">Use regular expression tools to perform searches through a filesystem or file content.</li>
<li class="has-line-data" data-line-start="2615" data-line-end="2616">grep</li>
<li class="has-line-data" data-line-start="2616" data-line-end="2617">egrep</li>
<li class="has-line-data" data-line-start="2617" data-line-end="2618">fgrep</li>
<li class="has-line-data" data-line-start="2618" data-line-end="2619">sed</li>
<li class="has-line-data" data-line-start="2619" data-line-end="2621">regex</li>
</ul>
<p class="has-line-data" data-line-start="2621" data-line-end="2622"><strong>Regex</strong></p>
<p class="has-line-data" data-line-start="2623" data-line-end="2626">Regular expression, Regex, regexp is a pattern to describe what we want to <em>match</em> from a text. Here will<br>
discuss the form of regex which is used with the <strong>grep</strong> (generalised regular expression processor)<br>
command.</p>
<p class="has-line-data" data-line-start="2627" data-line-end="2628">There is two kind of regex in GNU grep: <strong>Basic</strong> an <strong>Extended</strong>.</p>
<p class="has-line-data" data-line-start="2629" data-line-end="2630"><strong>Basic blocks</strong></p>
<p class="has-line-data" data-line-start="2631" data-line-end="2632"><em>Adding two expressions</em></p>
<p class="has-line-data" data-line-start="2633" data-line-end="2634">If you need to add (concat) two expressions, just write them after each other.</p>
<pre><code class="has-line-data" data-line-start="2636" data-line-end="2638">Regex Will match
</code></pre>
<pre><code class="has-line-data" data-line-start="2640" data-line-end="2642">a ali, mina, hamid, jadi
</code></pre>
<pre><code class="has-line-data" data-line-start="2644" data-line-end="2646">na nasim, mina, nananana batman, mona
</code></pre>
<p class="has-line-data" data-line-start="2647" data-line-end="2648"><strong><em>Repeating</em></strong></p>
<ul>
<li class="has-line-data" data-line-start="2649" data-line-end="2650">The ***** means repeating the previous character for 0 or more</li>
<li class="has-line-data" data-line-start="2650" data-line-end="2651">The <strong>+</strong> means repeating the previous character for 1 or more</li>
<li class="has-line-data" data-line-start="2651" data-line-end="2652">the**?** means zero or one repeats</li>
<li class="has-line-data" data-line-start="2652" data-line-end="2654">{n,m} The item is matched at least n times, but not more than m times</li>
</ul>
<pre><code class="has-line-data" data-line-start="2655" data-line-end="2657">Regex Will match Note
</code></pre>
<p class="has-line-data" data-line-start="2658" data-line-end="2666">a<em>b ab, aaab, aaaaab, aaabthis (^)<br>
a</em>b b, mobser Because there is a b here with zero <strong>a</strong> before it<br>
a+b ab, aab, aaabenz<br>
won’t match <strong>sober</strong> or <strong>b</strong> because there needs to be at<br>
least one <strong>a</strong><br>
a?b<br>
ab, a <strong>ab</strong> , b, batman (zero a then<br>
b), …</p>
<h3 class="code-line" data-line-start=2667 data-line-end=2668 ><a id="_2667"></a>.</h3>
<p class="has-line-data" data-line-start="2669" data-line-end="2670"><strong><em>Alternation (|)</em></strong></p>
<p class="has-line-data" data-line-start="2671" data-line-end="2672">If you say a|b it will match a or b.</p>
<p class="has-line-data" data-line-start="2673" data-line-end="2674"><strong><em>Character Classes</em></strong></p>
<p class="has-line-data" data-line-start="2675" data-line-end="2677">The dot (<strong>.</strong> ) means any character. So <strong>…</strong> will match anything with at least two character in it. You can also<br>
create your own classes with [abc] which will match a or b or c and [a-z] which match a to z.</p>
<p class="has-line-data" data-line-start="2678" data-line-end="2679">You can also refer to digits with \d and</p>
<p class="has-line-data" data-line-start="2680" data-line-end="2681"><strong><em>Ranges</em></strong></p>
<p class="has-line-data" data-line-start="2682" data-line-end="2683">There are easy ways to commonly used classes. Named classes open with [: and close with :]</p>
<pre><code class="has-line-data" data-line-start="2685" data-line-end="2687">Range Meaning
</code></pre>
<pre><code class="has-line-data" data-line-start="2689" data-line-end="2691">[:alnum:] Alphanumeric characters
</code></pre>
<pre><code class="has-line-data" data-line-start="2693" data-line-end="2695">[:blank:] Space and tab characters
</code></pre>
<pre><code class="has-line-data" data-line-start="2697" data-line-end="2699">[:digit:] The digits 0 through 9 (equivalent to 0-9)
</code></pre>
<pre><code class="has-line-data" data-line-start="2701" data-line-end="2704">[:upper:] and
[:lower:]
</code></pre>
<pre><code class="has-line-data" data-line-start="2706" data-line-end="2708">Upper and lower case letters, respectively.
</code></pre>
<pre><code class="has-line-data" data-line-start="2710" data-line-end="2712">Range Meaning
</code></pre>
<pre><code class="has-line-data" data-line-start="2714" data-line-end="2716">^ (negation)
</code></pre>
<pre><code class="has-line-data" data-line-start="2718" data-line-end="2721">As the first character after [ in a character class negates the sense of the remaining
characters
</code></pre>
<p class="has-line-data" data-line-start="2722" data-line-end="2723">A common form is .* which matches any character (zero or any length).</p>
<p class="has-line-data" data-line-start="2724" data-line-end="2725"><strong><em>Matching</em></strong> <em>specific locations</em></p>
<ul>
<li class="has-line-data" data-line-start="2726" data-line-end="2727">The caret <strong>^</strong> means beginning of the string</li>
<li class="has-line-data" data-line-start="2727" data-line-end="2729">The dollar <strong>$</strong> means the end of the string</li>
</ul>
<p class="has-line-data" data-line-start="2729" data-line-end="2730"><strong>Samples</strong></p>
<ul>
<li class="has-line-data" data-line-start="2731" data-line-end="2732">^a.* Matches anything that starts with a</li>
<li class="has-line-data" data-line-start="2732" data-line-end="2733">^a.*b$ Matches anything that starts with a and ends with b</li>
<li class="has-line-data" data-line-start="2733" data-line-end="2734">^a.*\d+.*b$ Matches anything starting with a, have some digits in the middle and end with b</li>
<li class="has-line-data" data-line-start="2734" data-line-end="2735">^(l|b)oo Matches anything starts with l or b and then have oo</li>
<li class="has-line-data" data-line-start="2735" data-line-end="2737">[f-h]|[A-K]$ The last character should be f to h (capital or small)</li>
</ul>
<p class="has-line-data" data-line-start="2737" data-line-end="2738"><strong>grep</strong></p>
<p class="has-line-data" data-line-start="2739" data-line-end="2744">The grep command can search inside the files.<br>
$ <strong>grep p friends</strong><br>
payam<br>
pedram<br>
There are the most important switches:</p>
<pre><code class="has-line-data" data-line-start="2746" data-line-end="2748">switch meaning
</code></pre>
<ul>
<li class="has-line-data" data-line-start="2749" data-line-end="2750">c just show the count</li>
<li class="has-line-data" data-line-start="2750" data-line-end="2751">v reverse the search</li>
<li class="has-line-data" data-line-start="2751" data-line-end="2752">n show line numbers</li>
<li class="has-line-data" data-line-start="2752" data-line-end="2753">l show only file names</li>
<li class="has-line-data" data-line-start="2753" data-line-end="2755">i case insensitive</li>
</ul>
<p class="has-line-data" data-line-start="2755" data-line-end="2776">$ **grep p ***<br>
friends:payam<br>
friends:pedram<br>
what_I_have.txt:laptop 2<br>
what_I_have.txt:pillow 5<br>
what_I_have.txt:apple 2<br>
$ <strong>grep p * - n</strong><br>
friends:12:payam<br>
friends:15:pedram<br>
what_I_have.txt:2:laptop 2<br>
what_I_have.txt:3:pillow 5<br>
what_I_have.txt:4:apple 2<br>
$ <strong>grep p * - l</strong><br>
friends<br>
what_I_have.txt<br>
$ <strong>grep p * - c</strong><br>
friends:2<br>
what_I_have.txt:3<br>
$<br>
If is very common to combine grep and find: find. -type f -print0 | xargs -0 grep -c a | grep -v ali # find all<br>
files with <strong>a</strong> in them but not <strong>ali</strong> `</p>
<p class="has-line-data" data-line-start="2777" data-line-end="2778"><strong>Extended grep</strong></p>
<p class="has-line-data" data-line-start="2779" data-line-end="2781">Extended grep is a GNU extension. It does not need the escaping and much easier. It can be used with -E<br>
option or <strong>egrep</strong> command which equals to grep -E.</p>
<p class="has-line-data" data-line-start="2782" data-line-end="2783"><strong>Fixed grep</strong></p>
<p class="has-line-data" data-line-start="2784" data-line-end="2786">If you need to search the exact string (and not interpret it as a regex), use grep -F or fgrep so the fgrep<br>
this$ wont go for the end of the line and will find <em>this$that</em> too.</p>
<p class="has-line-data" data-line-start="2787" data-line-end="2788"><strong>Sed</strong></p>
<p class="has-line-data" data-line-start="2789" data-line-end="2798">In previous lessons we saw simple sed usage. Here I have great news for you: <strong>sed understands regex</strong>! If<br>
is good to use - r switch to tell sed that we are using them.<br>
$ <strong>sed - r “s/^(a|b)/STARTS WITH A OR B/” friends</strong><br>
STARTS WITH A OR Bmir<br>
mina<br>
jadi<br>
STARTS WITH A OR Bita<br>
STARTS WITH A OR Bli<br>
hassan</p>
<p class="has-line-data" data-line-start="2799" data-line-end="2800">Main switches:</p>
<pre><code class="has-line-data" data-line-start="2802" data-line-end="2804">switch meaning
</code></pre>
<ul>
<li class="has-line-data" data-line-start="2805" data-line-end="2806">r use advanced regex</li>
<li class="has-line-data" data-line-start="2806" data-line-end="2808">n suppress output, you can use p at the end of your regex ( /something/p ) to print the output</li>
</ul>
<p class="has-line-data" data-line-start="2808" data-line-end="2812">$ sed - rn “/^(a|b)/p” friends<br>
amir<br>
bita<br>
ali</p>
<p class="has-line-data" data-line-start="2813" data-line-end="2814"><strong>103.8 – Perform basic file editing operations using vi - 3</strong></p>
<p class="has-line-data" data-line-start="2815" data-line-end="2816"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="2817" data-line-end="2818">Navigate a document using vi.</li>
<li class="has-line-data" data-line-start="2818" data-line-end="2819">Use basic vi modes.</li>
<li class="has-line-data" data-line-start="2819" data-line-end="2820">Insert, edit, delete, copy and find text.</li>
<li class="has-line-data" data-line-start="2820" data-line-end="2821">vi</li>
<li class="has-line-data" data-line-start="2821" data-line-end="2822">/,?</li>
<li class="has-line-data" data-line-start="2822" data-line-end="2823">h,j,k,l</li>
<li class="has-line-data" data-line-start="2823" data-line-end="2824">i, o, a</li>
<li class="has-line-data" data-line-start="2824" data-line-end="2825">c, d, p, y, dd, yy</li>
<li class="has-line-data" data-line-start="2825" data-line-end="2827">ZZ, :w!, :q!, :e!</li>
</ul>
<p class="has-line-data" data-line-start="2827" data-line-end="2828"><strong>Introduction</strong></p>
<p class="has-line-data" data-line-start="2829" data-line-end="2833"><strong>vi</strong> is a great tool! The best editor ever (some say after Emacs) and it is installed on all linux systems.<br>
Some say it is difficult to use and <em>abnormal</em> and some say it is the most natural editor there can be. Lets<br>
see.<br>
vi can be used with simplest keyboards and over network on ssh terminals</p>
<p class="has-line-data" data-line-start="2834" data-line-end="2843">In many systems, vi command is a link / alias to vim and there are many versions of vi. Check with –<br>
version switch:<br>
$ vi --version<br>
VIM - Vi IMproved 7.4 (2013 Aug 10, compiled Oct 20 2014 16:08:47)<br>
Included patches: 1 - 273<br>
Modified by <a href="mailto:pkg-vim-maintainers@lists.alioth.debian.org">pkg-vim-maintainers@lists.alioth.debian.org</a><br>
Compiled by buildd@<br>
Small version without GUI. Features included (+) or not (-):<br>
+acl - farsi - mouse_sgr - tag_old_static</p>
<ul>
<li class="has-line-data" data-line-start="2844" data-line-end="2845">arabic - file_in_path - mouse_sysmouse - tag_any_white</li>
<li class="has-line-data" data-line-start="2845" data-line-end="2846">autocmd - find_in_path - mouse_urxvt - tcl</li>
<li class="has-line-data" data-line-start="2846" data-line-end="2850">balloon_eval - float - mouse_xterm +terminfo<br>
…<br>
To edit a file with vi, just give the file name to it:</li>
</ul>
<p class="has-line-data" data-line-start="2850" data-line-end="2851">$ <strong>vi file.txt</strong></p>
<p class="has-line-data" data-line-start="2852" data-line-end="2853"><strong>vi moded</strong></p>
<p class="has-line-data" data-line-start="2854" data-line-end="2855">vi has 2 different modes:</p>
<ul>
<li class="has-line-data" data-line-start="2856" data-line-end="2858"><strong>Command mode</strong> is where you go around the file, search, delete text, copy paste, replace, … and<br>
give other commands to the vi. Some commands start with a : and some are only a keypress.</li>
<li class="has-line-data" data-line-start="2858" data-line-end="2860"><strong>Insert mode</strong> is where what you type, goes into the file at the cursors position.</li>
</ul>
<p class="has-line-data" data-line-start="2860" data-line-end="2861"><strong>Moving the cursor</strong></p>
<p class="has-line-data" data-line-start="2862" data-line-end="2863">If you need to move around, use these keys:</p>
<pre><code class="has-line-data" data-line-start="2865" data-line-end="2867">key function
</code></pre>
<pre><code class="has-line-data" data-line-start="2869" data-line-end="2871">h One character to the left (only current line)
</code></pre>
<pre><code class="has-line-data" data-line-start="2873" data-line-end="2875">j One line down
</code></pre>
<pre><code class="has-line-data" data-line-start="2877" data-line-end="2879">k One line up
</code></pre>
<pre><code class="has-line-data" data-line-start="2881" data-line-end="2883">l One character to the right (only current line)
</code></pre>
<pre><code class="has-line-data" data-line-start="2885" data-line-end="2887">w Next word on the current line
</code></pre>
<pre><code class="has-line-data" data-line-start="2889" data-line-end="2891">e Next end of word on the current line
</code></pre>
<pre><code class="has-line-data" data-line-start="2893" data-line-end="2896">b Previous beginning of the word on the current line

</code></pre>
<pre><code class="has-line-data" data-line-start="2898" data-line-end="2901">Ctrl-f Scroll forward one page

</code></pre>
<pre><code class="has-line-data" data-line-start="2903" data-line-end="2906">Ctrl-b Scroll backward one page

</code></pre>
<p class="has-line-data" data-line-start="2907" data-line-end="2908"><strong>Jumping</strong></p>
<pre><code class="has-line-data" data-line-start="2910" data-line-end="2913">key function

</code></pre>
<pre><code class="has-line-data" data-line-start="2915" data-line-end="2918">G With no number, will jump to the end &amp; 10G will jump to line 10

</code></pre>
<pre><code class="has-line-data" data-line-start="2920" data-line-end="2923">H 5H will go to the 5th line from the top of the screen

</code></pre>
<pre><code class="has-line-data" data-line-start="2925" data-line-end="2928">L 3L will move the cursor to the 3rd line to the last line of the screen

</code></pre>
<p class="has-line-data" data-line-start="2929" data-line-end="2930"><strong>Editing text</strong></p>
<p class="has-line-data" data-line-start="2931" data-line-end="2932">These command during the <em>command mode</em> will help you enter, edit, replace, … test:</p>
<pre><code class="has-line-data" data-line-start="2934" data-line-end="2937">key function

</code></pre>
<pre><code class="has-line-data" data-line-start="2939" data-line-end="2942">i Enter the insert mode

</code></pre>
<pre><code class="has-line-data" data-line-start="2944" data-line-end="2947">a Enter the insert mode after the current position of the cursor

</code></pre>
<pre><code class="has-line-data" data-line-start="2949" data-line-end="2952">r replace only one character

</code></pre>
<pre><code class="has-line-data" data-line-start="2954" data-line-end="2957">o open a new line below the cursor and go to the insert mode

</code></pre>
<pre><code class="has-line-data" data-line-start="2959" data-line-end="2962">O open a new line above the cursor and go to the insert mode

</code></pre>
<pre><code class="has-line-data" data-line-start="2964" data-line-end="2968">c clear to a location and go to the insert mode the replace till there and then normal insert (cw^ will
overwrite the current word)

</code></pre>
<pre><code class="has-line-data" data-line-start="2970" data-line-end="2973">d

</code></pre>
<pre><code class="has-line-data" data-line-start="2975" data-line-end="2979">delete. you can mix with w (dw) to delete a word. Same as cw but dw does not to to the insert
mode

</code></pre>
<pre><code class="has-line-data" data-line-start="2981" data-line-end="2984">dd Delete the current line

</code></pre>
<pre><code class="has-line-data" data-line-start="2986" data-line-end="2989">x Delete character at the position of the cursor

</code></pre>
<pre><code class="has-line-data" data-line-start="2991" data-line-end="2994">p Paste the last deleted text after the cursor

</code></pre>
<pre><code class="has-line-data" data-line-start="2996" data-line-end="2999">P Paste the last deleted text before the cursor

</code></pre>
<pre><code class="has-line-data" data-line-start="3001" data-line-end="3004">xp swaps the character at the cursor position with the one on its right

</code></pre>
<p class="has-line-data" data-line-start="3005" data-line-end="3006"><strong>Searching</strong></p>
<pre><code class="has-line-data" data-line-start="3008" data-line-end="3011">key function

</code></pre>
<p class="has-line-data" data-line-start="3012" data-line-end="3031">/ (^) Search forward (/happiness will find the next happiness)<br>
? Search backward<br>
n repeat previous search. You can also use / and? without any parameters)<br>
Search wraps around to the top once the bottom of file is reached<br>
<strong>Exiting</strong><br>
It is always funny when you see someone entering to the vi and now knowing how to exit! Learn these<br>
and prevent the laughter:<br>
<strong>key function</strong><br>
:q! Quit editing without saving = runaway after any mistake<br>
:w! Write the file (whether modified or not). Attempt to overwrite existing files or read-only or other unwritable files<br>
:w myfile.txt Write to a new name<br>
ZZ Exit and save the file if modified<br>
:e! Reload the file from disk<br>
:! Run a shell command<br>
Entering colon (:) during <em>command mode</em> will move the cursor to the bottom of the screen and vi will<br>
wait for your commands. Press ESC to return back to the normal command mode.<br>
<strong>Help</strong><br>
You can always ask for help with :help or :help subject. This way vi will open a help text which you can<br>
use / search just like any other text. Close it with :q command.</p>
<p class="has-line-data" data-line-start="3032" data-line-end="3033"><strong>104.1 – Create partitions and filesystems – 2</strong></p>
<p class="has-line-data" data-line-start="3034" data-line-end="3035"><strong>Objective</strong></p>
<ul>
<li class="has-line-data" data-line-start="3036" data-line-end="3037">Use various mkfs commands to set up partitions and create various filesystems such as:</li>
<li class="has-line-data" data-line-start="3037" data-line-end="3038">ext2/ext3/ext4</li>
<li class="has-line-data" data-line-start="3038" data-line-end="3039">xfs</li>
<li class="has-line-data" data-line-start="3039" data-line-end="3040">reiserfs v3</li>
<li class="has-line-data" data-line-start="3040" data-line-end="3041">vfat</li>
<li class="has-line-data" data-line-start="3041" data-line-end="3042">fdisk</li>
<li class="has-line-data" data-line-start="3042" data-line-end="3043">mkfs</li>
<li class="has-line-data" data-line-start="3043" data-line-end="3045">mkswap</li>
</ul>
<p class="has-line-data" data-line-start="3045" data-line-end="3046"><strong>Blocked devices</strong></p>
<p class="has-line-data" data-line-start="3047" data-line-end="3049">Is a technical term for any storage device which can be formatted to fixed sized blocks and blocks should<br>
be able to be accessed individually. That is Hard disks, USB Memories, CDs, …</p>
<p class="has-line-data" data-line-start="3050" data-line-end="3051">In long ls format, the first <strong>b</strong> indicates Block Device:</p>
<p class="has-line-data" data-line-start="3052" data-line-end="3057">$ <strong>ls - l /dev/loop1 /dev/sd[a-z]</strong><br>
brw-rw---- 1 root disk 7, 1 Jan 8 10:46 /dev/loop1<br>
brw-rw---- 1 root disk 8, 0 Jan 8 10:46 /dev/sda<br>
Some block devices mostly used as one single filesystem (like CDs &amp; Floppies) and some are divided<br>
into <strong>Partitions</strong> (Hard disks).</p>
<p class="has-line-data" data-line-start="3058" data-line-end="3059"><strong>fdisk</strong></p>
<p class="has-line-data" data-line-start="3060" data-line-end="3062">fdisk is the main command for viewing / changing and creating partitions. - l switch is for show:<br>
root@funlife:~# fdisk - l /dev/sda</p>
<p class="has-line-data" data-line-start="3063" data-line-end="3069">Disk /dev/sda: 298.1 GiB, 320072933376 bytes, 625142448 sectors<br>
Units: sectors of 1 * 512 = 512 bytes<br>
Sector size (logical/physical): 512 bytes / 512 bytes<br>
I/O size (minimum/optimal): 512 bytes / 512 bytes<br>
Disklabel type: dos<br>
Disk identifier: 0x000beca1</p>
<p class="has-line-data" data-line-start="3070" data-line-end="3075">Device Boot Start End Sectors Size Id Type<br>
/dev/sda1 * 2048 43094015 43091968 20.6G 83 Linux<br>
/dev/sda2 43094016 92078390 48984375 23.4G 83 Linux<br>
/dev/sda3 92080126 625141759 533061634 254.2G 5 Extended<br>
/dev/sda5 92080128 107702271 15622144 7.5G 82 Linux swap / Solaris</p>
<ul>
<li class="has-line-data" data-line-start="3076" data-line-end="3078">The <strong>Boot</strong> flag shows which partition starts the boot on DOS PCs and has no importance on LILO<br>
&amp; GRUB</li>
<li class="has-line-data" data-line-start="3078" data-line-end="3079">Start and End shows the where this partition is located on the disk</li>
<li class="has-line-data" data-line-start="3079" data-line-end="3080">Size is size!</li>
<li class="has-line-data" data-line-start="3080" data-line-end="3082">ID indicated the partition format (82 is swap, 83 is linux data, …)</li>
</ul>
<p class="has-line-data" data-line-start="3082" data-line-end="3083">It is also possible to run fdisk in interactive mode. m will show you the help:</p>
<p class="has-line-data" data-line-start="3084" data-line-end="3085">root@funlife:~# <strong>fdisk /dev/sda</strong></p>
<p class="has-line-data" data-line-start="3086" data-line-end="3089">Welcome to fdisk (util-linux 2.25.1).<br>
Changes will remain in memory only, until you decide to write them.<br>
Be careful before using the write command.</p>
<p class="has-line-data" data-line-start="3090" data-line-end="3091">Command (m for help): m</p>
<p class="has-line-data" data-line-start="3092" data-line-end="3093">Help:</p>
<h3 class="code-line" data-line-start=3094 data-line-end=3095 ><a id="DOS_MBR_3094"></a>DOS (MBR)</h3>
<p class="has-line-data" data-line-start="3096" data-line-end="3099">a toggle a bootable flag<br>
b edit nested BSD disklabel<br>
c toggle the dos compatibility flag</p>
<p class="has-line-data" data-line-start="3100" data-line-end="3107">Generic<br>
d delete a partition<br>
l list known partition types<br>
n add a new partition<br>
p print the partition table<br>
t change a partition type<br>
v verify the partition table</p>
<p class="has-line-data" data-line-start="3108" data-line-end="3112">Misc<br>
m print this menu<br>
u change display/entry units<br>
x extra functionality (experts only)</p>
<p class="has-line-data" data-line-start="3113" data-line-end="3116">Save &amp; Exit<br>
w write table to disk and exit<br>
q quit without saving changes</p>
<p class="has-line-data" data-line-start="3117" data-line-end="3122">Create a new label<br>
g create a new empty GPT partition table<br>
G create a new empty SGI (IRIX) partition table<br>
o create a new empty DOS partition table<br>
s create a new empty Sun partition table</p>
<p class="has-line-data" data-line-start="3123" data-line-end="3124"><strong>p</strong> displays the <strong>current partitions</strong> :</p>
<p class="has-line-data" data-line-start="3125" data-line-end="3132">Command (m for help): <strong>p</strong><br>
Disk /dev/sda: 298.1 GiB, 320072933376 bytes, 625142448 sectors<br>
Units: sectors of 1 * 512 = 512 bytes<br>
Sector size (logical/physical): 512 bytes / 512 bytes<br>
I/O size (minimum/optimal): 512 bytes / 512 bytes<br>
Disklabel type: dos<br>
Disk identifier: 0x000beca1</p>
<p class="has-line-data" data-line-start="3133" data-line-end="3139">Device Boot Start End Sectors Size Id Type<br>
/dev/sda1 * 2048 43094015 43091968 20.6G 83 Linux<br>
/dev/sda2 43094016 92078390 48984375 23.4G 83 Linux<br>
/dev/sda3 92080126 625141759 533061634 254.2G 5 Extended<br>
/dev/sda5 92080128 107702271 15622144 7.5G 82 Linux swap / Solaris<br>
/dev/sda6 107704320 625141759 517437440 246.8G 83 Linux</p>
<p class="has-line-data" data-line-start="3140" data-line-end="3149">You may remember the disk layouts from other chapters. fdisk can create them. Lets first delete my first<br>
partition:<br>
Command (m for help): <strong>p</strong><br>
Disk /dev/sda: 298.1 GiB, 320072933376 bytes, 625142448 sectors<br>
Units: sectors of 1 * 512 = 512 bytes<br>
Sector size (logical/physical): 512 bytes / 512 bytes<br>
I/O size (minimum/optimal): 512 bytes / 512 bytes<br>
Disklabel type: dos<br>
Disk identifier: 0x000beca1</p>
<p class="has-line-data" data-line-start="3150" data-line-end="3156">Device Boot Start End Sectors Size Id Type<br>
/dev/sda1 * 2048 43094015 43091968 20.6G 83 Linux<br>
/dev/sda2 43094016 92078390 48984375 23.4G 83 Linux<br>
/dev/sda3 92080126 625141759 533061634 254.2G 5 Extended<br>
/dev/sda5 92080128 107702271 15622144 7.5G 82 Linux swap / Solaris<br>
/dev/sda6 107704320 625141759 517437440 246.8G 83 Linux</p>
<p class="has-line-data" data-line-start="3157" data-line-end="3159">Command (m for help): d<br>
Partition number (1-3,5,6, default 6): 1</p>
<p class="has-line-data" data-line-start="3160" data-line-end="3161">Partition 1 has been deleted.</p>
<p class="has-line-data" data-line-start="3162" data-line-end="3163">I’m brave! Now lets create a smaller one there:</p>
<p class="has-line-data" data-line-start="3164" data-line-end="3168">Command (m for help): <strong>n</strong><br>
Partition type<br>
p primary (1 primary, 1 extended, 2 free)<br>
l logical (numbered from 5)</p>
<p class="has-line-data" data-line-start="3169" data-line-end="3173">Select (default p): p<br>
Partition number (1,4, default 1): 1<br>
First sector (2048-625142447, default 2048):<br>
Last sector, +sectors or +size{K,M,G,T,P} (2048-43094015, default 43094015): +15G</p>
<p class="has-line-data" data-line-start="3174" data-line-end="3175">Created a new partition 1 of type ‘Linux’ and of size 15 GiB.</p>
<p class="has-line-data" data-line-start="3176" data-line-end="3183">Command (m for help): <strong>p</strong><br>
Disk /dev/sda: 298.1 GiB, 320072933376 bytes, 625142448 sectors<br>
Units: sectors of 1 * 512 = 512 bytes<br>
Sector size (logical/physical): 512 bytes / 512 bytes<br>
I/O size (minimum/optimal): 512 bytes / 512 bytes<br>
Disklabel type: dos<br>
Disk identifier: 0x000beca1</p>
<p class="has-line-data" data-line-start="3184" data-line-end="3199">Device Boot Start End Sectors Size Id Type<br>
/dev/sda1 2048 31459327 31457280 15G 83 Linux<br>
/dev/sda2 43094016 92078390 48984375 23.4G 83 Linux<br>
/dev/sda3 92080126 625141759 533061634 254.2G 5 Extended<br>
/dev/sda5 92080128 107702271 15622144 7.5G 82 Linux swap / Solaris<br>
/dev/sda6 107704320 625141759 517437440 246.8G 83 Linux<br>
This new partitioned is not formatted but still marked 83 for later use. If I needed to use this partition<br>
as <strong>swap</strong> I had to set its ID to 82:<br>
Command (m for help): <strong>p</strong><br>
Disk /dev/sda: 298.1 GiB, 320072933376 bytes, 625142448 sectors<br>
Units: sectors of 1 * 512 = 512 bytes<br>
Sector size (logical/physical): 512 bytes / 512 bytes<br>
I/O size (minimum/optimal): 512 bytes / 512 bytes<br>
Disklabel type: dos<br>
Disk identifier: 0x000beca1</p>
<p class="has-line-data" data-line-start="3200" data-line-end="3206">Device Boot Start End Sectors Size Id Type<br>
/dev/sda1 2048 31459327 31457280 15G 83 Linux<br>
/dev/sda2 43094016 92078390 48984375 23.4G 83 Linux<br>
/dev/sda3 92080126 625141759 533061634 254.2G 5 Extended<br>
/dev/sda5 92080128 107702271 15622144 7.5G 82 Linux swap / Solaris<br>
/dev/sda6 107704320 625141759 517437440 246.8G 83 Linux</p>
<p class="has-line-data" data-line-start="3207" data-line-end="3210">Command (m for help): t<br>
Partition number (1-3,5,6, default 6): 1<br>
Hex code (type L to list all codes): L</p>
<p class="has-line-data" data-line-start="3211" data-line-end="3216">0 Empty 24 NEC DOS 81 Minix / old Lin bf Solaris<br>
1 FAT12 27 Hidden NTFS Win 82 Linux swap / So c1 DRDOS/sec (FAT-<br>
2 XENIX root 39 Plan 9 83 Linux c4 DRDOS/sec (FAT-<br>
3 XENIX usr 3c PartitionMagic 84 OS/2 hidden C: c6 DRDOS/sec (FAT-<br>
4 FAT16 &lt;32M 40 Venix 80286 85 Linux extended c7 Syrinx</p>
<p class="has-line-data" data-line-start="3217" data-line-end="3238">5 Extended 41 PPC PReP Boot 86 NTFS volume set da Non-FS data<br>
6 FAT16 42 SFS 87 NTFS volume set db CP/M / CTOS /.<br>
7 HPFS/NTFS/exFAT 4d QNX4.x 88 Linux plaintext de Dell Utility<br>
8 AIX 4e QNX4.x 2nd part 8e Linux LVM df BootIt<br>
9 AIX bootable 4f QNX4.x 3rd part 93 Amoeba e1 DOS access<br>
a OS/2 Boot Manag 50 OnTrack DM 94 Amoeba BBT e3 DOS R/O<br>
b W95 FAT32 51 OnTrack DM6 Aux 9f BSD/OS e4 SpeedStor<br>
c W95 FAT32 (LBA) 52 CP/M a0 IBM Thinkpad hi eb BeOS fs<br>
e W95 FAT16 (LBA) 53 OnTrack DM6 Aux a5 FreeBSD ee GPT<br>
f W95 Ext’d (LBA) 54 OnTrackDM6 a6 OpenBSD ef EFI (FAT-12/16/<br>
10 OPUS 55 EZ-Drive a7 NeXTSTEP f0 Linux/PA-RISC b<br>
11 Hidden FAT12 56 Golden Bow a8 Darwin UFS f1 SpeedStor<br>
12 Compaq diagnost 5c Priam Edisk a9 NetBSD f4 SpeedStor<br>
14 Hidden FAT16 &lt;3 61 SpeedStor ab Darwin boot f2 DOS secondary<br>
16 Hidden FAT16 63 GNU HURD or Sys af HFS / HFS+ fb VMware VMFS<br>
17 Hidden HPFS/NTF 64 Novell Netware b7 BSDI fs fc VMware VMKCORE<br>
18 AST SmartSleep 65 Novell Netware b8 BSDI swap fd Linux raid auto<br>
1b Hidden W95 FAT3 70 DiskSecure Mult bb Boot Wizard hid fe LANstep<br>
1c Hidden W95 FAT3 75 PC/IX be Solaris boot ff BBT<br>
1e Hidden W95 FAT1 80 Old Minix<br>
Hex code (type L to list all codes): 82</p>
<p class="has-line-data" data-line-start="3239" data-line-end="3240">Changed type of partition ‘Linux’ to ‘Linux swap / Solaris’.</p>
<p class="has-line-data" data-line-start="3241" data-line-end="3248">Command (m for help): p<br>
Disk /dev/sda: 298.1 GiB, 320072933376 bytes, 625142448 sectors<br>
Units: sectors of 1 * 512 = 512 bytes<br>
Sector size (logical/physical): 512 bytes / 512 bytes<br>
I/O size (minimum/optimal): 512 bytes / 512 bytes<br>
Disklabel type: dos<br>
Disk identifier: 0x000beca1</p>
<p class="has-line-data" data-line-start="3249" data-line-end="3257">Device Boot Start End Sectors Size Id Type<br>
/dev/sda1 2048 31459327 31457280 15G 82 Linux swap / Solaris<br>
/dev/sda2 43094016 92078390 48984375 23.4G 83 Linux<br>
/dev/sda3 92080126 625141759 533061634 254.2G 5 Extended<br>
/dev/sda5 92080128 107702271 15622144 7.5G 82 Linux swap / Solaris<br>
/dev/sda6 107704320 625141759 517437440 246.8G 83 Linux<br>
b is code for FAT32 (windows 95).<br>
But all we done was in memory! We need to write it to the partition table. <strong>‘v’</strong> will <strong>verify</strong> the setup:</p>
<p class="has-line-data" data-line-start="3258" data-line-end="3260">Command (m for help): <strong>v</strong><br>
Remaining 11639159 unallocated 512 - byte sectors.</p>
<p class="has-line-data" data-line-start="3261" data-line-end="3264">It tells me that I have unallocated space! I’m waisting my hard but I’m fine with it. So lets save it<br>
with w command (for <strong>write</strong> ):<br>
Command (m for help): w</p>
<p class="has-line-data" data-line-start="3265" data-line-end="3268">The partition table has been altered.<br>
Calling ioctl() to re-read partition table.<br>
Re-reading the partition table failed.: Device or resource busy</p>
<p class="has-line-data" data-line-start="3269" data-line-end="3271">The kernel still uses the old table. The new table will be used at the next reboot or after you run<br>
partprobe(8) or kpartx(8).</p>
<p class="has-line-data" data-line-start="3272" data-line-end="3273"><strong>Formatting the partition</strong></p>
<p class="has-line-data" data-line-start="3274" data-line-end="3275">Linux can handle more than 100 kind of partitions but most commons are:</p>
<pre><code class="has-line-data" data-line-start="3277" data-line-end="3279">Format Description
</code></pre>
<pre><code class="has-line-data" data-line-start="3281" data-line-end="3283">ext2
</code></pre>
<pre><code class="has-line-data" data-line-start="3285" data-line-end="3289">second extended filesystem was developed to address shortcomings in the Minix filesystem used in
early versions of Linux. It has been used extensively on Linux for many years. There is no journaling in
ext2, and it has largely been replaced by ext3 and more recently ext4.
</code></pre>
<pre><code class="has-line-data" data-line-start="3291" data-line-end="3293">ext3 ext2 + journaling, total storage can be 1EXAByte and each file can be 16TB, ...
</code></pre>
<pre><code class="has-line-data" data-line-start="3295" data-line-end="3298">ReiserFS

</code></pre>
<pre><code class="has-line-data" data-line-start="3300" data-line-end="3304">ReiserFS is a B-tree-based filesystem, great for large numbers of small files, journaling, no longer in
active development &amp; does not support SELinux, replaced with Reiser4.

</code></pre>
<pre><code class="has-line-data" data-line-start="3306" data-line-end="3309">XFS journaling, caches to RAM, great for uninterruptible power supplies

</code></pre>
<pre><code class="has-line-data" data-line-start="3311" data-line-end="3314">swap Swap space must be formatted for use as swap space, but it is not generally considered a filesystem.

</code></pre>
<pre><code class="has-line-data" data-line-start="3316" data-line-end="3319">vfat

</code></pre>
<pre><code class="has-line-data" data-line-start="3321" data-line-end="3325">FAT32, no journaling, good for data exchange with windows, does not understand permissions and
symbolic links

</code></pre>
<pre><code class="has-line-data" data-line-start="3327" data-line-end="3330">ext4 newer than ext3

</code></pre>
<p class="has-line-data" data-line-start="3331" data-line-end="3339">You can format your partitions with <strong>mkfs</strong> command (and <strong>mkswap</strong> for swap). This is a front end to<br>
commands like mkfs.ext3 for ext3, mkfs.ext4 for ext4 and mkfs.reiserfs for ReiserFS. full list of installed<br>
on your system is here:<br>
root@funlife:~# <strong>ls /sbin/mk</strong>*<br>
/sbin/mkdosfs /sbin/mkfs /sbin/mkfs.cramfs /sbin/mkfs.ext3 /sbin/mkfs.ext4dev /sbin/mkfs.minix<br>
/sbin/mkfs.ntfs /sbin/mkhomedir_helper /sbin/mkswap<br>
/sbin/mke2fs /sbin/mkfs.bfs /sbin/mkfs.ext2 /sbin/mkfs.ext4 /sbin/mkfs.fat /sbin/mkfs.msdos<br>
/sbin/mkfs.vfat /sbin/mkntfs</p>
<p class="has-line-data" data-line-start="3340" data-line-end="3351">The main switch is - type (or - t) to specify the format:<br>
root@funlife:~# <strong>mkfs - t ext3 /dev/sda1</strong><br>
mke2fs 1.42.10 (18-May-2014)<br>
/dev/sda1 contains a ext4 file system<br>
last mounted on /mnt on Mon Dec 22 12:04:22 2014<br>
Proceed anyway? (y,n) <strong>y</strong><br>
Creating filesystem with 5386496 4k blocks and 1349040 inodes<br>
Filesystem UUID: 0b5aad86-b507-41b9-a0ff-cf899cb92785<br>
Superblock backups stored on blocks:<br>
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,<br>
4096000</p>
<p class="has-line-data" data-line-start="3352" data-line-end="3356">Allocating group tables: done<br>
Writing inode tables: done<br>
Creating journal (32768 blocks): done<br>
Writing superblocks and filesystem accounting information: done</p>
<p class="has-line-data" data-line-start="3357" data-line-end="3363">root@funlife:~#<br>
This will have a same effect: mkfs.ext3 /dev/sda1<br>
If you need to assign a lable to the partition, you have to use the - L lable_name option. Please note that<br>
in renect system, people use UUIDs instead of labels. UUID of a disk can be viewed with:<br>
$ <strong>blkid /dev/sda1</strong><br>
/dev/sda1: UUID=“59d8cbdb-0e78- 4605 - 8aaf-cf02fcb85d2e” SEC_TYPE=“ext2” TYPE=“ext3”</p>
<h3 class="code-line" data-line-start=3364 data-line-end=3365 ><a id="GPT_3364"></a>GPT</h3>
<p class="has-line-data" data-line-start="3366" data-line-end="3370">Some systems use GUID Partition Table (GPT) instead of older MBR. In this case you have to use<br>
the <strong>gdisk</strong> tool which has more capabilities than fdisk.<br>
root@funlife:~# <strong>gdisk /dev/sda</strong><br>
GPT fdisk (gdisk) version 0.8.8</p>
<p class="has-line-data" data-line-start="3371" data-line-end="3376">Partition table scan:<br>
MBR: MBR only<br>
BSD: not present<br>
APM: not present<br>
GPT: not present</p>
<h3 class="code-line" data-line-start=3377 data-line-end=3378 ><a id="_3377"></a>***************************************************************</h3>
<p class="has-line-data" data-line-start="3379" data-line-end="3383">Found invalid GPT and valid MBR; converting MBR to GPT format<br>
in memory. THIS OPERATION IS POTENTIALLY DESTRUCTIVE! Exit by<br>
typing ‘q’ if you don’t want to convert your MBR partitions<br>
to GPT format!</p>
<hr>
<pre><code class="has-line-data" data-line-start="3387" data-line-end="3390">Creating different partitions

</code></pre>
<pre><code class="has-line-data" data-line-start="3392" data-line-end="3395">Partition Format type Sample Command Notes

</code></pre>
<p class="has-line-data" data-line-start="3396" data-line-end="3401">/dev/sda3 ext4 (^) mkfs -t ext4 -L data/dev/sda3 Named it <em>dafa</em>. Or use the mkfs.ext4command<br>
/dev/sdb2 xfs mkfs -t xfs -i size=512 /dev/sdb2 telling it to have larger inodes (normal is 256)<br>
/dev/sda8 ReiserFS mkfs -t reiserfs /dev/sda8 Or you can use mkreiserfs command.<br>
/dev/sdc FAT32 mkfs -t vfat /dev/sdc Or you can use mkfs.vfat command<br>
/dev/sda2 swap mkswap /dev/sda2 will be used as swap space</p>
<p class="has-line-data" data-line-start="3402" data-line-end="3403"><strong>104.2 – Maintain the Integrity of Filesystems – 2</strong></p>
<p class="has-line-data" data-line-start="3404" data-line-end="3405"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="3406" data-line-end="3407">Verify the integrity of filesystems.</li>
<li class="has-line-data" data-line-start="3407" data-line-end="3408">Monitor free space and inodes.</li>
<li class="has-line-data" data-line-start="3408" data-line-end="3409">Repair simple filesystem problems.</li>
<li class="has-line-data" data-line-start="3409" data-line-end="3410">du</li>
<li class="has-line-data" data-line-start="3410" data-line-end="3411">df</li>
<li class="has-line-data" data-line-start="3411" data-line-end="3412">fsck</li>
<li class="has-line-data" data-line-start="3412" data-line-end="3413">e2fsck</li>
<li class="has-line-data" data-line-start="3413" data-line-end="3414">mke2fs</li>
<li class="has-line-data" data-line-start="3414" data-line-end="3415">debugfs</li>
<li class="has-line-data" data-line-start="3415" data-line-end="3416">dumpe2fs</li>
<li class="has-line-data" data-line-start="3416" data-line-end="3417">tune2fs</li>
<li class="has-line-data" data-line-start="3417" data-line-end="3419">xfs tools</li>
</ul>
<p class="has-line-data" data-line-start="3419" data-line-end="3420"><strong>fsck</strong></p>
<p class="has-line-data" data-line-start="3421" data-line-end="3429">If anything bad happens for your filesystem, you will have a corrupted file system. The command to fix<br>
this is fsck. Technically this command is a front end for many commands:<br>
jadi@funlife:~$ <strong>ls /sbin/<em>fsck</em></strong><br>
/sbin/dosfsck /sbin/fsck.ext2 /sbin/fsck.fat /sbin/fsck.vfat<br>
/sbin/e2fsck /sbin/fsck.ext3 /sbin/fsck.minix<br>
/sbin/fsck /sbin/fsck.ext4 /sbin/fsck.msdos<br>
/sbin/fsck.cramfs /sbin/fsck.ext4dev /sbin/fsck.nfs<br>
Some of these are just hardlinks to e2fsck command</p>
<p class="has-line-data" data-line-start="3430" data-line-end="3437">A common switch during boot is - A which tells fsck to check all file systems in <strong>/etc/fstab</strong> ordered<br>
by <em>passno</em> in that file which is 6th field (File systems with <em>passno</em> of 0, wont be checked during the boot.<br>
root@funlife:~# <strong>fsck /dev/sdb</strong><br>
fsck from util-linux 2.25.1<br>
e2fsck 1.42.10 (18-May-2014)<br>
/dev/sdb is in use.<br>
e2fsck: Cannot continue, aborting.</p>
<p class="has-line-data" data-line-start="3438" data-line-end="3447">root@funlife:~# <strong>umount /dev/sdb</strong><br>
umount: /dev/sdb: not mounted<br>
root@funlife:~# <strong>umount /dev/sdb1</strong><br>
root@funlife:~# <strong>fsck /dev/sdb</strong><br>
fsck from util-linux 2.25.1<br>
e2fsck 1.42.10 (18-May-2014)<br>
ext2fs_open2: Bad magic number in super-block<br>
fsck.ext2: Superblock invalid, trying backup blocks…<br>
fsck.ext2: Bad magic number in super-block while trying to open /dev/sdb</p>
<p class="has-line-data" data-line-start="3448" data-line-end="3455">The superblock could not be read or does not describe a valid ext2/ext3/ext4<br>
filesystem. If the device is valid and it really contains an ext2/ext3/ext4<br>
filesystem (and not swap or ufs or something else), then the superblock<br>
is corrupt, and you might try running e2fsck with an alternate superblock:<br>
e2fsck - b 8193 &lt;device&gt;<br>
or<br>
e2fsck - b 32768 &lt;device&gt;</p>
<p class="has-line-data" data-line-start="3456" data-line-end="3463">You can also check filesystems with UUID (find them with <strong>blkid</strong> command or with labels):<br>
root@funlife:~# <strong>fsck /dev/sdb</strong><br>
fsck from util-linux 2.25.1<br>
e2fsck 1.42.10 (18-May-2014)<br>
ext2fs_open2: Bad magic number in super-block<br>
fsck.ext2: Superblock invalid, trying backup blocks…<br>
fsck.ext2: Bad magic number in super-block while trying to open /dev/sdb</p>
<p class="has-line-data" data-line-start="3464" data-line-end="3471">The superblock could not be read or does not describe a valid ext2/ext3/ext4<br>
filesystem. If the device is valid and it really contains an ext2/ext3/ext4<br>
filesystem (and not swap or ufs or something else), then the superblock<br>
is corrupt, and you might try running e2fsck with an alternate superblock:<br>
e2fsck - b 8193 &lt;device&gt;<br>
or<br>
e2fsck - b 32768 &lt;device&gt;</p>
<p class="has-line-data" data-line-start="3472" data-line-end="3486">root@funlife:~# <strong>blkid</strong><br>
/dev/sda1: LABEL=“movies”<br>
/dev/sdb1: UUID=“BA82-BECD” TYPE=“vfat” PARTUUID=“381add66-01”<br>
root@funlife:~# <strong>fsck LABEL=movies</strong><br>
fsck from util-linux 2.25.1<br>
root@funlife:~# <strong>fsck UUID=“BA82-BECD”</strong><br>
fsck from util-linux 2.25.1<br>
fsck.fat 3.0.26 (2014- 03 - 07)<br>
/dev/sdb1: 14 files, 1972/945094 clusters<br>
You can use - N switch to see what command/test is going to be executed:<br>
root@funlife:~# <strong>fsck - N UUID=“BA82-BECD”</strong><br>
fsck from util-linux 2.25.1<br>
[/sbin/fsck.vfat (1) – /dev/sdb1] fsck.vfat /dev/sdb1<br>
If you want to check a XFS filesystem, you have to use xfs_check command</p>
<p class="has-line-data" data-line-start="3487" data-line-end="3488"><strong>tune2fs</strong></p>
<p class="has-line-data" data-line-start="3489" data-line-end="3535">This is a command to <strong>tune</strong> <strong><em>ext</em></strong> file systems. It can show information and set many options. The - l option<br>
lists the current configs:<br>
jadi@funlife:~$ <strong>sudo tune2fs - l /dev/sda2</strong><br>
tune2fs 1.42.10 (18-May-2014)<br>
Filesystem volume name: &lt;none&gt;<br>
Last mounted on: /<br>
Filesystem UUID: 1651a94e-0b4e-47fb-aca0-f77e05714617<br>
Filesystem magic number: 0xEF53<br>
Filesystem revision #: 1 (dynamic)<br>
Filesystem features: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent<br>
flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize<br>
Filesystem flags: signed_directory_hash<br>
Default mount options: user_xattr acl<br>
Filesystem state: clean<br>
Errors behavior: Continue<br>
Filesystem OS type: Linux<br>
Inode count: 1531904<br>
Block count: 6123046<br>
Reserved block count: 306152<br>
Free blocks: 2302702<br>
Free inodes: 1073461<br>
First block: 0<br>
Block size: 4096<br>
Fragment size: 4096<br>
Reserved GDT blocks: 1022<br>
Blocks per group: 32768<br>
Fragments per group: 32768<br>
Inodes per group: 8192<br>
Inode blocks per group: 512<br>
Flex block group size: 16<br>
Filesystem created: Mon Dec 1 10:21:42 2014<br>
Last mount time: Sat Jan 31 17:21:51 2015<br>
Last write time: Sat Jan 31 17:21:51 2015<br>
Mount count: 32<br>
Maximum mount count: - 1<br>
Last checked: Mon Dec 1 10:21:42 2014<br>
Check interval: 0 (&lt;none&gt;)<br>
Lifetime writes: 103 GB<br>
Reserved blocks uid: 0 (user root)<br>
Reserved blocks gid: 0 (group root)<br>
First inode: 11<br>
Inode size: 256<br>
Required extra isize: 28<br>
Desired extra isize: 28<br>
Journal inode: 8<br>
First orphan inode: 786620</p>
<p class="has-line-data" data-line-start="3536" data-line-end="3539">Default directory hash: half_md4<br>
Directory Hash Seed: 16c38a41-e709-4e04-b1c2-8a79d71ea7e8<br>
Journal backup: inode blocks</p>
<p class="has-line-data" data-line-start="3540" data-line-end="3541"><strong>xfs_info</strong></p>
<p class="has-line-data" data-line-start="3542" data-line-end="3544">This is same as the tune2fs but for <strong>xfs file systems</strong>.<br>
xfs_info should be used on mounted file systems</p>
<p class="has-line-data" data-line-start="3545" data-line-end="3546"><strong>du &amp; df</strong></p>
<p class="has-line-data" data-line-start="3547" data-line-end="3549">In many cases you want to find out about the <strong>free space</strong> of a <strong>disk</strong> or find how much space a directory is<br>
using. This space can be used by the blocks of files or inodes.</p>
<p class="has-line-data" data-line-start="3550" data-line-end="3553">inodes contain the information about files. Information like the owner, when the last time it is used or<br>
edited, its size, if its a directory or not and peoples access rights on if. The inode number is unique within<br>
a particular filesystem and is also called files serial number.</p>
<p class="has-line-data" data-line-start="3554" data-line-end="3555"><strong>df</strong></p>
<p class="has-line-data" data-line-start="3556" data-line-end="3557">The DiskFree command is used to find out about the <strong>free</strong> and <strong>used space</strong> of <strong>file systems</strong>.</p>
<p class="has-line-data" data-line-start="3558" data-line-end="3572">jadi@funlife:~$ <strong>df - TH</strong><br>
Filesystem Type Size Used Avail Use% Mounted on<br>
/dev/sda2 ext4 23G 15G 7.7G 65% /<br>
none tmpfs 4.0K 0 4.0K 0% /sys/fs/cgroup<br>
udev devtmpfs 3.9G 4.0K 3.9G 1% /dev<br>
tmpfs tmpfs 788M 1.4M 786M 1% /run<br>
none tmpfs 5.0M 4.0K 5.0M 1% /run/lock<br>
none tmpfs 3.9G 19M 3.9G 1% /run/shm<br>
none tmpfs 100M 28K 100M 1% /run/user<br>
/dev/mapper/chome ext4 243G 229G 14G 95% /home/jadi<br>
/dev/sdb1 vfat 3.7G 7.8M 3.6G 1% /media/jadi/BA82-BECD<br>
Here the <code>-T</code> switch make df to show the file system types and <code>-H</code> make numbers human readable (in<br>
powers of 1000). Please note that <code>-h</code> is also human readable but in powres of 1024 (e.g. shows 1k for<br>
1000 bytes.</p>
<p class="has-line-data" data-line-start="3573" data-line-end="3582">If you need the inode data, use the - i switch:<br>
jadi@funlife:~$ <strong>df - i</strong><br>
Filesystem Inodes IUsed IFree IUse% Mounted on<br>
/dev/sda2 1531904 458616 1073288 30% /<br>
none 1007533 4 1007529 1% /sys/fs/cgroup<br>
udev 1003703 542 1003161 1% /dev<br>
tmpfs 1007533 644 1006889 1% /run<br>
none 1007533 3 1007530 1% /run/lock<br>
none 1007533 162 1007371 1% /run/shm</p>
<p class="has-line-data" data-line-start="3583" data-line-end="3587">none 1007533 33 1007500 1% /run/user<br>
/dev/mapper/chome 16171008 269293 15901715 2% /home/jadi<br>
/dev/sdb1 0 0 0 - /media/jadi/BA82-BECD<br>
vfat file format has no inodes; there is no owner or access rights on vfat filesystems.</p>
<p class="has-line-data" data-line-start="3588" data-line-end="3589"><strong>du</strong></p>
<p class="has-line-data" data-line-start="3590" data-line-end="3592">The <strong>DiskUsage</strong> command give information about the used space of <strong>directories and files</strong>. The common<br>
switches are:</p>
<pre><code class="has-line-data" data-line-start="3594" data-line-end="3597">switch usage

</code></pre>
<ul>
<li class="has-line-data" data-line-start="3598" data-line-end="3599">h print sizes in powers of 1024 (e.g., 1023M)</li>
<li class="has-line-data" data-line-start="3599" data-line-end="3600">H print sizes in powers of 1000 (e.g., 1.1G)</li>
<li class="has-line-data" data-line-start="3600" data-line-end="3602">c show the grand total</li>
</ul>
<pre><code class="has-line-data" data-line-start="3603" data-line-end="3606">--max-depth 2 shows only 2 directories furthur

</code></pre>
<ul>
<li class="has-line-data" data-line-start="3607" data-line-end="3609">s Only shows the summary and not all the directories one by one</li>
</ul>
<p class="has-line-data" data-line-start="3609" data-line-end="3616">jadi@funlife:~/w/lpic$ <strong>du</strong><br>
16 ./101<br>
701456 ./done<br>
701464 ./Logo/chert<br>
704588 ./Logo<br>
12 ./data<br>
12 ./100</p>
<ol start="9432884">
<li class="has-line-data" data-line-start="3616" data-line-end="3617"></li>
</ol>
<p class="has-line-data" data-line-start="3617" data-line-end="3624">jadi@funlife:~/w/lpic$ <strong>du - c</strong><br>
16 ./101<br>
701456 ./done<br>
701464 ./Logo/chert<br>
704588 ./Logo<br>
12 ./data<br>
12 ./100</p>
<ol start="9432884">
<li class="has-line-data" data-line-start="3624" data-line-end="3625"></li>
</ol>
<p class="has-line-data" data-line-start="3625" data-line-end="3628">9432884 total<br>
jadi@funlife:~/w/lpic$ <strong>du - hs</strong><br>
9.0G.</p>
<p class="has-line-data" data-line-start="3629" data-line-end="3630"><strong>Repairing</strong></p>
<p class="has-line-data" data-line-start="3631" data-line-end="3639">We used the <strong>fcsk</strong> for showing file system information but if is designed to <strong><em>fix</em></strong> <strong>file systems</strong> too. If the<br>
boot time check find a problems, you will be put into a command line to fix the problems.<br>
On non-journaling file systems (ext2) the fsck will show you many questions about each block and you<br>
have to say y if you want it to fix them. On journaling file systems (ext3&amp;4, xfs, …) the fsck has much less<br>
tasks to perform.<br>
For <strong>xfs file systems</strong> , we have <strong>xfs</strong> _ <strong>check</strong> command<br>
An important switch is - n which causes these commands <strong>not to fix</strong> anything and just show what was<br>
going to be done.</p>
<p class="has-line-data" data-line-start="3640" data-line-end="3641"><strong>debugfs</strong></p>
<p class="has-line-data" data-line-start="3642" data-line-end="3668">This is an interactive tool for <strong>debug an ext filesystem</strong>. It opens the filesystem in read-only mode unless<br>
we tell it not to (with - w option). It can un-delete files and directories…<br>
root@funlife:~# <strong>debugfs /dev/sda2</strong><br>
debugfs 1.42.10 (18-May-2014)<br>
debugfs: cd /etc/ &lt;-- cd<br>
debugfs: pwd &lt;-- show were am I<br>
[pwd] INODE: 524289 PATH: /etc<br>
[root] INODE: 2 PATH: /<br>
debugfs: stat passwd &lt;-- show data on one file<br>
Inode: 527187 Type: regular Mode: 0644 Flags: 0x80000<br>
Generation: 1875144872 Version: 0x00000000:00000001<br>
User: 0 Group: 0 Size: 2145<br>
File ACL: 0 Directory ACL: 0<br>
Links: 1 Blockcount: 8<br>
Fragment: Address: 0 Number: 0 Size: 0<br>
ctime: 0x548d4241:a7b196fc – Sun Dec 14 11:24:41 2014<br>
atime: 0x54cc635b:6acfc148 – Sat Jan 31 08:38:43 2015<br>
mtime: 0x548d4241:a01076f8 – Sun Dec 14 11:24:41 2014<br>
crtime: 0x548d4241:9f1c52f8 – Sun Dec 14 11:24:41 2014<br>
Size of extra inode fields: 28<br>
EXTENTS:<br>
(0):2188172<br>
debugfs: ncheck 527187 &lt;-- node check an inode<br>
Inode Pathname<br>
527187 /etc/passwd<br>
debugfs: q &lt;-- quit</p>
<p class="has-line-data" data-line-start="3669" data-line-end="3670"><strong>Superblock</strong></p>
<p class="has-line-data" data-line-start="3671" data-line-end="3674">Unix systems use superblocks to save <em>filesystem metadata</em>. Most of the times this block is located at the<br>
beginning of the file system and replicated on other locations too. The - <strong>n</strong> of <strong>mke2fs</strong> displays superblock<br>
locations</p>
<h1 class="code-line" data-line-start=3675 data-line-end=3676 ><a id="mke2fs__n_devsda7_3675"></a><strong>mke2fs - n /dev/sda7</strong></h1>
<p class="has-line-data" data-line-start="3677" data-line-end="3692">mke2fs 1.41.9 (22-Aug-2009)<br>
Filesystem label=<br>
OS type: Linux<br>
Block size=4096 (log=2)<br>
Fragment size=4096 (log=2)<br>
7159808 inodes, 28637862 blocks<br>
1431893 blocks (5.00%) reserved for the super user<br>
First data block=0<br>
Maximum filesystem blocks=4294967296<br>
874 block groups<br>
32768 blocks per group, 32768 fragments per group<br>
8192 inodes per group<br>
Superblock backups stored on blocks:<br>
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,<br>
4096000, 7962624, 11239424, 20480000, 23887872</p>
<pre><code class="has-line-data" data-line-start="3694" data-line-end="3696">Other tools
</code></pre>
<pre><code class="has-line-data" data-line-start="3698" data-line-end="3700">For the LPIC exam, it is good to know about these commands.
</code></pre>
<p class="has-line-data" data-line-start="3701" data-line-end="3702"><strong>filesystem command usage</strong></p>
<p class="has-line-data" data-line-start="3703" data-line-end="3704">ext tune2fs Show or set ext2 and ext3 parameters or even set the journaling options</p>
<p class="has-line-data" data-line-start="3705" data-line-end="3706">ext dumpe2fs</p>
<pre><code class="has-line-data" data-line-start="3708" data-line-end="3711">Prints the super block and block group descriptor information for an ext2 or ext3
filesystem.
</code></pre>
<p class="has-line-data" data-line-start="3712" data-line-end="3713">ext debugfs</p>
<pre><code class="has-line-data" data-line-start="3715" data-line-end="3719">Is an interactive file system debugger. Use it to examine or change the state of an ext2 or
ext3file system.

</code></pre>
<p class="has-line-data" data-line-start="3720" data-line-end="3721">reiserfs reiserfstune show and set parameters</p>
<p class="has-line-data" data-line-start="3722" data-line-end="3723">reiserfs debugreiserfs</p>
<pre><code class="has-line-data" data-line-start="3725" data-line-end="3729">Prints the super block and block group descriptor information for an ext2 or ext3
filesystem.

</code></pre>
<p class="has-line-data" data-line-start="3730" data-line-end="3731">XFS xfs_info display information</p>
<p class="has-line-data" data-line-start="3732" data-line-end="3733">XFS xfs_growfs expand file system</p>
<p class="has-line-data" data-line-start="3734" data-line-end="3735">XFS xfs_admin change parameters on XFS file systems</p>
<p class="has-line-data" data-line-start="3736" data-line-end="3737">XFS xfs_repair repair the problems</p>
<p class="has-line-data" data-line-start="3738" data-line-end="3739">XFS xfs_db checks and debugs the filesystem</p>
<p class="has-line-data" data-line-start="3740" data-line-end="3741"><strong>104.3 – Control mounting and unmounting of filesystems – 3</strong></p>
<p class="has-line-data" data-line-start="3742" data-line-end="3743"><strong>Objectives</strong></p>
<p class="has-line-data" data-line-start="3744" data-line-end="3746">Configure the mounting of a filesystem. Tasks include manually mounting and unmounting filesystems,<br>
configuring filesystem mounting on bootup, and configuring user-mountable removable filesystems.</p>
<ul>
<li class="has-line-data" data-line-start="3747" data-line-end="3748">Mount and unmount filesystems manually</li>
<li class="has-line-data" data-line-start="3748" data-line-end="3749">Configure filesystem mounting on bootup</li>
<li class="has-line-data" data-line-start="3749" data-line-end="3751">Configure user-mountable, removable filesystems</li>
</ul>
<p class="has-line-data" data-line-start="3751" data-line-end="3752"><strong>Mounting and Unmounting</strong></p>
<ul>
<li class="has-line-data" data-line-start="3753" data-line-end="3754">Describe the linux filesystem concept. A huge tree.</li>
<li class="has-line-data" data-line-start="3754" data-line-end="3755">There are other kinds of mountings: tmpfs, NFS, …</li>
<li class="has-line-data" data-line-start="3755" data-line-end="3757">It is better to mount on empty directories</li>
</ul>
<p class="has-line-data" data-line-start="3757" data-line-end="3758"><strong><em>Basic commands</em></strong></p>
<p class="has-line-data" data-line-start="3759" data-line-end="3762"><strong>cat /etc/fstab<br>
mount /dev/sda1 /media<br>
umount /media</strong></p>
<p class="has-line-data" data-line-start="3763" data-line-end="3764"><strong><em>Some switches</em></strong></p>
<p class="has-line-data" data-line-start="3765" data-line-end="3767"><strong>mount - t ext4 /dev/sda1 /media<br>
mount - o remount,ro /dev/sda1</strong></p>
<p class="has-line-data" data-line-start="3768" data-line-end="3769"><em>Get</em> <strong><em>info</em></strong> <em>on</em> <strong><em>UUID</em></strong> <em>and Label and Format</em></p>
<p class="has-line-data" data-line-start="3770" data-line-end="3771"><strong>blkid /dev/sda2</strong></p>
<p class="has-line-data" data-line-start="3772" data-line-end="3773"><strong>Bootup</strong></p>
<p class="has-line-data" data-line-start="3774" data-line-end="3775"><strong>/etc/fstab</strong></p>
<ul>
<li class="has-line-data" data-line-start="3776" data-line-end="3777"><strong>file system:</strong> Label, UUID, device</li>
<li class="has-line-data" data-line-start="3777" data-line-end="3778"><strong>mount point:</strong> swap or none for swap</li>
<li class="has-line-data" data-line-start="3778" data-line-end="3779"><strong>type:</strong> can be auto</li>
<li class="has-line-data" data-line-start="3779" data-line-end="3780"><strong>options:</strong> defaults, rw / ro, noauto, user, exec / noexec, noatime</li>
<li class="has-line-data" data-line-start="3780" data-line-end="3781"><strong>dump:</strong> do dump command backup this? mostly 0</li>
<li class="has-line-data" data-line-start="3781" data-line-end="3784"><strong>pass:</strong> Non-zero values of pass specify the order of checking filesystems at boot time (seen in<br>
Integrity of file systems)</li>
</ul>
<p class="has-line-data" data-line-start="3784" data-line-end="3785"><strong>note:</strong></p>
<ul>
<li class="has-line-data" data-line-start="3786" data-line-end="3787">User-mounted filesystems default to noexec unless exec is specified after user.</li>
<li class="has-line-data" data-line-start="3787" data-line-end="3790">noatime will disable recording of access times. Not using access times may improve<br>
performance.</li>
</ul>
<p class="has-line-data" data-line-start="3790" data-line-end="3791"><strong>swap</strong></p>
<p class="has-line-data" data-line-start="3792" data-line-end="3795"><strong>swapon<br>
swapoff<br>
swapon - s</strong></p>
<p class="has-line-data" data-line-start="3796" data-line-end="3797"><strong>104.5 – Manage file permissions and ownership – 3</strong></p>
<p class="has-line-data" data-line-start="3798" data-line-end="3799"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="3800" data-line-end="3801">Manage access permissions on regular and special files as well as directories.</li>
<li class="has-line-data" data-line-start="3801" data-line-end="3802">Use access modes such as suid, sgid and the sticky bit to maintain security.</li>
<li class="has-line-data" data-line-start="3802" data-line-end="3803">Know how to change the file creation mask.</li>
<li class="has-line-data" data-line-start="3803" data-line-end="3804">Use the group field to grant file access to group members.</li>
<li class="has-line-data" data-line-start="3804" data-line-end="3805">chmod</li>
<li class="has-line-data" data-line-start="3805" data-line-end="3806">umask</li>
<li class="has-line-data" data-line-start="3806" data-line-end="3807">chown</li>
<li class="has-line-data" data-line-start="3807" data-line-end="3809">chgrp</li>
</ul>
<p class="has-line-data" data-line-start="3809" data-line-end="3810"><strong>Users and Groups</strong></p>
<p class="has-line-data" data-line-start="3811" data-line-end="3814">A linux system can have many users and many groups. You can login with one user and use <strong>su</strong> command<br>
to change to another group. Each user belongs to <strong>one primary group</strong> and can be a member of other<br>
groups too.</p>
<p class="has-line-data" data-line-start="3815" data-line-end="3816">There commands like <strong>whoami</strong> , <strong>groups</strong> and <strong>id</strong> to determine who you are.</p>
<ul>
<li class="has-line-data" data-line-start="3817" data-line-end="3820">
<p class="has-line-data" data-line-start="3817" data-line-end="3819">$ <strong>whoami</strong><br>
jadi</p>
</li>
<li class="has-line-data" data-line-start="3820" data-line-end="3823">
<p class="has-line-data" data-line-start="3820" data-line-end="3822">$ <strong>groups</strong><br>
jadi adm cdrom sudo dip plugdev netdev lpadmin sambashare debian-tor</p>
</li>
<li class="has-line-data" data-line-start="3823" data-line-end="3828">
<p class="has-line-data" data-line-start="3823" data-line-end="3827">$ <strong>id</strong><br>
uid=1000(jadi) gid=1000(jadi)<br>
groups=1000(jadi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),102(netdev),108(lpadmin),124(samb<br>
ashare),125(debian-tor)</p>
</li>
<li class="has-line-data" data-line-start="3828" data-line-end="3833">
<p class="has-line-data" data-line-start="3828" data-line-end="3832">$ <strong>su root -</strong><br>
Password:<br>
bash: cannot set terminal process group (-1): Inappropriate ioctl for device<br>
bash: no job control in this shell</p>
</li>
<li class="has-line-data" data-line-start="3833" data-line-end="3837">
<h1 class="code-line" data-line-start=3833 data-line-end=3834 ><a id="id_3833"></a><strong>id</strong></h1>
<p class="has-line-data" data-line-start="3835" data-line-end="3836">uid=0(root) gid=0(root) groups=0(root)</p>
</li>
<li class="has-line-data" data-line-start="3837" data-line-end="3841">
<h1 class="code-line" data-line-start=3837 data-line-end=3838 ><a id="exit_3837"></a>exit</h1>
<p class="has-line-data" data-line-start="3839" data-line-end="3840">exit</p>
</li>
<li class="has-line-data" data-line-start="3841" data-line-end="3845">
<p class="has-line-data" data-line-start="3841" data-line-end="3844">$ <strong>whoami</strong><br>
jadi<br>
id shows both user and group information</p>
</li>
</ul>
<p class="has-line-data" data-line-start="3845" data-line-end="3849">There info are stored in <strong>/etc/passwd</strong> and <strong>/etc/group</strong><br>
$ <strong>cat /etc/group | grep adm</strong><br>
adm:x:4:syslog,jadi<br>
lpadmin:x:108:jadi</p>
<p class="has-line-data" data-line-start="3850" data-line-end="3851"><strong>File ownership &amp; permissions</strong></p>
<p class="has-line-data" data-line-start="3852" data-line-end="3853">Files also belong to one user and one group.</p>
<p class="has-line-data" data-line-start="3854" data-line-end="3855">$ <strong>ls - l /sbin/fdisk ~/w/lpic/notes.txt</strong></p>
<ul>
<li class="has-line-data" data-line-start="3856" data-line-end="3857">rw-rw-r-- 1 jadi users 576 Dec 7 22:30 /home/jadi/w/lpic/notes.txt</li>
<li class="has-line-data" data-line-start="3857" data-line-end="3860">rwxr-xr-x 1 root root 267176 Oct 15 18:58 /sbin/fdisk<br>
As you can see, the notes.txt belongs to jadi and a group called <em>users</em>.</li>
</ul>
<p class="has-line-data" data-line-start="3860" data-line-end="3862">In many distros, when you create a user, system creates a group with same name and assign that users<br>
files to that group</p>
<p class="has-line-data" data-line-start="3863" data-line-end="3865">Another part of the ls -l command shows the permissions on that file. Linux system users a 3 layer<br>
permission: permissions for the owner, for the group member and for <em>others</em>.</p>
<p class="has-line-data" data-line-start="3866" data-line-end="3867">Each layer also has 3 different parts:</p>
<ul>
<li class="has-line-data" data-line-start="3868" data-line-end="3869"><strong>R</strong> ead</li>
<li class="has-line-data" data-line-start="3869" data-line-end="3870"><strong>w</strong> rite (including deletion and edit)</li>
<li class="has-line-data" data-line-start="3870" data-line-end="3872"><strong>e</strong> xecute (reading directory content).</li>
</ul>
<p class="has-line-data" data-line-start="3872" data-line-end="3873">These are shown at the first column of ls - command as - rw-rw-r–. The character meanings are as follow:</p>
<pre><code class="has-line-data" data-line-start="3875" data-line-end="3878">bit meaning

</code></pre>
<pre><code class="has-line-data" data-line-start="3880" data-line-end="3883">1 What this entry is. Dash (-) is for ordinary files, 'l' is for links &amp; 'd' is for directory

</code></pre>
<pre><code class="has-line-data" data-line-start="3885" data-line-end="3888">2,3,4 read, write and execute access for the owner

</code></pre>
<pre><code class="has-line-data" data-line-start="3890" data-line-end="3893">5,6,7 read, write and execute access for the group members

</code></pre>
<pre><code class="has-line-data" data-line-start="3895" data-line-end="3898">8,9,10 read, write and execute access for other users

</code></pre>
<h3 class="code-line" data-line-start=3899 data-line-end=3900 ><a id="11_3899"></a>11</h3>
<pre><code class="has-line-data" data-line-start="3902" data-line-end="3906">Indicated if any other access methos (such as SELinux) applies to this file - not part of the 101
exam

</code></pre>
<p class="has-line-data" data-line-start="3907" data-line-end="3910">As you can see in our example, characters 2 to 10 show the accesses. A - there means “no access on this<br>
part” and read, write and execute are shown by r, w &amp; x.<br>
In the following line:</p>
<p class="has-line-data" data-line-start="3911" data-line-end="3912">$ <strong>ls - l /sbin/fdisk</strong></p>
<ul>
<li class="has-line-data" data-line-start="3913" data-line-end="3917">rwxr-xr-x 1 root root 267176 Oct 15 18:58 /sbin/fdisk<br>
We can see that the fdisk can be read, written and and be executed by its owner (root), only be read and<br>
executed by whoever is part of group root and be read and executed by all other users.</li>
</ul>
<p class="has-line-data" data-line-start="3917" data-line-end="3918">Let’s look at another example:</p>
<p class="has-line-data" data-line-start="3919" data-line-end="3925">$ <strong>ls - l /home/</strong><br>
total 12<br>
drwxr-xr-x 160 jadi jadi 12288 Feb 7 11:44 jadi<br>
The first character is a d so this is a directory! The owner (jadi) has read, write and execute access but<br>
other members of the <strong>group</strong> jadi and <strong>others</strong> only have read and execute access on this directory<br>
(execute means that they can see the files inside it).</p>
<p class="has-line-data" data-line-start="3926" data-line-end="3927"><strong>Chanhging permissions</strong></p>
<p class="has-line-data" data-line-start="3928" data-line-end="3930">It is possible to change the permissions on files &amp; directories using the <strong>chmod</strong> command. There are to<br>
ways to tell this command what you want to do:</p>
<ol>
<li class="has-line-data" data-line-start="3931" data-line-end="3932">using octal codes</li>
<li class="has-line-data" data-line-start="3932" data-line-end="3934">using short codes</li>
</ol>
<p class="has-line-data" data-line-start="3934" data-line-end="3937">When using octal codes, you have to to create an octal string to tell chmod what you want to do. This<br>
way, 0 means no access, means execute, 2 means write and 4 means read. So, if you want to give<br>
read+execute, you have to give 4+1 which is 5. This table shows every possible combination:</p>
<pre><code class="has-line-data" data-line-start="3939" data-line-end="3942">Symbolic Octal

</code></pre>
<pre><code class="has-line-data" data-line-start="3944" data-line-end="3947">rwx 7

</code></pre>
<pre><code class="has-line-data" data-line-start="3949" data-line-end="3952">rw- 6

</code></pre>
<pre><code class="has-line-data" data-line-start="3954" data-line-end="3957">r-x 5

</code></pre>
<pre><code class="has-line-data" data-line-start="3959" data-line-end="3962">r-- 4

</code></pre>
<ul>
<li class="has-line-data" data-line-start="3963" data-line-end="3964">wx 3</li>
<li class="has-line-data" data-line-start="3964" data-line-end="3966">w- 2</li>
</ul>
<pre><code class="has-line-data" data-line-start="3967" data-line-end="3970">--x 1

</code></pre>
<h3 class="code-line" data-line-start=3971 data-line-end=3972 ><a id="_0_3971"></a>— 0</h3>
<p class="has-line-data" data-line-start="3973" data-line-end="3974">If you want to give <strong>rwx</strong> to owner, <strong>rx</strong> to group and only <strong>x</strong> to others, you have to use <strong>751</strong> :</p>
<p class="has-line-data" data-line-start="3975" data-line-end="3976">$ <strong>ls - ltrh myfile</strong></p>
<ul>
<li class="has-line-data" data-line-start="3977" data-line-end="3980">rw-rw-r-- 1 jadi jadi 0 Feb 8 21:01 myfile<br>
$ <strong>chmod 751 myfile</strong><br>
$ <strong>ls - ltrh myfile</strong></li>
<li class="has-line-data" data-line-start="3980" data-line-end="3984">rwxr-x–x 1 jadi jadi 0 Feb 8 21:01 myfile<br>
But there is also an <em>easier</em> method. You can use <strong>+x</strong> to <strong>give execute permission</strong> , <strong>+r</strong> to <strong>give read<br>
permission</strong> and <strong>+w</strong> to <strong>give read permission</strong>. Removing these permissions will be like - r.</li>
</ul>
<p class="has-line-data" data-line-start="3984" data-line-end="3985">$ <strong>ls - ltrh myfile</strong></p>
<ul>
<li class="has-line-data" data-line-start="3986" data-line-end="3989">rwxr-x–x 1 jadi jadi 0 Feb 8 21:01 myfile<br>
$ <strong>chmod u-x myfile</strong><br>
$ <strong>ls - ltrh myfile</strong></li>
<li class="has-line-data" data-line-start="3989" data-line-end="3993">rw-r-x–x 1 jadi jadi 0 Feb 8 21:01 myfile<br>
$ <strong>chmod +x myfile</strong><br>
$ <strong>chmod uo+xr myfile</strong><br>
$ <strong>ls - ltrh myfile</strong></li>
<li class="has-line-data" data-line-start="3993" data-line-end="3997">rwxr-xr-x 1 jadi jadi 0 Feb 8 21:01 myfile<br>
you can tell chmod whos permission should be granted or removed by doing things like u+r (give read to<br>
user), og-w (remove write for other and group).</li>
</ul>
<p class="has-line-data" data-line-start="3997" data-line-end="3999">One very common switch on <strong>chmod</strong> is <strong>- R</strong> for recursive chmoding on files. This will give read permission<br>
of all files inside /tmp/ to any user:</p>
<h1 class="code-line" data-line-start=4000 data-line-end=4001 ><a id="chmod__R_or_tmp_4000"></a><strong>chmod - R o+r /tmp</strong></h1>
<p class="has-line-data" data-line-start="4002" data-line-end="4003"><strong>Access modes</strong></p>
<p class="has-line-data" data-line-start="4004" data-line-end="4007">So, you have access only to your files. But how you should change your password? or use programs<br>
which needs access to system files? You should be able to access /etc/passwd or /etc/shadow to change<br>
your password but you should not be able to access other people files!</p>
<p class="has-line-data" data-line-start="4008" data-line-end="4011">Normally when you run a program, it runs with <em>your</em> access levels but linux has two special bits on each<br>
file; <strong>suid</strong> (set user id) and <strong>guid</strong> (set group id). If these are set on a file, that file be will be executed with<br>
the access of the <strong>owner</strong> of the file and not the user who is running it.</p>
<p class="has-line-data" data-line-start="4012" data-line-end="4013">$ <strong>ls - ltrh /usr/bin/passwd</strong></p>
<ul>
<li class="has-line-data" data-line-start="4014" data-line-end="4016">rwsr-xr-x 1 root root 50K Jul 18 2014 /usr/bin/passwd</li>
</ul>
<p class="has-line-data" data-line-start="4016" data-line-end="4019">Did you note the s in the place of <em>executable bit</em> for the user and for the group? That means when any<br>
user runs this program, it will be run be the access of the owner of the file (which is root) instead of that<br>
users id.</p>
<p class="has-line-data" data-line-start="4020" data-line-end="4024">It is possible to set / unser the suid and sgid using chmod and +s or - s instead of x.<br>
The last special option is chmod is the <strong>sticky bit</strong> which lets only the owner of the file to delete it, even if<br>
other users have write (delete) access on that directory. This is good for places like /tmp.<br>
Sticky bit is identified by t and will be shown on the last bit of a directory:</p>
<p class="has-line-data" data-line-start="4025" data-line-end="4029">$ <strong>ls - dl /tmp</strong><br>
drwxrwxrwt 13 root root 77824 Feb 8 21:27 /tmp<br>
As you can see the sticky bit is set and although all users have write access in this directory, they wont<br>
be able to delete each others files.</p>
<p class="has-line-data" data-line-start="4030" data-line-end="4031">Lets review how you can set these access modes:</p>
<pre><code class="has-line-data" data-line-start="4033" data-line-end="4036">access mode octal symbolic

</code></pre>
<pre><code class="has-line-data" data-line-start="4038" data-line-end="4041">suid 4000 u+s

</code></pre>
<pre><code class="has-line-data" data-line-start="4043" data-line-end="4046">guid 2000 g+s

</code></pre>
<pre><code class="has-line-data" data-line-start="4048" data-line-end="4051">sticky 1000 t

</code></pre>
<p class="has-line-data" data-line-start="4052" data-line-end="4053"><strong>guid</strong> on a directory will force any new file in that directory to have the guid of the directory itself.</p>
<p class="has-line-data" data-line-start="4054" data-line-end="4055"><strong>umask</strong></p>
<p class="has-line-data" data-line-start="4056" data-line-end="4058">But what will be the access of the new files? What happens when you touch a new file? This is set<br>
with <strong>umask</strong>. This command tells the system what permissions <strong>should not be given to</strong> new files:</p>
<p class="has-line-data" data-line-start="4059" data-line-end="4062">$ <strong>umask</strong><br>
0002<br>
Which removes write (2) permissions from files.</p>
<p class="has-line-data" data-line-start="4063" data-line-end="4064">If we need to change <strong>umask</strong> , it can be done with the same command:</p>
<p class="has-line-data" data-line-start="4065" data-line-end="4069">$ <strong>umask</strong><br>
0002<br>
$ <strong>touch newfile</strong><br>
$ <strong>ls - ltrh newfile</strong></p>
<ul>
<li class="has-line-data" data-line-start="4070" data-line-end="4077">rw-rw-r-- 1 jadi jadi 0 Feb 8 21:38 newfile<br>
$ <strong>mkdir newdir</strong><br>
$ <strong>ls - ltrhd newdir</strong><br>
drwxrwxr-x 2 jadi jadi 4.0K Feb 8 21:38 newdir<br>
$ <strong>umask u=rw,g=,o=</strong><br>
$ <strong>touch newerfile</strong><br>
$ <strong>ls - l newerfile</strong></li>
<li class="has-line-data" data-line-start="4077" data-line-end="4082">rw------- 1 jadi jadi 0 Feb 8 21:41 newerfile<br>
$ <strong>umask</strong><br>
0177<br>
Note how we use u=rw,g=,o= to tell umask or chomd what we exactly need.</li>
</ul>
<p class="has-line-data" data-line-start="4082" data-line-end="4083"><strong>Changing owner and groups</strong></p>
<p class="has-line-data" data-line-start="4084" data-line-end="4086">If you need to change the <strong>ownership</strong> or <strong>group</strong> belonging of a file or directory, use the <strong>chown</strong> command:<br>
$ <strong>ls - ltrh newfile</strong></p>
<ul>
<li class="has-line-data" data-line-start="4087" data-line-end="4093">rw-rw-r-- 1 jadi jadi 0 Feb 8 21:38 newfile<br>
$ <strong>chown root:root newfile</strong><br>
chown: changing ownership of ‘newfile’: Operation not permitted<br>
$ <strong>sudo chown root:root newfile</strong><br>
[sudo] password for jadi:<br>
$ <strong>ls - ltrh newfile</strong></li>
<li class="has-line-data" data-line-start="4093" data-line-end="4095">rw-rw-r-- 1 root root 0 Feb 8 21:38 newfile</li>
</ul>
<p class="has-line-data" data-line-start="4095" data-line-end="4097">A common switch is <strong>- R</strong> to do the <strong>chown</strong> recursively and the general style is chown newuser:newgroup<br>
file.</p>
<p class="has-line-data" data-line-start="4098" data-line-end="4099">There is also a command specially for changing the group:</p>
<p class="has-line-data" data-line-start="4100" data-line-end="4102">$ <strong>sudo chgrp postgres newfile</strong><br>
$ <strong>ls - ltrh newfile</strong></p>
<ul>
<li class="has-line-data" data-line-start="4103" data-line-end="4105">rw-rw-r-- 1 root postgres 0 Feb 8 21:38 newfile</li>
</ul>
<p class="has-line-data" data-line-start="4105" data-line-end="4108">If a user is member of different groups, she can change her <strong>default group</strong> using the <strong>newggrp</strong> command:<br>
$ <strong>touch newfile</strong><br>
$ <strong>ls - ltrh newfile</strong></p>
<ul>
<li class="has-line-data" data-line-start="4109" data-line-end="4115">rw------- 1 jadi jadi 0 Feb 8 21:53 newfile<br>
$ <strong>groups</strong><br>
jadi adm cdrom sudo dip plugdev netdev lpadmin sambashare debian-tor<br>
$ <strong>newgrp adm</strong><br>
$ <strong>touch newerfile</strong><br>
$ <strong>ls - ltrh new</strong>*</li>
<li class="has-line-data" data-line-start="4115" data-line-end="4116">rw------- 1 jadi jadi 0 Feb 8 21:53 newfile</li>
<li class="has-line-data" data-line-start="4116" data-line-end="4118">rw------- 1 jadi adm 0 Feb 8 21:54 newerfile</li>
</ul>
<p class="has-line-data" data-line-start="4118" data-line-end="4119"><strong>104.6 – Create and change hard and symbolic links – 2</strong></p>
<p class="has-line-data" data-line-start="4120" data-line-end="4121"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="4122" data-line-end="4123">Create links.</li>
<li class="has-line-data" data-line-start="4123" data-line-end="4124">Identify hard and/or softlinks.</li>
<li class="has-line-data" data-line-start="4124" data-line-end="4125">Copying versus linking files.</li>
<li class="has-line-data" data-line-start="4125" data-line-end="4126">Use links to support system administration tasks.</li>
<li class="has-line-data" data-line-start="4126" data-line-end="4127">ln</li>
<li class="has-line-data" data-line-start="4127" data-line-end="4129">unlink</li>
</ul>
<p class="has-line-data" data-line-start="4129" data-line-end="4132">On a storage device, a file or directory is contained in a collection of blocks. Information about a file is<br>
contained in an inode, which records information such as the owner, when the file was last accessed,<br>
how large it is, whether it is a directory or not, and who can read from or write to it.</p>
<p class="has-line-data" data-line-start="4133" data-line-end="4134">$ <strong>ls -i $ ls -R</strong></p>
<p class="has-line-data" data-line-start="4135" data-line-end="4136"><strong>A link is simply an additional directory entry for a file or directory</strong></p>
<p class="has-line-data" data-line-start="4137" data-line-end="4138">$ <strong>ls -il $ vi link2file.txt #will edit both $ mv myfile.txt</strong></p>
<p class="has-line-data" data-line-start="4139" data-line-end="4141">A <strong>link</strong> is simply an additional directory entry for a file or directory, allowing two or more names for the<br>
same thing.</p>
<ul>
<li class="has-line-data" data-line-start="4142" data-line-end="4143">A <strong>hard link</strong> is a directory entry that points to an inode</li>
<li class="has-line-data" data-line-start="4143" data-line-end="4146">A <strong>soft link</strong> or symbolic link is a directory entry that points to an inode that provides the name of<br>
another directory entry.</li>
</ul>
<p class="has-line-data" data-line-start="4146" data-line-end="4148">The exact mechanism for storing the second name may depend on both the file system and the length<br>
of the name. Symbolic links are also called symlinks.</p>
<p class="has-line-data" data-line-start="4149" data-line-end="4151"><strong>Soft links</strong> , or <strong>symlinks</strong> , merely point to another file or directory by name rather than by inode. Soft links<br>
can cross file system boundaries.</p>
<p class="has-line-data" data-line-start="4152" data-line-end="4154">$ cp myfile.txt newfile.txt $ vi myfile.txt $ cat myfile.txt $ cat softlink.txt $ cat hardlink.txt $ cat<br>
newfile.txt $ ls -il</p>
<p class="has-line-data" data-line-start="4155" data-line-end="4157">You can create <strong>hard links</strong> only for files and not for directories. The exception is the special directory<br>
entries in a directory for the directory itself and for its parent (. and …)</p>
<p class="has-line-data" data-line-start="4158" data-line-end="4159">$ <strong>ls -ltrhi /etc/grub2.cfg</strong></p>
<p class="has-line-data" data-line-start="4160" data-line-end="4161">You will get an error if you attempt to create hard links that cross file systems or that are for directories.</p>
<p class="has-line-data" data-line-start="4162" data-line-end="4163">$ <strong>ln mydir link2dir # error! $ ln -s mydir link2dir</strong></p>
<p class="has-line-data" data-line-start="4164" data-line-end="4167">If you are using relative names, you will usually want the current working directory to be the directory<br>
where you are creating the link; otherwise, the link you create will be relative to another point in the file<br>
system.</p>
<p class="has-line-data" data-line-start="4168" data-line-end="4169">$ <strong>ln -s myfile.txt mydir/ #broken link</strong></p>
<p class="has-line-data" data-line-start="4170" data-line-end="4171">$ <strong>cd mydir $ ln -s …/myfile.txt.</strong></p>
<p class="has-line-data" data-line-start="4172" data-line-end="4173">we can find symbolic links with ls -i or even find:</p>
<p class="has-line-data" data-line-start="4174" data-line-end="4175">$ <strong>find. -type l</strong></p>
<p class="has-line-data" data-line-start="4176" data-line-end="4177">and they are useful!</p>
<p class="has-line-data" data-line-start="4178" data-line-end="4179">$ which java # linking to specific versions $ ls -ltrhi /etc/grub2.cfg # easier admin tasks $ ls -l /usr/lib64/</p>
<h1 class="code-line" data-line-start=4180 data-line-end=4181 ><a id="keeping_libraries_clean_4180"></a>keeping libraries clean</h1>
<p class="has-line-data" data-line-start="4182" data-line-end="4183"><strong>104.7 – Find system files and place files in the correct location – 2</strong></p>
<p class="has-line-data" data-line-start="4184" data-line-end="4185"><strong>Objectives</strong></p>
<ul>
<li class="has-line-data" data-line-start="4186" data-line-end="4187">Understand the correct locations of files under the FHS.</li>
<li class="has-line-data" data-line-start="4187" data-line-end="4188">Find files and commands on a Linux system.</li>
<li class="has-line-data" data-line-start="4188" data-line-end="4189">Know the location and purpose of important file and directories as defined in the FHS.</li>
<li class="has-line-data" data-line-start="4189" data-line-end="4190">find</li>
<li class="has-line-data" data-line-start="4190" data-line-end="4191">locate</li>
<li class="has-line-data" data-line-start="4191" data-line-end="4192">updatedb</li>
<li class="has-line-data" data-line-start="4192" data-line-end="4193">whereis</li>
<li class="has-line-data" data-line-start="4193" data-line-end="4194">which</li>
<li class="has-line-data" data-line-start="4194" data-line-end="4195">type</li>
<li class="has-line-data" data-line-start="4195" data-line-end="4197">/etc/updatedb.conf</li>
</ul>
<h3 class="code-line" data-line-start=4197 data-line-end=4198 ><a id="FHS_4197"></a>FHS</h3>
<p class="has-line-data" data-line-start="4199" data-line-end="4201"><strong>Filesystem Hierarchy Standard (FHS)</strong> is a document describing the Linux / Unix file hierarchy. It is very<br>
useful to know these because it lets you easily find what you are looking for:</p>
<pre><code class="has-line-data" data-line-start="4203" data-line-end="4206">directory usage

</code></pre>
<pre><code class="has-line-data" data-line-start="4208" data-line-end="4211">bin Essential command binaries

</code></pre>
<pre><code class="has-line-data" data-line-start="4213" data-line-end="4216">boot Static files of the boot loader

</code></pre>
<pre><code class="has-line-data" data-line-start="4218" data-line-end="4221">dev Device files

</code></pre>
<pre><code class="has-line-data" data-line-start="4223" data-line-end="4226">etc Host-specific system configuration

</code></pre>
<pre><code class="has-line-data" data-line-start="4228" data-line-end="4231">lib Essential shared libraries and kernel modules

</code></pre>
<pre><code class="has-line-data" data-line-start="4233" data-line-end="4236">media Mount point for removable media

</code></pre>
<pre><code class="has-line-data" data-line-start="4238" data-line-end="4241">mnt Mount point for mounting a filesystem temporarily

</code></pre>
<pre><code class="has-line-data" data-line-start="4243" data-line-end="4246">opt Add-on application software packages

</code></pre>
<pre><code class="has-line-data" data-line-start="4248" data-line-end="4251">sbin Essential system binaries

</code></pre>
<pre><code class="has-line-data" data-line-start="4253" data-line-end="4256">directory usage

</code></pre>
<pre><code class="has-line-data" data-line-start="4258" data-line-end="4261">srv Data for services provided by this system

</code></pre>
<pre><code class="has-line-data" data-line-start="4263" data-line-end="4266">tmp Temporary files

</code></pre>
<pre><code class="has-line-data" data-line-start="4268" data-line-end="4271">usr Secondary hierarchy

</code></pre>
<pre><code class="has-line-data" data-line-start="4273" data-line-end="4276">var Variable data

</code></pre>
<pre><code class="has-line-data" data-line-start="4278" data-line-end="4281">home User home directories (optional)

</code></pre>
<pre><code class="has-line-data" data-line-start="4283" data-line-end="4286">lib Alternate format essential shared libraries (optional)

</code></pre>
<pre><code class="has-line-data" data-line-start="4288" data-line-end="4291">root Home directory for the root user (optional)

</code></pre>
<p class="has-line-data" data-line-start="4292" data-line-end="4294">The <strong>/usr</strong> filesystem is the second major section of the filesystem, containing <strong>shareable</strong> , <strong>read</strong> - <strong>only data</strong>.<br>
It can be shared between systems, although present practice does not often do this.</p>
<p class="has-line-data" data-line-start="4295" data-line-end="4299">The <strong>/var</strong> filesystem contains <strong>variable data files</strong> , including spool directories and files, administrative and<br>
logging data, and transient and temporary files. Some portions of /var are not shareable between<br>
different systems, but others, such as /var/mail, /var/cache/man, /var/cache/fonts, and<br>
/var/spool/news, may be shared.</p>
<p class="has-line-data" data-line-start="4300" data-line-end="4301"><strong>Path</strong></p>
<p class="has-line-data" data-line-start="4302" data-line-end="4304">A general linux install has a lot of files; 741341 files in my case. So how does it find out where to look<br>
when you type a command? This is done by a variable called <strong>PATH</strong> :</p>
<p class="has-line-data" data-line-start="4305" data-line-end="4308">$ <strong>echo $PATH</strong><br>
/home/jadi/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games<br>
;/home/jadi/bin/</p>
<p class="has-line-data" data-line-start="4309" data-line-end="4310">And for root user:</p>
<h1 class="code-line" data-line-start=4311 data-line-end=4312 ><a id="echo_PATH_4311"></a><strong>echo $PATH</strong></h1>
<p class="has-line-data" data-line-start="4313" data-line-end="4314">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p>
<p class="has-line-data" data-line-start="4315" data-line-end="4317">As you can see, this is the list of directories separated with a colon. Obviously you can change your path<br>
with <strong>export PATH=$PATH:/usr/new/dir</strong> or put this in <strong>.bashrc</strong> to make it permanent.</p>
<p class="has-line-data" data-line-start="4318" data-line-end="4319"><strong>which, type and whereis</strong></p>
<p class="has-line-data" data-line-start="4320" data-line-end="4325">The <strong>which</strong> command shows the first appearance of the command given in path:<br>
$ <strong>which mkfd</strong><br>
$ <strong>which mkfs</strong><br>
/sbin/mkfs<br>
use the - a switch to show all appearance in the path and not only the first one.</p>
<p class="has-line-data" data-line-start="4326" data-line-end="4330">But what happens if you which for?<br>
$ <strong>which for</strong><br>
$ <strong>type for</strong><br>
for is a shell keyword</p>
<p class="has-line-data" data-line-start="4331" data-line-end="4343">As you can see, which did not found anything for for and we used type.<br>
$ <strong>type type</strong><br>
type is a shell builtin<br>
$ <strong>type for</strong><br>
for is a shell keyword<br>
$ <strong>type mkfs</strong><br>
mkfs is /sbin/mkfs<br>
$ <strong>type mkfd</strong><br>
bash: type: mkfd: not found<br>
The type command is more general that which and also understand and shows the <em>bash keywords</em>.<br>
Another useful command in this category is whereis. Unlike which, whereis shows man pages and source<br>
codes of programs alongside their binary location.</p>
<p class="has-line-data" data-line-start="4344" data-line-end="4353">$ <strong>whereis mkfs</strong><br>
mkfs: /sbin/mkfs.bfs /sbin/mkfs.ext3 /sbin/mkfs.ext4 /sbin/mkfs.vfat /sbin/mkfs.cramfs<br>
/sbin/mkfs.minix /sbin/mkfs.ext2 /sbin/mkfs.msdos /sbin/mkfs.fat /sbin/mkfs.ntfs /sbin/mkfs.ext4dev<br>
/sbin/mkfs /usr/share/man/man8/mkfs.8.gz<br>
$ <strong>whereis ping</strong><br>
ping: /bin/ping /usr/share/man/man8/ping.8.gz<br>
$ <strong>whereis chert</strong><br>
chert:<br>
$</p>
<p class="has-line-data" data-line-start="4354" data-line-end="4355"><strong>Find</strong></p>
<p class="has-line-data" data-line-start="4356" data-line-end="4357">We have already seen this command in detail but lets see a couple of new switches.</p>
<ul>
<li class="has-line-data" data-line-start="4358" data-line-end="4359">The - user and - group specifies a specific user &amp; group</li>
<li class="has-line-data" data-line-start="4359" data-line-end="4361">The - maxdepth tells the find how deep it should go into the directories.</li>
</ul>
<p class="has-line-data" data-line-start="4361" data-line-end="4372">$ <strong>find /tmp/ - maxdepth 1 - user jadi | head</strong><br>
$ <strong>find /tmp/ - maxdepth 1 - user jadi | head</strong><br>
/tmp/asheghloo.png<br>
/tmp/tmpAN6Drb<br>
/tmp/wrapper- 24115 - 2 - out<br>
/tmp/sni-qt_goldendict_20048-sRlmvN<br>
/tmp/asheghloo.gif<br>
/tmp/zim-jadi<br>
/tmp/3la.txt<br>
/tmp/unity_support_test.0<br>
/tmp/batman.jpg</p>
<p class="has-line-data" data-line-start="4373" data-line-end="4376">Or even find the files not belonging to any user / group with - nouser and - nogroup.<br>
Like other <em>tests</em> , you can add a! just before any phrase to negate it. So this will find files <strong>not<br>
belonging</strong> to jadi: find.! -user jadi</p>
<p class="has-line-data" data-line-start="4377" data-line-end="4378"><strong>Locate &amp; Updatedb</strong></p>
<p class="has-line-data" data-line-start="4379" data-line-end="4392">Find and know that it is slow, It searches the file system on each run but lets see the fastest command:<br>
$ <strong>locate happy</strong><br>
/home/jadi/.Spark/xtra/emoticons/Default.adiumemoticonset/happy.png<br>
/home/jadi/.Spark/xtra/emoticons/sparkEmoticonSet/happy.png<br>
/home/jadi/Downloads/jadi-net_radio-geek_040_antihappy.mp3<br>
/usr/share/emoticons/kde4/unhappy.png<br>
/usr/share/pixmaps/fvwm/mini.happy.xpm<br>
/usr/share/pixmaps/pidgin/emotes/default/happy.png<br>
/usr/share/pixmaps/pidgin/emotes/small/happy.png<br>
/usr/src/linux-headers-3.13.0- 40 - generic/include/config/happymeal.h<br>
/usr/src/linux-headers-3.16.0- 25 - generic/include/config/happymeal.h<br>
/usr/src/linux-headers-3.16.0- 28 - generic/include/config/happymeal.h<br>
/usr/src/linux-headers-3.16.0- 29 - generic/include/config/happymeal.h</p>
<p class="has-line-data" data-line-start="4393" data-line-end="4394">And it is fast:</p>
<p class="has-line-data" data-line-start="4395" data-line-end="4397">$ <strong>time locate kernel | wc - l</strong><br>
11235</p>
<p class="has-line-data" data-line-start="4398" data-line-end="4401">real 0m0.341s<br>
user 0m0.322s<br>
sys 0m0.015s</p>
<p class="has-line-data" data-line-start="4402" data-line-end="4406">This is fast because its data comes from a <strong>database</strong> created with <strong>updatedb</strong> command which is usually<br>
run on a daily basis with a cron job. Its configuration file is /etc/updatedb.conf or /etc/sysconfig/locate:<br>
$ <strong>cat /etc/updatedb.conf</strong><br>
PRUNE_BIND_MOUNTS=“yes”</p>
<h1 class="code-line" data-line-start=4407 data-line-end=4408 ><a id="PRUNENAMESgit_bzr_hg_svn_4407"></a>PRUNENAMES=&quot;.git .bzr .hg .svn&quot;</h1>
<p class="has-line-data" data-line-start="4409" data-line-end="4413">PRUNEPATHS=&quot;/tmp /var/spool /media /home/.ecryptfs&quot;<br>
PRUNEFS=“NFS nfs nfs4 rpc_pipefs afs binfmt_misc proc smbfs autofs iso9660 ncpfs coda devpts ftpfs<br>
devfs mfs shfs sysfs cifs lustre tmpfs usbfs udf fuse.glusterfs fuse.sshfs curlftpfs ecryptfs fusesmb<br>
devtmpfs”</p>
<p class="has-line-data" data-line-start="4414" data-line-end="4422">Please note that you can update the db by running <strong>updatedb</strong> as root and get some info about it by -<br>
S switch of locatecommand:<br>
$ <strong>locate - S</strong><br>
Database /var/lib/mlocate/mlocate.db:<br>
73,602 directories<br>
711,894 files<br>
46,160,154 bytes in file names<br>
18,912,999 bytes used to store database</p>
<pre><code class="has-line-data" data-line-start="4424" data-line-end="4563"># And... the LPIC1 exam 101 is DONE! Congrats.

[http://j.mp/jadilpic1](http://j.mp/jadilpic1)


# LPIC-1 Exam 10 2


**105.1 - Customize and use the shell environment** **_Weight - 4_**

**Objectives**

- Set environment variables (e.g. PATH) at login or when spawning a new shell
- Write Bash functions for frequently used sequences of commands
- Maintain skeleton directories for new user accounts Set command search path with the proper
    directory

**Terms**

### •.

- source
- /etc/bash.bashrc
- /etc/profile
- env
- export
- set
- unset
- ~/.bash_profile
- ~/.bash_login
- ~/.profile
- ~/.bashrc
- ~/.bash_logout
- function
- alias
- lists

**Environment variables**

We should set them when we login or change shell. Oh! And what happen when we are not logged in?
;)

**login vs non-login shell**

Sometimes you _login_ into the shell, say after a ssh but sometimes you just _open_ a shell; say in GUI.


**login shell**

This happens when you give your user and pass to enter a shell. Many steps are involved to setup
your variables and settings. These are the steps:

**1 -** /etc/profile is run

**2 -** A line in /etc/profile runs whatever is in /etc/profile.d/*

Now the global profile is loaded and system will go for user specific profiles:

**3 -** /home/USERNAME/.bash_profile

**4 -** /home/USERNAME/.bash_login

**5 -** /home/USERNAME/.profile

Note that only one of the 3, 4 &amp; 5 will be run. The system will go for .bash_profile and IF IT IS NOT
THERE will try for .bash_login and IF IT IS NOT THERE will try to run .profile. If any of these exists, the
system wont look any furthur. So if you have only 4 &amp; 5, only the 4 will be run.

At the end, the system loads:

**6 -** /home/USERNAME/.bashrc

which is users information (like aliases).

Note: /etc/profile also loads /etc/bashrc or /etc/bash.bashrc

**Interactive (non-login) shell**

If you run a shell in an **interactive mode** (non-login) shell say from a GUI, only two things will be run:

1.^ /etc/bash.bashrc (or in some systems /etc/bashrc)^
    2. /home/USERNAME/.bashrc

**Adding global configs for login shell**

You can add your global new config files int /etc/profile.d/ (with .sh at the end). It is cleaner and
better than editing the /etc/profile because an update can overwrite your changes if you do so.

**Adding global configs for interactive/non-login shell**

You can use /etc/bash.bashrc file (some systems /etc/bashrc). This is good for _aliases_ and other
global configs.


**user specific configs**

Most of the time PATH and env vars go into the in ~/.bash_profile and aliases go into the
~/.bashrc. Have a look at them!

**Aliases**

Most of the time they are defined in ~/.bashrc and look like this:

alias ll='ls -alF'

alias la='ls -A'

alias l='ls -CF'

It is kind of a shortcut.

**/etc/skel**

This directory contains files which will be used as a **starting template** for each new user.

**.bash_logout**

Runs when you logout from a login shell. In many distros it only clears the screen so the next person
will not be able to watch what you were doing before you logout.

**. (and source)**

Yes, only a dot! This is a shortcut for the bash source command. You can find it in files like
/etc/profile. It runs the executable in front of it as part of the current environment.

Note: If you just execute a file (without source or dot) bash creates a child, runs the
executable there and then closes it.

**Functions**

Like &quot;real&quot; programming languages, Bash has functions, though in a somewhat limited
implementation. A function is a subroutine, a code block that implements a set of operations, a
&quot;black box&quot; that performs a specified task. Wherever there is repetitive code, when a task repeats
with only slight variations in procedure, then consider using a function.

funnyls () {


</code></pre>
<p class="has-line-data" data-line-start="4564" data-line-end="4565">ls -ltrh</p>
<pre><code class="has-line-data" data-line-start="4567" data-line-end="4569">
</code></pre>
<p class="has-line-data" data-line-start="4570" data-line-end="4571">echo “This is a funny ls”</p>
<pre><code class="has-line-data" data-line-start="4573" data-line-end="4578">### }



</code></pre>
<p class="has-line-data" data-line-start="4579" data-line-end="4580">Set</p>
<pre><code class="has-line-data" data-line-start="4582" data-line-end="4584">
</code></pre>
<p class="has-line-data" data-line-start="4585" data-line-end="4587">Set allows you to change the values of shell options and set the positional<br>
parameters, or to display the names and values of shell variables.</p>
<pre><code class="has-line-data" data-line-start="4589" data-line-end="4591">
</code></pre>
<p class="has-line-data" data-line-start="4592" data-line-end="4593">Using set we can configure how bash works. These are some samples:</p>
<pre><code class="has-line-data" data-line-start="4595" data-line-end="4597">
</code></pre>
<p class="has-line-data" data-line-start="4598" data-line-end="4599">switch result</p>
<pre><code class="has-line-data" data-line-start="4601" data-line-end="4605">- b


</code></pre>
<p class="has-line-data" data-line-start="4606" data-line-end="4607">Cause the status of terminated background jobs to be reported immediately, rather than before</p>
<pre><code class="has-line-data" data-line-start="4609" data-line-end="4611">
</code></pre>
<p class="has-line-data" data-line-start="4612" data-line-end="4613">printing the next primary prompt.</p>
<pre><code class="has-line-data" data-line-start="4615" data-line-end="4620">- e return in case a pipline, command, ... return non-zero
    - n


</code></pre>
<p class="has-line-data" data-line-start="4621" data-line-end="4622">Read commands but do not execute them; this may be used to check a script for syntax errors.</p>
<pre><code class="has-line-data" data-line-start="4624" data-line-end="4626">
</code></pre>
<p class="has-line-data" data-line-start="4627" data-line-end="4628">This option is ignored by interactive shells.</p>
<pre><code class="has-line-data" data-line-start="4630" data-line-end="4850">- t Exit after reading and executing one command.
- C Prevent output redirection using ‘&gt;’, ‘&gt;&amp;’, and ‘&lt;&gt;’ from overwriting existing files.

**Export**

Set an environment variable. Mark each name to be passed to child processes in the
environment.

$ export name=jadi
$ echo $name
jadi
Note: when exporting, the variable will exists in child processes (commands you run from the
current shell). If you only say name=jadi and run a new command in your shell, the name **wont
be** jadi in **that** shell.
$ name=jadi
$ echo $name
jadi
$ bash
$ echo $name


$ exit
exit
$ echo $name
jadi
$ export name=jadi
$ bash
$ echo $name
jadi

**Unset**

This command _has nothing to do_ with set command! This can unset the defined variables or
functions.

$ **name=jadi**

$ **echo $name**

jadi

$ **unset name**

$ **echo $name**

You can also unset functions.

**env**

can set, remove or display variables or even run a command in a modified environment.

Syntax
env [OPTION]... [NAME=VALUE]... [COMMAND [ARGS]...]

Options

- u NAME
--unset=NAME
Remove variable NAME from the environment, if it was in the
environment.

### -

- i
--ignore-environment
Start with an empty environment, ignoring the inherited
environment.


**lists**

Bash even has arrays! We will see them later when scripting but you can do things like:

$ **list=(salam donya man injam)**
$ **echo ${list[1]}**
donya
$ **list=(&quot;salam donya&quot; &quot;man injam&quot;)**
$ **echo ${list[1]}**
man injam


**105.2 - Customize or write simple scripts - 4**

**Objectives**

- Use standard sh syntax (loops, tests)
- Use command substitution
- Test return values for success or failure or other information provided by a command
- Perform conditional mailing to the superuser
- Correctly select the script interpreter through the shebang (#!) line
- Manage the location, ownership, execution and suid-rights of scripts

**Terms and Utilities**

- for
- while
- test
- if
- read
- seq
- exec

**Shell Scripts**

Are a way of automating tasks.

**Shebang**

If a line starts with **#!** it is called **shebang** and tells the shell what **_interpreter_** to use for running

this script.

Note: Normally a # at the beginning of a script is for showing _comments_. Do not confuse it

with _Shebang_ (#!)

In many cases we run shells with #!/bin/bash or #!/bin/sh

We can use the command we already know in our shell scripts. A sample is:

#!/bin/bash

echo

echo &quot;We are learning! Wowww...&quot;

echo


**Variables**

Already seen in some parts. You can define variables like this **VARNAME=VALUE**. A sample:

#!/bin/bash

NAME=Jadi

echo

echo &quot;$NAME is learning! Wowww...&quot;

echo

Note: you can also do NAME=&quot;Jadi&quot;

**Command substitution**

Sometimes you need to have a variable with the result of something to a variable. In this case
you can use $() construct:

FILES=$(ls - 1)

**Executing scripts**

If the file is executable, we can run them using the ./script_name.sh if we are in the same

directory, or give the complete path or include their directory ine $PATH variable. As you can see
they are just normal programs.

Another way is giving our scripts name as a parameter to the bash or sh commands.

Note: you know that for making a file executable we can do chmod 755 filename or chmod +x
fiename.

**Conditions**

Up to now, we were just running commands one by one. That is not very _programmatic_. If we are

going to have some _logic_ in our programs, we need _conditions_ and _loops_. First we will cover

conditions, using the if command. Its usage is like this:

if [condition]

then

do something

do another thing

else

do new things

even funnier things

fi

Note: else part is optional, if, then, fi is enough.


Conditions can be TRUE or FALSE. A very simple conditions is if [ &quot;Linux&quot; = &quot;Linux&quot; ]. Silly? I know
but we will change it soon but for now, learn the syntax! Specially the _spaces_ and _=_ for checking if

two strings are equal.

#!/bin/bash

kernel=$(uname - s)

if [ $kernel = &quot;Linux&quot; ]

then

echo YES. You are using a Linux

else

echo &quot;Not a linux :(&quot;

fi

Note spaces and using double quotes (&quot;) on second echo because it has (character which will be
interpreted by bash if we do not enclose the string in a double quote.

The actual checking of the condition is done by test command which is writer as [ some test].
There are the other options:


</code></pre>
<p class="has-line-data" data-line-start="4851" data-line-end="4852">conditions what is means</p>
<pre><code class="has-line-data" data-line-start="4854" data-line-end="4856">
</code></pre>
<p class="has-line-data" data-line-start="4857" data-line-end="4858">“a” = “b” if two strings are equal (here it will return False)</p>
<pre><code class="has-line-data" data-line-start="4860" data-line-end="4862">
</code></pre>
<p class="has-line-data" data-line-start="4863" data-line-end="4864">“a” != “b” string a is not equal to string b</p>
<pre><code class="has-line-data" data-line-start="4866" data-line-end="4868">
</code></pre>
<p class="has-line-data" data-line-start="4869" data-line-end="4870">4 - lt 40 if 4 is lower than 40 (True)</p>
<pre><code class="has-line-data" data-line-start="4872" data-line-end="4874">
</code></pre>
<p class="has-line-data" data-line-start="4875" data-line-end="4876">5 - gt 15 if 5 is greater than 15 (False)</p>
<pre><code class="has-line-data" data-line-start="4878" data-line-end="4880">
</code></pre>
<p class="has-line-data" data-line-start="4881" data-line-end="4882">5 - ge 5 if 5 is greater or equal 5</p>
<pre><code class="has-line-data" data-line-start="4884" data-line-end="4886">
</code></pre>
<p class="has-line-data" data-line-start="4887" data-line-end="4888">5 - le 3 if 5 is lower or equal to 3</p>
<pre><code class="has-line-data" data-line-start="4890" data-line-end="4892">
</code></pre>
<p class="has-line-data" data-line-start="4893" data-line-end="4894">9 - ne 2 9 is not equal with 2 (True)</p>
<pre><code class="has-line-data" data-line-start="4896" data-line-end="5224">- f FILENAME if file FILENAME exists
- s FILENAME if file exists and its size is more than 0
- x FILENAME file exists and is executable


**Read**

Using read we can read the user input. Look at this:

1 #!/bin/sh

2

3 echo &quot;what is your name?&quot;

4 read NAME

5

6 echo &quot;Hello $NAME&quot;

7

8 if [ $NAME = &quot;Jadi&quot; ]

9 then

10 echo &quot;Oh I know you!&quot;

11 else

12 echo &quot;I wish I knew you&quot;

13 fi

14

15 echo &quot;Bye&quot;

**For loop**

Generally, loops are used to run a specific set of commands more than once. The syntax is like

this:

for VAR in SOME_LIST;

do

some stuff with $VAR

some other stuff

done

Note the in, ;, do and done.


On each loop, the VAR will be equal to one of the SOME_LIST elements. SOME_LIST can be
numbers, name of files, words, ...

for NUM in 1 2 3 4 5 6;

do

echo $NUM

done

But what if you needed to go 1 to 42? We have the seq command which can be used like seq 1
42 or a shorthand like {1..42}.

Good part is we can use non-numbers too!

for FILE in $(ls);

do

echo $FILE

wc $FILE

done

**While loop**

This is another kind of loop but loops _while_ a conditions is TRUE. This is the syntax:

while [condition]

do

do something

do anohter thing

done

Note: If your condition will remains true all the time, the while loop will run _forever_. This is called
an _infinite loop_

This is sample:

VAR=52

while [ $VAR - gt 42 ]

do

echo VAR is $VAR and it is still greater than 42

let VAR=VAR- 1

done


we will have an infinite loop if we use let VAR=VAR+1. Ctrl+C will help us to _break_ the loop.

Note the let usage! If you just just say VAR=1 and then VAR=$VAR+1, then VAR will be equal
to 1+1 as an string!.

**Mailing the root user**

For sending mail, you need to install **mailutils**. Then the mail command will send emails. You can
send the mail to the root user by issuing this command:

jadi@funlife:~$ mail root

Cc:

Subject: Hi there root

hello there. This is my mail

And root will get this email. She can read it using mail command.

If you need to send emails in a script, just do:

$ echo &quot;Body!&quot; | mail - s &quot;Subject&quot; root

This can be easily embeded as poart of your scripts!


**105.3 - SQL data management** **_- 2_**

**Objectives**

- Use of basic SQL commands
- Perform basic data manipulation

**Terms and Utilities**

- Insert
- Update
- Select
- Delete
- From
- where
- group by
- order by
- join

**Databases**

This module is about SQL language and MySQL is one of the many SQL databases. For this lesson, a
database consists of some **table** s and each table has some **row** s and **filed** s. Lets have a look. In this
lesson we are not going to _create_ or _design_ databases. You only need to have a general
understanding of databases (SQL databases) and know some command to use (read query or
update or add to them). The database I'm going to use in this lesson is called lpic and has two
tables contact and info.

**mysql command line**

You only need to know that mysql is a command line program to interactively connect to a mysql-
server. I use it like this:

$ **mysql -u root -p**

Which means I'm going to use user root and will provide a password. It was also possible to say:

$ **mysql -u root -p mypass lpic**

To provide the pass on command line (not a good idea for security reasons!) and tell mysql
program to connect to lpic database when it starts.


**Using a database**

When you connect to a database, you have to use the use command to select which database you
are going to issue commands on. Normally a database server (say mysql) can have 100s of
different databases in it, each for one user or program.

jadi@funlife:~$ **mysql -u root -p**

Enter password:

Welcome to the MySQL monitor. Commands end with ; or \g.

Your MySQL connection id is 17

Server version: 5.6.25-0ubuntu0.15.04.1 (Ubuntu)

Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; **SHOW DATABASES;**

### +--------------------+

| Database |

### +--------------------+

| information_schema |

| bad |

| good |

| lpic |

| mysql |

| performance_schema |


| ugly |

### +--------------------+

7 rows in set (0.00 sec)

mysql&gt; **USE LPIC;**

Reading table information for completion of table and column names You
can turn off this feature to get a quicker startup with -A

Database changed

mysql&gt; SHOW TABLES;

### +---------------- +

| Tables_in_lpic |

+---------------- +

| info |

| phonebook |

+---------------- +

2 rows in set (0.00 sec)


As you can see mysql is friendly and shows lovely tables! I've told her to use lpic and then show
tables and now I know that I have two tables: info &amp; phonebook.

Note: it is common to type MYSQL commands in CAPITAL LETTERS and names and values and ..
in lower case.

### SELECT

**SELECT** is obvious! It selects from a table. When we are not sure what field we are looking for, we
can select * to get all fields.

mysql&gt; **SELECT * FROM phonebook;**

### +-------- +------------------ +---------------- +

| name | email | phone |

+-------- +------------------ +---------------- +

| jadi | jadi@jadi.net | +9890something |

| nasrin | nasrin@lpic.test | +9898989898 |

| sina | far@from.here | +687randomnum |
haale | | 0935secret | +--------+------------------+----
------------+ 4 rows in set (0.00 sec)

### |


Or ask for a specific field:

mysql&gt; **SELECT name FROM phonebook;**

### +--------+

| name |

### +--------+

| jadi |

| nasrin |

| sina |

| haale |

### +--------+

3 rows in set (0.00 sec)


### WHERE

You can **add** **_conditions_** to your SQL queries using **WHERE**. Let’s have a look at the other table
we have:

mysql&gt; **SELECT * FROM info;**

### +--------+--------+--------+-------+

| name | height | weight | mood |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5225" data-line-end="5227">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5229" data-line-end="5241">| jadi | 180 | 74 | happy |

| sina | 175 | 81 | happy |

| nasrin | 174 | 68 | happy |

| mina | 171 | 59 | sad |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5242" data-line-end="5244">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5246" data-line-end="5260">4 rows in set (0.00 sec)

What if we only wanted to see our _happy_ friends?

mysql&gt; **SELECT * FROM info WHERE mood = 'happy';**

### +--------+--------+--------+-------+

| name | height | weight | mood |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5261" data-line-end="5263">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5265" data-line-end="5275">| jadi | 180 | 74 | happy |

| sina | 175 | 81 | happy |

| nasrin | 174 | 68 | happy |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5276" data-line-end="5278">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5280" data-line-end="5289">3 rows in set (0.00 sec)


mysql&gt; **SELECT * FROM info WHERE mood = 'happy' AND weight &gt;= 80;**

### +--------


</code></pre>
<h2 class="code-line" data-line-start=5290 data-line-end=5291 ><a id="_5290"></a>±</h2>
<hr>
<pre><code class="has-line-data" data-line-start="5295" data-line-end="5303">- +-------- +------- +

| name | height | weight | mood |

### +--------


</code></pre>
<h2 class="code-line" data-line-start=5304 data-line-end=5305 ><a id="_5304"></a>±</h2>
<hr>
<pre><code class="has-line-data" data-line-start="5309" data-line-end="5317">- +-------- +------- +

| sina | 175 | 81 | happy |

### +--------


</code></pre>
<h2 class="code-line" data-line-start=5318 data-line-end=5319 ><a id="_5318"></a>±</h2>
<hr>
<pre><code class="has-line-data" data-line-start="5323" data-line-end="5375">- +-------- +------- +

3 rows in set (0.00 sec)

Or if I only needed the **name** :

mysql&gt; **SELECT name FROM info WHERE mood = 'happy' AND weight &gt;= 80;**

### +------+

| name |

### +------+

| sina |

### +------+


### ORDER BY

This is used if you want to **sort** the data based on one field. Here I'm checking my phone book
based on people’s names:

mysql&gt; **SELECT * FROM phonebook ORDER BY name;**

### +-------- +------------------ +---------------- +

| name | email | phone |

+-------- +------------------ +---------------- +

| haale | | 0935secret |

| jadi | jadi@jadi.net | +9890something |

| nasrin | nasrin@lpic.test | +9898989898 | | sina |
far@from.here | +687randomnum | +--------+--------
----------+----------------+ 4 rows in set (0.00 sec)

This order can be done on any field, including numbers:

mysql&gt; **SELECT * FROM info ORDER BY height;**

### +--------+--------+--------+-------+

| name | height | weight | mood |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5376" data-line-end="5378">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5380" data-line-end="5392">| mina | 171 | 59 | sad |

| nasrin | 174 | 68 | happy |

| sina | 175 | 81 | happy |

| jadi | 180 | 74 | happy |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5393" data-line-end="5395">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5397" data-line-end="5555">4 rows in set (0.00 sec)


### GROUP BY

This will **_group_** the output. Unfortunately, this is not very clear.

mysql&gt; **SELECT * FROM info GROUP BY mood;** +---
---+--------+--------+-------+

| name | height | weight | mood |

### + ------+-------- +-------- +------- +

| jadi | 180 | 74 | happy |

| mina | 171 | 59 | sad |

+ ------+-------- +-------- +------- +

2 rows in set (0.00 sec)

We've seen that we have only two moods in our table: sad &amp; happy. When SELECTing all fields
(that is *) from this table GROUP BY mood, SQL will check all the moods, shows us only ONE from
each. This can be used like the **uniq** command you learned from LPIC101:

mysql&gt; **SELECT mood FROM info GROUP BY mood;**

### +------- +

| mood |

+------- +

| happy |

| sad |

+------- +

2 rows in set (0.00 sec)


Which gives you all available moods in the table. In real life this is not very useful and most of the
times it is combined with count. Have a look:

mysql&gt; **SELECT count(mood), mood FROM info GROUP BY mood;**

### +-------------+-------+

| count(mood) | mood |

### + ------------- +------- +

| 3 | happy |

| 1 | sad |

+ ------------- +------- +

2 rows in set (0.00 sec)

Which counts home many rows have that specific mood. So I have 3 happy friends and one sad
friend.

Note: count is not part of LPIC 105.3


### INSERT

Another clear command. It **adds a new row** to a table. Say I want to add some data to
phonebook:

mysql&gt; **INSERT INTO phonebook (name, phone, email) VALUES ('ghasem',
'+982112345678', '');**

Query OK, 1 row affected (0.01 sec)

mysql&gt; **SELECT * FROM phonebook;**

### +-------- +------------------ +---------------- +

| name | email | phone |

+-------- +------------------ +---------------- +

| jadi | jadi@jadi.net | +9890something |

| nasrin | nasrin@lpic.test | +9898989898 |

| sina | far@from.here | +687randomnum |

| haale | | 0935secret |

| ghasem | | +982112345678 |

### +--------+------------------+----------------+

5 rows in set (0.00 sec)


### DELETE

This will DELETE from a table. But be careful of what you delete... WHERE is your fiend here:

mysql&gt; **DELETE FROM phonebook WHERE name = 'ghasem';**

mysql&gt; **SELECT * FROM phonebook;**

### +-------- +------------------ +---------------- +

| name | email | phone |

+-------- +------------------ +---------------- +

| jadi | jadi@jadi.net | +9890something |

| nasrin | nasrin@lpic.test | +9898989898 |

| sina | far@from.here | +687randomnum |

| haale | | 0935secret |

+-------- +------------------ +---------------- +

4 rows in set (0.00 sec)


### UPDATE

It updates (changes) row and again WHERE is your friend:

mysql&gt; **SELECT * FROM phonebook;**

### +-------- +------------------ +---------------- +

| name | email | phone |

+-------- +------------------ +---------------- +

| jadi | jadi@jadi.net | +9890something |

| nasrin | nasrin@lpic.test | +9898989898 | | sina |
far@from.here | +687randomnum | | haale | |
0935secret | +--------+------------------+----------------+ 4
rows in set (0.00 sec)

mysql&gt; **UPDATE phonebook SET email='haale@lpic.fake' WHERE name = 'haale';** Query
OK, 1 row affected (0.01 sec)

Rows matched: 1 Changed: 1 Warnings: 0

mysql&gt; **SELECT * FROM phonebook;**

### +-------- +------------------


</code></pre>
<h2 class="code-line" data-line-start=5556 data-line-end=5557 ><a id="_5556"></a>±-</h2>
<hr>
<hr>
<p class="has-line-data" data-line-start="5562" data-line-end="5563">– +</p>
<pre><code class="has-line-data" data-line-start="5565" data-line-end="5571">| name | email | phone |

### +-------- +------------------


</code></pre>
<h2 class="code-line" data-line-start=5572 data-line-end=5573 ><a id="_5572"></a>±-</h2>
<hr>
<hr>
<p class="has-line-data" data-line-start="5578" data-line-end="5579">– +</p>
<pre><code class="has-line-data" data-line-start="5581" data-line-end="5594">| jadi | jadi@jadi.net | +9890something |

| nasrin | nasrin@lpic.test | +9898989898 |

| sina | far@from.here | +687randomnum |

| haale | haale@lpic.fake | 0935secret |


### +-------- +------------------


</code></pre>
<h2 class="code-line" data-line-start=5595 data-line-end=5596 ><a id="_5595"></a>±-</h2>
<hr>
<hr>
<p class="has-line-data" data-line-start="5601" data-line-end="5602">– +</p>
<pre><code class="has-line-data" data-line-start="5604" data-line-end="5617">4 rows in set (0.00 sec)


### JOIN

Join will **join** / **mix two tables**.

mysql&gt; **SELECT * FROM phonebook JOIN info;**

### +-------- +------------------ +---------------- +-------- +--------


</code></pre>
<p class="has-line-data" data-line-start="5618" data-line-end="5620">±----<br>
— ±------ +</p>
<pre><code class="has-line-data" data-line-start="5622" data-line-end="5628">| name | email | phone | name | height | weight | mood |

### +-------- +------------------ +---------------- +-------- +--------


</code></pre>
<p class="has-line-data" data-line-start="5629" data-line-end="5631">±----<br>
— ±------ +</p>
<pre><code class="has-line-data" data-line-start="5633" data-line-end="5669">| jadi | jadi@jadi.net | +9890something | jadi | 180 | 74 | happy |

| nasrin | nasrin@lpic.test | +9898989898 | jadi | 180 | 74 | happy |

| sina | far@from.here | +687randomnum | jadi | 180 | 74 | happy |

| haale | haale@lpic.fake | 0935secret | jadi | 180 | 74 | happy |

| jadi | jadi@jadi.net | +9890something | sina | 175 | 81 | happy |

| nasrin | nasrin@lpic.test | +9898989898 | sina | 175 | 81 | happy |

| sina | far@from.here | +687randomnum | sina | 175 | 81 | happy |

| haale | haale@lpic.fake | 0935secret | sina | 175 | 81 | happy |

| jadi | jadi@jadi.net | +9890something | nasrin | 174 | 68 | happy |

| nasrin | nasrin@lpic.test | +9898989898 | nasrin | 174 | 68 | happy |

| sina | far@from.here | +687randomnum | nasrin | 174 | 68 | happy |

| haale | haale@lpic.fake | 0935secret | nasrin | 174 | 68 | happy |

| jadi | jadi@jadi.net | +9890something | mina | 171 | 59 | sad |

| nasrin | nasrin@lpic.test | +9898989898 | mina | 171 | 59 | sad |

| sina | far@from.here | +687randomnum | mina | 171 | 59 | sad |

| haale | haale@lpic.fake | 0935secret | mina | 171 | 59 | sad |

### +-------- +------------------ +---------------- +-------- +--------


</code></pre>
<p class="has-line-data" data-line-start="5670" data-line-end="5672">±----<br>
— ±------ +</p>
<pre><code class="has-line-data" data-line-start="5674" data-line-end="5699">16 rows in set (0.00 sec)

Every single row from first table (phonebook) is copied in front of the second table (info). Not very
useful _yet_. It becomes useful when you give a _common field_ or tell it to JOIN tables based on a
criteria; using WHERE. Here is the magic:


mysql&gt; **SELECT * FROM phonebook JOIN info ON phonebook.name = info.name;**

### +-------- +------------------ +---------------- + --------+-------- +-------- +------- +

| name | email | phone | name | height | weight | mood |

+-------- +------------------ +---------------- + --------+-------- +-------- +------- +

| jadi | jadi@jadi.net | +9890something | jadi | 180 | 74 | happy |

| sina | far@from.here | +687randomnum | sina | 175 | 81 | happy |

| nasrin | nasrin@lpic.test | +9898989898 | nasrin | 174 | 68 | happy |

### +-------- +------------------


</code></pre>
<h2 class="code-line" data-line-start=5700 data-line-end=5701 ><a id="_5700"></a>±-</h2>
<hr>
<hr>
<p class="has-line-data" data-line-start="5706" data-line-end="5707">– ±------- ±------- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5709" data-line-end="5785">3 rows in set (0.00 sec)

Great! Now I have my friends list, their moods and their phone numbers! Say I'm bored and

I need to phone a cool friend:


mysql&gt; **SELECT phonebook.name, phone, mood FROM phonebook JOIN info ON
phonebook.name = info.name WHERE mood = 'happy';**

### +-------- +---------------- +------- +

| name | phone | mood |

+-------- +---------------- +------- +

| jadi | +9890something | happy |

| sina | +687randomnum | happy |

| nasrin | +9898989898 | happy |

+-------- +---------------- +------- +

3 rows in set (0.00 sec)

Note: both tables have a field called name so I needed to use phonebook.name to tell SQL which
name I want to show.

mysql&gt; **SELECT phonebook.name, phone, mood FROM phonebook JOIN info ON
phonebook.name = info.name AND height &lt; 175;**

### +-------- +------------- + -------+

| name | phone | mood |

+-------- +------------- + -------+

| nasrin | +9898989898 | happy |

+-------- +------------- + -------+

1 row in set (0.00 sec)

mysql&gt; **SELECT * FROM info WHERE mood = 'sad';**

### +------+--------+--------+------+

| name | height | weight | mood |

### + ------+-------- +-------- +------ +

| mina | 171 | 59 | sad |

+ ------+-------- +-------- +------ +

1 row in set (0.01 sec)


mysql&gt; **UPDATE info SET mood = 'happy' WHERE name = 'mina';**
Query OK, 0 rows affected (0.02 sec) Rows matched: 1 Changed: 0
Warnings: 0

mysql&gt; **SELECT * FROM info WHERE mood = 'sad';**
Empty set (0.00 sec)

mysql&gt; **SELECT * FROM info;**

### +--------+--------+--------+-------+

| name | height | weight | mood |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5786" data-line-end="5788">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5790" data-line-end="5802">| jadi | 180 | 74 | happy |

| sina | 175 | 81 | happy |

| nasrin | 174 | 68 | happy |

| mina | 171 | 59 | happy |

+--------


</code></pre>
<p class="has-line-data" data-line-start="5803" data-line-end="5805">±—<br>
---- ±------- ±------ +</p>
<pre><code class="has-line-data" data-line-start="5807" data-line-end="5856">**Quit**

mysql&gt; **quit**

Bye

jadi@funlife:~$


**106.1 - Install and configure X11** **_- 2_**

**Objectives**

- Verify that the video card and monitor are supported by an X server
- Awareness of the X font server
- Basic understanding and knowledge of the X Window configuration file

**Terms and Utilities:**

- /etc/X11/xorg.conf
- xhost
- DISPLAY
- xwininfo
- xdpyinfo
- X

**History**

This lesson is useless in modern life! Very strange but practically nothing in this lesson is used in
real life because **xorg.conf** , **xhost** , ... is not used in any modern linux system anymore. Maybe
they are here so you won’t be shocked if you see an older linux.

### X

The X Window System is a network transparent window system which runs on a wide range of
computing and graphics machines; including practically ALL Linux systems with graphical interfaces.
It is also called X11 because of its version, X window system, X server.


**/etc/X11/xorg.conf**

This is file X used to use for its configuration. In most cases this is automatically generated and
works. Newer systems do not have this file so let’s have a look at a xorg.conf I found on the
Internet.

Section &quot;Files&quot;


</code></pre>
<p class="has-line-data" data-line-start="5857" data-line-end="5858">FontPath “/usr/share/X11/fonts/misc”</p>
<pre><code class="has-line-data" data-line-start="5860" data-line-end="5862">
</code></pre>
<p class="has-line-data" data-line-start="5863" data-line-end="5864">FontPath “/usr/share/X11/fonts/100dpi/:unscaled”</p>
<pre><code class="has-line-data" data-line-start="5866" data-line-end="5868">
</code></pre>
<p class="has-line-data" data-line-start="5869" data-line-end="5870">FontPath “/usr/share/X11/fonts/75dpi/:unscaled”</p>
<pre><code class="has-line-data" data-line-start="5872" data-line-end="5874">
</code></pre>
<p class="has-line-data" data-line-start="5875" data-line-end="5876">FontPath “/usr/share/X11/fonts/Type1”</p>
<pre><code class="has-line-data" data-line-start="5878" data-line-end="5880">
</code></pre>
<p class="has-line-data" data-line-start="5881" data-line-end="5882">FontPath “/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType”</p>
<pre><code class="has-line-data" data-line-start="5884" data-line-end="5895">EndSection


This part is about **Fonts**. When X-Server is running it needs these files. FontPaths tell X11 where
fonts are. It also can refer to an IP running a font-server which is not common these days. Font
servers used to be responsible of rendering fonts to be shown on clients.

Section &quot;Module&quot;


</code></pre>
<p class="has-line-data" data-line-start="5896" data-line-end="5897">Load “bitmap”</p>
<pre><code class="has-line-data" data-line-start="5899" data-line-end="5901">
</code></pre>
<p class="has-line-data" data-line-start="5902" data-line-end="5903">Load “ddc”</p>
<pre><code class="has-line-data" data-line-start="5905" data-line-end="5907">
</code></pre>
<p class="has-line-data" data-line-start="5908" data-line-end="5909">Load “dri”</p>
<pre><code class="has-line-data" data-line-start="5911" data-line-end="5913">
</code></pre>
<p class="has-line-data" data-line-start="5914" data-line-end="5915">Load “extmod”</p>
<pre><code class="has-line-data" data-line-start="5917" data-line-end="5919">
</code></pre>
<p class="has-line-data" data-line-start="5920" data-line-end="5921">Load “freetype”</p>
<pre><code class="has-line-data" data-line-start="5923" data-line-end="5925">
</code></pre>
<p class="has-line-data" data-line-start="5926" data-line-end="5927">Load “glx”</p>
<pre><code class="has-line-data" data-line-start="5929" data-line-end="5931">
</code></pre>
<p class="has-line-data" data-line-start="5932" data-line-end="5933">Load “int10”</p>
<pre><code class="has-line-data" data-line-start="5935" data-line-end="5937">
</code></pre>
<p class="has-line-data" data-line-start="5938" data-line-end="5939">Load “type1”</p>
<pre><code class="has-line-data" data-line-start="5941" data-line-end="5943">
</code></pre>
<p class="has-line-data" data-line-start="5944" data-line-end="5945">Load “vbe”</p>
<pre><code class="has-line-data" data-line-start="5947" data-line-end="5949">
</code></pre>
<p class="has-line-data" data-line-start="5950" data-line-end="5951">Load “dbe”</p>
<pre><code class="has-line-data" data-line-start="5953" data-line-end="5962">EndSection

These are modules. We are asking X server to load so called modules.

Next we have to define our **InputDevices** :

Section &quot;InputDevice&quot;

</code></pre>
<p class="has-line-data" data-line-start="5963" data-line-end="5964">Identifier “Generic Keyboard”</p>
<pre><code class="has-line-data" data-line-start="5966" data-line-end="5968">
</code></pre>
<p class="has-line-data" data-line-start="5969" data-line-end="5970">Driver “kbd”</p>
<pre><code class="has-line-data" data-line-start="5972" data-line-end="5974">
</code></pre>
<p class="has-line-data" data-line-start="5975" data-line-end="5976">Option “CoreKeyboard”</p>
<pre><code class="has-line-data" data-line-start="5978" data-line-end="5980">
</code></pre>
<p class="has-line-data" data-line-start="5981" data-line-end="5982">Option “XkbRules” “xorg”</p>
<pre><code class="has-line-data" data-line-start="5984" data-line-end="5986">
</code></pre>
<p class="has-line-data" data-line-start="5987" data-line-end="5988">Option “XkbModel” “pc105”</p>
<pre><code class="has-line-data" data-line-start="5990" data-line-end="5992">
</code></pre>
<p class="has-line-data" data-line-start="5993" data-line-end="5994">Option “XkbLayout” “us”</p>
<pre><code class="has-line-data" data-line-start="5996" data-line-end="6002">EndSection

Section &quot;InputDevice&quot;


</code></pre>
<p class="has-line-data" data-line-start="6003" data-line-end="6004">Identifier “Configured Mouse”</p>
<pre><code class="has-line-data" data-line-start="6006" data-line-end="6008">
</code></pre>
<p class="has-line-data" data-line-start="6009" data-line-end="6010">Driver “mouse”</p>
<pre><code class="has-line-data" data-line-start="6012" data-line-end="6014">
</code></pre>
<p class="has-line-data" data-line-start="6015" data-line-end="6016">Option “CorePointer”</p>
<pre><code class="has-line-data" data-line-start="6018" data-line-end="6020">
</code></pre>
<p class="has-line-data" data-line-start="6021" data-line-end="6022">Option “Device” “/dev/input/mice”</p>
<pre><code class="has-line-data" data-line-start="6024" data-line-end="6026">
</code></pre>
<p class="has-line-data" data-line-start="6027" data-line-end="6028">Option “Protocol” “ImPS/2”</p>
<pre><code class="has-line-data" data-line-start="6030" data-line-end="6032">
</code></pre>
<p class="has-line-data" data-line-start="6033" data-line-end="6034">Option “Emulate3Buttons” “true”</p>
<pre><code class="has-line-data" data-line-start="6036" data-line-end="6038">
</code></pre>
<p class="has-line-data" data-line-start="6039" data-line-end="6040">Option “ZAxisMapping” “4 5”</p>
<pre><code class="has-line-data" data-line-start="6042" data-line-end="6048">EndSection

Section &quot;InputDevice&quot;


</code></pre>
<p class="has-line-data" data-line-start="6049" data-line-end="6050">Identifier “Synaptics Touchpad”</p>
<pre><code class="has-line-data" data-line-start="6052" data-line-end="6054">
</code></pre>
<p class="has-line-data" data-line-start="6055" data-line-end="6056">Driver “synaptics”</p>
<pre><code class="has-line-data" data-line-start="6058" data-line-end="6060">
</code></pre>
<p class="has-line-data" data-line-start="6061" data-line-end="6062">Option “SendCoreEvents” “true”</p>
<pre><code class="has-line-data" data-line-start="6064" data-line-end="6066">
</code></pre>
<p class="has-line-data" data-line-start="6067" data-line-end="6068">Option “Device” “/dev/psaux”</p>
<pre><code class="has-line-data" data-line-start="6070" data-line-end="6072">
</code></pre>
<p class="has-line-data" data-line-start="6073" data-line-end="6074">Option “Protocol” “auto-dev”</p>
<pre><code class="has-line-data" data-line-start="6076" data-line-end="6078">
</code></pre>
<p class="has-line-data" data-line-start="6079" data-line-end="6080">Option “RightEdge” “5000”</p>
<pre><code class="has-line-data" data-line-start="6082" data-line-end="6090">EndSection


As you can see each device has an **Identifier** , **Driver** and **some options**. We just defined a
mouse, a keyboard and a touchpad and gave them some names. Section &quot;Device&quot;


</code></pre>
<p class="has-line-data" data-line-start="6091" data-line-end="6092">Identifier “ATI Technologies, Inc. Radeon Mobility 7500 (M7 LW)”</p>
<pre><code class="has-line-data" data-line-start="6094" data-line-end="6096">
</code></pre>
<p class="has-line-data" data-line-start="6097" data-line-end="6098">Driver “radeon”</p>
<pre><code class="has-line-data" data-line-start="6100" data-line-end="6102">
</code></pre>
<p class="has-line-data" data-line-start="6103" data-line-end="6104">BusID “PCI:1:0:0”</p>
<pre><code class="has-line-data" data-line-start="6106" data-line-end="6108">
</code></pre>
<p class="has-line-data" data-line-start="6109" data-line-end="6110">Option “DynamicClocks” “on”</p>
<pre><code class="has-line-data" data-line-start="6112" data-line-end="6114">
</code></pre>
<p class="has-line-data" data-line-start="6115" data-line-end="6116">Option “CRT2HSync” “30-80”</p>
<pre><code class="has-line-data" data-line-start="6118" data-line-end="6120">
</code></pre>
<p class="has-line-data" data-line-start="6121" data-line-end="6122">Option “CRT2VRefresh” “59-75”</p>
<pre><code class="has-line-data" data-line-start="6124" data-line-end="6126">
</code></pre>
<p class="has-line-data" data-line-start="6127" data-line-end="6128">Option “MetaModes” &quot;1024x768 800x600 640x480</p>
<pre><code class="has-line-data" data-line-start="6130" data-line-end="6145">1024x768+1280x1024&quot;

EndSection

A graphic card is defined above. Again it has its identifies (name), its drivers and some
options (like support resolutions, refresh rates, ...). This device needs a screen and a
monitor:

Note: The vesa points to a low resolution, always working driver. It is used for
troubleshooting.

Section &quot;Monitor&quot;


</code></pre>
<p class="has-line-data" data-line-start="6146" data-line-end="6147">Identifier “Generic Monitor”</p>
<pre><code class="has-line-data" data-line-start="6149" data-line-end="6151">
</code></pre>
<p class="has-line-data" data-line-start="6152" data-line-end="6153">Option “DPMS”</p>
<pre><code class="has-line-data" data-line-start="6155" data-line-end="6161">EndSection

Section &quot;Screen&quot;


</code></pre>
<p class="has-line-data" data-line-start="6162" data-line-end="6163">Identifier “Screen0”</p>
<pre><code class="has-line-data" data-line-start="6165" data-line-end="6167">
</code></pre>
<p class="has-line-data" data-line-start="6168" data-line-end="6169">Device “Screen0 ATI Technologies, Inc. Radeon Mobility 7500 (M7 LW)”</p>
<pre><code class="has-line-data" data-line-start="6171" data-line-end="6173">
</code></pre>
<p class="has-line-data" data-line-start="6174" data-line-end="6175">Monitor “Generic Monitor”</p>
<pre><code class="has-line-data" data-line-start="6177" data-line-end="6179">
</code></pre>
<p class="has-line-data" data-line-start="6180" data-line-end="6181">DefaultDepth 24</p>
<pre><code class="has-line-data" data-line-start="6183" data-line-end="6185">
</code></pre>
<p class="has-line-data" data-line-start="6186" data-line-end="6187">SubSection “Display”</p>
<pre><code class="has-line-data" data-line-start="6189" data-line-end="6191">
</code></pre>
<p class="has-line-data" data-line-start="6192" data-line-end="6193">Depth 1</p>
<pre><code class="has-line-data" data-line-start="6195" data-line-end="6197">
</code></pre>
<p class="has-line-data" data-line-start="6198" data-line-end="6199">Modes “1024x768”</p>
<pre><code class="has-line-data" data-line-start="6201" data-line-end="6203">
</code></pre>
<p class="has-line-data" data-line-start="6204" data-line-end="6205">EndSubSection</p>
<pre><code class="has-line-data" data-line-start="6207" data-line-end="6209">
</code></pre>
<p class="has-line-data" data-line-start="6210" data-line-end="6211">SubSection “Display”</p>
<pre><code class="has-line-data" data-line-start="6213" data-line-end="6215">
</code></pre>
<p class="has-line-data" data-line-start="6216" data-line-end="6217">Depth 4</p>
<pre><code class="has-line-data" data-line-start="6219" data-line-end="6221">
</code></pre>
<p class="has-line-data" data-line-start="6222" data-line-end="6223">Modes “1024x768”</p>
<pre><code class="has-line-data" data-line-start="6225" data-line-end="6227">
</code></pre>
<p class="has-line-data" data-line-start="6228" data-line-end="6229">EndSubSection</p>
<pre><code class="has-line-data" data-line-start="6231" data-line-end="6233">
</code></pre>
<p class="has-line-data" data-line-start="6234" data-line-end="6235">SubSection “Display”</p>
<pre><code class="has-line-data" data-line-start="6237" data-line-end="6239">
</code></pre>
<p class="has-line-data" data-line-start="6240" data-line-end="6241">Depth 8</p>
<pre><code class="has-line-data" data-line-start="6243" data-line-end="6245">
</code></pre>
<p class="has-line-data" data-line-start="6246" data-line-end="6247">Modes “1024x768”</p>
<pre><code class="has-line-data" data-line-start="6249" data-line-end="6251">
</code></pre>
<p class="has-line-data" data-line-start="6252" data-line-end="6253">EndSubSection</p>
<pre><code class="has-line-data" data-line-start="6255" data-line-end="6257">
</code></pre>
<p class="has-line-data" data-line-start="6258" data-line-end="6259">SubSection “Display”</p>
<pre><code class="has-line-data" data-line-start="6261" data-line-end="6263">
</code></pre>
<p class="has-line-data" data-line-start="6264" data-line-end="6265">Depth 15</p>
<pre><code class="has-line-data" data-line-start="6267" data-line-end="6269">
</code></pre>
<p class="has-line-data" data-line-start="6270" data-line-end="6271">Modes “1024x768”</p>
<pre><code class="has-line-data" data-line-start="6273" data-line-end="6275">
</code></pre>
<p class="has-line-data" data-line-start="6276" data-line-end="6277">EndSubSection</p>
<pre><code class="has-line-data" data-line-start="6279" data-line-end="6281">
</code></pre>
<p class="has-line-data" data-line-start="6282" data-line-end="6283">SubSection “Display”</p>
<pre><code class="has-line-data" data-line-start="6285" data-line-end="6287">
</code></pre>
<p class="has-line-data" data-line-start="6288" data-line-end="6289">Depth 16</p>
<pre><code class="has-line-data" data-line-start="6291" data-line-end="6293">
</code></pre>
<p class="has-line-data" data-line-start="6294" data-line-end="6295">Modes “1024x768”</p>
<pre><code class="has-line-data" data-line-start="6297" data-line-end="6299">
</code></pre>
<p class="has-line-data" data-line-start="6300" data-line-end="6301">EndSubSection</p>
<pre><code class="has-line-data" data-line-start="6303" data-line-end="6305">
</code></pre>
<p class="has-line-data" data-line-start="6306" data-line-end="6307">SubSection “Display”</p>
<pre><code class="has-line-data" data-line-start="6309" data-line-end="6311">
</code></pre>
<p class="has-line-data" data-line-start="6312" data-line-end="6313">Depth 24</p>
<pre><code class="has-line-data" data-line-start="6315" data-line-end="6317">
</code></pre>
<p class="has-line-data" data-line-start="6318" data-line-end="6319">Modes “1024x768”</p>
<pre><code class="has-line-data" data-line-start="6321" data-line-end="6323">
</code></pre>
<p class="has-line-data" data-line-start="6324" data-line-end="6325">EndSubSection</p>
<pre><code class="has-line-data" data-line-start="6327" data-line-end="6339">EndSection


Note how the screen uses the defined monitor (using its identifier &quot;Generic Monitor&quot;) and defined
graphic card. Also note the different colour modes (say 24bit 1024x768).

At the end we have to glue all of the above in one place as **ServerLayout** :

Section &quot;ServerLayout&quot;


</code></pre>
<p class="has-line-data" data-line-start="6340" data-line-end="6341">Identifier “DefaultLayout”</p>
<pre><code class="has-line-data" data-line-start="6343" data-line-end="6345">
</code></pre>
<p class="has-line-data" data-line-start="6346" data-line-end="6347">Screen “Default Screen”</p>
<pre><code class="has-line-data" data-line-start="6349" data-line-end="6351">
</code></pre>
<p class="has-line-data" data-line-start="6352" data-line-end="6353">InputDevice “Generic Keyboard”</p>
<pre><code class="has-line-data" data-line-start="6355" data-line-end="6357">
</code></pre>
<p class="has-line-data" data-line-start="6358" data-line-end="6359">InputDevice “Configured Mouse”</p>
<pre><code class="has-line-data" data-line-start="6361" data-line-end="6363">
</code></pre>
<p class="has-line-data" data-line-start="6364" data-line-end="6365">InputDevice “Synaptics Touchpad”</p>
<pre><code class="has-line-data" data-line-start="6367" data-line-end="6391">EndSection

We have a layout with a screen and 3 input devices :)

Note: Do not panic. It is enough for you to understand the Section and EndSection and a general
understanding of the xorg.conf


**xwininfo**

The **xwininfo** command is a window information utility for X. Run it and it waits for you to click on
any window and gives you some information about that _window_ like its size, position, color
depth, ...

$ **xwininfo**

xwininfo: Please select the window about which you
would like information by clicking the mouse in
that window.

xwininfo: Window id: 0x5400004 &quot;jadi@funlife: ~/w/lpic/lpic1book&quot;


</code></pre>
<p class="has-line-data" data-line-start="6392" data-line-end="6393">Absolute upper-left X: 629</p>
<pre><code class="has-line-data" data-line-start="6395" data-line-end="6397">
</code></pre>
<p class="has-line-data" data-line-start="6398" data-line-end="6399">Absolute upper-left Y: 245</p>
<pre><code class="has-line-data" data-line-start="6401" data-line-end="6403">
</code></pre>
<p class="has-line-data" data-line-start="6404" data-line-end="6405">Relative upper-left X: 10</p>
<pre><code class="has-line-data" data-line-start="6407" data-line-end="6409">
</code></pre>
<p class="has-line-data" data-line-start="6410" data-line-end="6411">Relative upper-left Y: 36</p>
<pre><code class="has-line-data" data-line-start="6413" data-line-end="6415">
</code></pre>
<p class="has-line-data" data-line-start="6416" data-line-end="6417">Width: 655</p>
<pre><code class="has-line-data" data-line-start="6419" data-line-end="6421">
</code></pre>
<p class="has-line-data" data-line-start="6422" data-line-end="6423">Height: 426</p>
<pre><code class="has-line-data" data-line-start="6425" data-line-end="6427">
</code></pre>
<p class="has-line-data" data-line-start="6428" data-line-end="6429">Depth: 32</p>
<pre><code class="has-line-data" data-line-start="6431" data-line-end="6433">
</code></pre>
<p class="has-line-data" data-line-start="6434" data-line-end="6435">Visual: 0x71</p>
<pre><code class="has-line-data" data-line-start="6437" data-line-end="6439">
</code></pre>
<p class="has-line-data" data-line-start="6440" data-line-end="6441">Visual Class: TrueColor</p>
<pre><code class="has-line-data" data-line-start="6443" data-line-end="6445">
</code></pre>
<p class="has-line-data" data-line-start="6446" data-line-end="6447">Border width: 0</p>
<pre><code class="has-line-data" data-line-start="6449" data-line-end="6451">
</code></pre>
<p class="has-line-data" data-line-start="6452" data-line-end="6453">Class: InputOutput</p>
<pre><code class="has-line-data" data-line-start="6455" data-line-end="6457">
</code></pre>
<p class="has-line-data" data-line-start="6458" data-line-end="6459">Colormap: 0x5400003 (not installed)</p>
<pre><code class="has-line-data" data-line-start="6461" data-line-end="6463">
</code></pre>
<p class="has-line-data" data-line-start="6464" data-line-end="6465">Bit Gravity State: NorthWestGravity</p>
<pre><code class="has-line-data" data-line-start="6467" data-line-end="6511">Window Gravity State: NorthWestGravity

Backing Store State: NotUseful

Save Under State: no

Map State: IsViewable

Override Redirect State: no

Corners: +629+245 -82+245 - 82 - 97 +629- 97

- geometry 80x24- 72 - 87


**xdpyinfo**

This give you information about the running X session. Things like screens, color depth,
version, name, ...

name of display: :0

version number: 11.0

vendor string: The X.Org Foundation

vendor release number: 11701000

X.Org version: 1.17.1

maximum request size: 16777212 bytes

motion buffer size: 256

bitmap unit, bit order, padding: 32, LSBFirst, 32

image byte order: LSBFirst

number of supported pixmap formats: 7

supported pixmap formats:


</code></pre>
<p class="has-line-data" data-line-start="6512" data-line-end="6513">depth 1, bits_per_pixel 1, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6515" data-line-end="6517">
</code></pre>
<p class="has-line-data" data-line-start="6518" data-line-end="6519">depth 4, bits_per_pixel 8, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6521" data-line-end="6523">
</code></pre>
<p class="has-line-data" data-line-start="6524" data-line-end="6525">depth 8, bits_per_pixel 8, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6527" data-line-end="6529">
</code></pre>
<p class="has-line-data" data-line-start="6530" data-line-end="6531">depth 15, bits_per_pixel 16, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6533" data-line-end="6535">
</code></pre>
<p class="has-line-data" data-line-start="6536" data-line-end="6537">depth 16, bits_per_pixel 16, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6539" data-line-end="6541">
</code></pre>
<p class="has-line-data" data-line-start="6542" data-line-end="6543">depth 24, bits_per_pixel 32, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6545" data-line-end="6547">
</code></pre>
<p class="has-line-data" data-line-start="6548" data-line-end="6549">depth 32, bits_per_pixel 32, scanline_pad 32</p>
<pre><code class="has-line-data" data-line-start="6551" data-line-end="6562">keycode range: minimum 8, maximum 255

focus: window 0x5400005, revert to Parent

number of extensions: 28


### BIG-REQUESTS


</code></pre>
<p class="has-line-data" data-line-start="6563" data-line-end="6564">Composite</p>
<pre><code class="has-line-data" data-line-start="6566" data-line-end="6740">### DAMAGE

### ...

### ...


**xhost**

This command used to **control the access** to the X server. If you are on a X server and run **xhost** it
tells you the access status.

$ **xhost**

access control enabled, only authorized clients can connect
SI:localuser:jadi

As you can see only authorized clients can connect. To open it for all:

jadi@funlife:~$ **xhost +**

access control disabled, clients can connect from any host

And for closing it again:

jadi@funlife:~$ **xhost -**

access control enabled, only authorized clients can connect

Or open it for only one specific IP:

jadi@funlife:~$ **xhost +192.168.42.85**

192.168.42.85 being added to access control list
jadi@funlife:~$ **xhost**

access control enabled, only authorized clients can connect

INET:192.168.42.85 (no nameserver response within 5 seconds)

SI:localuser:jadi


### DISPLAY

This variable tell graphical program where to show their graphical output (where to draw their
inputs). In normal cases this is set on my own machine:

$ **echo $DISPLAY**

### :0

But if another X is listening to all IPs (after xhost +) or listening to my machine (after xhost
192.168.42.85) I can change the DISPLAY environment and connect my graphical output to that
machine. In this case if I run a graphical program, its output (windows) will be shown on another
machine:

$ **export DISPLAY=192.168.42.85:0**

$ xeyes # the eyes will be shown on 192.168.42.85 machine

Note: This wont work if you test it on a modern machine. Most X11s do not listen on any port
these days.


**106.2 - Setup a display manager** **_- 1_**

**Objectives**

- Basic configuration of LightDM
- Turn the display manager on or off
- Change the display manager greeting
- Awareness of XDM, KDM and GDM

**Terms and Utilities**

- lightdm
- /etc/lightdm/

**Display Manager**

A **Display Manager** is a graphical interface which lets you login into your system when you turn
your computer on. There are many different display managers (say XDM, SDDM, KDM, GDM, ...)
but their general functionality is same: show a login form and let the user the enter (or choose) its
name, password and the Desktop she needs to use. Also many of the DMs let the user to choose
Accessibility Tools (covered in 106.3), connect to the network, change the keyboard layout or
change the system volume.

**lightdm**

Many of the distros use **LightDM** as their display/login manager. It shows the default user (last
logged in user) and asks for password. If you have more than one desktop installed (say XFCE, KDE
and Gnome) it also lets you choose the one you need.


**_lightdm_** can accept _themes_ and calls them _greeters_.

**/etc/lightdm**

All of the lightdm configs are in /etc/lightdm.

$ **ls -ltrh /etc/lightdm/**

total 24K

- rw-r--r-- 1 root root 40 Sep 23 12:56 keys.conf
- rw-r--r-- 1 root root 801 Sep 27 13:03 lightdm-webkit2-greeter.conf -rw-r-
- r-- 1 root root 452 Sep 27 13:08 users.conf -rwxr-xr-x 1 root root 1.5K Sep
27 13:08 Xsession
- rw-r--r-- 1 root root 6.5K Sep 27 13:08 lightdm.conf

Some distributions like Ubuntu are using a lightdm.conf.d directory instead of a straight
forward lightdm.conf and put their configs there.

[SeatDefaults]

### ...

user-session=gnome

#autologin-user=jadi

#allow-user-switching=true

allow-guest=true

greeter-session=lightdm-webkit2-greeter

### ...

The **greeter-session** tells which greeter (theme) should be used. You can install more greeters
using your package manager. Another important config is **user-session** which tells the lightdm
what desktop is the default one.


**Controlling DMs**

The **lightdm** works as a service. You can start, stop &amp; restart it or even use systemctl disable lightdm
to disable it on next boots.

You already know how to reboot your computer in text mode from previous lessons (using grub,
kernel parameters during the boot or using init command).


**106.3 - Accessibility** **_- 1_**

**Objectives**

- Basic knowledge of keyboard accessibility settings (AccessX)
- Basic knowledge of visual settings and themes
- Basic knowledge of assistive technology (ATs)

**Terms and Utilities**

- Sticky/Repeat Keys
- Slow/Bounce/Toggle Keys
- Mouse Keys
- High Contrast/Large Print Desktop Themes
- Screen Reader
- Braille Display
- Screen Magnifier
- On-Screen Keyboard
- Gestures (used at login, for example GDM)
- Orca
- GOK
- emacspeak

**Linux is for everyone**

Some people have physical complications. Some cannot see well, some cannot see at all and some
cannot user their finger as I can do. Linux have 3 answers:


</code></pre>
<p class="has-line-data" data-line-start="6741" data-line-end="6742">1 - AccessX helps people with physical problems to use keyboard/mouse</p>
<pre><code class="has-line-data" data-line-start="6744" data-line-end="6746">
</code></pre>
<p class="has-line-data" data-line-start="6747" data-line-end="6749">2 - Visual Settings help people with vision problems by magnifying the screen and things<br>
like that</p>
<pre><code class="has-line-data" data-line-start="6751" data-line-end="6753">
</code></pre>
<p class="has-line-data" data-line-start="6754" data-line-end="6756">3 - Assistive Technologies are things like text-to-speech (tts) and reads the screen for people<br>
with visual problem</p>
<pre><code class="has-line-data" data-line-start="6758" data-line-end="6767">These options are available in display managers (login screen) and in major desktops (like
gnome, kde, xfce, ...). Its logo is a human stretching its hands a legs.


In **Gnome** the config is located at Settings ~ Universal Access. The configurations are
categorized and are as follows:


</code></pre>
<p class="has-line-data" data-line-start="6768" data-line-end="6770">High Contrast<br>
Zoom</p>
<pre><code class="has-line-data" data-line-start="6772" data-line-end="6774">
</code></pre>
<p class="has-line-data" data-line-start="6775" data-line-end="6776">Large text</p>
<pre><code class="has-line-data" data-line-start="6778" data-line-end="6780">
</code></pre>
<p class="has-line-data" data-line-start="6781" data-line-end="6782">Screen Reader</p>
<pre><code class="has-line-data" data-line-start="6784" data-line-end="6786">
</code></pre>
<p class="has-line-data" data-line-start="6787" data-line-end="6789">Screen Keyboard (show a keyboard on screen)<br>
Visual Alerts (instead Beeps, flash the screen )</p>
<pre><code class="has-line-data" data-line-start="6791" data-line-end="6793">
</code></pre>
<p class="has-line-data" data-line-start="6794" data-line-end="6795">Sticky Keys (Press shift, then press a -&gt; capital A)</p>
<pre><code class="has-line-data" data-line-start="6797" data-line-end="6799">
</code></pre>
<p class="has-line-data" data-line-start="6800" data-line-end="6801">Slow Keys (do not repeat keys after pressing a key for few seconds)</p>
<pre><code class="has-line-data" data-line-start="6803" data-line-end="6805">
</code></pre>
<p class="has-line-data" data-line-start="6806" data-line-end="6808">Bounce Keys (if you hit a key twice fast, it won’t accept the second one)<br>
Mouse Keys (Arrow keys on number path will work as a mouse)</p>
<pre><code class="has-line-data" data-line-start="6810" data-line-end="6812">
</code></pre>
<p class="has-line-data" data-line-start="6813" data-line-end="6815">Simulate Secondary Click (by holding down the click)<br>
Hover click (click by waiting on a button)</p>
<pre><code class="has-line-data" data-line-start="6817" data-line-end="6873">### TTS

Applications like **Orca** or **Emacspeak** can read the dialog boxes to you so you can decide what
the answer only by hearing.


**107.1 - Manage user and group accounts and related system files -** **_5_**

**Objectives**

- Add, modify and remove users and groups.
- Manage user/group info in password/group databases.
- Create and manage special purpose and limited accounts.

**Terms and Utilities**

- /etc/passwd
- /etc/shadow
- /etc/group
- /etc/skel/
- chage
- getent
- groupadd
- groupdel
- groupmod
- passwd
- useradd
- userdel
- usermod

**Changing password**

Each user can change her password using the **passwd** command:

$ **passwd**

Changing password for jadi.

(current) UNIX password:

New password:

Retype new password:

passwd: password updated successfully

If the password is too short or too similar to the previous one or even a dictionary word, the passwd
command may refuse to change it. Also note that the commands asks for the _current password_ first
to make sure that someone is not using your computer to change your password.


The **root** user can change **any users’** password to anything (weak passwords) without
providing their current password:


</code></pre>
<h1 class="code-line" data-line-start=6874 data-line-end=6875 ><a id="passwd_6874"></a>passwd</h1>
<p class="has-line-data" data-line-start="6876" data-line-end="6879">jadi<br>
New<br>
passwor</p>
<pre><code class="has-line-data" data-line-start="6881" data-line-end="6900">d:^

BAD PASSWORD: it does not contain enough DIFFERENT characters

BAD PASSWORD: is too simple
Retype new password:

passwd: password updated successfully
Users and groups

Linux is a multi-user system so you should be able to manage these users. You should be able to
**add** , **remove** and **modify** users.

Linux also has the concept of **groups**. You can define groups, give privileges to them and make
users members of these groups. For example there can be a &quot;printer&quot; group who has access to
printings and you can add user &quot;jadi&quot; to this group.


</code></pre>
<p class="has-line-data" data-line-start="6901" data-line-end="6903">Each user can be a member of many different groups<br>
Each file belongs to one user and one group</p>
<pre><code class="has-line-data" data-line-start="6905" data-line-end="6920">**Managing Users**

**Adding users**

Adding a user is done using the **useradd** command. These are the main switches:

**switch meaning**

- d home directory (-d /home/user)
- m create home directory
- s specify shell
- G add to additional groups


</code></pre>
<p class="has-line-data" data-line-start="6921" data-line-end="6922">comment. most of the time, users actual name. Use quotes if comments has spaces</p>
<pre><code class="has-line-data" data-line-start="6924" data-line-end="6928">- c


</code></pre>
<p class="has-line-data" data-line-start="6929" data-line-end="6930">or special characters in them</p>
<pre><code class="has-line-data" data-line-start="6932" data-line-end="6970">On some systems **useradd** creates the home directory and on some, you have to specify the -m
switch yourself. It is good to use it all the time.

When a new user directory is being created, the system will copy the contents of **/etc/skel** to their
home dir. **/etc/skel** is used as a template for the home of users.


**Modifying users**

It supports most of the **useradd** switches. For example you can change _jadi_ 's login shell by issuing
**usermod -s /bin/csh jadi**. But there are 3 more switches:

**switch meaning**

- L lock this account
- U Unlock the account
- aG add to more groups (say usermod -aG wheel jadi)

Note: If you do usermod -G wheel,users jadi, jadi will be ONLY the member of these two groups.
That is why we use -aG newgoup to ADD a new group to what jadi is a member of. - G is like saying
&quot;jadis groups are ...&quot; and -aG is like &quot;add this group to whatever groups jadi is a member of&quot;.

**Deleting users**

If you want to remove a user, use **userdel** as easy as:

**userdel jadi**

If you add the **- r** switch, the home directory and mail spool will be erased too!


**Managing Groups**

It is kind of same as users, you can do **groupadd** , **groupdel** and **groupmod**. Each group as an **id** and
a **name**.


</code></pre>
<h1 class="code-line" data-line-start=6971 data-line-end=6972 ><a id="groupadd_g_1200_newgroup_6971"></a>groupadd -g 1200 newgroup</h1>
<pre><code class="has-line-data" data-line-start="6974" data-line-end="7029">Adds a group called _newgroup_ with id 1200. If needed, the root user can change a groups ID (to
2000) by issuing groupmod -g 2000 newgroup or deleting the group by groupdel newgroup.

Note: If root deletes a group with members, people wont be deleted! They will just wont be the
members of that group anymore.

**Important files**

**/etc/passwd**

This is the file which contains all the user names and their shells, etc, ..

**tail /etc/passwd**

scard:x:491:489:Smart Card Reader:/var/run/pcscd:/usr/sbin/nologin
sshd:x:493:491:SSH daemon:/var/lib/sshd:/bin/false statd:x:488:65534:NFS
statd daemon:/var/lib/nfs:/sbin/nologin tftp:x:496:493:TFTP
account:/srv/tftpboot:/bin/false lightdm:x:10:14:Light Display
Manager:/var/lib/lightdm:/bin/false wwwrun:x:30:8:WWW daemon
apache:/var/lib/wwwrun:/bin/false
jadi:x:1000:100:jadi:/home/jadi:/bin/bash

svn:x:485:482:user for Apache Subversion svnserve:/srv/svn:/sbin/nologin
privoxy:x:484:480:Daemon user for privoxy:/var/lib/privoxy:/bin/false

As you can see the format is:

username:password:userid:primary group id:Name and comments:home dir:shell


In old days the password or the hashed password was actually shown in this file but
nowadays that is moved to the **/etc/shadow** file.

Note: **/etc/passwd** should be readable to all users so it is not a good place for password! These
days if there is a x instead of password, it means _go look at the /etc/shadow_ file.

Note how _special users_ like lightdm are having /bin/false as their shell; this prevents them from
logging into the system for real.

**/etc/shadow**

This file contains password (hashed passwords) of the users.

See how the **/etc/passwd** is readable for all but **/etc/shadow** is only readable for root and
members of the shadow group:

#^ **ls -ltrh /etc/passwd /etc/shadow**^

- rw-r--r-- 1 root root 1.9K Oct 28 15:47 /etc/passwd
- rw-r----- 1 root shadow 851 Oct 29 19:06 /etc/shadow

But what is in it?


</code></pre>
<h1 class="code-line" data-line-start=7030 data-line-end=7031 ><a id="tail_7030"></a>tail</h1>
<p class="has-line-data" data-line-start="7032" data-line-end="7044">/etc/shadow<br>
scard:!:16369<br>
::::::<br>
sshd:!:16369::<br>
::::<br>
statd:!:16369:<br>
:::::<br>
tftp:!:16369:::<br>
:::<br>
uucp:<em>:16369<br>
::::::<br>
lightdm:</em>:163</p>
<pre><code class="has-line-data" data-line-start="7046" data-line-end="7063">69::::::^

jadi:$6$enk5I3bv$uSQrRpen7m9xDapYLgwgh3P/71OLZUgj31n8AwzgIM2lA5Hc/BmRVAMC0
eswdBGkseuXSvmaz0lsYFtduvuqUo:16737:0:99999:7:::

svn:!:16736::::::

privoxy:!:16736::::::

Note:! means **no password**

Wow! Jadi has an encrypted password there. Some numbers are following that encrypted
password too: **16737:0:99999:7:::**. What do the mean? The following table tells you.



</code></pre>
<p class="has-line-data" data-line-start="7064" data-line-end="7065">filed meaning</p>
<pre><code class="has-line-data" data-line-start="7067" data-line-end="7071">16737When was the last time this password changes


</code></pre>
<p class="has-line-data" data-line-start="7072" data-line-end="7074">0 User wont be able to change the password 0 days after each change<br>
99999After this many days, the user HAVE to change his password</p>
<pre><code class="has-line-data" data-line-start="7076" data-line-end="7078">
</code></pre>
<p class="has-line-data" data-line-start="7079" data-line-end="7080">7 …and the user will be informed 7 days before the expiration to change his password</p>
<pre><code class="has-line-data" data-line-start="7082" data-line-end="7096">Note: there numbers are &quot;days after 1st of January 1970&quot; or the Epoch time in days. For
example 16737 means 16373 days after 1st Jan 1970. Strange but practical!

But we do not need to change these strange number manually. If needed, we can use the **chage**
tool to change these numbers. If you issue the **chage** jadi the system will prompt you for all the
parameters one by one. Also it is possible to use switches to change specific parameters on
command line.

**switch meaning**

- l list information


</code></pre>
<p class="has-line-data" data-line-start="7097" data-line-end="7098">Set the expiration date. Date can be a number, in YYYY-MM-DD format or -1 which</p>
<pre><code class="has-line-data" data-line-start="7100" data-line-end="7104">- E


</code></pre>
<p class="has-line-data" data-line-start="7105" data-line-end="7106">will mean never</p>
<pre><code class="has-line-data" data-line-start="7108" data-line-end="7118"># **chage -l jadi**

Last password change : Oct 29, 2015

Password expires

Password inactive


</code></pre>
<p class="has-line-data" data-line-start="7119" data-line-end="7120">: never</p>
<pre><code class="has-line-data" data-line-start="7122" data-line-end="7124">
</code></pre>
<p class="has-line-data" data-line-start="7125" data-line-end="7126">: never</p>
<pre><code class="has-line-data" data-line-start="7128" data-line-end="7136">Account expires

Minimum number of days between password change

Maximum number of days between password change


</code></pre>
<p class="has-line-data" data-line-start="7137" data-line-end="7138">: never</p>
<pre><code class="has-line-data" data-line-start="7140" data-line-end="7142">
</code></pre>
<p class="has-line-data" data-line-start="7143" data-line-end="7144">: 0</p>
<pre><code class="has-line-data" data-line-start="7146" data-line-end="7234">### : 99999

Number of days of warning before password expires
: 7


**/etc/group**

This file contains the groups and their IDs.

# **tail /etc/group**

avahi:x:486:

kdm:!:485:

mysql:x:484:

winbind:x:483:

at:x:25:

svn:x:482:

vboxusers:x:481:

input:x:1000:jadi

privoxy:x:480:


Note: See that x there? Theoretically groups can have passwords but it is never used in any distro!
The file is **/etc/gshadow**

**Checking user info**

Previously you saw the **chage -l jadi** but there are more commands for checking user status.

One is id:

# **id jadi**
uid=1000(jadi) gid=100(users) groups=1000(input),100(users)

Another solution is **getent** (for **get entry** ). It can query important _databases_ for specific

entries. These databases include /etc/passwd, /etc/hosts, /etc/shadow, /etc/group, ...

funlife:~ # **getent group tor**

tor:x:479:

funlife:~ # **getent passwd jadi**

jadi:x:1000:100:jadi:/home/jadi:/bin/bash

funlife:~ # **getent shadow jadi**

jadi:$6$enk5I3bv$uSQrRpen7m9xDapYLgwgh3P/71OLZUgj31n8AwzgIM2lA5Hc/BmRVAMC0
eswdBGkseuXSvmaz0lsYFtduvuqUo:16737:0:99999:7:::


**107.2 - Automate system administration tasks by scheduling jobs -** **_4_**

**Objectives**

- Manage cron and at jobs.
- Configure user access to cron and at services.
- Configure anacron.

**Terms and Utilities**

- /etc/cron.{d,daily,hourly,monthly,weekly}/
- /etc/at.deny
- /etc/at.allow
- /etc/crontab
- /etc/cron.allow
- /etc/cron.deny
- /var/spool/cron/
- crontab
- at
- atq
- atrm
- anacron
- /etc/anacrontab



</code></pre>
<p class="has-line-data" data-line-start="7235" data-line-end="7236">Crontab format</p>
<pre><code class="has-line-data" data-line-start="7238" data-line-end="7240">
</code></pre>
<p class="has-line-data" data-line-start="7241" data-line-end="7243">Crontab files are responsible to run some commands on specific intervals. Each line has 5 fileds to<br>
specify the run time and whatever after it is considered the command to be run.</p>
<pre><code class="has-line-data" data-line-start="7245" data-line-end="7247">
</code></pre>
<p class="has-line-data" data-line-start="7248" data-line-end="7249">A B C D E command and arguments</p>
<pre><code class="has-line-data" data-line-start="7251" data-line-end="7253">
</code></pre>
<p class="has-line-data" data-line-start="7254" data-line-end="7255">filed Meaning values</p>
<pre><code class="has-line-data" data-line-start="7257" data-line-end="7259">
</code></pre>
<p class="has-line-data" data-line-start="7260" data-line-end="7261">A minute 0 - 59</p>
<pre><code class="has-line-data" data-line-start="7263" data-line-end="7265">
</code></pre>
<p class="has-line-data" data-line-start="7266" data-line-end="7267">B hour 0 - 23</p>
<pre><code class="has-line-data" data-line-start="7269" data-line-end="7271">
</code></pre>
<p class="has-line-data" data-line-start="7272" data-line-end="7273">C day of month 1 - 31</p>
<pre><code class="has-line-data" data-line-start="7275" data-line-end="7277">
</code></pre>
<p class="has-line-data" data-line-start="7278" data-line-end="7279">D month 1 - 12 (or names, see below)</p>
<pre><code class="has-line-data" data-line-start="7281" data-line-end="7283">
</code></pre>
<p class="has-line-data" data-line-start="7284" data-line-end="7285">E day of week 0 - 7 (0 or 7 is Sunday, or use names)</p>
<pre><code class="has-line-data" data-line-start="7287" data-line-end="7289">
</code></pre>
<p class="has-line-data" data-line-start="7290" data-line-end="7292">Each time field can be a * to indicate ANY. Also if you have @reboot or @daily instead of time<br>
fields, the command will be run once after the reboot or daily. Let’s see some examples:</p>
<pre><code class="has-line-data" data-line-start="7294" data-line-end="7296">
</code></pre>
<p class="has-line-data" data-line-start="7297" data-line-end="7298">5 0 * * * $HOME/bin/daily.job &gt;&gt; $HOME/tmp/out 2&gt;&amp;1</p>
<pre><code class="has-line-data" data-line-start="7300" data-line-end="7302">
</code></pre>
<h1 class="code-line" data-line-start=7303 data-line-end=7304 ><a id="run_at_215pm_on_the_first_of_every_month__output_mailed_to_paul_7303"></a>run at 2:15pm on the first of every month – output mailed to paul</h1>
<pre><code class="has-line-data" data-line-start="7306" data-line-end="7312">15 14 1 * * $HOME/bin/monthly^

#^ run at 10 pm on weekdays, annoy Joe^


</code></pre>
<p class="has-line-data" data-line-start="7313" data-line-end="7314">0 22 * * 1- 5 mail -s “It’s 10pm” joe%Joe,%%Where are your kids?%</p>
<pre><code class="has-line-data" data-line-start="7316" data-line-end="7318">
</code></pre>
<p class="has-line-data" data-line-start="7319" data-line-end="7320">23 0-23/2 * * * echo “run 23 minutes after midn, 2am, 4am …, everyday”</p>
<pre><code class="has-line-data" data-line-start="7322" data-line-end="7324">
</code></pre>
<p class="has-line-data" data-line-start="7325" data-line-end="7326">5 4 * * sun echo “run at 5 after 4 every sunday”</p>
<pre><code class="has-line-data" data-line-start="7328" data-line-end="7405">*/5**** echo &quot;each 5 mintues&quot;

42 8,18 * * 1- 5 echo &quot;8:42 and 18:42 and only on weekdays (monday till friday)&quot;

@reboot echo &quot;runs after the reboot&quot;

Note: be careful about using a * on the first filed. That will run your cron on every minute!

Note: Use with care. Something like 42 8 1 1 0 runs ONLY IF 1st Of Jan is a Monday! When
a cron runs, the output will be emailed to the owner of the cron.


**User specific crons**

**Cron** is a linux service. To see your crons you can use **crontab -l** (list) and for editing it you can
use **crontab -e** (edit) which will open the cron files with a special editor and will load your
inserted crons (if they are correct) after wards.

The files will be saved at **/var/spool/cron/tabs/** or **`/var/spool/crontabs'** :

#^ **cat /var/spool/cron/tabs/jadi**^

#^ DO NOT EDIT THIS FILE -^ edit the master and reinstall.^

#^ (/tmp/crontab.khObLu installed on Thu Oct 29 22:04:43 2015)^

#^ (Cronie version 4.2)^

* * * * * date &gt;&gt; /tmp/date.cron.txt

You should never edit these files directly; Use crontab -e instead.

**At**

We say that **crontab** runs commands on specific intervals but what will happen if you
needed to run a command only once? Here at is your friend. $ **at now + 1 min**

warning: commands will be executed using /bin/sh

at&gt; touch /tmp/at

at&gt; &lt;EOT&gt;

job 3 at Thu Oct 29 22:12:00 2015

Note: As always, at the end of input we press Ctrl+D

If you want to check what is in the queue you can use **atq** and then try **atrm** 4 to delete job
number 4;

$ **at teatime**


warning: commands will be executed using /bin/sh at&gt;
echo &quot;tea time is 4pm&quot; at&gt; &lt;EOT&gt;

job 4 at Fri Oct 30 16:00:00 2015

jadi@funlife:~$ **at tomorrow**

warning: commands will be executed using /bin/sh at&gt;
echo &quot;tomorrow this time&quot; at&gt; &lt;EOT&gt;

job 5 at Fri Oct 30 22:15:00 2015

jadi@funlife:~$ at 17:30

warning: commands will be executed using /bin/sh at&gt;
echo &quot;this is the first 17:30&quot; at&gt; &lt;EOT&gt;

job 6 at Fri Oct 30 17:30:00 2015


jadi@funlife:~$ **atq**


</code></pre>
<p class="has-line-data" data-line-start="7406" data-line-end="7407">5 Fri Oct 30 22:15:00 2015 a jadi</p>
<pre><code class="has-line-data" data-line-start="7409" data-line-end="7411">
</code></pre>
<p class="has-line-data" data-line-start="7412" data-line-end="7413">4 Fri Oct 30 16:00:00 2015 a jadi</p>
<pre><code class="has-line-data" data-line-start="7415" data-line-end="7417">
</code></pre>
<p class="has-line-data" data-line-start="7418" data-line-end="7420">6 Fri Oct 30 17:30:00 2015 a jadi<br>
jadi@funlife:~$ atrm 4</p>
<pre><code class="has-line-data" data-line-start="7422" data-line-end="7428">jadi@funlife:~$ **atq**^

5 Fri Oct 30 22:15:00 2015 a jadi^


</code></pre>
<p class="has-line-data" data-line-start="7429" data-line-end="7430">6 Fri Oct 30 17:30:00 2015 a jadi</p>
<pre><code class="has-line-data" data-line-start="7432" data-line-end="7444">**System wide cron**

There is file called **/etc/crontab**. This looks like a normal user file opened with **crontab -e** but has
one extra filed:

A B C D E USER command and arguments

This file should be edited with an editor directly and we can mention which user runs these
commands.


</code></pre>
<h1 class="code-line" data-line-start=7445 data-line-end=7446 ><a id="cat_etccrontab_SHELLbinsh_7445"></a>cat /etc/crontab SHELL=/bin/sh</h1>
<p class="has-line-data" data-line-start="7447" data-line-end="7449">PATH=/usr/bin:/usr/sbin:/sbin:/bin:/usr/lib/news/<br>
bin MAILTO=root</p>
<pre><code class="has-line-data" data-line-start="7451" data-line-end="7528">### #

#^ check scripts in cron.hourly, cron.daily, cron.weekly, and cron.monthly^

#^

- */15 * * * * root test -x /usr/lib/cron/run-crons &amp;&amp; /usr/lib/cron/run-crons &gt;/dev/null 2&gt;&amp;1

Note: Have a look at first two line. It configures the shell which will run the commands and the
PATH variable plus who will get the output emails.

As you can see this default crontab runs other crons! They are hourly, daily, weekly and
monthly crons.


**System hourly, daliy, weekly, monthly, .. crons**

We have some system level crontab files in **/etc/cron.d/** too. In other words, whatever file which is
copied there, will be treated just like /etc/crontab file (a system wide cron file). This make systems
much cleaner and lets programs to copy one file there instead of editing the /etc/crontab.

$ **sudo tree /etc/cron***

root's password:

/etc/cron.d

└── mdadm

/etc/cron.daily

├── google-chrome

├── mdadm

├── mlocate.cron

├── packagekit-background.cron

├── suse-clean_catman

├── suse.de-backup-rc.config

├── suse.de-backup-rpmdb

├── suse.de-check-battery

├── suse.de-cron-local

├── suse.de-snapper

└── suse-do_mandb

/etc/cron.deny [error opening dir]

/etc/cron.hourly

└── suse.de-snapper


/etc/cron.monthly

/etc/crontab [error opening dir]

/etc/cron.weekly


Let’s have a look at one of the **cron.d** files:

$ **cat /etc/cron.d/mdadm**

### #

#^ cron.d/mdadm -^ regular redundancy checks^


</code></pre>
<h1 class="code-line" data-line-start=7529 data-line-end=7530 ><a id="_7529"></a></h1>
<pre><code class="has-line-data" data-line-start="7532" data-line-end="7536">#^ Start checking each month early in the morning.^


</code></pre>
<h1 class="code-line" data-line-start=7537 data-line-end=7538 ><a id="Continue_each_day_until_all_done_7537"></a>Continue each day until all done</h1>
<pre><code class="has-line-data" data-line-start="7540" data-line-end="7548">PATH=/sbin:/usr/sbin:/bin:/usr/bin

0 1 * * 0 root source /etc/sysconfig/mdadm; [ -n &quot;$MDADM_CHECK_DURATION&quot; -a -x
/usr/share/mdadm/mdcheck -a $(date +\%d) -le 7 ] &amp;&amp; /usr/share/mdadm/mdcheck --
duration &quot;$MDADM_CHECK_DURATION&quot;


</code></pre>
<p class="has-line-data" data-line-start="7549" data-line-end="7551">0 1 * * 1-6 root source /etc/sysconfig/mdadm; [ -n “$MDADM_CHECK_DURATION” -a -x<br>
/usr/share/mdadm/mdcheck ] &amp;&amp; /usr/share/mdadm/mdcheck --continue --duration</p>
<pre><code class="has-line-data" data-line-start="7553" data-line-end="7592">&quot;$MDADM_CHECK_DURATION&quot;^

But /etc/cron.hourly, /etc/cron.daily, /etc/cron.weekly, /etc/cron.monthly is **TOTALLY
DIFFERENT**. In these directories are actual executable scripts and files. The cron will run these
files one a hour, one a day, once a week or once a month based on their directory names.

**anacron**

The difference between **cron** and **anacron** , is this:

If the system is down when the cron should run a task, that cron job won’t run till the next
occurrence! But anacron creates the timestamp each time a **daily** , **weekly** or **monthly** job runs. If
the system **boots up** and find outs that one of the anacron jobs are missed, it will run it during the
boot!

As you can see **anacron** is useful for important tasks. If you need to take a backup once a week it
is better to use anacron instead of cron; or feeding your dog once a day using cron may lead to it
staying hungry for a day if the system is down when he should be fed.

Note: anacron checks the timestamps at BOOT TIME and do not handle hourly crons.


**Controlling access using files**

You have already seen files at **/var/spool/cron/tabs/USERNAME**. There are also 4 more files to
control who can and cannot use cron and at. The files are:

/etc/cron.allow

/etc/cron.deny

/etc/at.allow

/etc/at.deny

In most systems none of these files exist but if you create them, they will become active as follow:


</code></pre>
<p class="has-line-data" data-line-start="7593" data-line-end="7596">file<br>
functionality<br>
extension</p>
<pre><code class="has-line-data" data-line-start="7598" data-line-end="7600">
</code></pre>
<p class="has-line-data" data-line-start="7601" data-line-end="7604">ONLY users mentioned in this file are allowed to run this service. All other<br>
.allow<br>
users will be denied</p>
<pre><code class="has-line-data" data-line-start="7606" data-line-end="7608">
</code></pre>
<p class="has-line-data" data-line-start="7609" data-line-end="7610">.deny Everybody can use the service except the users mentioned in this file</p>
<pre><code class="has-line-data" data-line-start="7612" data-line-end="7689">**107.3 Localization and internationalization** **_- 3_**

**Objectives**

- Configure locale settings and environment variables.
- Configure timezone settings and environment variables.

**Terms and Utilities**

- /etc/timezone
- /etc/localtime
- /usr/share/zoneinfo/
- LC_*
- LC_ALL
- LANG
- TZ
- /usr/bin/locale
- tzselect
- timedatectl
- date
- iconv
- UTF- 8
- ISO- 8859
- ASCII
- Unicode

**Time zone**

On linux systems you can use **date** and **cal** commands to check the **date** and the **calendar**.

It is possible to print a custom date using + formatter:

[jadi@funlife ~]$ **date +'%Y%m%d-%M'**

### 20160103 - 39

[jadi@funlife ~]$ **date +'%Y%m%d-%H%M'**

### 20160103 - 2239


Time zones determines what your time difference is comparing with a reference time zone. This way
you can talk about times regardless from your location. In another words, I can tell you &quot;start the
change request at 02:30 UTC&quot; we both know when the change will be started in our own time zone
(mine is 02:30 minus 3:30).

You can configure your time zone while installing the system or by using a GUI in the system
settings. It is even possible to set the time zone by clicking or right-clicking on the date and time on
your panel. But as always there is a command line way. The old one used to be tzconfig but it is not
used anymore.

Different distros do have their own configuration commands, a general one is:

**tzselect**

Please identify a location so that time zone rules can be set correctly.

Please select a continent, ocean, &quot;coord&quot;, or &quot;TZ&quot;.

1)^ Africa^

2)^ Americas^

3)^ Antarctica^

4)^ Arctic Ocean^

5)^ Asia^

6)^ Atlantic Ocean^

7)^ Australia^

8)^ Europe^


</code></pre>
<ol start="9">
<li class="has-line-data" data-line-start="7690" data-line-end="7694">Indian<br>
Ocean 10)<br>
Pacific</li>
</ol>
<pre><code class="has-line-data" data-line-start="7695" data-line-end="7879">Ocean^

11) coord - I want to use geographical coordinates.

12) TZ - I want to specify the time zone using the Posix TZ format.

This process will suggest you to set a variable called **TZ** as follow to set _your own_ time zone, but not
the systems:

**TZ='Asia/Tehran'; export TZ**


**Configuring time zone**

There is a directory at **/usr/share/zoneinfo/** containing all the time zone info. These are binary
files. If you need to change your systems time zone you need to change 2 files: **cat
/etc/timezone**

Asia/Tehran

And there is a short link at this place:

#^ **ls -ltrh /etc/localtime**^

- rw-r--r-- 1 root root 1.7K Jan 2 18:10 /etc/localtime

This file should be replaced by the correct file from /usr/share/zoneinfo/. It is nicer to make a
symbolic link rather than copying the actual file. This will prevent the conflicts during next upgrades.


**Configuring Languages**

You can check the status of current selected system language by issuing **locale** :

$ **locale**

LANG=en_US.UTF- 8

### LANGUAGE=

LC_CTYPE=&quot;en_US.UTF-8&quot;

LC_NUMERIC=&quot;en_US.UTF-8&quot;

LC_TIME=&quot;en_US.UTF-8&quot;

LC_COLLATE=&quot;en_US.UTF-8&quot;

LC_MONETARY=&quot;en_US.UTF-8&quot;

LC_MESSAGES=&quot;en_US.UTF-8&quot;

LC_PAPER=&quot;en_US.UTF-8&quot;

LC_NAME=&quot;en_US.UTF-8&quot;

LC_ADDRESS=&quot;en_US.UTF-8&quot;

LC_TELEPHONE=&quot;en_US.UTF-8&quot;

LC_MEASUREMENT=&quot;en_US.UTF-8&quot;

LC_IDENTIFICATION=&quot;en_US.UTF-8&quot;

### LC_ALL=

These are all environment variables telling system what languages to use. Here I'm using

LANG=en_US.UTF-8 which means I'm using English with US variant and UTF-8 encoding.

UTF-8 and other encodings will be discussed a bit later in this chapter


Other variables tell the system how to show different things based on localization systems. For
example, if we change the LC_TIME to &quot;en_GB.UTF-8&quot; the time will be printed in Great Britain format
from that moment on.

Another important settings is LC_ALL. It can be used to change **ALL** settings. If you do a export
LC_ALL=fa_IR.UTF-8, all the settings will be set to that one, with no exception. It is always
possible to unset LC_ALL.

### LANG=C

Another important point to know is the LANG=C settings. This indicates two things:

1.^ All language settings will be default (en.US)^
    2. Binary sort order

It is also possible to do a LC_ALL=C.


**Changing or adding locales**

This is **not a part of LPIC exam** but it is good to know that on a debian based machine, you can
change, add or set your default _locales_ using dpkg-reconfigure locales.

**Character Encoding**

### ACSII

Computers used to work with 7bit characters encoding. That would give us 128 characters which
was enough for numbers, punctuation and digits!

### ISO- 8859

It had more characters and a lots of sets for Thai, Arabic and other languages but still had ASCII
character sets.

### UTF- 8

The Unicode Transformation Format is the newest encoding method. It is a real universal encoding
with characters not only for all written languages but also for fun characters like ¾, ♠, π and ⚤. It is
backward compatible with the ASCII and uses 8 bit code units ( **not 8 bit coding!** ). In most cases it is a
good idea to use UTF-8 and be sure that your system will work in practically all cases.



Above table shows how UTF8 is the leader compared with ASCII and ISO-8859.

**iconv**

If you needed to convert coding to each other, the command is **iconv**. The -l switch will show
you all the available codings:

**iconv -f WINDOWS- 1258 - t UTF- 8 /tmp/myfile.txt**

Note: -f is for &quot;from&quot; and -t is for &quot;to&quot;. Easy to remember


**108.1 - Maintain system time -** **_3_**

**Objectives**

- Set the system date and time.
- Set the hardware clock to the correct time in UTC.
- Configure the correct timezone.
- Basic NTP configuration.
- Knowledge of using the pool.ntp.org service.
- Awareness of the ntpq command.

**Terms and Utilities**

- /usr/share/zoneinfo/
- /etc/timezone
- /etc/localtime
- /etc/ntp.conf
- date
- hwclock
- ntpd
- ntpdate
- pool.ntp.org

**How a computer keeps its time**

There is a clock in your computer; a hardware clock on your motherboard! It has its own battery
and keeps the time even when the computer is off. When the system boots, the OS reads this
**hardware time** and it sets its **system time** to the hardware clock and uses it from there on.

Hardware clock can be the **localtime** (your computers timezone) or **UTC time** (standard time).
You can check this **by /etc/adjtime** :

$ **cat /etc/adjtime**

### 0.000000 1451741899 0.000000

### 1451741899

### UTC


As you can see in my computer the time is set on UTC so the computers add my timezone

difference each time it boots up to the hardware clock. The hwclock can be used to show

the time based on the hwtime. See how it works based on the hardware time even after we

DO CHANGE the system time:

root@funlife:~# **date**

Mon Jan 4 22:01:18 IRST 2016


</code></pre>
<h1 class="code-line" data-line-start=7880 data-line-end=7881 ><a id="date_s_Jan_4_222222_7880"></a>date -s &quot;Jan 4 22:22:22</h1>
<p class="has-line-data" data-line-start="7882" data-line-end="7884">2016&quot; Mon Jan 4 22:22:22<br>
IRST 2016</p>
<pre><code class="has-line-data" data-line-start="7886" data-line-end="7901">root@funlife:~# **date**^

Mon Jan 4 22:02:18 IRST 2016
root@funlife:~# **hwclock**

Mon 04 Jan 2016 10:02:21 PM IRST .108596 seconds

Even when the hardware clock is set on UTC, hwclock date shows the date in the localtime (time
after adding the timezone to the UTC time)

Older OSs used to set the hardware clock on localtime zone instead of timezone. This can be achived
by:


</code></pre>
<h1 class="code-line" data-line-start=7902 data-line-end=7903 ><a id="hwclock_localtime_set_date01052015_7902"></a>hwclock --localtime --set --date=&quot;01/05/2015</h1>
<p class="has-line-data" data-line-start="7904" data-line-end="7905">22:04:00&quot; If you want to fix it, just issue:</p>
<pre><code class="has-line-data" data-line-start="7907" data-line-end="7942">#^ **hwclock -u -w**^

In this command -u tell the hardware clock that this is a UTC time and -w tells &quot;sync with
systemtime&quot;.


### NTP

**Network Time Protocol** is my favourite protocol. It is one of the coolest protocols ever if you dive
into its details. But unfortunately for LPIC1 you do not need to go into NTP depths. This protocol
uses **NTP servers** to find out the accurate time shown by best atomic clocks on this planet. One of
the most famous severs used by ntp people is **pool.ntp.org**. If you check that website you will see
that it is a **pool** of ntp servers and by giving your NTP server the pool.ntp.org, it will be redirected to
one of the many ntp servers available on that pool.

**ntpdate**

The most straight forward command to set the **systemclock** is **ntpdate** and used like this:

#^ **ntpdate pool.ntp.org**^

4 Jan 22:15:02 ntpdate[18708]: adjust time server 194.225.150.25 offset -0.006527 sec

Then, we need to set the **hwclock** to the just corrected system time by **sudo hwclock -w**.

**ntpd**

Instead of manually setting the time each time, you can use a linux service called **ntp** to keep
your time using some time servers (the most famous one is pool.ntp.org). Install the ntp and start
the server:

#^ **apt install ntp**^


</code></pre>
<h1 class="code-line" data-line-start=7943 data-line-end=7944 ><a id="systemctl_start_ntp_7943"></a>systemctl start ntp</h1>
<pre><code class="has-line-data" data-line-start="7946" data-line-end="7952">Fun fact? You cannot use both! Look at this:

root@funlife:~# **ntpdate pool.ntp.org**


</code></pre>
<p class="has-line-data" data-line-start="7953" data-line-end="7954">4 Jan 22:14:25 ntpdate[18670]: the NTP socket is in use, exiting</p>
<pre><code class="has-line-data" data-line-start="7956" data-line-end="7965">As you can see, now the **ntp** is using the NTP port and **ntpdate** has problems starting up.


Main configuration file of ntp is located at **/etc/ntp.conf** :

#^ **cat /etc/ntp.conf**^


</code></pre>
<h1 class="code-line" data-line-start=7966 data-line-end=7967 ><a id="etcntpconf_configuration_for_ntpd_see_ntpconf5_for_help_7966"></a>/etc/ntp.conf, configuration for ntpd; see ntp.conf(5) for help</h1>
<pre><code class="has-line-data" data-line-start="7969" data-line-end="7973">driftfile /var/lib/ntp/ntp.drift


</code></pre>
<h1 class="code-line" data-line-start=7974 data-line-end=7975 ><a id="Enable_this_if_you_want_statistics_to_be_7974"></a>Enable this if you want statistics to be</h1>
<p class="has-line-data" data-line-start="7976" data-line-end="7977">logged. #statsdir /var/log/ntpstats/</p>
<pre><code class="has-line-data" data-line-start="7979" data-line-end="7987">statistics loopstats peerstats clockstats filegen
loopstats file loopstats type day enable filegen
peerstats file peerstats type day enable filegen
clockstats file clockstats type day enable



</code></pre>
<h1 class="code-line" data-line-start=7988 data-line-end=7989 ><a id="You_do_need_to_talk_to_an_NTP_server_or_two_or_7988"></a>You do need to talk to an NTP server or two (or</h1>
<p class="has-line-data" data-line-start="7990" data-line-end="7991">three). #server ntp.your-provider.example</p>
<pre><code class="has-line-data" data-line-start="7993" data-line-end="8021">#^ pool.ntp.org maps to about 1000 low-stratum NTP servers. Your server will^

#^ pick a different set every time it starts up. Please consider joining the^

#^ pool: &lt;http://www.pool.ntp.org/join.html&gt;^

pool 0.debian.pool.ntp.org iburst

pool 1.debian.pool.ntp.org iburst

pool 2.debian.pool.ntp.org iburst

pool 3.debian.pool.ntp.org iburst

#^ Access control configuration; see /usr/share/doc/ntp-doc/html/accopt.html for^

#^ details. The web page &lt;http://support.ntp.org/bin/view/Support/AccessRestrictions&gt;^

#^ might also be helpful.^

#

#^ Note that &quot;restrict&quot; applies to both servers and clients, so a configuration^

#^ that might be intended to block requests from certain clients could also end^


</code></pre>
<h1 class="code-line" data-line-start=8022 data-line-end=8023 ><a id="up_blocking_replies_from_your_own_upstream_servers_8022"></a>up blocking replies from your own upstream servers.</h1>
<pre><code class="has-line-data" data-line-start="8025" data-line-end="8027">
</code></pre>
<h1 class="code-line" data-line-start=8028 data-line-end=8029 ><a id="By_default_exchange_time_with_everybody_but_dont_allow_configuration_8028"></a>By default, exchange time with everybody, but don’t allow configuration.</h1>
<pre><code class="has-line-data" data-line-start="8031" data-line-end="8043">restrict -4 default kod notrap nomodify nopeer noquery limited^

restrict -6 default kod notrap nomodify nopeer noquery limited

#^ Local users may interrogate^ the ntp server more closely.^

restrict 127.0.0.1

restrict ::1


</code></pre>
<h1 class="code-line" data-line-start=8044 data-line-end=8045 ><a id="Needed_for_adding_pool_entries_8044"></a>Needed for adding pool entries</h1>
<p class="has-line-data" data-line-start="8046" data-line-end="8048">restrict source notrap nomodify<br>
noquery</p>
<pre><code class="has-line-data" data-line-start="8050" data-line-end="8067">#^ Clients from this (example!) subnet have unlimited access, but only if^


#^ cryptographically authenticated.^

#restrict 192.168.123.0 mask 255.255.255.0 notrust

#^ If you want to provide time to your local subnet, change the next line.^

#^ (Again, the address is an example only.)^

#broadcast 192.168.123.255

#^ If you want to listen to time broadcasts on your local subnet, de-comment the^


</code></pre>
<h1 class="code-line" data-line-start=8068 data-line-end=8069 ><a id="next_lines_Please_do_this_only_if_you_trust_everybody_on_the_network_8068"></a>next lines. Please do this only if you trust everybody on the network!</h1>
<pre><code class="has-line-data" data-line-start="8071" data-line-end="8088">#disable auth^

#broadcastclient

If needed, you can change the ntp servers to the ntp servers you want to use.

Review the configuration and you will see cool things like giving the ntp service to other
computers although you do not need it for passing LPIC.


**ntpq**

The **ntpq** queries the ntp service. One famous switch is **- p** (for Print) that shows the pool we are
using to sync the clock:


</code></pre>
<p class="has-line-data" data-line-start="8089" data-line-end="8090">ntpq -p</p>
<pre><code class="has-line-data" data-line-start="8092" data-line-end="8094">
</code></pre>
<p class="has-line-data" data-line-start="8095" data-line-end="8096">remote refid st t when poll reach delay offset jitter</p>
<pre><code class="has-line-data" data-line-start="8098" data-line-end="8102">### =========================================================================== ===


</code></pre>
<p class="has-line-data" data-line-start="8103" data-line-end="8104">0.debian.pool.n .POOL. 16 p - 64 0 0.000 0.000 0.000</p>
<pre><code class="has-line-data" data-line-start="8106" data-line-end="8108">
</code></pre>
<p class="has-line-data" data-line-start="8109" data-line-end="8110">1.debian.pool.n .POOL. 16 p - 64 0 0.000 0.000 0.000</p>
<pre><code class="has-line-data" data-line-start="8112" data-line-end="8114">
</code></pre>
<p class="has-line-data" data-line-start="8115" data-line-end="8116">2.debian.pool.n .POOL. 16 p - 64 0 0.000 0.000 0.000</p>
<pre><code class="has-line-data" data-line-start="8118" data-line-end="8120">
</code></pre>
<p class="has-line-data" data-line-start="8121" data-line-end="8122">3.debian.pool.n .POOL. 16 p - 64 0 0.000 0.000 0.000</p>
<pre><code class="has-line-data" data-line-start="8124" data-line-end="8136">+46.209.14.1 192.168.5.2 4 u 7 64 1 58.300 - 15.546 14.519

- ntp.tums.ac.ir 195.161.115.4 4 u 4 64 1 30.636 2.485 4.025

*194.225.150.25 194.190.168.1 2 u 5 64 1 31.478 -3.870 95.635

+5.160.24.41 192.168.5.2 4 u 3 64 1 90.000 - 28.328 21.643

In this output:


</code></pre>
<ul>
<li class="has-line-data" data-line-start="8137" data-line-end="8140">means that the ntp is using this server as the main<br>
reference, + means that this is a good server,</li>
</ul>
<pre><code class="has-line-data" data-line-start="8141" data-line-end="8179">**-** shows an out of range server which will be neglected.


**108.2 - System logging -** **_4_**

**Objectives**

- Configuration of the syslog daemon.
- Understanding of standard facilities, priorities and actions.
- Configuration of logrotate.
- Awareness of rsyslog and syslog-ng.

**Terms and Utilities**

- syslog.conf
- syslogd
- klogd
- /var/log/
- logger
- logrotate
- /etc/logrotate.conf
- /etc/logrotate.d/
- journalctl
- /etc/systemd/journald.conf
- /var/log/journal/

**History**

The Linux logging system is under heavy changes. We will cover the **syslog** but most system have
replaced it with **rsyslog** and **systemd journal** s. The strange thing is the fact that **systemd journal**
uses a binary file format which is not that common in Linux world.

The logging in linux is orginized based on three concepts: **facilities** , **priorities** and **actions**. When a
program generated a log, it tags or labels that log with a facility (like mail) which says what this log is
and a priority (like alert). Each tag can have values like the following list:


</code></pre>
<p class="has-line-data" data-line-start="8180" data-line-end="8181">Facilities : auth, user, kern, cron, daemon, mail, user, local1, local2, …</p>
<pre><code class="has-line-data" data-line-start="8183" data-line-end="8185">
</code></pre>
<p class="has-line-data" data-line-start="8186" data-line-end="8187">Priorities : emerg/panic, alert, crit, err/error, warn/warning, notice, info, debug</p>
<pre><code class="has-line-data" data-line-start="8189" data-line-end="8197">As you can guess, the **facilities** work like categories and priorities indicate how important this log
is - or in more technical language indicated logs level.


On the **action** part we can have things like these:


</code></pre>
<p class="has-line-data" data-line-start="8198" data-line-end="8199">action sample meaning</p>
<pre><code class="has-line-data" data-line-start="8201" data-line-end="8203">
</code></pre>
<p class="has-line-data" data-line-start="8204" data-line-end="8205">filename /usr/log/logins.log will write the log to this file</p>
<pre><code class="has-line-data" data-line-start="8207" data-line-end="8209">
</code></pre>
<p class="has-line-data" data-line-start="8210" data-line-end="8211">username jadi will notify that person on the screen</p>
<pre><code class="has-line-data" data-line-start="8213" data-line-end="8215">
</code></pre>
<p class="has-line-data" data-line-start="8216" data-line-end="8217">@ip @192.168.1.100</p>
<pre><code class="has-line-data" data-line-start="8219" data-line-end="8221">
</code></pre>
<p class="has-line-data" data-line-start="8222" data-line-end="8223">will send this log to this log server and that log server will decide what</p>
<pre><code class="has-line-data" data-line-start="8225" data-line-end="8227">
</code></pre>
<p class="has-line-data" data-line-start="8228" data-line-end="8229">its configs</p>
<pre><code class="has-line-data" data-line-start="8231" data-line-end="8252">So a line like this will show the kernel panics to a remote log server and also will log
everything on every level to a log file:

kern.panic @192.168.1.100

*.* /var/log/messages

If you log some specific priority, all the **more important** things will be logged too! So if you write
**cron.notice /var/log/cron/log** , you are logging the emerg/panic, alert, critical, error, warning and
notice logs of the cron category too.

If you need to log ONLY one specific level, add an equal sign (=) before the priority like this
local3.=alert /var/log/user.alert.log.

It is important to know that the binary which logs the * _kern_ category is a standalone daemon. This
daemon is called klogd and uses same configuration files. Why? so even after everything is
crashed, klogd can log the kernel crashes ;)



</code></pre>
<p class="has-line-data" data-line-start="8253" data-line-end="8254">Syslog and Rsyslog</p>
<pre><code class="has-line-data" data-line-start="8256" data-line-end="8258">
</code></pre>
<p class="has-line-data" data-line-start="8259" data-line-end="8261">Most modern system use rsyslog instead of syslog. Their functionality is mostly same and here we<br>
will only cover the rsyslog.</p>
<pre><code class="has-line-data" data-line-start="8263" data-line-end="8265">
</code></pre>
<p class="has-line-data" data-line-start="8266" data-line-end="8268">The main configuration file in rsyslog , as you should be able to guess is /etc/syslog.conf. It loads<br>
some modules on the top and then have lines like this:</p>
<pre><code class="has-line-data" data-line-start="8270" data-line-end="8272">
</code></pre>
<p class="has-line-data" data-line-start="8273" data-line-end="8274">auth,authpriv.* /var/log/auth.log</p>
<pre><code class="has-line-data" data-line-start="8276" data-line-end="8278">
</code></pre>
<p class="has-line-data" data-line-start="8279" data-line-end="8280"><em>.</em>;auth,authpriv.none - /var/log/syslog</p>
<pre><code class="has-line-data" data-line-start="8282" data-line-end="8284">
</code></pre>
<p class="has-line-data" data-line-start="8285" data-line-end="8286">#cron.* /var/log/cron.log</p>
<pre><code class="has-line-data" data-line-start="8288" data-line-end="8290">
</code></pre>
<p class="has-line-data" data-line-start="8291" data-line-end="8292">daemon.* - /var/log/daemon.log</p>
<pre><code class="has-line-data" data-line-start="8294" data-line-end="8296">
</code></pre>
<p class="has-line-data" data-line-start="8297" data-line-end="8298">kern.* - /var/log/kern.log</p>
<pre><code class="has-line-data" data-line-start="8300" data-line-end="8302">
</code></pre>
<p class="has-line-data" data-line-start="8303" data-line-end="8304">lpr.* - /var/log/lpr.log</p>
<pre><code class="has-line-data" data-line-start="8306" data-line-end="8308">
</code></pre>
<p class="has-line-data" data-line-start="8309" data-line-end="8310">mail.* - /var/log/mail.log</p>
<pre><code class="has-line-data" data-line-start="8312" data-line-end="8314">
</code></pre>
<p class="has-line-data" data-line-start="8315" data-line-end="8316">user.* - /var/log/user.log</p>
<pre><code class="has-line-data" data-line-start="8318" data-line-end="8320">
</code></pre>
<p class="has-line-data" data-line-start="8321" data-line-end="8322">‘auth,authpriv.*’ means both auth and authpriv properties</p>
<pre><code class="has-line-data" data-line-start="8324" data-line-end="8326">
</code></pre>
<p class="has-line-data" data-line-start="8327" data-line-end="8329">Note that sometimes on the action we have a -. This means the log will go the memory cache<br>
to prevent disk from spinning all the time.</p>
<pre><code class="has-line-data" data-line-start="8331" data-line-end="8333">
</code></pre>
<p class="has-line-data" data-line-start="8334" data-line-end="8336">Again there is a /etc/rsyslog.d/ and it is better for different software and admins to add their<br>
specific configs there, instead of editing the main configuration file.</p>
<pre><code class="has-line-data" data-line-start="8338" data-line-end="8340">
</code></pre>
<p class="has-line-data" data-line-start="8341" data-line-end="8342">Creating rsyslog listener</p>
<pre><code class="has-line-data" data-line-start="8344" data-line-end="8346">
</code></pre>
<p class="has-line-data" data-line-start="8347" data-line-end="8348">If you need to start a rsylog listener and catch other systems log messages, it is enough to add an</p>
<pre><code class="has-line-data" data-line-start="8350" data-line-end="8354">- r switch to rsyslog options. Just edit the /etc/default/rsyslog and change options from &quot;&quot; to &quot;-r&quot;.


</code></pre>
<p class="has-line-data" data-line-start="8355" data-line-end="8356">cat /etc/default/rsyslog</p>
<pre><code class="has-line-data" data-line-start="8358" data-line-end="8366">#^ Options for rsyslogd^

#^ - x disables DNS lookups for remote messages^

#^ See rsyslogd(8) for more details^


</code></pre>
<p class="has-line-data" data-line-start="8367" data-line-end="8368">RSYSLOGD_OPTIONS=&quot;-r&quot;</p>
<pre><code class="has-line-data" data-line-start="8370" data-line-end="8372">
</code></pre>
<p class="has-line-data" data-line-start="8373" data-line-end="8374">And restart the daemon:</p>
<pre><code class="has-line-data" data-line-start="8376" data-line-end="8378">
</code></pre>
<h1 class="code-line" data-line-start=8379 data-line-end=8380 ><a id="systemctl_restart_rsyslog_8379"></a>systemctl restart rsyslog</h1>
<pre><code class="has-line-data" data-line-start="8382" data-line-end="8396">**Journalctl**

The newer distributions are switching to **systemd** and are using **systemd journal** for their logging.
As I mentioned earlier the systemd keeps its logs as binary files and the user should use the
**journalctl** to access them.

#^ **journalctl**^

-- Logs begin at Sun 2016- 01 - 03 10:35:53 IRST, end at Tue 2016- 01 - 05 22:34:06 IRST. -- Jan 03
10:35:53 funlife systemd-journald[184]: Runtime journal (/run/log/journal/) is currently using
8.0M.


</code></pre>
<p class="has-line-data" data-line-start="8397" data-line-end="8398">Maximum allowed usage is set to 238.1M.</p>
<pre><code class="has-line-data" data-line-start="8400" data-line-end="8402">
</code></pre>
<p class="has-line-data" data-line-start="8403" data-line-end="8404">Leaving at least 357.2M free (of currently available 2.3G of space).</p>
<pre><code class="has-line-data" data-line-start="8406" data-line-end="8408">
</code></pre>
<p class="has-line-data" data-line-start="8409" data-line-end="8410">Enforced usage limit is thus 238.1M, of which 230.1M are still</p>
<pre><code class="has-line-data" data-line-start="8412" data-line-end="8457">available.

Jan 03 10:35:53 funlife kernel: Initializing cgroup subsys cpuset

Jan 03 10:35:53 funlife kernel: Initializing cgroup subsys cpu

Jan 03 10:35:53 funlife kernel: Initializing cgroup subsys cpuacct

Jan 03 10:35:53 funlife kernel: Linux version 4.3.0- 1 - amd64 (debian-kernel@lists.debian.org) (gcc
version 5.3.1 20151207 (Debian 5.3.1-3) ) #1 SMP Debian 4.3.3-2 (2015-

Jan 03 10:35:53 funlife kernel: Command line: BOOT_IMAGE=/boot/vmlinuz-4.3.0- 1 - amd64
root=UUID=e6b1e8e9-dee3-45cd-b147-44801cc680f0 ro quiet Jan 03 10:35:53 funlife kernel:
Disabled fast string operations

At the moment, most new systems use systemd and journalctl but also have rsyslog
installed and are logging information in both systems.

The config file of journalctl is located at /etc/systemd/journald.conf.

**Logger**

It is possible to use the logger command to generate some logs:

**logger local1.info jadi was here**

And this will appear at /var/log/syslog.


**Logrotate**

Now we are generating a lot of logs. What should we do with them? How they should be
archived? The **logrotate** utility assists us in this area. Its main config file is /etc/logrotate.conf
and as any modern program, other config files can go into /etc/logrotate.d/.

#^ **cat /etc/logrotate.conf**^

#^ see &quot;man logrotate&quot; for details^

#^ rotate log files weekly^

weekly


</code></pre>
<h1 class="code-line" data-line-start=8458 data-line-end=8459 ><a id="keep_4_weeks_worth_of_8458"></a>keep 4 weeks worth of</h1>
<p class="has-line-data" data-line-start="8460" data-line-end="8461">backlogs rotate 4</p>
<pre><code class="has-line-data" data-line-start="8463" data-line-end="8465">
</code></pre>
<h1 class="code-line" data-line-start=8466 data-line-end=8467 ><a id="create_new_empty_log_files_after_rotating_old_8466"></a>create new (empty) log files after rotating old</h1>
<p class="has-line-data" data-line-start="8468" data-line-end="8469">ones create</p>
<pre><code class="has-line-data" data-line-start="8471" data-line-end="8473">
</code></pre>
<h1 class="code-line" data-line-start=8474 data-line-end=8475 ><a id="uncomment_this_if_you_want_your_log_files_8474"></a>uncomment this if you want your log files</h1>
<p class="has-line-data" data-line-start="8476" data-line-end="8477">compressed #compress</p>
<pre><code class="has-line-data" data-line-start="8479" data-line-end="8481">
</code></pre>
<h1 class="code-line" data-line-start=8482 data-line-end=8483 ><a id="packages_drop_log_rotation_information_into_this_8482"></a>packages drop log rotation information into this</h1>
<p class="has-line-data" data-line-start="8484" data-line-end="8485">directory include /etc/logrotate.d</p>
<pre><code class="has-line-data" data-line-start="8487" data-line-end="8489">
</code></pre>
<h1 class="code-line" data-line-start=8490 data-line-end=8491 ><a id="no_packages_own_wtmp_or_btmp__well_rotate_them_8490"></a>no packages own wtmp, or btmp – we’ll rotate them</h1>
<pre><code class="has-line-data" data-line-start="8493" data-line-end="8497">here /var/log/wtmp {^


</code></pre>
<p class="has-line-data" data-line-start="8498" data-line-end="8500">missingok<br>
monthly</p>
<pre><code class="has-line-data" data-line-start="8502" data-line-end="8504">
</code></pre>
<p class="has-line-data" data-line-start="8505" data-line-end="8507">create 0664 root utmp<br>
rotate 1</p>
<pre><code class="has-line-data" data-line-start="8509" data-line-end="8515">### }

/var/log/btmp {


</code></pre>
<p class="has-line-data" data-line-start="8516" data-line-end="8517">missingok</p>
<pre><code class="has-line-data" data-line-start="8519" data-line-end="8521">
</code></pre>
<p class="has-line-data" data-line-start="8522" data-line-end="8523">monthly</p>
<pre><code class="has-line-data" data-line-start="8525" data-line-end="8527">
</code></pre>
<p class="has-line-data" data-line-start="8528" data-line-end="8529">create 0660 root utmp</p>
<pre><code class="has-line-data" data-line-start="8531" data-line-end="8533">
</code></pre>
<p class="has-line-data" data-line-start="8534" data-line-end="8535">rotate 1</p>
<pre><code class="has-line-data" data-line-start="8537" data-line-end="8546">### }

# system-specific logs may be configured here


It is very easy to see how it works. Let’s check one of them:


</code></pre>
<h1 class="code-line" data-line-start=8547 data-line-end=8548 ><a id="cat_8547"></a>cat</h1>
<p class="has-line-data" data-line-start="8549" data-line-end="8550">/etc/logrotate.d/ngin</p>
<pre><code class="has-line-data" data-line-start="8552" data-line-end="8556">**x** /var/log/nginx/*.log {^


</code></pre>
<p class="has-line-data" data-line-start="8557" data-line-end="8563">weekly<br>
missingok<br>
rotate 52<br>
compress<br>
delaycompress<br>
notifempty</p>
<pre><code class="has-line-data" data-line-start="8565" data-line-end="8567">
</code></pre>
<p class="has-line-data" data-line-start="8568" data-line-end="8570">create 0640 www-data adm<br>
sharedscripts</p>
<pre><code class="has-line-data" data-line-start="8572" data-line-end="8574">
</code></pre>
<p class="has-line-data" data-line-start="8575" data-line-end="8576">prerotate</p>
<pre><code class="has-line-data" data-line-start="8578" data-line-end="8580">
</code></pre>
<p class="has-line-data" data-line-start="8581" data-line-end="8583">if [ -d /etc/logrotate.d/httpd-prerotate ]; then \ run-parts<br>
/etc/logrotate.d/httpd-prerotate; \</p>
<pre><code class="has-line-data" data-line-start="8585" data-line-end="8587">
</code></pre>
<p class="has-line-data" data-line-start="8588" data-line-end="8589">fi \</p>
<pre><code class="has-line-data" data-line-start="8591" data-line-end="8593">
</code></pre>
<p class="has-line-data" data-line-start="8594" data-line-end="8595">endscript</p>
<pre><code class="has-line-data" data-line-start="8597" data-line-end="8599">
</code></pre>
<p class="has-line-data" data-line-start="8600" data-line-end="8601">postrotate</p>
<pre><code class="has-line-data" data-line-start="8603" data-line-end="8605">
</code></pre>
<p class="has-line-data" data-line-start="8606" data-line-end="8607">invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1</p>
<pre><code class="has-line-data" data-line-start="8609" data-line-end="8611">
</code></pre>
<p class="has-line-data" data-line-start="8612" data-line-end="8613">endscript</p>
<pre><code class="has-line-data" data-line-start="8615" data-line-end="8622">### }


These are the meaning of some of these parameters:


</code></pre>
<p class="has-line-data" data-line-start="8623" data-line-end="8624">parameter meaning</p>
<pre><code class="has-line-data" data-line-start="8626" data-line-end="8628">
</code></pre>
<p class="has-line-data" data-line-start="8629" data-line-end="8630">weekly rotate logs weekly</p>
<pre><code class="has-line-data" data-line-start="8632" data-line-end="8634">
</code></pre>
<p class="has-line-data" data-line-start="8635" data-line-end="8636">missingok it is fine if there is no log for this week</p>
<pre><code class="has-line-data" data-line-start="8638" data-line-end="8640">
</code></pre>
<p class="has-line-data" data-line-start="8641" data-line-end="8642">rotate 52 keep the latest 52 logs and delete the older ones</p>
<pre><code class="has-line-data" data-line-start="8644" data-line-end="8646">
</code></pre>
<p class="has-line-data" data-line-start="8647" data-line-end="8648">compress compress the logs</p>
<pre><code class="has-line-data" data-line-start="8650" data-line-end="8652">
</code></pre>
<p class="has-line-data" data-line-start="8653" data-line-end="8654">create 0640 www-data adm create the files with this access and owners</p>
<pre><code class="has-line-data" data-line-start="8656" data-line-end="8658">
</code></pre>
<p class="has-line-data" data-line-start="8659" data-line-end="8660">pre &amp; post rotate run these scripts or commands before and after the rotation</p>
<pre><code class="has-line-data" data-line-start="8662" data-line-end="8795">This configuration will create a zipped file for each week, keeping only 52 of them instead of a huge
log file for this program.


**108.3 Mail Transfer Agent (MTA) basics -** **_3_**

**Objectives**

- Create e-mail aliases.
- Configure e-mail forwarding.
- Knowledge of commonly available MTA programs (postfix, sendmail, qmail, exim) (no
    configuration)

**Terms and Utilities**

- ~/.forward
- sendmail emulation layer commands
- newaliases
- mail
- mailq
- postfix
- sendmail
- exim
- qmail

**MTAs**

Mai Transfer Agents or MTAs are programs which **handle emails** in your operating system.

There are lot of MTAs available and each distro or sysadmin uses the one she likes more.

**Sendmail**

One of the oldest options available. It is big and difficult to configure and keep safe and secure
so very few systems use it as default MTA.

**Qmail**

**qmail** is an attempt to provide an ultra-secure MTA while keeping the MTA compatible with sendmail
ideas. It is modular and claims to be free of any security bug. It also claim to be the 2nd popular mail
agent on the Internet.

qmail is not a GPL software. It is Public Domain.


**Exim**

It aims to be a general and flexible mailer with extensive facilities for checking incoming e-mail. It
is feature rich with ACLs, authentication, ...

**Postfix**

This is a new alternative to sendmail and uses easy to understand configuration files. It supports
multiple domains, encryption, etc. Postfix is what you may find on most distros as default.

**Sendmail emulation layer**

As I already said, sendmail is the oldest MTA which is still active. Other MTAs respect his age and
provide a _sendmail emulation layer_ to keep themselves backward compatible with it. In other words
you can type sendmail or mailq on your command line regardless of what MTA you've installed.

**Aliases**

There are some mail aliases on the system. Defined in /etc/aliases.

$ **cat /etc/aliases**

# /etc/aliases

mailer-daemon: postmaster

postmaster: root

nobody: root

hostmaster: root

usenet: root # &lt;--- I'm using this sample

news: root

webmaster: root

www:^ root^

ftp: root

abuse: root

noc: root


security: root

root: jadi

This tells the system if there is a message for 'usenet' it will sent to the root user. Note that in the
last line, jadi is reading the root emails. This line lets me read emails sent to root without needing
to login with root.

when this file is update, the newaliases should be run!

root@funlife:~# **newaliases**

root@funlife:~#


**Sending mail**

It is possible to send an email from the command line using the mail command:

[jadi@funlife ~]$ **mail news**

Subject: Email to news user

hahah.. we know where this will go.

this will go to root and then to jadi!

Hi Jadi!

Cc:

[jadi@funlife ~]$ **mail**

Mail version 8.1.2 01/15/2001. Type? for help.

&quot;/var/mail/jadi&quot;: 12 messages 12 new

&gt;N 1 root@funlife Sat Jan 02 08:50 39/1373 apt-listchanges: news for f


</code></pre>
<p class="has-line-data" data-line-start="8796" data-line-end="8797">N 2 root@funlife Sat Jan 02 09:01 165/7438 apt-listchanges: news for f</p>
<pre><code class="has-line-data" data-line-start="8799" data-line-end="8801">
</code></pre>
<p class="has-line-data" data-line-start="8802" data-line-end="8803">N 3 jadi@funlife Sat Jan 02 19:58 18/640 *** SECURITY information fo</p>
<pre><code class="has-line-data" data-line-start="8805" data-line-end="8807">
</code></pre>
<p class="has-line-data" data-line-start="8808" data-line-end="8809">N 4 jadi@funlife Sat Jan 02 20:04 18/631 *** SECURITY information fo</p>
<pre><code class="has-line-data" data-line-start="8811" data-line-end="8813">
</code></pre>
<p class="has-line-data" data-line-start="8814" data-line-end="8815">N 5 jadi@funlife Sun Jan 03 10:15 18/664 *** SECURITY information fo</p>
<pre><code class="has-line-data" data-line-start="8817" data-line-end="8819">
</code></pre>
<p class="has-line-data" data-line-start="8820" data-line-end="8821">N 6 root@funlife Mon Jan 04 12:42 27/941 Cron <a href="mailto:jadi@funlife">jadi@funlife</a> /home/j</p>
<pre><code class="has-line-data" data-line-start="8823" data-line-end="8825">
</code></pre>
<p class="has-line-data" data-line-start="8826" data-line-end="8827">N 7 root@funlife Mon Jan 04 17:11 26/845 apt-listchanges: news for f</p>
<pre><code class="has-line-data" data-line-start="8829" data-line-end="8831">
</code></pre>
<p class="has-line-data" data-line-start="8832" data-line-end="8833">N 8 root@funlife Tue Jan 05 18:42 27/945 Cron <a href="mailto:jadi@funlife">jadi@funlife</a> /home/j</p>
<pre><code class="has-line-data" data-line-start="8835" data-line-end="8837">
</code></pre>
<p class="has-line-data" data-line-start="8838" data-line-end="8839">N 9 root@funlife Wed Jan 06 09:17 46/1788 apt-listchanges: news for f</p>
<pre><code class="has-line-data" data-line-start="8841" data-line-end="8843">
</code></pre>
<p class="has-line-data" data-line-start="8844" data-line-end="8845">N 10 root@funlife Thu Jan 07 12:42 27/945 Cron <a href="mailto:jadi@funlife">jadi@funlife</a> /home/j</p>
<pre><code class="has-line-data" data-line-start="8847" data-line-end="8849">
</code></pre>
<p class="has-line-data" data-line-start="8850" data-line-end="8851">N 11 root@funlife Thu Jan 07 18:42 27/943 Cron <a href="mailto:jadi@funlife">jadi@funlife</a> /home/j</p>
<pre><code class="has-line-data" data-line-start="8853" data-line-end="8855">
</code></pre>
<p class="has-line-data" data-line-start="8856" data-line-end="8857">N 12 jadi@funlife Thu Jan 7 19:53 17/478 Email to news user</p>
<pre><code class="has-line-data" data-line-start="8859" data-line-end="8863">### &amp; 12


</code></pre>
<p class="has-line-data" data-line-start="8864" data-line-end="8866">Mess<br>
age</p>
<pre><code class="has-line-data" data-line-start="8868" data-line-end="8926">12:^

From jadi@funlife Thu Jan 7 19:53:08 2016 X-
Original-To: news


To: news@funlife

Subject: Email to news user

Date: Thu, 7 Jan 2016 19:53:08 +0330 (IRST)

From: jadi@funlife (jadi)

hahah.. we know where this will go.

this will go to root and then to jadi!

Hi Jadi!

&amp;^ d^

&amp;^ q^

Held 11 messages in /var/mail/jadi


**Local forwards**

We saw that it is possible to **forward emails** using the /etc/aliases. That file is not writable by
normal users so what a normal user like _jadi_ should do?

Each user can create a .forward file in her own directory and all mail targeted to that user will be
forwarded to that address.

You can even put a complete email address like jadijadi@gmail.com in your .forward file. mail
command is not part of LPIC102 but it is good if you play and learn it to some extent. It also can
send email from within the scripts like 'echo -e &quot;email content&quot; | mail -s &quot;email subject&quot;
&quot;example@example.com&quot;'

**Mailq**

This command **lists the mail queue**. Each entry shows the queue file ID, message size, arrival time,
sender, and the recipients that still need to be delivered. If mail could not be delivered upon the last
attempt, the reason for failure is shown. The sysadmin can use this command to check the status of
emails still in the queues.

$ **mailq**

- Queue ID- --Size-- ----Arrival Time---- - Sender/Recipient-------

AA52C228E6B 468 Thu Jan 7 19:59:41 jadi@funlife

(connect to alt2.gmail-smtp-in.l.google.com[2404:6800:4003:c01::1a]:25: Network is
unreachable)


</code></pre>
<p class="has-line-data" data-line-start="8927" data-line-end="8928"><a href="mailto:jadijadi@gmail.com">jadijadi@gmail.com</a></p>
<pre><code class="has-line-data" data-line-start="8930" data-line-end="8997">-- 0 Kbytes in 1 Request.


**108.4 - Manage printers and printing -** **_2_**

**Objectives**

- Basic CUPS configuration (for local and remote printers).
- Manage user print queues.
- Troubleshoot general printing problems.
- Add and remove jobs from configured printer queues.

**Terms and Utilities**

- CUPS configuration files, tools and utilities
- /etc/cups/
- lpd legacy interface (lpr, lprm, lpq)

### CUPS

Most Linux distros use **CUPS** for printing. CUPS stands for **Common Unix Printing System**. There
are different interfaces for CUPS link command line tools, web based interface and GUIs. CUPS is
designed to simplify the printing on various printers from different manufactures.

**CUPS web interface**

The general way to access the CUPS configuration and info page is going to the servers IP on port
**631** from a browser. That will be **localhost:631** or **127.0.0.1:631** from your browser.


**Important parts** on this webpage are:

| **Jobs tab** |to check the jobs the CUPS is handling|

| **Administration** |For adding printers, managing jobs and configuring the CUPS server|
| **Printers** |Show the printers|

As soon as you push the Add Printer button, you will need to give CUPS admin user
password

Suggested Activity: Visit your CUPS web interface and add a printer

Good news is that the CUPS has most of the common printer drivers installed. You just need to
choose the printer from the dropdown menu.

**Configuration files**

As any other linux program, CUPS saves its configuration at /etc directory.

#^ **ls /etc/cups**^

cups-browsed.conf interfaces raw.types subscriptions.conf
cupsd.conf ppd snmp.conf subscriptions.conf.O cups-files.conf
raw.convs ssl

One important file is **cupsd.conf**. Have a look at it; it is very easy to understand. For example the
Listen localhost:631 line tells the CUPS to listen on localhost port 631.

All the printer data is saved at **/etc/cups/printers.conf**. The web interface or any other GUI is
actually editing this file.

#^ Printer configuration file for CUPS v2.1.0^

#^ Written by cupsd^


</code></pre>
<h1 class="code-line" data-line-start=8998 data-line-end=8999 ><a id="DO_NOT_EDIT_THIS_FILE_WHEN_CUPSD_IS_8998"></a>DO NOT EDIT THIS FILE WHEN CUPSD IS</h1>
<pre><code class="has-line-data" data-line-start="9001" data-line-end="9036">RUNNING &lt;DefaultPrinter Apple-Dot-Matrix&gt;^

UUID urn:uuid:0f6c2f2b- 6338 - 388a-76de-09f2ef1994d5 Info
Apple Dot Matrix

Location Fake Location

MakeModel Apple Dot Matrix Foomatic/appledmp (recommended)
DeviceURI ipp://fakeprinter/


State Idle

StateTime 1453402271
ConfigTime 1453402271
Type 8433668 Accepting
Yes

Shared Yes JobSheets
none none
QuotaPeriod 0
PageLimit 0

KLimit 0 OpPolicy
default ErrorPolicy
retry-job
&lt;/DefaultPrinter&gt;


**Legacy tools**

Just like the MTA programs, CUPS support all the legacy command line programs too.


</code></pre>
<p class="has-line-data" data-line-start="9037" data-line-end="9038">command usage</p>
<pre><code class="has-line-data" data-line-start="9040" data-line-end="9042">
</code></pre>
<p class="has-line-data" data-line-start="9043" data-line-end="9044">lpr print a file</p>
<pre><code class="has-line-data" data-line-start="9046" data-line-end="9048">
</code></pre>
<p class="has-line-data" data-line-start="9049" data-line-end="9050">lpq show print queue/jobs</p>
<pre><code class="has-line-data" data-line-start="9052" data-line-end="9054">
</code></pre>
<p class="has-line-data" data-line-start="9055" data-line-end="9056">lprm rm/remove a file from priner queue</p>
<pre><code class="has-line-data" data-line-start="9058" data-line-end="9060">
</code></pre>
<p class="has-line-data" data-line-start="9061" data-line-end="9062">lpc printer control / troubleshooting program</p>
<pre><code class="has-line-data" data-line-start="9064" data-line-end="9092">**lpq**

The **q** is for **queue** therefor lpq shows the printer queue and is used when you want to see the jobs.
If you use the -a switch, the lpq will show the jobs of **all** printers. Alternatively you can use the -P
switch to show the jobs of a specific printer. So the following command will show the jobs of a
printer called Apple-Dot-Matrix:

# **lpq -PApple-Dot-Matrix**

Apple-Dot-Matrix is ready and printing

Rank Owner Job File(s) Total Size

active unknown 1 unknown 7168 bytes

1st unknown 2 unknown 2048 bytes

It is strange but there should not be ANY space between -P and the printers name


**lpr**

This command is used to send a job to a printer. Again the printer is specified by -P.

$ **lpr -PApple-Dot-Matrix for_print.txt**


</code></pre>
<p class="has-line-data" data-line-start="9093" data-line-end="9094">lpq</p>
<pre><code class="has-line-data" data-line-start="9096" data-line-end="9156">Apple-Dot-Matrix is ready and printing

Rank Owner Job File(s) Total Size

active jadi 1 Untitled Document 1 7168 bytes

1st jadi 2 Untitled1 2048 bytes

2nd jadi 3 for_print.txt 1024 bytes

If no printer is specified, the default printer will be used


**lprm**

The _rm_ is for _remove_ so the lprm will **remove jobs** from the queue. You need to provide the **Job ID**
to this command.

$ **lpq**

Apple-Dot-Matrix is ready and printing

Rank Owner Job File(s) Total Size

active jadi 1 Untitled Document 1 7168 bytes

1st jadi 2 Untitled1 2048 bytes

2nd jadi 3 for_print.txt 1024 bytes

jadi@funlife:/tmp$ lprm 2

jadi@funlife:/tmp$ lpq

Apple-Dot-Matrix is ready and printing

Rank Owner Job File(s) Total Size

active jadi 1 Untitled Document 1 7168 bytes

1st jadi 3 for_print.txt 1024 bytes

Only root can remove other peoples print jobs

If you need to remove ALL the jobs of a specific printer, you can go with -Pprinter_name -. Yes!
that is only one dash (-) after the printer name; that's why this is called a legacy command.

the lprm - will remove all the print jobs

**lpc**

Here, the **c** is for **control**. lpc lets you check the status (via lpc status) and troubleshoot your
printers.

$ **lpc status**

Apple-Dot-Matrix:


</code></pre>
<p class="has-line-data" data-line-start="9157" data-line-end="9158">printer is on device ‘ipp’ speed - 1</p>
<pre><code class="has-line-data" data-line-start="9160" data-line-end="9162">
</code></pre>
<p class="has-line-data" data-line-start="9163" data-line-end="9164">queuing is enabled</p>
<pre><code class="has-line-data" data-line-start="9166" data-line-end="9168">
</code></pre>
<p class="has-line-data" data-line-start="9169" data-line-end="9170">printing is enabled</p>
<pre><code class="has-line-data" data-line-start="9172" data-line-end="9174">
</code></pre>
<p class="has-line-data" data-line-start="9175" data-line-end="9177">2 entries<br>
daemon</p>
<pre><code class="has-line-data" data-line-start="9179" data-line-end="9183">present^


</code></pre>
<p class="has-line-data" data-line-start="9184" data-line-end="9185">Here,</p>
<pre><code class="has-line-data" data-line-start="9187" data-line-end="9189">
</code></pre>
<p class="has-line-data" data-line-start="9190" data-line-end="9192">queuing is enabled tell us that the queue can accept new print jobs. If the queue is<br>
disabled, you can not even send new jobs to the printer.</p>
<pre><code class="has-line-data" data-line-start="9194" data-line-end="9196">
</code></pre>
<p class="has-line-data" data-line-start="9197" data-line-end="9199">printing is enabled means that the printer is actually can print on the paper. This will be on<br>
the disable state if the printer is out of ink or paper or experiencing a paper jam.</p>
<pre><code class="has-line-data" data-line-start="9201" data-line-end="9205">If you are having problems with your printer or need to prevent it from accepting new jobs or let it
accept jobs but not print, these four commands will let you achieve your needs:

</code></pre>
<p class="has-line-data" data-line-start="9206" data-line-end="9207">command usage</p>
<pre><code class="has-line-data" data-line-start="9209" data-line-end="9211">
</code></pre>
<p class="has-line-data" data-line-start="9212" data-line-end="9213">cupsaccept tells the printer queue to accept new jobs</p>
<pre><code class="has-line-data" data-line-start="9215" data-line-end="9217">
</code></pre>
<p class="has-line-data" data-line-start="9218" data-line-end="9219">cupsreject tells the printer to reject any new job</p>
<pre><code class="has-line-data" data-line-start="9221" data-line-end="9223">
</code></pre>
<p class="has-line-data" data-line-start="9224" data-line-end="9225">cupsenable enables the actual/physical printing of the jobs</p>
<pre><code class="has-line-data" data-line-start="9227" data-line-end="9229">
</code></pre>
<p class="has-line-data" data-line-start="9230" data-line-end="9231">cupsdisable disables the physical printing of the jobs</p>
<pre><code class="has-line-data" data-line-start="9233" data-line-end="9243">In all cases you have to provide the printer name of the printer. it is also possible to provide a
reason using -r switch.

$ **cupsdisable Apple-Dot-Matrix -r &quot;need more paper&quot;**

$ **lpc status**

Apple-Dot-Matrix:

</code></pre>
<p class="has-line-data" data-line-start="9244" data-line-end="9245">printer is on device ‘ipp’ speed - 1</p>
<pre><code class="has-line-data" data-line-start="9247" data-line-end="9249">
</code></pre>
<p class="has-line-data" data-line-start="9250" data-line-end="9251">queuing is enabled</p>
<pre><code class="has-line-data" data-line-start="9253" data-line-end="9255">
</code></pre>
<p class="has-line-data" data-line-start="9256" data-line-end="9257">printing is disabled</p>
<pre><code class="has-line-data" data-line-start="9259" data-line-end="9261">
</code></pre>
<p class="has-line-data" data-line-start="9262" data-line-end="9265">2 entries<br>
daemon<br>
present</p>
<pre><code class="has-line-data" data-line-start="9267" data-line-end="9309">**109.1 - Fundamentals of internet protocols** **_- 4_**

**Objectives**

- Demonstrate an understanding of network masks and CIDR notation.
- Knowledge of the differences between private and public &quot;dotted quad&quot; IP addresses.
- Knowledge about common TCP and UDP ports and services (20, 21, 22, 23, 25, 53, 80, 110,
    123, 139, 143, 161, 162, 389, 443, 465, 514, 636, 993, 995).
- Knowledge about the differences and major features of UDP, TCP and ICMP.
- Knowledge of the major differences between IPv4 and IPv6.
- Knowledge of the basic features of IPv6.

**Terms and Utilities**

- /etc/services
- IPv4, IPv6
- Subnetting
- TCP, UDP, ICMP

**IPv4**

**Internet Protocol** or **IP** is an address that points to a destination on the Internet. This destination
can be a single computer, a server, a switch or even a network (behind that IP). An IP version four
is in the form of A.B.C.D where A, B, C &amp; D are between 0-255. The following are all valid IP
addresses:

### '''' 1.2.3.4 1.1.1.1 100.0.0.100 192.168.1.4 ''''

each part of an IP address is called an Octet since it is constructed of an 8 bit number
(0..255)

How many IP addresses are available with IPv4? 256 _256_ 256*256 = 4294967296. That is around
4.3 billion - only! Even from this 4.3B, some are not usable (as you will see later) &amp; the _usable_
range is around 3.7B.


**Private IPs**

Any IP address in the form of following addresses are called a _private IP address_ :


</code></pre>
<p class="has-line-data" data-line-start="9310" data-line-end="9311">range Number of IPs in this range</p>
<pre><code class="has-line-data" data-line-start="9313" data-line-end="9315">
</code></pre>
<p class="has-line-data" data-line-start="9316" data-line-end="9317">192.168.0-255.0- 255 65K IPs</p>
<pre><code class="has-line-data" data-line-start="9319" data-line-end="9321">
</code></pre>
<p class="has-line-data" data-line-start="9322" data-line-end="9323">172.16-31.0-255.0- 255 1M IPs</p>
<pre><code class="has-line-data" data-line-start="9325" data-line-end="9327">
</code></pre>
<p class="has-line-data" data-line-start="9328" data-line-end="9329">10.0-255.0-255.0- 255 16M IPs</p>
<pre><code class="has-line-data" data-line-start="9331" data-line-end="9372">Anyone can use any of these IPs on her devices as long as it is not connected directly to the
internet. Have a look at this example:


In the middle you can see a **Network Address Translation** or **NAT device**. It is connected to the
**Internet** using only one public IP (It might be 5.27.1.30). On the left side of the **NAT box** , there are **4
computers** with Private IPs. Each time any of these devices targets an address on the Internet (a public
IP), the NAT device will use his own public IP to request that IP and when he gets the data, will provide
it to the _Natted_ device - the device behind the NAT. This way we can create huge networks behind a
NAT device. In this scenario, all the devices can reach the Internet but no-one from the Internet can
reach any of them, directly.

**Subnetting**

OK! We have around 4B addresses in IPv4. But what happens if I send a packet to another IP? Say I
try to print a document on the _local_ printer as you learned in previous section? Who should listen
for this packet? Does the whole Internet pass it hand to hand? Obviously not! Only my _local_ network
will wait for such a packet and only my printer (with its local IP) will receive it. When configuring a
network, we define **subnet** s. For example, my home network is configured on 192.168.1.0-255. This
way my Wi-Fi router is 192.168.1.1, my laptop will be 192.168.1.10, my printer 192.168.1.100, my
desktop 192.168.1.2 and my tv 192.168.1.200. When my phone connects to my Wi-Fi it might be
192.168.1.33. Any time any packets tries to reach any IP in my **subnet** (that is 192.168.1.0-255), my
router does so. If any devices tries to reach anything out of my subnet (say a public IP), my router
will use its NAT functionality to send the packets over the Internet.

This is done using a netmask. But before going there, let me do a fast review on binary
representation of number, and specially IP addresses.


**Binary representation of IPs**

You are probably familiar with binary base - it is the basis of anything related to computers. If not I
highly recommend you to do a google search and read if from another source since this book
assumes you already know it. In short when writing numbers on binary format (base 2), the only
used digits are 0 and 1. An easy way for conversion is using the following table to convert 0 and 1s
to our _normal_ decimal format.

### 128 64 32 16 8 4 2 1


</code></pre>
<p class="has-line-data" data-line-start="9373" data-line-end="9374">0 0 0 0 0 0 0 0 equals 0 in decimal</p>
<pre><code class="has-line-data" data-line-start="9376" data-line-end="9378">
</code></pre>
<p class="has-line-data" data-line-start="9379" data-line-end="9380">1 0 0 0 0 0 0 0 equals 128 in decimal</p>
<pre><code class="has-line-data" data-line-start="9382" data-line-end="9384">
</code></pre>
<p class="has-line-data" data-line-start="9385" data-line-end="9386">1 0 0 0 0 0 0 1 equals 129 in decimal</p>
<pre><code class="has-line-data" data-line-start="9388" data-line-end="9390">
</code></pre>
<p class="has-line-data" data-line-start="9391" data-line-end="9392">0 0 1 0 0 0 0 0 equals 32 in decimal</p>
<pre><code class="has-line-data" data-line-start="9394" data-line-end="9396">
</code></pre>
<p class="has-line-data" data-line-start="9397" data-line-end="9398">0 0 0 0 0 1 1 0 equals 6 in decimal</p>
<pre><code class="has-line-data" data-line-start="9400" data-line-end="9402">
</code></pre>
<p class="has-line-data" data-line-start="9403" data-line-end="9404">1 0 1 1 0 0 1 1 equals 179 in decimal</p>
<pre><code class="has-line-data" data-line-start="9406" data-line-end="9408">
</code></pre>
<p class="has-line-data" data-line-start="9409" data-line-end="9410">1 1 1 1 1 1 1 1 equals 255 in decimal</p>
<pre><code class="has-line-data" data-line-start="9412" data-line-end="9417">So 11000000.10101000.00000001.00001111 equals to 192.168.1.15.



</code></pre>
<p class="has-line-data" data-line-start="9418" data-line-end="9419">Netmask mask</p>
<pre><code class="has-line-data" data-line-start="9421" data-line-end="9423">
</code></pre>
<p class="has-line-data" data-line-start="9424" data-line-end="9428">We already saw that subnets are used to create small / local networks. When computers are in one<br>
subnet, they can see each other directly without any routing. For any address out of my subnet, a<br>
router should handle the packets and send them to their destination. This is done using subnet<br>
masks. Let’s try an example.</p>
<pre><code class="has-line-data" data-line-start="9430" data-line-end="9432">
</code></pre>
<p class="has-line-data" data-line-start="9433" data-line-end="9439">Say we are going to create a subnet like 192.168.1.0-255. Here the 192.168.1 part is same among all<br>
the devices and the last octet changes. A subnet mask is another string like A.B.C.D which tells the<br>
computer what part of the IP in this subnet will remain same among all devices and what parts can<br>
be changed. Here, the subnet mask for 192.168.1.0-255 is 255.255.255.0. As you can see any “fixed”<br>
octet will have 255 as its subnet mask and the changing (from 0 to 255) octets subnet mask is 0. Can<br>
you guess the subnet mask of 10.10.0-255.0-255? That is 255.255.0.0.</p>
<pre><code class="has-line-data" data-line-start="9441" data-line-end="9443">
</code></pre>
<p class="has-line-data" data-line-start="9444" data-line-end="9445">fixed parts are 255 and when an octet can be anything from 0 to 255, its subnet mask is 0.</p>
<pre><code class="has-line-data" data-line-start="9447" data-line-end="9449">
</code></pre>
<p class="has-line-data" data-line-start="9450" data-line-end="9451">Remember our discussion about binary numbers? We can represent the IPs in binaries:</p>
<pre><code class="has-line-data" data-line-start="9453" data-line-end="9457">**network (fixed part) subnet (who will**


</code></pre>
<p class="has-line-data" data-line-start="9458" data-line-end="9459">decimal 192.168.1. 0 - 255</p>
<pre><code class="has-line-data" data-line-start="9461" data-line-end="9463">
</code></pre>
<p class="has-line-data" data-line-start="9464" data-line-end="9465">binary 11000000.10101000.00000001. 00000000 - 11111111</p>
<pre><code class="has-line-data" data-line-start="9467" data-line-end="9469">
</code></pre>
<p class="has-line-data" data-line-start="9470" data-line-end="9471">subnet mask (binary) 11111111.11111111.11111111. 00000000</p>
<pre><code class="has-line-data" data-line-start="9473" data-line-end="9475">
</code></pre>
<p class="has-line-data" data-line-start="9476" data-line-end="9477">subnet mask (decimal) 255.255.255. 0</p>
<pre><code class="has-line-data" data-line-start="9479" data-line-end="9481">
</code></pre>
<p class="has-line-data" data-line-start="9482" data-line-end="9484">When talking bout subnet masks, we will put a 1 when that digit can not be changed and a 0 when<br>
that digit can be changed.</p>
<pre><code class="has-line-data" data-line-start="9486" data-line-end="9499">### CIDR

**Classless Inter-Domain Routing** or **CIDR** is another way of talking about subnet masks. Telling
someone that &quot;my network is 192.168.1.0 and my subnet mask is 255.255.255.0&quot; is difficult so
some people prefer to say &quot;my network is 192.168.1.0/24&quot;. This is a shortcut! 24 is the number of
1s in your subnet which is 11111111.11111111.11111111.00000000 in binary and has twenty four
1s. At the beginning this might look difficult but in practice it is more functional to use &quot;my network
is 172.16.1.1/16&quot; instead of &quot;my network is 172.16.1.1 with netmask 255.255.0.0&quot;.

Here are some famous samples:


</code></pre>
<p class="has-line-data" data-line-start="9500" data-line-end="9501">decimal netmask binary netmask</p>
<pre><code class="has-line-data" data-line-start="9503" data-line-end="9634">### 255.255.255.0 11111111.11111111.11111111.00000000

### 255.255.0.0 11111111.11111111.00000000.00000000

### 255.0.0.0 11111111.00000000.00000000.00000000

### 255.255.255.240 11111111.11111111.11111111.11110000

### 255.255.255.248 11111111.11111111.11111111.11111000

As you can see on the last two examples, the subnet mask (or **netmask** ) can start anywhere in any
octet.

In short CIDR is just &quot;number of 1s in a netmask&quot;.

For a better understanding of subnetting, have a look at Cisco document


**IPv6**

We saw that there are only around 4B IPv4s available. Just consider that we are around 7B people
on the planet earth so there is not even enough IP for every person on IPv4 range. Add to this the
latest demands from all the mobile phones, cars, fridges, clocks, TVs, camera, ...! They all want to
be on the Internet; this is called Internet Of Things. What should be done? We saw one solution
called NAT but the permanent solution is a new version of the IP; IP version 6. In version 6 IPs are
not limited to 4 octets anymore.

A sample IPv6 address looks like 2001:0db8:0a0b:12f0:0000:0000:0000:0001 and it can be
shortened to 2001:db8:a0b:12f0::1. Here we have decimal numbers from **0000** to **FFFF** and **8** fields
which are separated by **:**. This way we will have around 3.4*(10^38) IPs which is enough for
whatever we can imagine at the moment. Just imagine that it can allocate 2^52 addresses for
every observable star in the known universe.

Although at the moment there is shortage on IPv4, IPv6 is not adopted much yet and most of the
Internet is still working on IPv4.


**Communication Protocols**

When computers communicate, they use Protocols. This protocols are designed to let computers
speak in different ways for fulfilling different needs. Here we will have a look at three of the most
popular protocols on the Internet: **TCP** / **UDP** / **ICMP**.

### TCP

**Transmission Control Protocol** or **TCP** is designed to make sure that both parties are _speaking_ with
each other without losing any information. In this protocol the receiver will get anything the
sender sends, exactly as it is sent. When you are downloading a program from the Internet, TCP is
the best option because you need the file exactly as it is stored on the server. This can be a
communication like this:

A- Are you ready?

B- Yes

A- Please share with me the file XYZ

B- Ok. Are you ready?

A- Yes. Start sending

B- OK. This is the part 1 of XYZ

A- OK I got it.

B- Good. Now is it correct?

A- Yes. Please send the second part

B- OK. Are you ready for the second part?

As you can see, TCP needs a lot of communications and sometimes it is not even suitable. When you
are listening to music or having a video chat, it is better if the computer just skips some packages in
case of problems and continues from the new one it gets.


### UDP

You are video-chatting with a friend and network fluctuates. What is a better choice? A)
retransmitting the missing packets and/or re-establishing the connection and continue the whole
conversation with a 2s delay or B) just show the newer packets we got and continue the live video-
conference and just forget about that 2 second fluctuation (missed data)? If your choice is B, it is
better if you use UDP ( **User Datagram Protocol** ) for your chat program. UDP is less reliable: the
sender sends packets without communicating much and hearing back from the receiver and
receiver listens for packets without negotiating the exact details with the sender. It is **much faster
than TCP** but you cannot be sure that 100% of packets will be received by the B party.

### ICMP

**Internet Control Messaging Protocol** or **ICMP** is a specific purpose protocol used to check the
connectivity of the servers by the ping command. The first computer just tells &quot;are you there?&quot;
and the second will answer &quot;yes I'm here&quot;. Have a look at this practical example: [jadi@funlife ~]$
**ping google.com**

PING google.com (173.194.32.135) 56(84) bytes of data.

64 bytes from 173.194.32.135: icmp_seq=1 ttl=48 time=239 ms

64 bytes from 173.194.32.135: icmp_seq=2 ttl=48 time=236 ms ^C

--- google.com ping statistics ---

2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt
min/avg/max/mdev = 236.707/238.174/239.642/1.546 ms

As you can see, we are pinging (send ICMP packets) to a server and it answers are back
(replying to our ICMP packets).

ICMP is used for network troubleshooting and DOES NOT transfers user data


**Port**


Any computer has an address but there are many programs running on that computer. By using an
IP address, you can tell the Internet the destination of your packets but how can you decide which
program on that computer should answer to your packet? We know that a computer with the
address of 5.1.23.1 has a webserver and an ftp server on it but how can we reach it and tell it &quot;i
want the index.html of your webserver&quot; or &quot;deliver me the XYZ file from your FTP server&quot;? This is
done using PORTs.

Ports are numbers where a program LISTENS to. For example, port 80 is reserved for webservers so
if I connect to 5.1.23.1:80 I'm sure that I'm talking with the webserver. In the same way, when the
file transport protocol (FTP) starts, it starts listening on port 20 &amp; 21 and if I use a FTP client to reach
that computer, I will automatically connect to port 21 which is reserved for FTP.

Different ports can use different transmission protocols (UDP or TCP). The default port of some
protocols are as follow. These are very important and most admins know them.


</code></pre>
<p class="has-line-data" data-line-start="9635" data-line-end="9636">port usage</p>
<pre><code class="has-line-data" data-line-start="9638" data-line-end="9640">
</code></pre>
<p class="has-line-data" data-line-start="9641" data-line-end="9642">20, 21 FTP (one data, one control)</p>
<pre><code class="has-line-data" data-line-start="9644" data-line-end="9648">### 22 SSH


</code></pre>
<p class="has-line-data" data-line-start="9649" data-line-end="9650">23 Telnet</p>
<pre><code class="has-line-data" data-line-start="9652" data-line-end="9665">### 25 SMTP

### 53 DNS

### 80 HTTP

### 110 POP3


### 123 NTP


</code></pre>
<p class="has-line-data" data-line-start="9666" data-line-end="9667">139 NetBIOS</p>
<pre><code class="has-line-data" data-line-start="9669" data-line-end="9673">### 143 IMAP


</code></pre>
<p class="has-line-data" data-line-start="9674" data-line-end="9675">port usage</p>
<pre><code class="has-line-data" data-line-start="9677" data-line-end="9722">### 161, 162 SNMP

### 389 LDAP

### 443 HTTPS

### 465 SMTPS

### 636 LDAPS

### 993 IMAPS

### 995 POP3S

Note that in this table all ports above 400 ends with S, which stands for **S** ecure You
can find all of the above ports and many many others in /etc/services


**109.2 - Basic network configuration -** **_4_**

**Objectives**

- Manually and automatically configure network interfaces.
- Basic TCP/IP host configuration.
- Setting a default route.

**Terms and Utilities**

- /etc/hostname
- /etc/hosts
- /etc/nsswitch.conf
- ifconfig
- ifup
- ifdown
- ip
- route
- ping

**ifconfig, up and down**

The **ifconfig** is the main command for configuring the network adapters manually. Running it with
no arguments, will show all the network adapters and their configurations. $ **ifconfig**


</code></pre>
<p class="has-line-data" data-line-start="9723" data-line-end="9724">enp0s25: flags=4099&lt;UP,BROADCAST,MULTICAST&gt; mtu 1500</p>
<pre><code class="has-line-data" data-line-start="9726" data-line-end="9728">
</code></pre>
<p class="has-line-data" data-line-start="9729" data-line-end="9730">ether f0:de:f1:62:c5:73 txqueuelen 1000 (Ethernet)</p>
<pre><code class="has-line-data" data-line-start="9732" data-line-end="9734">
</code></pre>
<p class="has-line-data" data-line-start="9735" data-line-end="9736">RX packets 0 bytes 0 (0.0 B)</p>
<pre><code class="has-line-data" data-line-start="9738" data-line-end="9740">
</code></pre>
<p class="has-line-data" data-line-start="9741" data-line-end="9742">RX errors 0 dropped 0 overruns 0 frame 0</p>
<pre><code class="has-line-data" data-line-start="9744" data-line-end="9746">
</code></pre>
<p class="has-line-data" data-line-start="9747" data-line-end="9748">TX packets 0 bytes 0 (0.0 B)</p>
<pre><code class="has-line-data" data-line-start="9750" data-line-end="9752">
</code></pre>
<p class="has-line-data" data-line-start="9753" data-line-end="9755">TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0<br>
device interrupt 20 memory 0xd1500000-d1520000</p>
<pre><code class="has-line-data" data-line-start="9757" data-line-end="9762">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt; mtu 65536 inet
127.0.0.1 netmask 255.0.0.0


</code></pre>
<p class="has-line-data" data-line-start="9763" data-line-end="9764">inet6 ::1 prefixlen 128 scopeid 0x10&lt;host&gt;</p>
<pre><code class="has-line-data" data-line-start="9766" data-line-end="9768">
</code></pre>
<p class="has-line-data" data-line-start="9769" data-line-end="9770">loop txqueuelen 1 (Local Loopback)</p>
<pre><code class="has-line-data" data-line-start="9772" data-line-end="9774">
</code></pre>
<p class="has-line-data" data-line-start="9775" data-line-end="9776">RX packets 560719 bytes 339937974 (324.1 MiB)</p>
<pre><code class="has-line-data" data-line-start="9778" data-line-end="9780">
</code></pre>
<p class="has-line-data" data-line-start="9781" data-line-end="9782">RX errors 0 dropped 0 overruns 0 frame 0</p>
<pre><code class="has-line-data" data-line-start="9784" data-line-end="9786">
</code></pre>
<p class="has-line-data" data-line-start="9787" data-line-end="9788">TX packets 560719 bytes 339937974 (324.1 MiB)</p>
<pre><code class="has-line-data" data-line-start="9790" data-line-end="9792">
</code></pre>
<p class="has-line-data" data-line-start="9793" data-line-end="9794">TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</p>
<pre><code class="has-line-data" data-line-start="9796" data-line-end="9813">lo is a virtual network adapter and is called **_loopback_**. It is accessible only from the computer itself. It
is used when programs want to speak with the computer they are running on it.

Ethernet networks are called **ethx** or things like **enp0s25**.

It is possible to use **ifconfig** to change the network configurations, but you should have root access:

$ **sudo ifconfig enp0s25 192.168.42.42**

password for jadi:

$ **ifconfig enp0s25**

enp0s25: flags=4099&lt;UP,BROADCAST,MULTICAST&gt; mtu 1500


</code></pre>
<p class="has-line-data" data-line-start="9814" data-line-end="9816">inet 192.168.42.42 netmask 255.255.255.0 broadcast 192.168.42.255 ether<br>
f0:de:f1:62:c5:73 txqueuelen 1000 (Ethernet) RX packets 0 bytes 0 (0.0 B)</p>
<pre><code class="has-line-data" data-line-start="9818" data-line-end="9820">
</code></pre>
<p class="has-line-data" data-line-start="9821" data-line-end="9822">RX errors 0 dropped 0 overruns 0 frame 0</p>
<pre><code class="has-line-data" data-line-start="9824" data-line-end="9826">
</code></pre>
<p class="has-line-data" data-line-start="9827" data-line-end="9828">TX packets 0 bytes 0 (0.0 B)</p>
<pre><code class="has-line-data" data-line-start="9830" data-line-end="9832">
</code></pre>
<p class="has-line-data" data-line-start="9833" data-line-end="9835">TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0<br>
device interrupt 20 memory 0xd1500000-d1520000</p>
<pre><code class="has-line-data" data-line-start="9837" data-line-end="9857">### $


In the same way, you can change the netmask of an interface with ifconfig eth0 netmask
255.255.0.0 or do both in one step:

# **ifconfig eth0 192.168.42.42 netmask 255.255.255.0**
It is also possible to turn the interfaces **_up_** and **_down_** using a predefined configuration by:

$ **sudo ifconfig enp0s25 down**

[sudo] password for jadi:

$ **ifconfig**

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt; mtu 65536 inet
127.0.0.1 netmask 255.0.0.0


</code></pre>
<p class="has-line-data" data-line-start="9858" data-line-end="9859">inet6 ::1 prefixlen 128 scopeid 0x10&lt;host&gt;</p>
<pre><code class="has-line-data" data-line-start="9861" data-line-end="9863">
</code></pre>
<p class="has-line-data" data-line-start="9864" data-line-end="9865">loop txqueuelen 1 (Local Loopback)</p>
<pre><code class="has-line-data" data-line-start="9867" data-line-end="9869">
</code></pre>
<p class="has-line-data" data-line-start="9870" data-line-end="9871">RX packets 562273 bytes 340257228 (324.4 MiB)</p>
<pre><code class="has-line-data" data-line-start="9873" data-line-end="9875">
</code></pre>
<p class="has-line-data" data-line-start="9876" data-line-end="9877">RX errors 0 dropped 0 overruns 0 frame 0</p>
<pre><code class="has-line-data" data-line-start="9879" data-line-end="9881">
</code></pre>
<p class="has-line-data" data-line-start="9882" data-line-end="9883">TX packets 562273 bytes 340257228 (324.4 MiB)</p>
<pre><code class="has-line-data" data-line-start="9885" data-line-end="9887">
</code></pre>
<p class="has-line-data" data-line-start="9888" data-line-end="9889">TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</p>
<pre><code class="has-line-data" data-line-start="9891" data-line-end="9898">wlp3s0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet
192.168.1.35 netmask 255.255.255.0 broadcast 192.168.1.255 inet6
fe80::8ea9:82ff:fe7b:8906 prefixlen 64 scopeid 0x20&lt;link&gt; ether
8c:a9:82:7b:89:06 txqueuelen 1000 (Ethernet)


</code></pre>
<p class="has-line-data" data-line-start="9899" data-line-end="9900">RX packets 2330388 bytes 2634026235 (2.4 GiB)</p>
<pre><code class="has-line-data" data-line-start="9902" data-line-end="9904">
</code></pre>
<p class="has-line-data" data-line-start="9905" data-line-end="9906">RX errors 0 dropped 0 overruns 0 frame 0</p>
<pre><code class="has-line-data" data-line-start="9908" data-line-end="9910">
</code></pre>
<p class="has-line-data" data-line-start="9911" data-line-end="9912">TX packets 2027352 bytes 511549072 (487.8 MiB)</p>
<pre><code class="has-line-data" data-line-start="9914" data-line-end="9916">
</code></pre>
<p class="has-line-data" data-line-start="9917" data-line-end="9918">TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</p>
<pre><code class="has-line-data" data-line-start="9920" data-line-end="10009">As you can see _down_ing the interface removed it from the list of active interfaces, using switch

- a will tell the ifconfig to show ALL interfaces, even if they are down.

In many systems there are **ifup** and **ifdown** commands directly to up and down interfaces easily.
They work just like **ifup eth0**.

**Network Gateways**

A computer normally can see all of the computers in its own subnet / netmask. But what happens
when you send a packet to a computer _outside_ of your own network? In this case your computer
delivers that packet to an address called **network gateway**. The **gateway** device can **route** the
packets between different networks. It has more than 1 interface and is connected to different
networks so working like a post office, it can hand over your packets to another network and after
several handovers, and your packet will reach its destination.

In your network configurations, there is a **default gateway**. That is the address which is used as a
**gateway** when your computer tries to reach a computer outside its network.

**Network configuration files**

**Redhat based systems**

Unfortunately Debian based and Redhat based systems use different locations for their
nework configuration files. On Redhat, CentOS, Fedora, ... the fields are located at
**/etc/sysconfig/network-scripts/.** A sample is as below:

$ **cat /etc/sysconfig/network-scripts/ifcfg-eth0**

DEVICE=eth0

ONBOOT=yes

TYPE=Ethernet

### IPADDR=192.168.1.10

### NETMASK=255.255.255.0

### DNS1=4.2.2.4


On these systems, the default gateway is configured via the below file:

**cat /etc/sysconfig/network**

NETWORKING=yes

HOSTNAME=lpictest

### GATEWAY=192.168.1.1


**Debian based systems**

On Debian based systems (including Ubuntu) the main configuration file for network

interfaces is **/etc/network/interfaces**. This one file has the configuration for all of the

interfaces. Have a look:

auto lo

iface lo inte loopback

auto eth0

#ifconfig eth0 inet dhcp

iface eth0 inet static

address 192.168.1.10

netmask 255.255.255.0

gateway 192.168.1.1

dns-nameservers 4.2.2.4

ifdown and ifup will use these config files

**DNS config file**

As you saw, we were able to set the DNS configuration in network interface config files. But this is
not the only way. There is another file which contains this data: **/etc/resolv.conf**. $ **cat
/etc/resolv.conf**


</code></pre>
<h1 class="code-line" data-line-start=10010 data-line-end=10011 ><a id="Generated_by_10010"></a>Generated by</h1>
<p class="has-line-data" data-line-start="10012" data-line-end="10015">resolvconf<br>
nameserver<br>
192.168.1.1</p>
<pre><code class="has-line-data" data-line-start="10017" data-line-end="10043">If you want to change your DNS on the fly, you can edit this file but it will be lost after reboot
or **ifdown** and **ifup**.


**Hostname**

There is another text file which shows or sets the hostname. That is **/etc/hostname**. $ **cat
/etc/hostname**

funlife

**Hosts**

The **/etc/hosts** file contains server names and their IPs. It is just like what DNS does but has a
higher priority than DNS. If you add something like

**4.2.2.4 funnyip**

There and ping funnyip your computer will start pinging 4.2.2.4 without querying any DNS server.

There is an entry on /etc/hosts for your machine. If you are changing the /etc/hostname it is
important to add that name to your /etc/hosts line containing 127.0.0.1 too.



</code></pre>
<p class="has-line-data" data-line-start="10044" data-line-end="10045">Route</p>
<pre><code class="has-line-data" data-line-start="10047" data-line-end="10049">
</code></pre>
<p class="has-line-data" data-line-start="10050" data-line-end="10053">The route command can show or change the routing system. As you saw on default gateway<br>
section, routing is responsible to send your packets to their correct destination. For checking the<br>
current route you can issue</p>
<pre><code class="has-line-data" data-line-start="10055" data-line-end="10057">
</code></pre>
<p class="has-line-data" data-line-start="10058" data-line-end="10059">$ route</p>
<pre><code class="has-line-data" data-line-start="10061" data-line-end="10063">
</code></pre>
<p class="has-line-data" data-line-start="10064" data-line-end="10065">Kernel IP routing table</p>
<pre><code class="has-line-data" data-line-start="10067" data-line-end="10069">
</code></pre>
<p class="has-line-data" data-line-start="10070" data-line-end="10071">Destination Gateway Genmask Flags Metric Ref Use Iface</p>
<pre><code class="has-line-data" data-line-start="10073" data-line-end="10075">
</code></pre>
<p class="has-line-data" data-line-start="10076" data-line-end="10077">default gateway 0.0.0.0 UG 600 0 0 wlp3s0</p>
<pre><code class="has-line-data" data-line-start="10079" data-line-end="10081">
</code></pre>
<p class="has-line-data" data-line-start="10082" data-line-end="10083">192.168.1.0 * 255.255.255.0 U 600 0 0 wlp3s0</p>
<pre><code class="has-line-data" data-line-start="10085" data-line-end="10087">
</code></pre>
<p class="has-line-data" data-line-start="10088" data-line-end="10089">And for temporary adding a default route , you can do:</p>
<pre><code class="has-line-data" data-line-start="10091" data-line-end="10093">
</code></pre>
<p class="has-line-data" data-line-start="10094" data-line-end="10095">route add default gw 192.168.1.1</p>
<pre><code class="has-line-data" data-line-start="10097" data-line-end="10101">### IP


</code></pre>
<p class="has-line-data" data-line-start="10102" data-line-end="10104">The ip command is the new tool for configuring the networking interfaces. You can do many things<br>
using it. the addr show will show you the current interfaces and their configurations: $ ip addr show</p>
<pre><code class="has-line-data" data-line-start="10106" data-line-end="10108">
</code></pre>
<p class="has-line-data" data-line-start="10109" data-line-end="10110">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group</p>
<pre><code class="has-line-data" data-line-start="10112" data-line-end="10116">default qlen 1^


</code></pre>
<p class="has-line-data" data-line-start="10117" data-line-end="10119">link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet<br>
127.0.0.1/8 scope host lo</p>
<pre><code class="has-line-data" data-line-start="10121" data-line-end="10123">
</code></pre>
<p class="has-line-data" data-line-start="10124" data-line-end="10126">valid_lft forever preferred_lft forever<br>
inet6 ::1/128 scope host</p>
<pre><code class="has-line-data" data-line-start="10128" data-line-end="10130">
</code></pre>
<p class="has-line-data" data-line-start="10131" data-line-end="10132">valid_lft forever preferred_lft forever</p>
<pre><code class="has-line-data" data-line-start="10134" data-line-end="10136">
</code></pre>
<p class="has-line-data" data-line-start="10137" data-line-end="10138">2: wlp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group</p>
<pre><code class="has-line-data" data-line-start="10140" data-line-end="10144">default qlen 1000^


</code></pre>
<p class="has-line-data" data-line-start="10145" data-line-end="10146">link/ether 8c:a9:82:7b:89:06 brd ff:ff:ff:ff:ff:ff</p>
<pre><code class="has-line-data" data-line-start="10148" data-line-end="10150">
</code></pre>
<p class="has-line-data" data-line-start="10151" data-line-end="10153">inet 192.168.1.35/24 brd 192.168.1.255 scope global dynamic wlp3s0<br>
valid_lft 254572sec preferred_lft 254572sec</p>
<pre><code class="has-line-data" data-line-start="10155" data-line-end="10157">
</code></pre>
<p class="has-line-data" data-line-start="10158" data-line-end="10160">inet6 fe80::8ea9:82ff:fe7b:8906/64 scope link<br>
valid_lft forever preferred_lft forever</p>
<pre><code class="has-line-data" data-line-start="10162" data-line-end="10164">
</code></pre>
<p class="has-line-data" data-line-start="10165" data-line-end="10166">3: enp0s25: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel state DOWN group default</p>
<pre><code class="has-line-data" data-line-start="10168" data-line-end="10281">qlen 1000^


link/ether f0:de:f1:62:c5:73 brd ff:ff:ff:ff:ff:ff

inet 192.168.42.42/24 brd 192.168.42.255 scope global enp0s25
valid_lft forever preferred_lft forever


**Ping**

**Ping** is the most straight forward network troubleshooting command. You can check your
connection with any server using it. Let’s see if my computer sees 4.2.2.4: $ ping 4.2.2.4

PING 4.2.2.4 (4.2.2.4) 56(84) bytes of data.

64 bytes from 4.2.2.4: icmp_seq=1 ttl=52 time=103 ms

64 bytes from 4.2.2.4: icmp_seq=2 ttl=52 time=101 ms

64 bytes from 4.2.2.4: icmp_seq=3 ttl=52 time=103 ms

--- 4.2.2.4 ping statistics ---

6 packets transmitted, 6 received, 0% packet loss, time 5007ms rtt
min/avg/max/mdev = 101.465/103.608/108.219/2.263 ms

**Nsswitch**

The **/etc/nsswitch.conf** file is used to configure which services are to be used to determine
information such as **hostnames** , **password files** , and **group files**. Mine is

# **cat /etc/nsswitch.conf**

# Begin /etc/nsswitch.conf

passwd: files

group: files

shadow: files

publickey: files

hosts: files dns myhostname

networks: files

protocols: files


services: files

ethers: files

rpc: files

netgroup: files

# End /etc/nsswitch.conf

So if someone wants to check a password, the system will try the password _file_ on the system. Or if
they want to check an ip address of a hostname, my config says hosts: files dns myhostname so the
computer first tries the files (/etc/hosts) and then goes for DNS. If I reverse these and change the
line to

hosts: dns files

Any resolve request will be sent to a DNS server first and the /etc/hosts will be used _only_ if the
DNS servers answers &quot;I don’t know!&quot;


**109.3 - Basic network troubleshooting -** **_4_**

**Objectives**

- Manually and automatically configure network interfaces and routing tables to include
    adding, starting, stopping, restarting, deleting or reconfiguring network interfaces.
- Change, view, or configure the routing table and correct an improperly set default route
    manually.
- Debug problems associated with the network configuration.

**Terms and Utilities**

- ifconfig
- ip
- ifup
- ifdown
- route
- host
- hostname
- dig
- netstat
- ping
- ping6
- traceroute
- traceroute6
- tracepath
- tracepath6
- netcat

**Troubleshooting network problems**

When a network related problem is reported to you, you have to take a lot of steps to find out
where the root cause of the problem is. For example if the report says &quot;I cannot open webpages&quot;,
you have to start from checking if the network interface has an ip, if it is up, it the routing is OK and
if the DNS works fine and if everything is OK, you have to try reaching a server on the Internet via
**ping** command and if you see any problems, you have to use **traceroute** to see where your traffic is
going wrong. In this lesson, we will review these basic steps.



</code></pre>
<p class="has-line-data" data-line-start="10282" data-line-end="10283">ifconfig &amp; ip</p>
<pre><code class="has-line-data" data-line-start="10285" data-line-end="10287">
</code></pre>
<p class="has-line-data" data-line-start="10288" data-line-end="10291">As you already know, ifconfig and ip commands can be used to check the IP address of your<br>
interfaces. If a network card is going to work, it needs a correct IP address and netmask. Let me<br>
check my own computer to see it has an IP address: [jadi@funlife ~]$ ip addr show</p>
<pre><code class="has-line-data" data-line-start="10293" data-line-end="10295">
</code></pre>
<p class="has-line-data" data-line-start="10296" data-line-end="10297">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group</p>
<pre><code class="has-line-data" data-line-start="10299" data-line-end="10303">default^


</code></pre>
<p class="has-line-data" data-line-start="10304" data-line-end="10306">link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet<br>
127.0.0.1/8 scope host lo</p>
<pre><code class="has-line-data" data-line-start="10308" data-line-end="10310">
</code></pre>
<p class="has-line-data" data-line-start="10311" data-line-end="10313">valid_lft forever preferred_lft forever<br>
inet6 ::1/128 scope host</p>
<pre><code class="has-line-data" data-line-start="10315" data-line-end="10317">
</code></pre>
<p class="has-line-data" data-line-start="10318" data-line-end="10319">valid_lft forever preferred_lft forever</p>
<pre><code class="has-line-data" data-line-start="10321" data-line-end="10323">
</code></pre>
<p class="has-line-data" data-line-start="10324" data-line-end="10325">2: wlp3s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc pfifo_fast state DOWN</p>
<pre><code class="has-line-data" data-line-start="10327" data-line-end="10331">group default qlen 1000^


</code></pre>
<p class="has-line-data" data-line-start="10332" data-line-end="10333">link/ether f0:de:f1:62:c5:73 brd ff:ff:ff:ff:ff:ff</p>
<pre><code class="has-line-data" data-line-start="10335" data-line-end="10337">
</code></pre>
<p class="has-line-data" data-line-start="10338" data-line-end="10339">3: enp0s25: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default</p>
<pre><code class="has-line-data" data-line-start="10341" data-line-end="10345">qlen 1000^


</code></pre>
<p class="has-line-data" data-line-start="10346" data-line-end="10347">link/ether 8c:a9:82:7b:89:06 brd ff:ff:ff:ff:ff:ff</p>
<pre><code class="has-line-data" data-line-start="10349" data-line-end="10351">
</code></pre>
<p class="has-line-data" data-line-start="10352" data-line-end="10354">inet 192.168.1.35/24 brd 192.168.1.255 scope global dynamic wlp3s0<br>
valid_lft 254836sec preferred_lft 254836sec</p>
<pre><code class="has-line-data" data-line-start="10356" data-line-end="10358">
</code></pre>
<p class="has-line-data" data-line-start="10359" data-line-end="10361">inet6 fe80::8ea9:82ff:fe7b:8906/64 scope link<br>
valid_lft forever preferred_lft forever</p>
<pre><code class="has-line-data" data-line-start="10363" data-line-end="10365">
</code></pre>
<p class="has-line-data" data-line-start="10366" data-line-end="10367">[jadi@funlife ~]$ ifconfig</p>
<pre><code class="has-line-data" data-line-start="10369" data-line-end="10371">
</code></pre>
<p class="has-line-data" data-line-start="10372" data-line-end="10373">enp0s25 Link encap:Ethernet HWaddr f0:de:f1:62:c5:73</p>
<pre><code class="has-line-data" data-line-start="10375" data-line-end="10377">
</code></pre>
<p class="has-line-data" data-line-start="10378" data-line-end="10380">inet addr:192.168.1.35 Bcast:192.168.1.255 Mask:255.255.255.0 inet6<br>
addr: fe80::8ea9:82ff:fe7b:8906/64 Scope:Link</p>
<pre><code class="has-line-data" data-line-start="10382" data-line-end="10384">
</code></pre>
<p class="has-line-data" data-line-start="10385" data-line-end="10389">UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX<br>
packets:231586 errors:0 dropped:0 overruns:0 frame:0 TX<br>
packets:200220 errors:0 dropped:0 overruns:0 carrier:0<br>
collisions:0 txqueuelen:1000</p>
<pre><code class="has-line-data" data-line-start="10391" data-line-end="10393">
</code></pre>
<p class="has-line-data" data-line-start="10394" data-line-end="10395">RX bytes:198053888 (198.0 MB) TX bytes:51583154 (51.5 MB)</p>
<pre><code class="has-line-data" data-line-start="10397" data-line-end="10399">
</code></pre>
<p class="has-line-data" data-line-start="10400" data-line-end="10401">lo Link encap:Local Loopback</p>
<pre><code class="has-line-data" data-line-start="10403" data-line-end="10419">inet addr:127.0.0.1 Mask:255.0.0.0

inet6 addr: ::1/128 Scope:Host

UP LOOPBACK RUNNING MTU:65536 Metric:1

RX packets:221752 errors:0 dropped:0 overruns:0 frame:0

TX packets:221752 errors:0 dropped:0 overruns:0 carrier:0

collisions:0 txqueuelen:0

RX bytes:150859909 (150.8 MB) TX bytes:150859909 (150.8 MB)


</code></pre>
<p class="has-line-data" data-line-start="10420" data-line-end="10422">Both commands show that my IP address is OK. This is assigned to my be the WiFi modem and<br>
192.168.1.35 as IP and 255.255.255.0 looks reasonable.</p>
<pre><code class="has-line-data" data-line-start="10424" data-line-end="10545">**Ping**

This is the most common tool when troubleshooting a network problem. Let’s see if I can see my
network gateway first.

[jadi@funlife ~]$ **route**

Kernel IP routing table

Destination Gateway Genmask Flags Metric Ref Use Iface

default 192.168.1.1 0.0.0.0 UG 600 0 0 wlp3s0

link-local * 255.255.0.0 U 1000 0 0 wlp3s0

192.168.1.0 * 255.255.255.0 U 600 0 0 wlp3s0

[jadi@funlife ~]$ ping 192.168.1.1

PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.

64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=3.02 ms

64 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=3.08 ms ^C

--- 192.168.1.1 ping statistics ---

2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt
min/avg/max/mdev = 3.023/3.052/3.082/0.062 ms

I can ping my gateway but is it possible to reach a server on the Internet using its IP address. Let’s
ping 4.2.2.4; it is very well known server on the Internet and many people use it to check their
connectivity.

[jadi@funlife ~]$ **ping 4.2.2.4**

PING 4.2.2.4 (4.2.2.4) 56(84) bytes of data.

64 bytes from 4.2.2.4: icmp_seq=1 ttl=50 time=108 ms

64 bytes from 4.2.2.4: icmp_seq=2 ttl=50 time=111 ms

64 bytes from 4.2.2.4: icmp_seq=3 ttl=50 time=113 ms ^C

--- 4.2.2.4 ping statistics ---


3 packets transmitted, 3 received, 0% packet loss, time 2003ms rtt
min/avg/max/mdev = 108.160/111.233/113.717/2.338 ms This is
working fine. Bud can I ping google.com too?

[jadi@funlife ~]$ **ping google.com**

ping: unknown host google.com

Aha! We found the problem. In this case I have a correct IP address, I can ping 4.2.2.4 but I cannot
ping google.com with the error message &quot;unknown host&quot;. This means my computer cannot translate
google.com to its IP address; this is a DNS issue:

[jadi@funlife ~]$ **cat /etc/resolv.conf**

# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)

# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

No wonder we had problems with surfing the WWW. There is no active DNS in my computer so no
one will be able to reach sites by their domain names! This should be fixed by adding a DNS to my
configuration files and then use ifdown eth0 and then ifup eth0 to load it.


**Routing problems**

In some situations you cannot reach the Internet (say 4.2.2.4 or 8.8.8.8) but you can ping your
gateway. Have a look:

[jadi@funlife ~]$ **ping 8.8.8.8**

connect: Network is unreachable

[jadi@funlife ~]$ **ping 192.168.1.1**

PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.

64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=3.03 ms

6 4 bytes from 192.168.1.1: icmp_seq=2 ttl=254 time=3.31 ms ^C

--- 192.168.1.1 ping statistics ---

2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt
min/avg/max/mdev = 3.039/3.174/3.310/0.146 ms

What is going on here? Let’s see what clues I have:

1) I can reach the gateway

2) When asking for the Internet, my computer does not know what to do. In this case the **default
gateway** is missing: the computer does not know what to do if a packet is outside its network mask.

You know that we can set the default gateway using the /etc/network/interfaces config file but there
is also a route command to show and change the routing configurations on the fly. Routes added or
changed via route command will be lost after a reboot! Permanent configurations should come from
configuration files.


Let’s check our current routing state using route command as root.

[jadi@funlife ~]$ **sudo route**

[sudo] password for jadi:

Kernel IP routing table

Destination Gateway Genmask Flags Metric Ref Use Iface

link-local * 255.255.0.0 U 1000 0 0 wlp3s0

192.168.1.0 * 255.255.255.0 U6000 0 wlp3s0


</code></pre>
<p class="has-line-data" data-line-start="10546" data-line-end="10550">It is stated that “there is no gateway for the network 192.168.1.0 netmask 255.255.255.0”. This<br>
means that if you ping a server in this network (say 192.168.1.100), it does not needs any routing.<br>
But what happens if you ping 8.8.8.8? Nothing stated in our routing table above! No wonder that<br>
we are getting Network is unreachable when ping 4.2.2.4. Let’s add a default route:</p>
<pre><code class="has-line-data" data-line-start="10552" data-line-end="10554">
</code></pre>
<p class="has-line-data" data-line-start="10555" data-line-end="10556">[jadi@funlife ~]$ sudo route add default gw 192.168.1.1</p>
<pre><code class="has-line-data" data-line-start="10558" data-line-end="10560">
</code></pre>
<p class="has-line-data" data-line-start="10561" data-line-end="10562">[jadi@funlife ~]$ ping 4.2.2.4</p>
<pre><code class="has-line-data" data-line-start="10564" data-line-end="10566">
</code></pre>
<p class="has-line-data" data-line-start="10567" data-line-end="10568">PING 4.2.2.4 (4.2.2.4) 56(84) bytes of data.</p>
<pre><code class="has-line-data" data-line-start="10570" data-line-end="10572">
</code></pre>
<p class="has-line-data" data-line-start="10573" data-line-end="10574">64 bytes from 4.2.2.4: icmp_seq=1 ttl=50 time=109 ms</p>
<pre><code class="has-line-data" data-line-start="10576" data-line-end="10578">
</code></pre>
<p class="has-line-data" data-line-start="10579" data-line-end="10580">64 bytes from 4.2.2.4: icmp_seq=2 ttl=50 time=111 ms</p>
<pre><code class="has-line-data" data-line-start="10582" data-line-end="10584">
</code></pre>
<p class="has-line-data" data-line-start="10585" data-line-end="10586">64 bytes from 4.2.2.4: icmp_seq=3 ttl=49 time=199 ms</p>
<pre><code class="has-line-data" data-line-start="10588" data-line-end="10590">
</code></pre>
<p class="has-line-data" data-line-start="10591" data-line-end="10592">— 4.2.2.4 ping statistics —</p>
<pre><code class="has-line-data" data-line-start="10594" data-line-end="10596">
</code></pre>
<p class="has-line-data" data-line-start="10597" data-line-end="10599">3 packets transmitted, 3 received, 0% packet loss, time 2002ms rtt<br>
min/avg/max/mdev = 109.493/140.344/199.612/41.922 ms</p>
<pre><code class="has-line-data" data-line-start="10601" data-line-end="10603">
</code></pre>
<p class="has-line-data" data-line-start="10604" data-line-end="10605">[jadi@funlife ~]$ sudo route</p>
<pre><code class="has-line-data" data-line-start="10607" data-line-end="10609">
</code></pre>
<p class="has-line-data" data-line-start="10610" data-line-end="10611">Kernel IP routing table</p>
<pre><code class="has-line-data" data-line-start="10613" data-line-end="10615">
</code></pre>
<p class="has-line-data" data-line-start="10616" data-line-end="10617">Destination Gateway Genmask Flags Metric Ref Use Iface</p>
<pre><code class="has-line-data" data-line-start="10619" data-line-end="10621">
</code></pre>
<p class="has-line-data" data-line-start="10622" data-line-end="10623">default 192.168.1.1 0.0.0.0 UG 0 0 0 wlp3s0</p>
<pre><code class="has-line-data" data-line-start="10625" data-line-end="10627">
</code></pre>
<p class="has-line-data" data-line-start="10628" data-line-end="10629">link-local * 255.255.0.0 U 1000 0 0 wlp3s0</p>
<pre><code class="has-line-data" data-line-start="10631" data-line-end="10633">
</code></pre>
<p class="has-line-data" data-line-start="10634" data-line-end="10635">192.168.1.0 * 255.255.255.0 U 600 0 0 wlp3s0</p>
<pre><code class="has-line-data" data-line-start="10637" data-line-end="10639">
</code></pre>
<p class="has-line-data" data-line-start="10640" data-line-end="10643">We were able to ping the Internet after adding a default gateway using route command. It is<br>
important to know that we can define even more routes and control exactly where our packets<br>
should go based on their destinations.</p>
<pre><code class="has-line-data" data-line-start="10645" data-line-end="10955">**Netstat**

This command can show many different information about our network. The two main
functionalities are showing the **routing table** and checking the **listening ports**. Let’s check our
routing table using it.

[jadi@funlife ~]$ **netstat -nr**

Kernel IP routing table

Destination Gateway Genmask Flags MSS Window irtt Iface

0.0.0.0 192.168.1.1 0.0.0.0 UG 0 0 0 wlp3s0

169.254.0.0 0.0.0.0 255.255.0.0 U 0 0 0 wlp3s0

192.168.1.0 0.0.0.0 255.255.255.0 U 0 0 0 wlp3s0

It is also very useful to the see what ports are in listening state in our server:

[jadi@funlife ~]$ **netstat -na | grep 80**

tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN

The **- na** switch will show all the open ports and here I'm checking if port 80 (web) is active on my
server. It is and listening to any connection from 0.0.0.0 which means &quot;anywhere&quot;: Any one can
connect to my computers web server and request pages.

In these switches, -n stands for _numeric_ , -a stands for _all ports_ and -r stands for _routes_.


**Traceroute**

This is a more advanced troubleshooting tool. It is like pinging all the servers between you and
your destination one by one and see where our packets go wrong. Let’s check how I reach
google.com.

[jadi@funlife ~]$ **traceroute google.com**

traceroute to google.com (173.194.32.160), 30 hops max, 60 byte packets

1 192.168.1.1 (192.168.1.1) 3.090 ms 3.113 ms 3.115 ms^

2 85 -^15 -^16 - 103.shatel.ir (85.15.16.103) 29.904 ms 34.851 ms 34.885 ms^

3 85 -^15 -^0 - 193.shatel.ir (85.15.0.193) 34.880 ms 39.454 ms 39.459 ms^

4 85 -^15 -^0 - 1.shatel.ir (85.15.0.1) 39.451 ms 39.444 ms 43.865 ms^

5 172.18.196.17 (172.18.196.17) 43.887 ms 46.506 ms 51.990 ms^

6 172.18.196.22 (172.18.196.22) 51.943 ms 29.418 ms 29.430 ms^

7 10.10.53.229 (10.10.53.229) 32.421 ms 32.344 ms 34.705 ms^

8 10.10.53.222 (10.10.53.222) 39.814 ms 39.773 ms 39.808 ms^

9 xe- 0 - 3 - 3 - xcr2.fri.cw.net (62.208.252.109) 126.654 ms 131.411 ms 131.363 ms 10
ae29 - xcr1.fri.cw.net (195.2.24.221) 126.570 ms 129.053 ms 129.073 ms

11 195.2.19.6 (195.2.19.6) 173.273 ms 173.284 ms 178.795 ms

12 216.239.56.106 (216.239.56.106) 143.786 ms 145.279 ms 216.239.57.143

(216.239.57.143) 115.669 ms

13 209.85.143.25 (209.85.143.25) 111.427 ms 113.970 ms 113.989 ms

14 74.125.37.88 (74.125.37.88) 127.402 ms 125.199 ms 74.125.37.92 (74.125.37.92)

122.175 ms

15 209.85.247.72 (209.85.247.72) 137.551 ms 137.564 ms 140.535 ms

16 72.14.236.249 (72.14.236.249) 161.583 ms 170.447 ms 170.407 ms

17 173.194.32.160 (173.194.32.160) 170.375 ms 72.14.235.231 (72.14.235.231) 159.352 ms
161.666 ms


On the first step (1) I reach my own router. On the 2nd step, I'm at my ISP which is shutel. I'm still on
shatel on 3rd and 4th steps and so on. After a long path, on the 17th step, I reach my destination.
This is used to troubleshoot routing problems.

In some routers, the ping trafic is blocked and you will see * * * at some steps because those
servers are blocking ICMP traffic.

There is another command called **tracepath** which is very similar to traceroute. For the LPIC1
level, they are essentially the same!

**IPv6**

If you are on an IPv6 network you have to use **traceroute6** and **ping6** instead of traceroute and
ping.


**Dig**

The **dig** command is a **DNS lookup tool**. If you are having problem with a domain name, you can
check how it is being resolved to IPs; and by whom. [jadi@funlife ~]$ **dig google.com**

; &lt;&lt;&gt;&gt; DiG 9.9.5-11ubuntu1.3-Ubuntu &lt;&lt;&gt;&gt; google.com ;;
global options: +cmd

;; Got answer:

;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 50032

;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

### ;; QUESTION SECTION:

;google.com. IN A

### ;; ANSWER SECTION:

google.com. 293 IN A 216.58.214.46

;; Query time: 120 msec

;; SERVER: 4.2.2.4#53(4.2.2.4)

;; WHEN: Fri Apr 01 22:00:05 IRDT 2016

;; MSG SIZE rcvd: 44
You can see that SERVER 4.2.2.4 is resolving google.com to 216.58.214.46.

**Netcat**

The **nc** (or **netcat** ) utility is used for just about anything under the sun involving TCP, UDP, or UNIX-
domain sockets. It can **open TCP connections** , **send UDP packets** , **listen on arbitrary TCP** and **UDP**
por **t** s, do **port scanning** , and deal with **both IPv4** and **IPv6**.

Unlike telnet, nc scripts nicely, and separates error messages onto standard error instead of sending
them to standard output, as telnet does with some. This is a very capable command and it is enough
for you to be familiar with its general concept.


**109.4 Configure client-side DNS -** **_2_**

**Objectives**

- Query remote DNS servers.
- Configure local name resolution and use remote DNS servers.
- Modify the order in which name resolution is done.

**Terms and Utilities**

- /etc/hosts
- /etc/resolv.conf
- /etc/nsswitch.conf
- host
- dig
- getent

### DNS

We already know a lot about **Domain Name Server** - A service who translates domain

names (like yahoo.com) to IP addresses (like 206.190.36.45). A DNS server is used when you

try to ping a server using its name. You have seen the config files for DNS and should know

that the actual DNS server which is being used by the computer can be checked / changed

(temporarily) from **/etc/resolv.conf** :

$ **cat /etc/resolv.conf**

# Generated by NetworkManager
nameserver 192.168.1.1
nameserver 4.2.2.4

$ **ping x.org**

PING x.org (131.252.210.176) 56(84) bytes of data.

64 bytes from annarchy.freedesktop.org (131.252.210.176): icmp_seq=1 ttl=45 time=338 ms


64 bytes from annarchy.freedesktop.org (131.252.210.176): icmp_seq=2 ttl=45 time=333

ms

### ^C

--- x.org ping statistics ---

2 packets transmitted, 2 received, 0% packet loss, time 1000ms rtt
min/avg/max/mdev = 333.088/335.612/338.136/2.524 ms


**Dig**

The dig tool is specifically build to **query DNS**. If you want to find out where x.org points to,

you can do:

$ **dig x.org**

; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-RedHat-9.10.3-12.P4.fc23 &lt;&lt;&gt;&gt; x.org ;;
global options: +cmd

;; Got answer:

;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 7483

;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

### ;; OPT PSEUDOSECTION:

; EDNS: version: 0, flags:; udp: 512

;; QUESTION SECTION:

;x.org. IN A

### ;; ANSWER SECTION:

x.org. 1625 IN A 131.252.210.176

;; Query time: 35 msec

;; SERVER: 192.168.1.1#53(192.168.1.1)

;; WHEN: Sun Apr 17 12:45:02 IRDT 2016

;; MSG SIZE rcvd: 50

As you can see, dig did a **ip lookup** for x.org and told me that the IP is 131.252.210.176. The 1625 is
called the TTL or _Time To Live_ and show how many seconds before this answer expires. This
command also tells us which server is used to find the answer (last 4 lines) and when and how long
it took.


There is also a way to tell dig command what server it should use as the DNS:

$ **dig @8.8.8.8 google.com**

; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-RedHat-9.10.3-12.P4.fc23 &lt;&lt;&gt;&gt; @8.8.8.8 google.com

; (1 server found)

;; global options: +cmd

;; Got answer:

;; - &gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24313

;; flags: qr rd ra; QUERY: 1, ANSWER: 11, AUTHORITY: 0, ADDITIONAL: 1

### ;; OPT PSEUDOSECTION:

; EDNS: version: 0, flags:; udp: 512

;; QUESTION SECTION:

;google.com. IN A

### ;; ANSWER SECTION:

google.com. 112 IN A 173.194.32.133

google.com. 112 IN A 173.194.32.136

google.com. 112 IN A 173.194.32.132

google.com. 112 IN A 173.194.32.129

google.com. 112 IN A 173.194.32.137

google.com. 112 IN A 173.194.32.130

google.com. 112 IN A 173.194.32.134

google.com. 112 IN A 173.194.32.135

google.com. 112 IN A 173.194.32.128

google.com. 112 IN A 173.194.32.131

google.com. 112 IN A 173.194.32.142


;; Query time: 238 msec

;; SERVER: 8.8.8.8#53(8.8.8.8)

;; WHEN: Sun Apr 17 13:03:38 IRDT 2016

;; MSG SIZE rcvd: 215

Here I have asked dig to use 8.8.8.8 as its DNS and query google.com. You can see that I've got
more than 1 answer (actually much more than 1 answer). My computer can randomly contact any
of those IPs to reach the google.com. In other words, google.com is using more than 1 server/IP
and 8.8.8.8 provides all of them when queried for that domain.


**/etc/hosts**

This is a file containing IP addresses and their domain names - statically saved! Lets have a look:

$ head /etc/hosts

127.0.0.1 funlife localhost.localdomain

::1 funlife localhost6.localdomain6


</code></pre>
<p class="has-line-data" data-line-start="10956" data-line-end="10957">localhost <a href="http://clickadu.com">clickadu.com</a></p>
<pre><code class="has-line-data" data-line-start="10959" data-line-end="10961">
</code></pre>
<p class="has-line-data" data-line-start="10962" data-line-end="10963">localhost6</p>
<pre><code class="has-line-data" data-line-start="10965" data-line-end="11056">10.159.32.155 nsnproxy

172.16.12.134 linuxclass wonderland

193.40.12.135 salma

87.106.233.90 gratis.vps

192.168.59.231 mass1

This file can be changed by root and will map some domain names (localhost, mass1,
gratis.vps, ...) to some IP addresses. If I ping _mass1_ on this computer.. lets see:

$ **dig mass1**

; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-RedHat-9.10.3-12.P4.fc23 &lt;&lt;&gt;&gt; mass1 ;;
global options: +cmd

;; Got answer:

;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 39464

;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

### ;; OPT PSEUDOSECTION:

; EDNS: version: 0, flags:; udp: 512

;; QUESTION SECTION:

;mass1. IN A


### ;; AUTHORITY SECTION:

. 600 IN SOA a.root-servers.net. nstld.verisign-grs.com. 2016041700 1800 900 604800 86400

;; Query time: 516 msec

;; SERVER: 192.168.1.1#53(192.168.1.1)

;; WHEN: Sun Apr 17 13:15:07 IRDT 2016

;; MSG SIZE rcvd: 109

$ **ping mass1**

PING mass1 (192.168.59.231) 56(84) bytes of data.

From 85- 15 - 16 - 103.shatel.ir (85.15.16.103) icmp_seq=1 Packet filtered From
85 - 15 - 16 - 103.shatel.ir (85.15.16.103) icmp_seq=2 Packet filtered

My computer pings 192.168.59.231 when I go for mass1 even when the DNS cannot finds this
name because that is defined in **/etc/hosts**.


**Nsswitch**

The **/etc/nsswitch.conf** file tells the system about the priority of lookups, password checks. $ **cat
/etc/nsswitch.conf**

### #

# /etc/nsswitch.conf

#
# An example Name Service Switch config file. This file should be

# sorted with the most-used services at the beginning.

#

# The entry '[NOTFOUND=return]' means that the search for an

# entry should stop if the search in the previous entry turned

# up nothing. Note that if the search failed due to some other reason

# (like no NIS server responding) then the search continues with the

# next entry.

#

# Valid entries include:

#
# nisplus Use NIS+ (NIS version 3)


</code></pre>
<h1 class="code-line" data-line-start=11057 data-line-end=11058 ><a id="nis_Use_NIS_NIS_version_2_also_called_YP_11057"></a>nis Use NIS (NIS version 2), also called YP</h1>
<pre><code class="has-line-data" data-line-start="11060" data-line-end="11062">
</code></pre>
<h1 class="code-line" data-line-start=11063 data-line-end=11064 ><a id="dns_Use_DNS_Domain_Name_Service_11063"></a>dns Use DNS (Domain Name Service)</h1>
<pre><code class="has-line-data" data-line-start="11066" data-line-end="11068">
</code></pre>
<h1 class="code-line" data-line-start=11069 data-line-end=11070 ><a id="files_Use_the_local_files_11069"></a>files Use the local files</h1>
<pre><code class="has-line-data" data-line-start="11072" data-line-end="11074">
</code></pre>
<h1 class="code-line" data-line-start=11075 data-line-end=11076 ><a id="db_Use_the_local_database_db_files_11075"></a>db Use the local database (.db) files</h1>
<pre><code class="has-line-data" data-line-start="11078" data-line-end="11080">
</code></pre>
<h1 class="code-line" data-line-start=11081 data-line-end=11082 ><a id="compat_Use_NIS_on_compat_mode_11081"></a>compat Use NIS on compat mode</h1>
<pre><code class="has-line-data" data-line-start="11084" data-line-end="11086">
</code></pre>
<h1 class="code-line" data-line-start=11087 data-line-end=11088 ><a id="hesiod_Use_Hesiod_for_user_lookups_11087"></a>hesiod Use Hesiod for user lookups</h1>
<pre><code class="has-line-data" data-line-start="11090" data-line-end="11092">
</code></pre>
<h1 class="code-line" data-line-start=11093 data-line-end=11094 ><a id="NOTFOUNDreturn_Stop_searching_if_not_found_so_far_11093"></a>[NOTFOUND=return] Stop searching if not found so far</h1>
<pre><code class="has-line-data" data-line-start="11096" data-line-end="11098">
</code></pre>
<h1 class="code-line" data-line-start=11099 data-line-end=11100 ><a id="_11099"></a></h1>
<pre><code class="has-line-data" data-line-start="11102" data-line-end="11728"># To use db, put the &quot;db&quot; in front of &quot;files&quot; for entries you want to be

# looked up first in the databases

#

# Example:


#passwd: db files nisplus nis

#shadow: db files nisplus nis

#group: db files nisplus nis

passwd: files sss

shadow: files sss

group: files sss

#hosts: db files nisplus nis dns

hosts: files mdns4_minimal [NOTFOUND=return] dns myhostname mymachines

# Example - obey only what nisplus tells us...

#services: nisplus [NOTFOUND=return] files

#networks: nisplus [NOTFOUND=return] files


#protocols: nisplus [NOTFOUND=return] files

#rpc: nisplus [NOTFOUND=return] files

#ethers: nisplus [NOTFOUND=return] files

#netmasks: nisplus [NOTFOUND=return] files

bootparams: nisplus [NOTFOUND=return] files

ethers: files

netmasks: files

networks: files

protocols: files

rpc: files

services: files sss

netgroup: files sss

publickey: nisplus

automount: files sss

aliases: files nisplus

On the DNS line I have hosts: files mdns4_minimal [NOTFOUND=return] dns myhostname
mymachines. This means when the system wants to find the IP address of a name, it first go for the
files (/etc/hosts) and then for m **dns** 4_minimal and then **dns** and so on. In this case if I add the
facebook.com to my **/etc/hosts** like this:

**127.0.0.1 facebook.com**

And then point my browser to facebook.com, my computer will try to open a webserver on
127.0.0.1 instead of the real IP of Facebook.


**Getent**

The **getent** command is a utility to get entries from Name Service Switch libraries (read
/etc/nsswitch.conf). If you want to check what the config of your hosts is, you can do as follow.

$ **getent hosts**

127.0.0.1 funlife localhost.localdomain localhost clickadu.com

127.0.0.1 funlife localhost6.localdomain6 localhost6

10.159.32.155 nsnproxy

172.16.12.134 linuxclass wonderland

193.40.12.135 salma

87.106.233.90 gratisvps

192.168.59.231 mass1

192.168.59.232 mass2

192.168.59.233 mass3

192.168.59.234 mass4

192.168.59.235 mass5

192.168.59.236 mass6

192.168.59.237 mass7

192.168.59.238 mass8

192.168.59.239 mass9

127.0.0.1 frctlstartupfailure localtodoer localdeliv

127.0.0.1 frctlmeth

### ```


**110.1 - Perform security administration tasks -** **_3_**

**Objectives**

- Audit a system to find files with the suid/sgid bit set.
- Set or change user passwords and password aging information.
- Being able to use nmap and netstat to discover open ports on a system.
- Set up limits on user logins, processes and memory usage.
- Determine which users have logged in to the system or are currently logged in.
- Basic sudo configuration and usage.

**Terms and Utilities**

- find
- passwd
- fuser
- lsof
- nmap
- chage
- netstat
- sudo
- /etc/sudoers
- su
- usermod
- ulimit
- who, w, last

**suid and guid**

When the **suid** bit is set on an executable file, whoever runs the file, is running the file with the
access of the owner of the file. Have a look at the ping command: jadi@funlife ~$ **type ping**

ping is hashed (/bin/ping)

jadi@funlife ~$ **ls -ltrh /bin/ping**

- rwsr-xr-x 1 root root 44K May 8 2014 /bin/ping

The s on the access rights part, tells us that whoever runs the ping command, the ping
command will be run with root access. This is needed by root and is OK on my distro.


What happens if someone changes the suid of the vi command? let’s see who own vi:

jadi@funlife ~$ **type vi**

vi is /usr/bin/vi

jadi@funlife ~$ **ls -ltrh /usr/bin/vi**

lrwxrwxrwx 1 root root 20 Jun 1 12:52 /usr/bin/vi -&gt; /etc/alternatives/vi

At the moment, the vi is owned by root, so if the suid bit is set, vi will always be run as root!

In that case anybody will be able to edit any file! You can see why it is important to check for

suid files on your system:

$ **sudo find / -perm -u+s**

Same applies for guid. If the guid is set, the file will be run with access of its group.


**Open Ports**

**netstat, fuser and lsof**

On module 109.1 we talked about ports, ports are like wholes in our systems used by servers to
listen to the outside world. If I'm running a web server on my computer I should have a port open so
people can ask that server &quot;please show me your index.html&quot;. Many malwares open ports to let the
attacker to communicate with them. It is important to check your computer for open ports time to
time. The main command for this task is **netstat** using the **- na** or **- ap** or **- tuna** switch.. I'm sure tuna is
easy to remember if you have the tuna fish in mind!

jadi@funlife ~$ **netstat -tuna**

Active Internet connections (servers and established)

Proto Recv-Q Send-Q Local Address Foreign Address State

tcp 0 0 127.0.0.1:3306 0.0.0.0:* LISTEN

tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN

tcp 0 0 127.0.1.1:53 0.0.0.0:* LISTEN

tcp 0 0 127.0.0.1:9050 0.0.0.0:* LISTEN

tcp 25 0 192.168.59.9:49934 192.168.59.192:139 CLOSE_WAIT

tcp 0 0 127.0.0.1:60228 127.0.0.1:1080 ESTABLISHED

tcp 0 0 192.168.1.35:55324 159.203.148.169:8385 ESTABLISHED

tcp 0 0 127.0.0.1:59590 127.0.0.1:1080 ESTABLISHED

tcp 0 0 127.0.0.1:60212 127.0.0.1:1080 ESTABLISHED

tcp 0 0 192.168.1.35:54220 159.203.148.169:8385 ESTABLISHED

tcp 0 0 127.0.0.1:57186 127.0.0.1:1080 ESTABLISHED

tcp 0 0 192.168.1.35:49574 173.194.122.231:443 ESTABLISHED

tcp 0 0 127.0.0.1:59002 127.0.0.1:1080 ESTABLISHED

udp 0 0 0.0.0.0:54502 0.0.0.0:*

udp 0 0 0.0.0.0:5353 0.0.0.0:*

udp 0 0 0.0.0.0:5353 0.0.0.0:*

All the LISTEN ports are servers; they are LISTENING for new incoming connections. The
ESTABLISHED connections are the active connections between your computer and another
computer. In these tables 0.0.0.0 dictates _any address_ or _any interface_.


Another useful tool here is **lsof** and **fuser**. The former is already discussed in previous
sections.

**lsof** shows the open files on the system and having in mind that _everything in Linux is a file or a
process_ you can conclude that this command should be able to display open connections too; and
you are right:

# **lsof -i**

COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME

privoxy 806 privoxy 4u IPv4 16130 0t0 TCP funlife:8118 (LISTEN)

cups-brow 903 root 8u IPv4 17477 0t0 UDP *:ipp

mysqld 971 mysql 19u IPv4 20875 0t0 TCP funlife:mysql (LISTEN)

tor 1038 debian-tor 6u IPv4 19155 0t0 TCP funlife:9050 (LISTEN)

dnsmasq 1260 nobody 11u IPv4 1910037 0t0 UDP *:18666

adb 1278 jadi 5u IPv4 579541 0t0 TCP funlife:5037 (LISTEN)

chromium- 2891 jadi 88u IPv4 813611 0t0 TCP 192.168.1.35:45702-&gt;do-

13.lastpass.com:https (ESTABLISHED)

chromium- 2891 jadi 126u IPv4 1907389 0t0 TCP 192.168.1.35:50642-&gt;ntt-

2.lastpass.com:https (ESTABLISHED)

chromium- 2891 jadi 133u IPv4 1909733 0t0 TCP 192.168.1.35:50644-&gt;ntt-

2.lastpass.com:https (ESTABLISHED)

chromium- 2891 jadi 268u IPv4 785289 0t0 TCP 192.168.1.35:60736-&gt;lf-in-

f188.1e100.net:5228 (ESTABLISHED)

python 4925 jadi 4u IPv4 658287 0t0 TCP funlife:8000 (LISTEN)

Telegram 4943 jadi 39u IPv4 773463 0t0 TCP 192.168.1.35:44732-

&gt;149.154.175.50:https (ESTABLISHED)

dhclient 9984 root 6u IPv4 787885 0t0 UDP *:bootpc

nginx 11095 root 6u IPv4 17998 0t0 TCP *:http (LISTEN)

nginx 11099 www-data 7u IPv6 17999 0t0 TCP *:http (LISTEN)

chrome 14264 jadi 114u IPv4 788089 0t0 UDP *:mdns

chrome 14264 jadi 126u IPv4 1872872 0t0 TCP funlife:60370-&gt;funlife:socks

(ESTABLISHED)

chrome 14264 jadi 138u IPv4 1908382 0t0 TCP funlife:60408-&gt;funlife:socks


### (ESTABLISHED)

Wow! this command shows the command, PID, user running it and source and destination IP and
tells of if this is a LISTENING or STABLISHED connection.

If you want to check which process is using port 80, you can grep the output of any above
commands or simply use the fuser command to find all the PIDs related to that specific port:
root@funlife:/bin# **fuser 80/tcp**

80/tcp: 11095 11096 11097 11098 11099


**nmap**

**nmap** is the toolbox of hackers! You can nmap a server to find out about a lot of data about that
server:

# **nmap localhost**

Starting Nmap 7.01 ( https://nmap.org ) at 2016 - 06 - 04 21:32 IRDT
Nmap scan report for localhost (127.0.0.1) Host is up (0.0000070s
latency).

rDNS record for 127.0.0.1: funlife

Not shown: 995 closed ports

### PORT STATE SERVICE

80/tcp open http

1080/tcp open socks

3306/tcp open mysql

8000/tcp open http-alt

9050/tcp open tor-socks

Nmap done: 1 IP address (1 host up) scanned in 1.66 seconds
root@funlife:~#

In the most basic form, **nmap** checks all the open ports from 1 to 1000 and prints the results.
There are a lot of switches to find other information about the hosts and they are used by every
single hacker who wants to examine a server’s status.


**sudo vs su**

We've used sudo and su in all the chapters and this is time to have a closer look at them! **su**
changes your account to something else. You get a new prompt with the new user account after
successfully suing to that account: jadi@funlife ~$ **whoami**

jadi

jadi@funlife ~$ **su -**

Password:

root@funlife:~# **whoami**

root

root@funlife:~# **su jadi -**

bash: cannot set terminal process group (-1): Inappropriate ioctl for device

bash: no job control in this shell

jadi@funlife /root$ **whoami**

jadi

jadi@funlife /root$ **exit**

exit

root@funlife:~# **whoami**

root

root@funlife:~# **exit**

logout

jadi@funlife ~$ **whoami**

jadi

jadi@funlife ~$


Note that when running su you have to **provide the root password** to become root; or any other
users password to become that user!

On the other hand, **sudo** asks for you own password and runs the command you gave it, with the
root privileges. So sudo ls runs the ls command with the root privileges after asking for **your
password**. Obviously you should have the _sudo right_ to issue sudo. This is defined in **/etc/sudoers**
file:

$ **sudo cat /etc/sudoers**

### #

# This file MUST be edited with the 'visudo' command as root.

#
# Please consider adding local content in /etc/sudoers.d/ instead of

# directly modifying this file.

#

# See the man page for details on how to write a sudoers file.

#

Defaults env_reset
Defaults mail_badpass

Defaults secure_path=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;

# Host alias specification


# User alias specification

# Cmnd alias specification

# User privilege specification

root ALL=(ALL:ALL) ALL

# Members of the admin group may gain root privileges
%admin ALL=(ALL) ALL

# Allow members of group sudo to execute any command

%sudo ALL=(ALL:ALL) ALL

# See sudoers(5) for more information on &quot;#include&quot; directives:

#includedir /etc/sudoers.d

Note the 2 important lines: how root gets the right to run all the commands and how the sudo and
admin groups get rights to run commands as root. The ALL:ALL means these users can run as any
use and any group. The last ALL tells the sudo that these users / groups can run ALL commands. It is
possible to put /bin/ping in the last part to tell sudo that this user can run only ping as root.

The /etc/sudoers file is very important and breaking it will make major problems. To prevent you
from adding un-interpretable lines in that file, the **visudo** command should be used instead of vi
/etc/sudoers. This tool will check your edits to make sure that sudo command can understand them.

Now we know what sudo su - means. The sudo tells the system to run the su - command with the
root access. It asks your password and runs the su - as the root if you have sudo access. The su
commands changes your user to root and - switch load the root environment variables. This way
you can become root using your own password via running su with sudo.


**User limits**

The resources on a Linux machine can be manages for users by the **ulimit** command. It is part of
the PAM system. If you want to check the limits on the system run: ~$ **ulimit -a**

core file size (blocks, -c) 0

data seg size (kbytes, -d) unlimited

scheduling priority (-e) 0

file size (blocks, -f) unlimited

pending signals (-i) 47457

max locked memory (kbytes, -l) 64

max memory size (kbytes, -m) unlimited

open files (-n) 1024

pipe size (512 bytes, -p) 8

POSIX message queues (bytes, -q) 819200

real-time priority (-r) 0

stack size (kbytes, -s) 8192

cpu time (seconds, -t) unlimited

max user processes (-u) 47457

virtual memory (kbytes, -v) unlimited

file locks (-x) unlimited

And you can change them like this:

$ **ulimit -t 1**

This will limit the CPU TIME of any process to 1 seconds. If you use more than that, the process will
be killed automatically (by PAM module). Please note that clock time is different than CPU time. To
see how much CPU time a process uses run it like this:

$ **time firefox**

Changing the **ulimit** as we did is a temporary thing. It only persists in that specific shell.


To change the **ulimits system-wide** :

$ **cat /etc/security/limits.conf**

# /etc/security/limits.conf

#
#Each line describes a limit for a user in the form:

### #

#&lt;domain&gt; &lt;type&gt; &lt;item&gt; &lt;value&gt;

### #

#Where:

#&lt;domain&gt; can be:

# - a user name

# - a group name, with @group syntax

# - the wildcard *, for default entry

# - the wildcard %, can be also used with %group syntax,


# for maxlogin limit

# - NOTE: group and wildcard limits are not applied to root.

# To apply a limit to the root user, &lt;domain&gt; must be

# the literal username root.

#

#&lt;type&gt; can have the two values:

# - &quot;soft&quot; for enforcing the soft limits

# - &quot;hard&quot; for enforcing hard limits

#
#&lt;item&gt; can be one of the following:

# - core - limits the core file size (KB)

# - data - max data size (KB)

# - fsize - maximum filesize (KB)

# - memlock - max locked-in-memory address space (KB)

# - nofile - max number of open files

# - rss - max resident set size (KB)

# - stack - max stack size (KB)

# - cpu - max CPU time (MIN)

# - nproc - max number of processes

# - as - address space limit (KB)

# - maxlogins - max number of logins for this user

# - maxsyslogins - max number of logins on the system

# - priority - the priority to run user process with

# - locks - max number of file locks the user can hold

# - sigpending - max number of pending signals

# - msgqueue - max memory used by POSIX message queues (bytes)

# - nice - max nice priority allowed to raise to values: [-20, 19]

# - rtprio - max realtime priority

# - chroot - change root to directory (Debian-specific)

#

#&lt;domain&gt; &lt;type&gt; &lt;item&gt; &lt;value&gt;


### #

#* soft core 0

#root hard core 100000

#* hard rss 10000

#@student hard nproc 20

#@faculty soft nproc 20

#@faculty hard nproc 50

#ftp hard nproc 0

#ftp - chroot /ftp

#@student - maxlogins 4

# End of file

**Soft** limits can be changed by the user but hard limits are the real stop points.


**Checking the users in the system**

If you need to check who is in your system (and to some extend what they are doing) you can
use these commands:

$ **w**

</code></pre>
<p class="has-line-data" data-line-start="11729" data-line-end="11730">22:03:37 up 3 days, 5:33, 13 users, load average: 1.48, 1.12, 1.19</p>
<pre><code class="has-line-data" data-line-start="11732" data-line-end="11873">### USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT

jadi tty7 :0 Wed16 3days 2:30m 1.96s /sbin/upstart --user

jadi pts/18 :0 Wed16 3:04m 1:02 1:02 /usr/bin/python manage.py runserver

0.0.0.0:8000

jadi pts/19 :0 Wed16 1:11m 0.35s 0.35s /bin/bash

root tty2 Wed16 3days 0.07s 0.03s -bash

jadi pts/21 :0 08:41 45:37 0.06s 0.06s /bin/bash

jadi pts/23 :0 Thu11 46:49 0.25s 0.23s ssh startups

jadi pts/21 funlife Fri22 45:37 0.06s 0.06s /bin/bash

jadi pts/25 :0 10:17 31:37 0.07s 5.81s /usr/bin/python /usr/bin/x-terminal-

emulator

jadi pts/26 :0 21:39 0.00s 0.07s 0.00s w

jadi pts/27 :0 21:55 8:09 0.01s 0.01s /bin/bash

You have a line for each logged in users (every single shell window is a separated login).

Another useful command is **who**. Let’s check it:

$ **who**

jadi tty7 2016 - 06 - 01 16:30 (:0)

jadi pts/17 2016 - 06 - 01 16:30 (funlife)

jadi pts/2 2016 - 06 - 01 16:32 (:0)

jadi pts/18 2016 - 06 - 01 16:32 (:0)

jadi pts/19 2016 - 06 - 01 16:33 (:0)

root tty2 2016 - 06 - 01 16:36

jadi pts/21 2016 - 06 - 04 08:41 (:0)


As you can see both these commands tell you when was the **time** that the user logged into the
system but does not show the logged out people (because they are not on the system anymore!). If
you need that data use the last command:

~$ **last | head**

jadi pts/27 :0 Sat Jun 4 21:55 gone - no logout

jadi pts/26 :0 Sat Jun 4 21:39 gone - no logout

jadi pts/26 :0 Sat Jun 4 18:55 - 19:42 (00:46)

jadi pts/25 :0 Sat Jun 4 10:17 gone - no logout

jadi pts/26 :0 Sat Jun 4 09:25 - 09:26 (00:00)

jadi pts/26 :0 Sat Jun 4 09:25 - 09:25 (00:00)

jadi pts/25 :0 Sat Jun 4 08:52 - 09:27 (00:35)

jadi pts/21 :0 Sat Jun 4 08:41 gone - no logout

jadi pts/21 funlife Fri Jun 3 22:22 - 08:41 (10:18)

There is a way to check the failed logins too: **last -f /var/log/btmp**


**110.2 - Setup host security -** **_3_**

**Objectives**

- Awareness of shadow passwords and how they work.
- Turn off network services not in use.
- Understand the role of TCP wrappers.

**Terms and Utilities**

- /etc/nologin
- /etc/passwd
- /etc/shadow
- /etc/xinetd.d/
- /etc/xinetd.conf
- /etc/inetd.d/
- /etc/inetd.conf
- /etc/inittab
- /etc/init.d/
- /etc/hosts.allow
- /etc/hosts.deny

Shadow passwords

The **/dev/passwd** is already discussed. It contains the passwords of the users but there is a logical
problem: if a user should be able to change her own password, he should have access to this file and
if this is the case, he can see other people’s passwords. $ **ls -ltrh /etc/passwd**

- rw-r--r-- 1 root root 2.5K Jun 5 19:14 /etc/passwd

To prevent this the **/etc/shadow** file is introduces. In modern systems, we only show a * at

the **location of the password** in **/etc/passwd** and **store the real password** in **/etc/shadow**.

jadi@funlife ~$ **grep jadi /etc/passwd**

jadi:x:1000:1000:jadi,,,:/home/jadi:/bin/bash

jadi@funlife ~$ **grep jadi /etc/shadow**


grep: /etc/shadow: Permission denied

jadi@funlife ~$ **sudo grep jadi /etc/shadow**

[sudo] password for jadi:

jadi:$6$bp01DBX.$I6dt4pz8GeXJl6asgPeKhSdepf40bgepTz8zwB3HFmN56SdcsxjTETdZAmRt1
7biwMYOI7SoGFOXssHqeNFgw/:16963:0:99999:7::: jadi@funlife ~$ sudo ls -ltrh /etc/shadow

- rw-r----- 1 root shadow 1.5K Jun 11 17:36 /etc/shadow

**/etc/nologin**

This is a cool file! If you create and write something in it, the content will be shown to any person
who tries to login into the system and **the login attempt will fail**. It is useful for maintenance
time. Delete this file and the users will be able to login again.

**Admin** users will be able to login even in the presence of /etc/nologin

**Turn off network services**

Turning services off is easy but a bit different on different systems. In case you want to turn the
**httpd service off** , you can do:


</code></pre>
<p class="has-line-data" data-line-start="11874" data-line-end="11875">system service manager command</p>
<pre><code class="has-line-data" data-line-start="11877" data-line-end="11879">
</code></pre>
<p class="has-line-data" data-line-start="11880" data-line-end="11882">older linux systems<br>
SysV</p>
<pre><code class="has-line-data" data-line-start="11884" data-line-end="11886">
</code></pre>
<p class="has-line-data" data-line-start="11887" data-line-end="11888">chkconfig httpd off</p>
<pre><code class="has-line-data" data-line-start="11890" data-line-end="11892">
</code></pre>
<p class="has-line-data" data-line-start="11893" data-line-end="11894">sysv-rc-conf httpd off</p>
<pre><code class="has-line-data" data-line-start="11896" data-line-end="11898">
</code></pre>
<p class="has-line-data" data-line-start="11899" data-line-end="11900">Ubuntu Upstart update-rc.d httpd remove</p>
<pre><code class="has-line-data" data-line-start="11902" data-line-end="11904">
</code></pre>
<p class="has-line-data" data-line-start="11905" data-line-end="11906">newer linux distros systemd systemctl disable httpd</p>
<pre><code class="has-line-data" data-line-start="11908" data-line-end="11925">Please note that these commands prevent the service from starting on system boot.


**Super-servers**

A super-server or sometimes called a service dispatcher is a type of daemon run generally on Unix-
like systems for security reasons. It starts other servers when needed, normally with access to them
checked by a TCP wrapper.

This is a sample **xinetd** configuration:

service telnet

### {


</code></pre>
<p class="has-line-data" data-line-start="11926" data-line-end="11927">disable = no</p>
<pre><code class="has-line-data" data-line-start="11929" data-line-end="11931">
</code></pre>
<p class="has-line-data" data-line-start="11932" data-line-end="11933">flags = REUSE</p>
<pre><code class="has-line-data" data-line-start="11935" data-line-end="11937">
</code></pre>
<p class="has-line-data" data-line-start="11938" data-line-end="11939">socket_type = stream</p>
<pre><code class="has-line-data" data-line-start="11941" data-line-end="11943">
</code></pre>
<p class="has-line-data" data-line-start="11944" data-line-end="11945">wait = no</p>
<pre><code class="has-line-data" data-line-start="11947" data-line-end="11949">
</code></pre>
<p class="has-line-data" data-line-start="11950" data-line-end="11951">user = root</p>
<pre><code class="has-line-data" data-line-start="11953" data-line-end="11955">
</code></pre>
<p class="has-line-data" data-line-start="11956" data-line-end="11957">server = /usr/sbin/in.telnetd</p>
<pre><code class="has-line-data" data-line-start="11959" data-line-end="11961">
</code></pre>
<p class="has-line-data" data-line-start="11962" data-line-end="11963">log_on_failure += USERID</p>
<pre><code class="has-line-data" data-line-start="11965" data-line-end="11967">
</code></pre>
<p class="has-line-data" data-line-start="11968" data-line-end="11969">no_access = 10.0.1.0/24</p>
<pre><code class="has-line-data" data-line-start="11971" data-line-end="12126">### }

If we change the disable to yes and restart the xinetd, the telnet daemon will start running.

There are a few files to control to xinetd related files.


**/etc/hosts.allow &amp; /etc/hosts.deny**

These two files will **allow** or **deny access** from specific hosts. Its logic is like cron.deny and
cron.allow. If something is **allowd** , everything else is denied but if you add something to the
/etc/hosts.deny, only that specific thing is denied (and every other thing is allowed).

jadi@funlife ~$ **cat /etc/hosts.allow**

# /etc/hosts.allow: list of hosts that are allowed to access the system.

# See the manual pages hosts_access(5) and hosts_options(5).

#
# Example: ALL: LOCAL @some_netgroup

# ALL: .foobar.edu EXCEPT terminalserver.foobar.edu

#

# If you're going to protect the portmapper use the name &quot;rpcbind&quot; for the

# daemon name. See rpcbind(8) and rpc.mountd(8) for further information.

#

telnet: 10.10.100.

Here the telnet service is only allowed from 10.10.100.*. It is possible to use ALL as the service
name to allow or deny ALL services.

After changing this file, xinetd should be restarted

As mentioned, super servers are not being used anymore and most distributions use
standalone services running on them. This is also called tcp wrapping since the tcp
connections are being passwd from xinetd and xinetd decides what to do with them.


**110.3 - Securing data with encryption -** **_3_**

**Objectives**

- Perform basic OpenSSH 2 client configuration and usage.
- Understand the role of OpenSSH 2 server host keys.
- Perform basic GnuPG configuration, usage and revocation.
- Understand SSH port tunnels (including X11 tunnels).

**Terms and Utilities**

- ssh
- ssh-keygen
- ssh-agent
- ssh-add
- ~/.ssh/id_rsa and id_rsa.pub
- ~/.ssh/id_dsa and id_dsa.pub
- /etc/ssh/ssh_host_rsa_key and ssh_host_rsa_key.pub
- /etc/ssh/ssh_host_dsa_key and ssh_host_dsa_key.pub
- ~/.ssh/authorized_keys
- ssh_known_hosts
- gpg
- ~/.gnupg/

**Key Pairs**

In traditional cryptography the **symmetric keys** were used: both parties had a shared password; the
files were encrypted with that password and then decrypted using the same password. These years
the **Key Pairs** are becoming more and more common. When generating a key pair, we generate two
keys using a computer algorithm in the way that any message which is encrypted using one, can be
opened only using the other key. These are called **Public &amp; Private key**. You publish the public key
to your friends and even the strangers and if they need to send an encrypted message to you,
scramble it using YOUR public key and send it to you. After receiving it, you open the file using your
PRIVATE Key.

Great point about Public / Private Key is that the data can be transmitted over the internet with no
fear of hackers or governments. You are publishing your key to the word, someone picks it and uses
it to encrypt some data and sent the result to you. People can see that you are receiving &quot;some data&quot;
but they cannot encrypt it because they do not have the private key needed to decrypt it.


**ssh key pairs**

Before using keys, we have to **generate** them. This task is as simple as running one
command:

$ **ssh-keygen**

Generating public/private rsa key pair.

Enter file in which to save the key (/home/jadi/.ssh/id_rsa):

Created directory '/home/jadi/.ssh'.

Enter passphrase (empty for no passphrase):

Enter same passphrase again:

Your identification has been saved in /home/jadi/.ssh/id_rsa.

Your public key has been saved in /home/jadi/.ssh/id_rsa.pub.

The key fingerprint is:

bc:1c:1a:da:0b:8b:22:56:da:1f:68:14:5b:da:7e:2e jadi@localhost.localdomain

The key's randomart image is:

### +-- [ RSA 2048]----+

### | |

### | |

### |.. |

### | *. |

### | +..S |

| ..oo + o |

| +oooo.o |

|oo.o E+. |

|o.. o.o. |

+----------------- +


The above process asked for a passphrase. It is used to secure our key. You can create a
password and it will be asked each time you want to use this key.

We have the option to generate keys using **different algorithms** , here I used the default RSA

and these two keys are created in ~/.ssh/:

[jadi@localhost ~]$ **ls .ssh -ltrh**

total 8.0K

- rw-r--r--. 1 jadi jadi 408 Jun 15 13:58 id_rsa.pubss -rw-
------. 1 jadi jadi 1.7K Jun 15 13:58 id_rsa

As soon as we ssh to any server, a file called **known_hosts** will save that sites public keys.

The next step is copying our public key there. For this task there is command called **ssh-copyid**.
It works like this:

</code></pre>
<p class="has-line-data" data-line-start="12127" data-line-end="12128">ssh-copy-id 10.0.2.15</p>
<pre><code class="has-line-data" data-line-start="12130" data-line-end="12136">jadi@10.0.2.15's password:

Now try logging into the machine, with &quot;ssh '10.0.2.15'&quot;, and check in:


</code></pre>
<p class="has-line-data" data-line-start="12137" data-line-end="12138">.ssh/authorized_keys</p>
<pre><code class="has-line-data" data-line-start="12140" data-line-end="12225">To make sure we haven't added extra keys that you weren't expecting.

Now we will be able to **login** into that server **without providing our password**.

There is a **key pair** called **/etc/ssh_host_rsa_key** and **/etc/ssh_host_rsa_key.pub** on any server.
These keys are used to **verify the security of the connectivity**. Server provides me its public key and
uses its private key to keep the connection secure. This is the public key the client saved in its
**~/.ssh/known_hosts**.

**ssh tunnels**

We have already discussed X forwarding.


**Encryption using gpg**

A software called **gpg** lets us use public and private keys to encrypt our data. At the
beginning we have to **create a key pair** :

**gpg --gen-key**

Then we need to share our public key to other people. To **export our public key file** we need
to run:

**gpg --export name &gt; gpg.pub**

And the other party can **import our public key** into his gpg database by:

**gpg --import gpg.pub**

At this stage, if he wants to encrypt some data to us (say the file file.txt) he should run:

**gpg --out file.txt.encrypted --recipient jadijdai@gmail.com --encrypt file.txt**

And give the file.txt.encrypted to us. For opening it, we just need to:

**gpg --out out.txt --decrypt file.txt.encrypted**

As you saw, the public keys should be shared. The B party uses A parties public key to
encrypt a data and A party uses his Private key to open it.


**Revoking keys**

What happens if you forget your key password or someone hacked your computer and acquired
your private key? In this case you have to announce to the world that &quot;I'm hacked! Do not use that
public key of mine anymore!&quot;. This is called revoking. To **create a revoke key** , run:

**gpg --output revoke.asc --gen-revoke jadijadi@gmail.com**

This tells gpg to create a **revoke file** called **revoke.asc** for the identity jadijadi@gmail.com. If
jadijadi@gmail.com needs to invalidate his public key, he have to publish this file to the internet or
key servers.

**Signing**

In the previous section we used **gpg** to ecrypt the data. We used someone’s Public key to sign and
she used her own Private Key to decrypt the text. What happens if we do this in the reverse? I mean
what happens if I encrypt something with my Private key, send it on the internet and everyone on
the internet will be able to decrypt it using my Public key which is shared with everyone - since it is
Public. This is signing!

By encrypting a document using your private key, you let everyone to try to open it using your
public key and if they succeed, they will be sure that you have signed it using YOUR private key!
gpg has a specific command to sign documents:

**gpg --clearsign originalfile**

Here the **--clearsign** tells the gpg to include the clear text message in the output file too. The output
file will be **originalfile.asc**

And another one to **verify** that a document is singed correctly:

**gpg --verify recievedfile**


Bibliography

Bresnahan, C. (e.d.). _102.1 - Design Hard Disk Layout &amp; Beyond_. Irkuprat minn
https://static1.squarespace.com/static/510bcffce4b02b65f6e3d89f/t/52ec14f8e4b0296c21
7ae388/1391203576272/Objective+102-1+Design+Hard+Disk+Layout.pdf.

Bresnahan, C. (e.d.). _Objective 101-1: Determine and Configure Hardware Settings Study Sheet_.

</code></pre>
<p class="has-line-data" data-line-start="12226" data-line-end="12230">Irkuprat minn<br>
<a href="https://static1.squarespace.com/static/510bcffce4b02b65f6e3d89f/t/52ec113de4b034d1de">https://static1.squarespace.com/static/510bcffce4b02b65f6e3d89f/t/52ec113de4b034d1de</a><br>
3335b3/1391202621555/Objective+101-<br>
1+Determine+and+Configure+Hardware+Settings.pdf.</p>
<pre><code class="has-line-data" data-line-start="12232" data-line-end="12252">Izgurskii, D. (e.d.). _lpic- 1 - study-notes_. Irkuprat minn https://github.com/Dmitrii-I/lpic- 1 - study-
notes/blob/master/exam-101.md.

Mirmirani, J. (e.d.). _LPIC1 exam guide in plain English_. Irkuprat minn
https://jadi.gitbooks.io/lpic1/content/1011_determine_and_configure_hardware_settings.h
tml.

Semaev, K. (e.d.). _lpic_1- 101_. Irkuprat minn https://github.com/ksemaev/lpic_1-101.

Shields, I. (e.d.). _Learn Linux, 101: Manage user and group accounts and related system files_. Irkuprat
minn https://developer.ibm.com/tutorials/l-lpic1- 107 - 1/.

Shields, I. (e.d.). _Learn Linux, 101: Manage user and group accounts and related system files_. Irkuprat
minn https://developer.ibm.com/tutorials/l-lpic1- 107 - 1/.

Smith, R. W. (e.d.). _LPIC-1: Linux Professional Institute Certification Study Guide._

Solutions, L. E. (e.d.). _Linux 101 Examination_. Irkuprat minn

</code></pre>
<pre><code class="has-line-data" data-line-start="12256" data-line-end="12258">
</code></pre>